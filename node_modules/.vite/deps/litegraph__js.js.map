{
  "version": 3,
  "sources": ["../../litegraph.js/build/litegraph.js"],
  "sourcesContent": ["//packer version\n\n\n(function(global) {\n    // *************************************************************\n    //   LiteGraph CLASS                                     *******\n    // *************************************************************\n\n    /**\n     * The Global Scope. It contains all the registered node classes.\n     *\n     * @class LiteGraph\n     * @constructor\n     */\n\n    var LiteGraph = (global.LiteGraph = {\n        VERSION: 0.4,\n\n        CANVAS_GRID_SIZE: 10,\n\n        NODE_TITLE_HEIGHT: 30,\n        NODE_TITLE_TEXT_Y: 20,\n        NODE_SLOT_HEIGHT: 20,\n        NODE_WIDGET_HEIGHT: 20,\n        NODE_WIDTH: 140,\n        NODE_MIN_WIDTH: 50,\n        NODE_COLLAPSED_RADIUS: 10,\n        NODE_COLLAPSED_WIDTH: 80,\n        NODE_TITLE_COLOR: \"#999\",\n        NODE_SELECTED_TITLE_COLOR: \"#FFF\",\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: \"#AAA\",\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: \"#333\",\n        NODE_DEFAULT_BGCOLOR: \"#353535\",\n        NODE_DEFAULT_BOXCOLOR: \"#666\",\n        NODE_DEFAULT_SHAPE: \"box\",\n        NODE_BOX_OUTLINE_COLOR: \"#FFF\",\n        DEFAULT_SHADOW_COLOR: \"rgba(0,0,0,0.5)\",\n        DEFAULT_GROUP_FONT: 24,\n\n        WIDGET_BGCOLOR: \"#222\",\n        WIDGET_OUTLINE_COLOR: \"#666\",\n        WIDGET_TEXT_COLOR: \"#DDD\",\n        WIDGET_SECONDARY_TEXT_COLOR: \"#999\",\n\n        LINK_COLOR: \"#9A9\",\n        EVENT_LINK_COLOR: \"#A86\",\n        CONNECTING_LINK_COLOR: \"#AFA\",\n\n        MAX_NUMBER_OF_NODES: 1000, //avoid infinite loops\n        DEFAULT_POSITION: [100, 100], //default node position\n        VALID_SHAPES: [\"default\", \"box\", \"round\", \"card\"], //,\"circle\"\n\n        //shapes are used for nodes but also for slots\n        BOX_SHAPE: 1,\n        ROUND_SHAPE: 2,\n        CIRCLE_SHAPE: 3,\n        CARD_SHAPE: 4,\n        ARROW_SHAPE: 5,\n        GRID_SHAPE: 6, // intended for slot arrays\n\n        //enums\n        INPUT: 1,\n        OUTPUT: 2,\n\n        EVENT: -1, //for outputs\n        ACTION: -1, //for inputs\n\n        NODE_MODES: [\"Always\", \"On Event\", \"Never\", \"On Trigger\"], // helper, will add \"On Request\" and more in the future\n        NODE_MODES_COLORS:[\"#666\",\"#422\",\"#333\",\"#224\",\"#626\"], // use with node_box_coloured_by_mode\n        ALWAYS: 0,\n        ON_EVENT: 1,\n        NEVER: 2,\n        ON_TRIGGER: 3,\n\n        UP: 1,\n        DOWN: 2,\n        LEFT: 3,\n        RIGHT: 4,\n        CENTER: 5,\n\n        LINK_RENDER_MODES: [\"Straight\", \"Linear\", \"Spline\"], // helper\n        STRAIGHT_LINK: 0,\n        LINEAR_LINK: 1,\n        SPLINE_LINK: 2,\n\n        NORMAL_TITLE: 0,\n        NO_TITLE: 1,\n        TRANSPARENT_TITLE: 2,\n        AUTOHIDE_TITLE: 3,\n        VERTICAL_LAYOUT: \"vertical\", // arrange nodes vertically\n\n        proxy: null, //used to redirect calls\n        node_images_path: \"\",\n\n        debug: false,\n        catch_exceptions: true,\n        throw_errors: true,\n        allow_scripts: false, //if set to true some nodes like Formula would be allowed to evaluate code that comes from unsafe sources (like node configuration), which could lead to exploits\n        use_deferred_actions: true, //executes actions during the graph execution flow\n        registered_node_types: {}, //nodetypes by string\n        node_types_by_file_extension: {}, //used for dropping files in the canvas\n        Nodes: {}, //node types by classname\n\t\tGlobals: {}, //used to store vars between graphs\n\n        searchbox_extras: {}, //used to add extra features to the search box\n        auto_sort_node_types: false, // [true!] If set to true, will automatically sort node types / categories in the context menus\n\t\t\n\t\tnode_box_coloured_when_on: false, // [true!] this make the nodes box (top left circle) coloured when triggered (execute/action), visual feedback\n        node_box_coloured_by_mode: false, // [true!] nodebox based on node mode, visual feedback\n        \n        dialog_close_on_mouse_leave: true, // [false on mobile] better true if not touch device, TODO add an helper/listener to close if false\n        dialog_close_on_mouse_leave_delay: 500,\n        \n        shift_click_do_break_link_from: false, // [false!] prefer false if results too easy to break links - implement with ALT or TODO custom keys\n        click_do_break_link_to: false, // [false!]prefer false, way too easy to break links\n        \n        search_hide_on_mouse_leave: true, // [false on mobile] better true if not touch device, TODO add an helper/listener to close if false\n        search_filter_enabled: false, // [true!] enable filtering slots type in the search widget, !requires auto_load_slot_types or manual set registered_slot_[in/out]_types and slot_types_[in/out]\n        search_show_all_on_open: true, // [true!] opens the results list when opening the search widget\n        \n        auto_load_slot_types: false, // [if want false, use true, run, get vars values to be statically set, than disable] nodes types and nodeclass association with node types need to be calculated, if dont want this, calculate once and set registered_slot_[in/out]_types and slot_types_[in/out]\n        \n\t\t// set these values if not using auto_load_slot_types\n        registered_slot_in_types: {}, // slot types for nodeclass\n        registered_slot_out_types: {}, // slot types for nodeclass\n        slot_types_in: [], // slot types IN\n        slot_types_out: [], // slot types OUT\n        slot_types_default_in: [], // specify for each IN slot type a(/many) default node(s), use single string, array, or object (with node, title, parameters, ..) like for search\n\t\tslot_types_default_out: [], // specify for each OUT slot type a(/many) default node(s), use single string, array, or object (with node, title, parameters, ..) like for search\n\t\t\n\t\talt_drag_do_clone_nodes: false, // [true!] very handy, ALT click to clone and drag the new node\n\n\t\tdo_add_triggers_slots: false, // [true!] will create and connect event slots when using action/events connections, !WILL CHANGE node mode when using onTrigger (enable mode colors), onExecuted does not need this\n\t\t\n\t\tallow_multi_output_for_events: true, // [false!] being events, it is strongly reccomended to use them sequentially, one by one\n\n\t\tmiddle_click_slot_add_default_node: false, //[true!] allows to create and connect a ndoe clicking with the third button (wheel)\n\t\t\n\t\trelease_link_on_empty_shows_menu: false, //[true!] dragging a link to empty space will open a menu, add from list, search or defaults\n\t\t\n        pointerevents_method: \"mouse\", // \"mouse\"|\"pointer\" use mouse for retrocompatibility issues? (none found @ now)\n        // TODO implement pointercancel, gotpointercapture, lostpointercapture, (pointerover, pointerout if necessary)\n\n        ctrl_shift_v_paste_connect_unselected_outputs: false, //[true!] allows ctrl + shift + v to paste nodes with the outputs of the unselected nodes connected with the inputs of the newly pasted nodes\n\n        // if true, all newly created nodes/links will use string UUIDs for their id fields instead of integers.\n        // use this if you must have node IDs that are unique across all graphs and subgraphs.\n        use_uuids: false,\n\n        /**\n         * Register a node class so it can be listed when the user wants to create a new one\n         * @method registerNodeType\n         * @param {String} type name of the node and path\n         * @param {Class} base_class class containing the structure of a node\n         */\n\n        registerNodeType: function(type, base_class) {\n            if (!base_class.prototype) {\n                throw \"Cannot register a simple object, it must be a class with a prototype\";\n            }\n            base_class.type = type;\n\n            if (LiteGraph.debug) {\n                console.log(\"Node registered: \" + type);\n            }\n\n            const classname = base_class.name;\n\n            const pos = type.lastIndexOf(\"/\");\n            base_class.category = type.substring(0, pos);\n\n            if (!base_class.title) {\n                base_class.title = classname;\n            }\n\n            //extend class\n            for (var i in LGraphNode.prototype) {\n                if (!base_class.prototype[i]) {\n                    base_class.prototype[i] = LGraphNode.prototype[i];\n                }\n            }\n\n            const prev = this.registered_node_types[type];\n            if(prev) {\n                console.log(\"replacing node type: \" + type);\n            }\n            if( !Object.prototype.hasOwnProperty.call( base_class.prototype, \"shape\") ) {\n                Object.defineProperty(base_class.prototype, \"shape\", {\n                    set: function(v) {\n                        switch (v) {\n                            case \"default\":\n                                delete this._shape;\n                                break;\n                            case \"box\":\n                                this._shape = LiteGraph.BOX_SHAPE;\n                                break;\n                            case \"round\":\n                                this._shape = LiteGraph.ROUND_SHAPE;\n                                break;\n                            case \"circle\":\n                                this._shape = LiteGraph.CIRCLE_SHAPE;\n                                break;\n                            case \"card\":\n                                this._shape = LiteGraph.CARD_SHAPE;\n                                break;\n                            default:\n                                this._shape = v;\n                        }\n                    },\n                    get: function() {\n                        return this._shape;\n                    },\n                    enumerable: true,\n                    configurable: true\n                });\n                \n\n                //used to know which nodes to create when dragging files to the canvas\n                if (base_class.supported_extensions) {\n                    for (let i in base_class.supported_extensions) {\n                        const ext = base_class.supported_extensions[i];\n                        if(ext && ext.constructor === String) {\n                            this.node_types_by_file_extension[ ext.toLowerCase() ] = base_class;\n                        }\n                    }\n                }\n            }\n\n            this.registered_node_types[type] = base_class;\n            if (base_class.constructor.name) {\n                this.Nodes[classname] = base_class;\n            }\n            if (LiteGraph.onNodeTypeRegistered) {\n                LiteGraph.onNodeTypeRegistered(type, base_class);\n            }\n            if (prev && LiteGraph.onNodeTypeReplaced) {\n                LiteGraph.onNodeTypeReplaced(type, base_class, prev);\n            }\n\n            //warnings\n            if (base_class.prototype.onPropertyChange) {\n                console.warn(\n                    \"LiteGraph node class \" +\n                        type +\n                        \" has onPropertyChange method, it must be called onPropertyChanged with d at the end\"\n                );\n            }\n            \n            // TODO one would want to know input and ouput :: this would allow through registerNodeAndSlotType to get all the slots types\n            if (this.auto_load_slot_types) {\n                new base_class(base_class.title || \"tmpnode\");\n            }\n        },\n\n        /**\n         * removes a node type from the system\n         * @method unregisterNodeType\n         * @param {String|Object} type name of the node or the node constructor itself\n         */\n        unregisterNodeType: function(type) {\n            const base_class =\n                type.constructor === String\n                    ? this.registered_node_types[type]\n                    : type;\n            if (!base_class) {\n                throw \"node type not found: \" + type;\n            }\n            delete this.registered_node_types[base_class.type];\n            if (base_class.constructor.name) {\n                delete this.Nodes[base_class.constructor.name];\n            }\n        },\n\n        /**\n        * Save a slot type and his node\n        * @method registerSlotType\n        * @param {String|Object} type name of the node or the node constructor itself\n        * @param {String} slot_type name of the slot type (variable type), eg. string, number, array, boolean, ..\n        */\n        registerNodeAndSlotType: function(type, slot_type, out){\n            out = out || false;\n            const base_class =\n                type.constructor === String &&\n                this.registered_node_types[type] !== \"anonymous\"\n                    ? this.registered_node_types[type]\n                    : type;\n\n            const class_type = base_class.constructor.type;\n\n            let allTypes = [];\n            if (typeof slot_type === \"string\") {\n                allTypes = slot_type.split(\",\");\n            } else if (slot_type == this.EVENT || slot_type == this.ACTION) {\n                allTypes = [\"_event_\"];\n            } else {\n                allTypes = [\"*\"];\n            }\n\n            for (let i = 0; i < allTypes.length; ++i) {\n                let slotType = allTypes[i];\n                if (slotType === \"\") {\n                    slotType = \"*\";\n                }\n                const registerTo = out\n                    ? \"registered_slot_out_types\"\n                    : \"registered_slot_in_types\";\n                if (this[registerTo][slotType] === undefined) {\n                    this[registerTo][slotType] = { nodes: [] };\n                }\n                if (!this[registerTo][slotType].nodes.includes(class_type)) {\n                    this[registerTo][slotType].nodes.push(class_type);\n                }\n\n                // check if is a new type\n                if (!out) {\n                    if (!this.slot_types_in.includes(slotType.toLowerCase())) {\n                        this.slot_types_in.push(slotType.toLowerCase());\n                        this.slot_types_in.sort();\n                    }\n                } else {\n                    if (!this.slot_types_out.includes(slotType.toLowerCase())) {\n                        this.slot_types_out.push(slotType.toLowerCase());\n                        this.slot_types_out.sort();\n                    }\n                }\n            }\n        },\n        \n        /**\n         * Create a new nodetype by passing an object with some properties\n         * like onCreate, inputs:Array, outputs:Array, properties, onExecute\n         * @method buildNodeClassFromObject\n         * @param {String} name node name with namespace (p.e.: 'math/sum')\n         * @param {Object} object methods expected onCreate, inputs, outputs, properties, onExecute\n         */\n         buildNodeClassFromObject: function(\n            name,\n            object\n        ) {\n            var ctor_code = \"\";\n            if(object.inputs)\n            for(var i=0; i < object.inputs.length; ++i)\n            {\n                var _name = object.inputs[i][0];\n                var _type = object.inputs[i][1];\n                if(_type && _type.constructor === String)\n                    _type = '\"'+_type+'\"';\n                ctor_code += \"this.addInput('\"+_name+\"',\"+_type+\");\\n\";\n            }\n            if(object.outputs)\n            for(var i=0; i < object.outputs.length; ++i)\n            {\n                var _name = object.outputs[i][0];\n                var _type = object.outputs[i][1];\n                if(_type && _type.constructor === String)\n                    _type = '\"'+_type+'\"';\n                ctor_code += \"this.addOutput('\"+_name+\"',\"+_type+\");\\n\";\n            }\n            if(object.properties)\n            for(var i in object.properties)\n            {\n                var prop = object.properties[i];\n                if(prop && prop.constructor === String)\n                    prop = '\"'+prop+'\"';\n                ctor_code += \"this.addProperty('\"+i+\"',\"+prop+\");\\n\";\n            }\n            ctor_code += \"if(this.onCreate)this.onCreate()\";\n            var classobj = Function(ctor_code);\n            for(var i in object)\n                if(i!=\"inputs\" && i!=\"outputs\" && i!=\"properties\")\n                    classobj.prototype[i] = object[i];\n            classobj.title = object.title || name.split(\"/\").pop();\n            classobj.desc = object.desc || \"Generated from object\";\n            this.registerNodeType(name, classobj);\n            return classobj;\n        },\n        \n        /**\n         * Create a new nodetype by passing a function, it wraps it with a proper class and generates inputs according to the parameters of the function.\n         * Useful to wrap simple methods that do not require properties, and that only process some input to generate an output.\n         * @method wrapFunctionAsNode\n         * @param {String} name node name with namespace (p.e.: 'math/sum')\n         * @param {Function} func\n         * @param {Array} param_types [optional] an array containing the type of every parameter, otherwise parameters will accept any type\n         * @param {String} return_type [optional] string with the return type, otherwise it will be generic\n         * @param {Object} properties [optional] properties to be configurable\n         */\n        wrapFunctionAsNode: function(\n            name,\n            func,\n            param_types,\n            return_type,\n            properties\n        ) {\n            var params = Array(func.length);\n            var code = \"\";\n            if(param_types !== null) //null means no inputs\n            {\n                var names = LiteGraph.getParameterNames(func);\n                for (var i = 0; i < names.length; ++i) {\n                    var type = 0;\n                    if(param_types)\n                    {\n                        //type = param_types[i] != null ? \"'\" + param_types[i] + \"'\" : \"0\";\n                        if( param_types[i] != null && param_types[i].constructor === String )\n                            type = \"'\" + param_types[i] + \"'\" ;\n                        else if( param_types[i] != null )\n                            type = param_types[i];\n                    } \n                    code +=\n                        \"this.addInput('\" +\n                        names[i] +\n                        \"',\" +\n                        type +\n                        \");\\n\";\n                }\n            }\n            if(return_type !== null) //null means no output\n            code +=\n                \"this.addOutput('out',\" +\n                (return_type != null ? (return_type.constructor === String ? \"'\" + return_type + \"'\" : return_type) : 0) +\n                \");\\n\";\n            if (properties) {\n                code +=\n                    \"this.properties = \" + JSON.stringify(properties) + \";\\n\";\n            }\n            var classobj = Function(code);\n            classobj.title = name.split(\"/\").pop();\n            classobj.desc = \"Generated from \" + func.name;\n            classobj.prototype.onExecute = function onExecute() {\n                for (var i = 0; i < params.length; ++i) {\n                    params[i] = this.getInputData(i);\n                }\n                var r = func.apply(this, params);\n                this.setOutputData(0, r);\n            };\n            this.registerNodeType(name, classobj);\n            return classobj;\n        },\n\n        /**\n         * Removes all previously registered node's types\n         */\n        clearRegisteredTypes: function() {\n            this.registered_node_types = {};\n            this.node_types_by_file_extension = {};\n            this.Nodes = {};\n            this.searchbox_extras = {};\n        },\n\n        /**\n         * Adds this method to all nodetypes, existing and to be created\n         * (You can add it to LGraphNode.prototype but then existing node types wont have it)\n         * @method addNodeMethod\n         * @param {Function} func\n         */\n        addNodeMethod: function(name, func) {\n            LGraphNode.prototype[name] = func;\n            for (var i in this.registered_node_types) {\n                var type = this.registered_node_types[i];\n                if (type.prototype[name]) {\n                    type.prototype[\"_\" + name] = type.prototype[name];\n                } //keep old in case of replacing\n                type.prototype[name] = func;\n            }\n        },\n\n        /**\n         * Create a node of a given type with a name. The node is not attached to any graph yet.\n         * @method createNode\n         * @param {String} type full name of the node class. p.e. \"math/sin\"\n         * @param {String} name a name to distinguish from other nodes\n         * @param {Object} options to set options\n         */\n\n        createNode: function(type, title, options) {\n            var base_class = this.registered_node_types[type];\n            if (!base_class) {\n                if (LiteGraph.debug) {\n                    console.log(\n                        'GraphNode type \"' + type + '\" not registered.'\n                    );\n                }\n                return null;\n            }\n\n            var prototype = base_class.prototype || base_class;\n\n            title = title || base_class.title || type;\n\n            var node = null;\n\n            if (LiteGraph.catch_exceptions) {\n                try {\n                    node = new base_class(title);\n                } catch (err) {\n                    console.error(err);\n                    return null;\n                }\n            } else {\n                node = new base_class(title);\n            }\n\n            node.type = type;\n\n            if (!node.title && title) {\n                node.title = title;\n            }\n            if (!node.properties) {\n                node.properties = {};\n            }\n            if (!node.properties_info) {\n                node.properties_info = [];\n            }\n            if (!node.flags) {\n                node.flags = {};\n            }\n            if (!node.size) {\n                node.size = node.computeSize();\n\t\t\t\t//call onresize?\n            }\n            if (!node.pos) {\n                node.pos = LiteGraph.DEFAULT_POSITION.concat();\n            }\n            if (!node.mode) {\n                node.mode = LiteGraph.ALWAYS;\n            }\n\n            //extra options\n            if (options) {\n                for (var i in options) {\n                    node[i] = options[i];\n                }\n            }\n\n\t\t\t// callback\n            if ( node.onNodeCreated ) {\n                node.onNodeCreated();\n            }\n            \n            return node;\n        },\n\n        /**\n         * Returns a registered node type with a given name\n         * @method getNodeType\n         * @param {String} type full name of the node class. p.e. \"math/sin\"\n         * @return {Class} the node class\n         */\n        getNodeType: function(type) {\n            return this.registered_node_types[type];\n        },\n\n        /**\n         * Returns a list of node types matching one category\n         * @method getNodeType\n         * @param {String} category category name\n         * @return {Array} array with all the node classes\n         */\n\n        getNodeTypesInCategory: function(category, filter) {\n            var r = [];\n            for (var i in this.registered_node_types) {\n                var type = this.registered_node_types[i];\n                if (type.filter != filter) {\n                    continue;\n                }\n\n                if (category == \"\") {\n                    if (type.category == null) {\n                        r.push(type);\n                    }\n                } else if (type.category == category) {\n                    r.push(type);\n                }\n            }\n\n            if (this.auto_sort_node_types) {\n                r.sort(function(a,b){return a.title.localeCompare(b.title)});\n            }\n\n            return r;\n        },\n\n        /**\n         * Returns a list with all the node type categories\n         * @method getNodeTypesCategories\n         * @param {String} filter only nodes with ctor.filter equal can be shown\n         * @return {Array} array with all the names of the categories\n         */\n        getNodeTypesCategories: function( filter ) {\n            var categories = { \"\": 1 };\n            for (var i in this.registered_node_types) {\n\t\t\t\tvar type = this.registered_node_types[i];\n                if ( type.category && !type.skip_list )\n                {\n\t\t\t\t\tif(type.filter != filter)\n\t\t\t\t\t\tcontinue;\n                    categories[type.category] = 1;\n                }\n            }\n            var result = [];\n            for (var i in categories) {\n                result.push(i);\n            }\n            return this.auto_sort_node_types ? result.sort() : result;\n        },\n\n        //debug purposes: reloads all the js scripts that matches a wildcard\n        reloadNodes: function(folder_wildcard) {\n            var tmp = document.getElementsByTagName(\"script\");\n            //weird, this array changes by its own, so we use a copy\n            var script_files = [];\n            for (var i=0; i < tmp.length; i++) {\n                script_files.push(tmp[i]);\n            }\n\n            var docHeadObj = document.getElementsByTagName(\"head\")[0];\n            folder_wildcard = document.location.href + folder_wildcard;\n\n            for (var i=0; i < script_files.length; i++) {\n                var src = script_files[i].src;\n                if (\n                    !src ||\n                    src.substr(0, folder_wildcard.length) != folder_wildcard\n                ) {\n                    continue;\n                }\n\n                try {\n                    if (LiteGraph.debug) {\n                        console.log(\"Reloading: \" + src);\n                    }\n                    var dynamicScript = document.createElement(\"script\");\n                    dynamicScript.type = \"text/javascript\";\n                    dynamicScript.src = src;\n                    docHeadObj.appendChild(dynamicScript);\n                    docHeadObj.removeChild(script_files[i]);\n                } catch (err) {\n                    if (LiteGraph.throw_errors) {\n                        throw err;\n                    }\n                    if (LiteGraph.debug) {\n                        console.log(\"Error while reloading \" + src);\n                    }\n                }\n            }\n\n            if (LiteGraph.debug) {\n                console.log(\"Nodes reloaded\");\n            }\n        },\n\n        //separated just to improve if it doesn't work\n        cloneObject: function(obj, target) {\n            if (obj == null) {\n                return null;\n            }\n            var r = JSON.parse(JSON.stringify(obj));\n            if (!target) {\n                return r;\n            }\n\n            for (var i in r) {\n                target[i] = r[i];\n            }\n            return target;\n        },\n\n        /*\n         * https://gist.github.com/jed/982883?permalink_comment_id=852670#gistcomment-852670\n         */\n        uuidv4: function() {\n            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16));\n        },\n\n        /**\n         * Returns if the types of two slots are compatible (taking into account wildcards, etc)\n         * @method isValidConnection\n         * @param {String} type_a\n         * @param {String} type_b\n         * @return {Boolean} true if they can be connected\n         */\n        isValidConnection: function(type_a, type_b) {\n\t\t\tif (type_a==\"\" || type_a===\"*\") type_a = 0;\n\t\t\tif (type_b==\"\" || type_b===\"*\") type_b = 0;\n            if (\n                !type_a //generic output\n                || !type_b // generic input\n                || type_a == type_b //same type (is valid for triggers)\n                || (type_a == LiteGraph.EVENT && type_b == LiteGraph.ACTION)\n            ) {\n                return true;\n            }\n\n            // Enforce string type to handle toLowerCase call (-1 number not ok)\n            type_a = String(type_a);\n            type_b = String(type_b);\n            type_a = type_a.toLowerCase();\n            type_b = type_b.toLowerCase();\n\n            // For nodes supporting multiple connection types\n            if (type_a.indexOf(\",\") == -1 && type_b.indexOf(\",\") == -1) {\n                return type_a == type_b;\n            }\n\n            // Check all permutations to see if one is valid\n            var supported_types_a = type_a.split(\",\");\n            var supported_types_b = type_b.split(\",\");\n            for (var i = 0; i < supported_types_a.length; ++i) {\n                for (var j = 0; j < supported_types_b.length; ++j) {\n                    if(this.isValidConnection(supported_types_a[i],supported_types_b[j])){\n\t\t\t\t\t//if (supported_types_a[i] == supported_types_b[j]) {\n                        return true;\n                    }\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Register a string in the search box so when the user types it it will recommend this node\n         * @method registerSearchboxExtra\n         * @param {String} node_type the node recommended\n         * @param {String} description text to show next to it\n         * @param {Object} data it could contain info of how the node should be configured\n         * @return {Boolean} true if they can be connected\n         */\n        registerSearchboxExtra: function(node_type, description, data) {\n            this.searchbox_extras[description.toLowerCase()] = {\n                type: node_type,\n                desc: description,\n                data: data\n            };\n        },\n\n        /**\n         * Wrapper to load files (from url using fetch or from file using FileReader)\n         * @method fetchFile\n         * @param {String|File|Blob} url the url of the file (or the file itself)\n         * @param {String} type an string to know how to fetch it: \"text\",\"arraybuffer\",\"json\",\"blob\"\n         * @param {Function} on_complete callback(data)\n         * @param {Function} on_error in case of an error\n         * @return {FileReader|Promise} returns the object used to \n         */\n\t\tfetchFile: function( url, type, on_complete, on_error ) {\n\t\t\tvar that = this;\n\t\t\tif(!url)\n\t\t\t\treturn null;\n\n\t\t\ttype = type || \"text\";\n\t\t\tif( url.constructor === String )\n\t\t\t{\n\t\t\t\tif (url.substr(0, 4) == \"http\" && LiteGraph.proxy) {\n\t\t\t\t\turl = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\n\t\t\t\t}\n\t\t\t\treturn fetch(url)\n\t\t\t\t.then(function(response) {\n\t\t\t\t\tif(!response.ok)\n\t\t\t\t\t\t throw new Error(\"File not found\"); //it will be catch below\n\t\t\t\t\tif(type == \"arraybuffer\")\n\t\t\t\t\t\treturn response.arrayBuffer();\n\t\t\t\t\telse if(type == \"text\" || type == \"string\")\n\t\t\t\t\t\treturn response.text();\n\t\t\t\t\telse if(type == \"json\")\n\t\t\t\t\t\treturn response.json();\n\t\t\t\t\telse if(type == \"blob\")\n\t\t\t\t\t\treturn response.blob();\n\t\t\t\t})\n\t\t\t\t.then(function(data) {\n\t\t\t\t\tif(on_complete)\n\t\t\t\t\t\ton_complete(data);\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tconsole.error(\"error fetching file:\",url);\n\t\t\t\t\tif(on_error)\n\t\t\t\t\t\ton_error(error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if( url.constructor === File || url.constructor === Blob)\n\t\t\t{\n\t\t\t\tvar reader = new FileReader();\n\t\t\t\treader.onload = function(e)\n\t\t\t\t{\n\t\t\t\t\tvar v = e.target.result;\n\t\t\t\t\tif( type == \"json\" )\n\t\t\t\t\t\tv = JSON.parse(v);\n\t\t\t\t\tif(on_complete)\n\t\t\t\t\t\ton_complete(v);\n\t\t\t\t}\n\t\t\t\tif(type == \"arraybuffer\")\n\t\t\t\t\treturn reader.readAsArrayBuffer(url);\n\t\t\t\telse if(type == \"text\" || type == \"json\")\n\t\t\t\t\treturn reader.readAsText(url);\n\t\t\t\telse if(type == \"blob\")\n\t\t\t\t\treturn reader.readAsBinaryString(url);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n    });\n\n    //timer that works everywhere\n    if (typeof performance != \"undefined\") {\n        LiteGraph.getTime = performance.now.bind(performance);\n    } else if (typeof Date != \"undefined\" && Date.now) {\n        LiteGraph.getTime = Date.now.bind(Date);\n    } else if (typeof process != \"undefined\") {\n        LiteGraph.getTime = function() {\n            var t = process.hrtime();\n            return t[0] * 0.001 + t[1] * 1e-6;\n        };\n    } else {\n        LiteGraph.getTime = function getTime() {\n            return new Date().getTime();\n        };\n    }\n\n    //*********************************************************************************\n    // LGraph CLASS\n    //*********************************************************************************\n\n    /**\n     * LGraph is the class that contain a full graph. We instantiate one and add nodes to it, and then we can run the execution loop.\n\t * supported callbacks:\n\t\t+ onNodeAdded: when a new node is added to the graph\n\t\t+ onNodeRemoved: when a node inside this graph is removed\n\t\t+ onNodeConnectionChange: some connection has changed in the graph (connected or disconnected)\n     *\n     * @class LGraph\n     * @constructor\n     * @param {Object} o data from previous serialization [optional]\n     */\n\n    function LGraph(o) {\n        if (LiteGraph.debug) {\n            console.log(\"Graph created\");\n        }\n        this.list_of_graphcanvas = null;\n        this.clear();\n\n        if (o) {\n            this.configure(o);\n        }\n    }\n\n    global.LGraph = LiteGraph.LGraph = LGraph;\n\n    //default supported types\n    LGraph.supported_types = [\"number\", \"string\", \"boolean\"];\n\n    //used to know which types of connections support this graph (some graphs do not allow certain types)\n    LGraph.prototype.getSupportedTypes = function() {\n        return this.supported_types || LGraph.supported_types;\n    };\n\n    LGraph.STATUS_STOPPED = 1;\n    LGraph.STATUS_RUNNING = 2;\n\n    /**\n     * Removes all nodes from this graph\n     * @method clear\n     */\n\n    LGraph.prototype.clear = function() {\n        this.stop();\n        this.status = LGraph.STATUS_STOPPED;\n\n        this.last_node_id = 0;\n        this.last_link_id = 0;\n\n        this._version = -1; //used to detect changes\n\n        //safe clear\n        if (this._nodes) {\n            for (var i = 0; i < this._nodes.length; ++i) {\n                var node = this._nodes[i];\n                if (node.onRemoved) {\n                    node.onRemoved();\n                }\n            }\n        }\n\n        //nodes\n        this._nodes = [];\n        this._nodes_by_id = {};\n        this._nodes_in_order = []; //nodes sorted in execution order\n        this._nodes_executable = null; //nodes that contain onExecute sorted in execution order\n\n        //other scene stuff\n        this._groups = [];\n\n        //links\n        this.links = {}; //container with all the links\n\n        //iterations\n        this.iteration = 0;\n\n        //custom data\n        this.config = {};\n\t\tthis.vars = {};\n\t\tthis.extra = {}; //to store custom data\n\n        //timing\n        this.globaltime = 0;\n        this.runningtime = 0;\n        this.fixedtime = 0;\n        this.fixedtime_lapse = 0.01;\n        this.elapsed_time = 0.01;\n        this.last_update_time = 0;\n        this.starttime = 0;\n\n        this.catch_errors = true;\n\n        this.nodes_executing = [];\n        this.nodes_actioning = [];\n        this.nodes_executedAction = [];\n        \n        //subgraph_data\n        this.inputs = {};\n        this.outputs = {};\n\n        //notify canvas to redraw\n        this.change();\n\n        this.sendActionToCanvas(\"clear\");\n    };\n\n    /**\n     * Attach Canvas to this graph\n     * @method attachCanvas\n     * @param {GraphCanvas} graph_canvas\n     */\n\n    LGraph.prototype.attachCanvas = function(graphcanvas) {\n        if (graphcanvas.constructor != LGraphCanvas) {\n            throw \"attachCanvas expects a LGraphCanvas instance\";\n        }\n        if (graphcanvas.graph && graphcanvas.graph != this) {\n            graphcanvas.graph.detachCanvas(graphcanvas);\n        }\n\n        graphcanvas.graph = this;\n\n        if (!this.list_of_graphcanvas) {\n            this.list_of_graphcanvas = [];\n        }\n        this.list_of_graphcanvas.push(graphcanvas);\n    };\n\n    /**\n     * Detach Canvas from this graph\n     * @method detachCanvas\n     * @param {GraphCanvas} graph_canvas\n     */\n    LGraph.prototype.detachCanvas = function(graphcanvas) {\n        if (!this.list_of_graphcanvas) {\n            return;\n        }\n\n        var pos = this.list_of_graphcanvas.indexOf(graphcanvas);\n        if (pos == -1) {\n            return;\n        }\n        graphcanvas.graph = null;\n        this.list_of_graphcanvas.splice(pos, 1);\n    };\n\n    /**\n     * Starts running this graph every interval milliseconds.\n     * @method start\n     * @param {number} interval amount of milliseconds between executions, if 0 then it renders to the monitor refresh rate\n     */\n\n    LGraph.prototype.start = function(interval) {\n        if (this.status == LGraph.STATUS_RUNNING) {\n            return;\n        }\n        this.status = LGraph.STATUS_RUNNING;\n\n        if (this.onPlayEvent) {\n            this.onPlayEvent();\n        }\n\n        this.sendEventToAllNodes(\"onStart\");\n\n        //launch\n        this.starttime = LiteGraph.getTime();\n        this.last_update_time = this.starttime;\n        interval = interval || 0;\n        var that = this;\n\n\t\t//execute once per frame\n        if ( interval == 0 && typeof window != \"undefined\" && window.requestAnimationFrame ) {\n            function on_frame() {\n                if (that.execution_timer_id != -1) {\n                    return;\n                }\n                window.requestAnimationFrame(on_frame);\n\t\t\t\tif(that.onBeforeStep)\n\t\t\t\t\tthat.onBeforeStep();\n                that.runStep(1, !that.catch_errors);\n\t\t\t\tif(that.onAfterStep)\n\t\t\t\t\tthat.onAfterStep();\n            }\n            this.execution_timer_id = -1;\n            on_frame();\n        } else { //execute every 'interval' ms\n            this.execution_timer_id = setInterval(function() {\n                //execute\n\t\t\t\tif(that.onBeforeStep)\n\t\t\t\t\tthat.onBeforeStep();\n                that.runStep(1, !that.catch_errors);\n\t\t\t\tif(that.onAfterStep)\n\t\t\t\t\tthat.onAfterStep();\n            }, interval);\n        }\n    };\n\n    /**\n     * Stops the execution loop of the graph\n     * @method stop execution\n     */\n\n    LGraph.prototype.stop = function() {\n        if (this.status == LGraph.STATUS_STOPPED) {\n            return;\n        }\n\n        this.status = LGraph.STATUS_STOPPED;\n\n        if (this.onStopEvent) {\n            this.onStopEvent();\n        }\n\n        if (this.execution_timer_id != null) {\n            if (this.execution_timer_id != -1) {\n                clearInterval(this.execution_timer_id);\n            }\n            this.execution_timer_id = null;\n        }\n\n        this.sendEventToAllNodes(\"onStop\");\n    };\n\n    /**\n     * Run N steps (cycles) of the graph\n     * @method runStep\n     * @param {number} num number of steps to run, default is 1\n     * @param {Boolean} do_not_catch_errors [optional] if you want to try/catch errors \n     * @param {number} limit max number of nodes to execute (used to execute from start to a node)\n     */\n\n    LGraph.prototype.runStep = function(num, do_not_catch_errors, limit ) {\n        num = num || 1;\n\n        var start = LiteGraph.getTime();\n        this.globaltime = 0.001 * (start - this.starttime);\n\n        //not optimal: executes possible pending actions in node, problem is it is not optimized\n        //it is done here as if it was done in the later loop it wont be called in the node missed the onExecute\n        \n        //from now on it will iterate only on executable nodes which is faster\n        var nodes = this._nodes_executable\n            ? this._nodes_executable\n            : this._nodes;\n        if (!nodes) {\n            return;\n        }\n\n\t\tlimit = limit || nodes.length;\n\n        if (do_not_catch_errors) {\n            //iterations\n            for (var i = 0; i < num; i++) {\n                for (var j = 0; j < limit; ++j) {\n                    var node = nodes[j];\n                    if(LiteGraph.use_deferred_actions && node._waiting_actions && node._waiting_actions.length)\n                        node.executePendingActions();\n                    if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                        //wrap node.onExecute();\n\t\t\t\t\t\tnode.doExecute();\n                    }\n                }\n\n                this.fixedtime += this.fixedtime_lapse;\n                if (this.onExecuteStep) {\n                    this.onExecuteStep();\n                }\n            }\n\n            if (this.onAfterExecute) {\n                this.onAfterExecute();\n            }\n        } else { //catch errors\n            try {\n                //iterations\n                for (var i = 0; i < num; i++) {\n                    for (var j = 0; j < limit; ++j) {\n                        var node = nodes[j];\n                        if(LiteGraph.use_deferred_actions && node._waiting_actions && node._waiting_actions.length)\n                            node.executePendingActions();\n                        if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                            node.onExecute();\n                        }\n                    }\n\n                    this.fixedtime += this.fixedtime_lapse;\n                    if (this.onExecuteStep) {\n                        this.onExecuteStep();\n                    }\n                }\n\n                if (this.onAfterExecute) {\n                    this.onAfterExecute();\n                }\n                this.errors_in_execution = false;\n            } catch (err) {\n                this.errors_in_execution = true;\n                if (LiteGraph.throw_errors) {\n                    throw err;\n                }\n                if (LiteGraph.debug) {\n                    console.log(\"Error during execution: \" + err);\n                }\n                this.stop();\n            }\n        }\n\n        var now = LiteGraph.getTime();\n        var elapsed = now - start;\n        if (elapsed == 0) {\n            elapsed = 1;\n        }\n        this.execution_time = 0.001 * elapsed;\n        this.globaltime += 0.001 * elapsed;\n        this.iteration += 1;\n        this.elapsed_time = (now - this.last_update_time) * 0.001;\n        this.last_update_time = now;\n        this.nodes_executing = [];\n        this.nodes_actioning = [];\n        this.nodes_executedAction = [];\n    };\n\n    /**\n     * Updates the graph execution order according to relevance of the nodes (nodes with only outputs have more relevance than\n     * nodes with only inputs.\n     * @method updateExecutionOrder\n     */\n    LGraph.prototype.updateExecutionOrder = function() {\n        this._nodes_in_order = this.computeExecutionOrder(false);\n        this._nodes_executable = [];\n        for (var i = 0; i < this._nodes_in_order.length; ++i) {\n            if (this._nodes_in_order[i].onExecute) {\n                this._nodes_executable.push(this._nodes_in_order[i]);\n            }\n        }\n    };\n\n    //This is more internal, it computes the executable nodes in order and returns it\n    LGraph.prototype.computeExecutionOrder = function(\n        only_onExecute,\n        set_level\n    ) {\n        var L = [];\n        var S = [];\n        var M = {};\n        var visited_links = {}; //to avoid repeating links\n        var remaining_links = {}; //to a\n\n        //search for the nodes without inputs (starting nodes)\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            var node = this._nodes[i];\n            if (only_onExecute && !node.onExecute) {\n                continue;\n            }\n\n            M[node.id] = node; //add to pending nodes\n\n            var num = 0; //num of input connections\n            if (node.inputs) {\n                for (var j = 0, l2 = node.inputs.length; j < l2; j++) {\n                    if (node.inputs[j] && node.inputs[j].link != null) {\n                        num += 1;\n                    }\n                }\n            }\n\n            if (num == 0) {\n                //is a starting node\n                S.push(node);\n                if (set_level) {\n                    node._level = 1;\n                }\n            } //num of input links\n            else {\n                if (set_level) {\n                    node._level = 0;\n                }\n                remaining_links[node.id] = num;\n            }\n        }\n\n        while (true) {\n            if (S.length == 0) {\n                break;\n            }\n\n            //get an starting node\n            var node = S.shift();\n            L.push(node); //add to ordered list\n            delete M[node.id]; //remove from the pending nodes\n\n            if (!node.outputs) {\n                continue;\n            }\n\n            //for every output\n            for (var i = 0; i < node.outputs.length; i++) {\n                var output = node.outputs[i];\n                //not connected\n                if (\n                    output == null ||\n                    output.links == null ||\n                    output.links.length == 0\n                ) {\n                    continue;\n                }\n\n                //for every connection\n                for (var j = 0; j < output.links.length; j++) {\n                    var link_id = output.links[j];\n                    var link = this.links[link_id];\n                    if (!link) {\n                        continue;\n                    }\n\n                    //already visited link (ignore it)\n                    if (visited_links[link.id]) {\n                        continue;\n                    }\n\n                    var target_node = this.getNodeById(link.target_id);\n                    if (target_node == null) {\n                        visited_links[link.id] = true;\n                        continue;\n                    }\n\n                    if (\n                        set_level &&\n                        (!target_node._level ||\n                            target_node._level <= node._level)\n                    ) {\n                        target_node._level = node._level + 1;\n                    }\n\n                    visited_links[link.id] = true; //mark as visited\n                    remaining_links[target_node.id] -= 1; //reduce the number of links remaining\n                    if (remaining_links[target_node.id] == 0) {\n                        S.push(target_node);\n                    } //if no more links, then add to starters array\n                }\n            }\n        }\n\n        //the remaining ones (loops)\n        for (var i in M) {\n            L.push(M[i]);\n        }\n\n        if (L.length != this._nodes.length && LiteGraph.debug) {\n            console.warn(\"something went wrong, nodes missing\");\n        }\n\n        var l = L.length;\n\n        //save order number in the node\n        for (var i = 0; i < l; ++i) {\n            L[i].order = i;\n        }\n\n        //sort now by priority\n        L = L.sort(function(A, B) {\n            var Ap = A.constructor.priority || A.priority || 0;\n            var Bp = B.constructor.priority || B.priority || 0;\n            if (Ap == Bp) {\n                //if same priority, sort by order\n                return A.order - B.order;\n            }\n            return Ap - Bp; //sort by priority\n        });\n\n        //save order number in the node, again...\n        for (var i = 0; i < l; ++i) {\n            L[i].order = i;\n        }\n\n        return L;\n    };\n\n    /**\n     * Returns all the nodes that could affect this one (ancestors) by crawling all the inputs recursively.\n     * It doesn't include the node itself\n     * @method getAncestors\n     * @return {Array} an array with all the LGraphNodes that affect this node, in order of execution\n     */\n    LGraph.prototype.getAncestors = function(node) {\n        var ancestors = [];\n        var pending = [node];\n        var visited = {};\n\n        while (pending.length) {\n            var current = pending.shift();\n            if (!current.inputs) {\n                continue;\n            }\n            if (!visited[current.id] && current != node) {\n                visited[current.id] = true;\n                ancestors.push(current);\n            }\n\n            for (var i = 0; i < current.inputs.length; ++i) {\n                var input = current.getInputNode(i);\n                if (input && ancestors.indexOf(input) == -1) {\n                    pending.push(input);\n                }\n            }\n        }\n\n        ancestors.sort(function(a, b) {\n            return a.order - b.order;\n        });\n        return ancestors;\n    };\n\n    /**\n     * Positions every node in a more readable manner\n     * @method arrange\n     */\n    LGraph.prototype.arrange = function (margin, layout) {\n        margin = margin || 100;\n\n        const nodes = this.computeExecutionOrder(false, true);\n        const columns = [];\n        for (let i = 0; i < nodes.length; ++i) {\n            const node = nodes[i];\n            const col = node._level || 1;\n            if (!columns[col]) {\n                columns[col] = [];\n            }\n            columns[col].push(node);\n        }\n\n        let x = margin;\n\n        for (let i = 0; i < columns.length; ++i) {\n            const column = columns[i];\n            if (!column) {\n                continue;\n            }\n            let max_size = 100;\n            let y = margin + LiteGraph.NODE_TITLE_HEIGHT;\n            for (let j = 0; j < column.length; ++j) {\n                const node = column[j];\n                node.pos[0] = (layout == LiteGraph.VERTICAL_LAYOUT) ? y : x;\n                node.pos[1] = (layout == LiteGraph.VERTICAL_LAYOUT) ? x : y;\n                const max_size_index = (layout == LiteGraph.VERTICAL_LAYOUT) ? 1 : 0;\n                if (node.size[max_size_index] > max_size) {\n                    max_size = node.size[max_size_index];\n                }\n                const node_size_index = (layout == LiteGraph.VERTICAL_LAYOUT) ? 0 : 1;\n                y += node.size[node_size_index] + margin + LiteGraph.NODE_TITLE_HEIGHT;\n            }\n            x += max_size + margin;\n        }\n\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * Returns the amount of time the graph has been running in milliseconds\n     * @method getTime\n     * @return {number} number of milliseconds the graph has been running\n     */\n    LGraph.prototype.getTime = function() {\n        return this.globaltime;\n    };\n\n    /**\n     * Returns the amount of time accumulated using the fixedtime_lapse var. This is used in context where the time increments should be constant\n     * @method getFixedTime\n     * @return {number} number of milliseconds the graph has been running\n     */\n\n    LGraph.prototype.getFixedTime = function() {\n        return this.fixedtime;\n    };\n\n    /**\n     * Returns the amount of time it took to compute the latest iteration. Take into account that this number could be not correct\n     * if the nodes are using graphical actions\n     * @method getElapsedTime\n     * @return {number} number of milliseconds it took the last cycle\n     */\n\n    LGraph.prototype.getElapsedTime = function() {\n        return this.elapsed_time;\n    };\n\n    /**\n     * Sends an event to all the nodes, useful to trigger stuff\n     * @method sendEventToAllNodes\n     * @param {String} eventname the name of the event (function to be called)\n     * @param {Array} params parameters in array format\n     */\n    LGraph.prototype.sendEventToAllNodes = function(eventname, params, mode) {\n        mode = mode || LiteGraph.ALWAYS;\n\n        var nodes = this._nodes_in_order ? this._nodes_in_order : this._nodes;\n        if (!nodes) {\n            return;\n        }\n\n        for (var j = 0, l = nodes.length; j < l; ++j) {\n            var node = nodes[j];\n\n            if (\n                node.constructor === LiteGraph.Subgraph &&\n                eventname != \"onExecute\"\n            ) {\n                if (node.mode == mode) {\n                    node.sendEventToAllNodes(eventname, params, mode);\n                }\n                continue;\n            }\n\n            if (!node[eventname] || node.mode != mode) {\n                continue;\n            }\n            if (params === undefined) {\n                node[eventname]();\n            } else if (params && params.constructor === Array) {\n                node[eventname].apply(node, params);\n            } else {\n                node[eventname](params);\n            }\n        }\n    };\n\n    LGraph.prototype.sendActionToCanvas = function(action, params) {\n        if (!this.list_of_graphcanvas) {\n            return;\n        }\n\n        for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n            var c = this.list_of_graphcanvas[i];\n            if (c[action]) {\n                c[action].apply(c, params);\n            }\n        }\n    };\n\n    /**\n     * Adds a new node instance to this graph\n     * @method add\n     * @param {LGraphNode} node the instance of the node\n     */\n\n    LGraph.prototype.add = function(node, skip_compute_order) {\n        if (!node) {\n            return;\n        }\n\n        //groups\n        if (node.constructor === LGraphGroup) {\n            this._groups.push(node);\n            this.setDirtyCanvas(true);\n            this.change();\n            node.graph = this;\n            this._version++;\n            return;\n        }\n\n        //nodes\n        if (node.id != -1 && this._nodes_by_id[node.id] != null) {\n            console.warn(\n                \"LiteGraph: there is already a node with this ID, changing it\"\n            );\n            if (LiteGraph.use_uuids) {\n                node.id = LiteGraph.uuidv4();\n            }\n            else {\n                node.id = ++this.last_node_id;\n            }\n        }\n\n        if (this._nodes.length >= LiteGraph.MAX_NUMBER_OF_NODES) {\n            throw \"LiteGraph: max number of nodes in a graph reached\";\n        }\n\n        //give him an id\n        if (LiteGraph.use_uuids) {\n            if (node.id == null || node.id == -1)\n                node.id = LiteGraph.uuidv4();\n        }\n        else {\n            if (node.id == null || node.id == -1) {\n                node.id = ++this.last_node_id;\n            } else if (this.last_node_id < node.id) {\n                this.last_node_id = node.id;\n            }\n        }\n\n        node.graph = this;\n        this._version++;\n\n        this._nodes.push(node);\n        this._nodes_by_id[node.id] = node;\n\n        if (node.onAdded) {\n            node.onAdded(this);\n        }\n\n        if (this.config.align_to_grid) {\n            node.alignToGrid();\n        }\n\n        if (!skip_compute_order) {\n            this.updateExecutionOrder();\n        }\n\n        if (this.onNodeAdded) {\n            this.onNodeAdded(node);\n        }\n\n        this.setDirtyCanvas(true);\n        this.change();\n\n        return node; //to chain actions\n    };\n\n    /**\n     * Removes a node from the graph\n     * @method remove\n     * @param {LGraphNode} node the instance of the node\n     */\n\n    LGraph.prototype.remove = function(node) {\n        if (node.constructor === LiteGraph.LGraphGroup) {\n            var index = this._groups.indexOf(node);\n            if (index != -1) {\n                this._groups.splice(index, 1);\n            }\n            node.graph = null;\n            this._version++;\n            this.setDirtyCanvas(true, true);\n            this.change();\n            return;\n        }\n\n        if (this._nodes_by_id[node.id] == null) {\n            return;\n        } //not found\n\n        if (node.ignore_remove) {\n            return;\n        } //cannot be removed\n\n\t\tthis.beforeChange(); //sure? - almost sure is wrong\n\n        //disconnect inputs\n        if (node.inputs) {\n            for (var i = 0; i < node.inputs.length; i++) {\n                var slot = node.inputs[i];\n                if (slot.link != null) {\n                    node.disconnectInput(i);\n                }\n            }\n        }\n\n        //disconnect outputs\n        if (node.outputs) {\n            for (var i = 0; i < node.outputs.length; i++) {\n                var slot = node.outputs[i];\n                if (slot.links != null && slot.links.length) {\n                    node.disconnectOutput(i);\n                }\n            }\n        }\n\n        //node.id = -1; //why?\n\n        //callback\n        if (node.onRemoved) {\n            node.onRemoved();\n        }\n\n        node.graph = null;\n        this._version++;\n\n        //remove from canvas render\n        if (this.list_of_graphcanvas) {\n            for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n                var canvas = this.list_of_graphcanvas[i];\n                if (canvas.selected_nodes[node.id]) {\n                    delete canvas.selected_nodes[node.id];\n                }\n                if (canvas.node_dragged == node) {\n                    canvas.node_dragged = null;\n                }\n            }\n        }\n\n        //remove from containers\n        var pos = this._nodes.indexOf(node);\n        if (pos != -1) {\n            this._nodes.splice(pos, 1);\n        }\n        delete this._nodes_by_id[node.id];\n\n        if (this.onNodeRemoved) {\n            this.onNodeRemoved(node);\n        }\n\n\t\t//close panels\n\t\tthis.sendActionToCanvas(\"checkPanels\");\n\n        this.setDirtyCanvas(true, true);\n\t\tthis.afterChange(); //sure? - almost sure is wrong\n        this.change();\n\n        this.updateExecutionOrder();\n    };\n\n    /**\n     * Returns a node by its id.\n     * @method getNodeById\n     * @param {Number} id\n     */\n\n    LGraph.prototype.getNodeById = function(id) {\n        if (id == null) {\n            return null;\n        }\n        return this._nodes_by_id[id];\n    };\n\n    /**\n     * Returns a list of nodes that matches a class\n     * @method findNodesByClass\n     * @param {Class} classObject the class itself (not an string)\n     * @return {Array} a list with all the nodes of this type\n     */\n    LGraph.prototype.findNodesByClass = function(classObject, result) {\n        result = result || [];\n        result.length = 0;\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].constructor === classObject) {\n                result.push(this._nodes[i]);\n            }\n        }\n        return result;\n    };\n\n    /**\n     * Returns a list of nodes that matches a type\n     * @method findNodesByType\n     * @param {String} type the name of the node type\n     * @return {Array} a list with all the nodes of this type\n     */\n    LGraph.prototype.findNodesByType = function(type, result) {\n        var type = type.toLowerCase();\n        result = result || [];\n        result.length = 0;\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].type.toLowerCase() == type) {\n                result.push(this._nodes[i]);\n            }\n        }\n        return result;\n    };\n\n    /**\n     * Returns the first node that matches a name in its title\n     * @method findNodeByTitle\n     * @param {String} name the name of the node to search\n     * @return {Node} the node or null\n     */\n    LGraph.prototype.findNodeByTitle = function(title) {\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].title == title) {\n                return this._nodes[i];\n            }\n        }\n        return null;\n    };\n\n    /**\n     * Returns a list of nodes that matches a name\n     * @method findNodesByTitle\n     * @param {String} name the name of the node to search\n     * @return {Array} a list with all the nodes with this name\n     */\n    LGraph.prototype.findNodesByTitle = function(title) {\n        var result = [];\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].title == title) {\n                result.push(this._nodes[i]);\n            }\n        }\n        return result;\n    };\n\n    /**\n     * Returns the top-most node in this position of the canvas\n     * @method getNodeOnPos\n     * @param {number} x the x coordinate in canvas space\n     * @param {number} y the y coordinate in canvas space\n     * @param {Array} nodes_list a list with all the nodes to search from, by default is all the nodes in the graph\n     * @return {LGraphNode} the node at this position or null\n     */\n    LGraph.prototype.getNodeOnPos = function(x, y, nodes_list, margin) {\n        nodes_list = nodes_list || this._nodes;\n\t\tvar nRet = null;\n        for (var i = nodes_list.length - 1; i >= 0; i--) {\n            var n = nodes_list[i];\n            if (n.isPointInside(x, y, margin)) {\n                // check for lesser interest nodes (TODO check for overlapping, use the top)\n\t\t\t\t/*if (typeof n == \"LGraphGroup\"){\n\t\t\t\t\tnRet = n;\n\t\t\t\t}else{*/\n\t\t\t\t\treturn n;\n\t\t\t\t/*}*/\n            }\n        }\n        return nRet;\n    };\n\n    /**\n     * Returns the top-most group in that position\n     * @method getGroupOnPos\n     * @param {number} x the x coordinate in canvas space\n     * @param {number} y the y coordinate in canvas space\n     * @return {LGraphGroup} the group or null\n     */\n    LGraph.prototype.getGroupOnPos = function(x, y) {\n        for (var i = this._groups.length - 1; i >= 0; i--) {\n            var g = this._groups[i];\n            if (g.isPointInside(x, y, 2, true)) {\n                return g;\n            }\n        }\n        return null;\n    };\n\n    /**\n     * Checks that the node type matches the node type registered, used when replacing a nodetype by a newer version during execution\n     * this replaces the ones using the old version with the new version\n     * @method checkNodeTypes\n     */\n    LGraph.prototype.checkNodeTypes = function() {\n        var changes = false;\n        for (var i = 0; i < this._nodes.length; i++) {\n            var node = this._nodes[i];\n            var ctor = LiteGraph.registered_node_types[node.type];\n            if (node.constructor == ctor) {\n                continue;\n            }\n            console.log(\"node being replaced by newer version: \" + node.type);\n            var newnode = LiteGraph.createNode(node.type);\n            changes = true;\n            this._nodes[i] = newnode;\n            newnode.configure(node.serialize());\n            newnode.graph = this;\n            this._nodes_by_id[newnode.id] = newnode;\n            if (node.inputs) {\n                newnode.inputs = node.inputs.concat();\n            }\n            if (node.outputs) {\n                newnode.outputs = node.outputs.concat();\n            }\n        }\n        this.updateExecutionOrder();\n    };\n\n    // ********** GLOBALS *****************\n\n    LGraph.prototype.onAction = function(action, param, options) {\n        this._input_nodes = this.findNodesByClass(\n            LiteGraph.GraphInput,\n            this._input_nodes\n        );\n        for (var i = 0; i < this._input_nodes.length; ++i) {\n            var node = this._input_nodes[i];\n            if (node.properties.name != action) {\n                continue;\n            }\n            //wrap node.onAction(action, param);\n            node.actionDo(action, param, options);\n            break;\n        }\n    };\n\n    LGraph.prototype.trigger = function(action, param) {\n        if (this.onTrigger) {\n            this.onTrigger(action, param);\n        }\n    };\n\n    /**\n     * Tell this graph it has a global graph input of this type\n     * @method addGlobalInput\n     * @param {String} name\n     * @param {String} type\n     * @param {*} value [optional]\n     */\n    LGraph.prototype.addInput = function(name, type, value) {\n        var input = this.inputs[name];\n        if (input) {\n            //already exist\n            return;\n        }\n\n\t\tthis.beforeChange();\n        this.inputs[name] = { name: name, type: type, value: value };\n        this._version++;\n\t\tthis.afterChange();\n\n        if (this.onInputAdded) {\n            this.onInputAdded(name, type);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Assign a data to the global graph input\n     * @method setGlobalInputData\n     * @param {String} name\n     * @param {*} data\n     */\n    LGraph.prototype.setInputData = function(name, data) {\n        var input = this.inputs[name];\n        if (!input) {\n            return;\n        }\n        input.value = data;\n    };\n\n    /**\n     * Returns the current value of a global graph input\n     * @method getInputData\n     * @param {String} name\n     * @return {*} the data\n     */\n    LGraph.prototype.getInputData = function(name) {\n        var input = this.inputs[name];\n        if (!input) {\n            return null;\n        }\n        return input.value;\n    };\n\n    /**\n     * Changes the name of a global graph input\n     * @method renameInput\n     * @param {String} old_name\n     * @param {String} new_name\n     */\n    LGraph.prototype.renameInput = function(old_name, name) {\n        if (name == old_name) {\n            return;\n        }\n\n        if (!this.inputs[old_name]) {\n            return false;\n        }\n\n        if (this.inputs[name]) {\n            console.error(\"there is already one input with that name\");\n            return false;\n        }\n\n        this.inputs[name] = this.inputs[old_name];\n        delete this.inputs[old_name];\n        this._version++;\n\n        if (this.onInputRenamed) {\n            this.onInputRenamed(old_name, name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Changes the type of a global graph input\n     * @method changeInputType\n     * @param {String} name\n     * @param {String} type\n     */\n    LGraph.prototype.changeInputType = function(name, type) {\n        if (!this.inputs[name]) {\n            return false;\n        }\n\n        if (\n            this.inputs[name].type &&\n            String(this.inputs[name].type).toLowerCase() ==\n                String(type).toLowerCase()\n        ) {\n            return;\n        }\n\n        this.inputs[name].type = type;\n        this._version++;\n        if (this.onInputTypeChanged) {\n            this.onInputTypeChanged(name, type);\n        }\n    };\n\n    /**\n     * Removes a global graph input\n     * @method removeInput\n     * @param {String} name\n     * @param {String} type\n     */\n    LGraph.prototype.removeInput = function(name) {\n        if (!this.inputs[name]) {\n            return false;\n        }\n\n        delete this.inputs[name];\n        this._version++;\n\n        if (this.onInputRemoved) {\n            this.onInputRemoved(name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n        return true;\n    };\n\n    /**\n     * Creates a global graph output\n     * @method addOutput\n     * @param {String} name\n     * @param {String} type\n     * @param {*} value\n     */\n    LGraph.prototype.addOutput = function(name, type, value) {\n        this.outputs[name] = { name: name, type: type, value: value };\n        this._version++;\n\n        if (this.onOutputAdded) {\n            this.onOutputAdded(name, type);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Assign a data to the global output\n     * @method setOutputData\n     * @param {String} name\n     * @param {String} value\n     */\n    LGraph.prototype.setOutputData = function(name, value) {\n        var output = this.outputs[name];\n        if (!output) {\n            return;\n        }\n        output.value = value;\n    };\n\n    /**\n     * Returns the current value of a global graph output\n     * @method getOutputData\n     * @param {String} name\n     * @return {*} the data\n     */\n    LGraph.prototype.getOutputData = function(name) {\n        var output = this.outputs[name];\n        if (!output) {\n            return null;\n        }\n        return output.value;\n    };\n\n    /**\n     * Renames a global graph output\n     * @method renameOutput\n     * @param {String} old_name\n     * @param {String} new_name\n     */\n    LGraph.prototype.renameOutput = function(old_name, name) {\n        if (!this.outputs[old_name]) {\n            return false;\n        }\n\n        if (this.outputs[name]) {\n            console.error(\"there is already one output with that name\");\n            return false;\n        }\n\n        this.outputs[name] = this.outputs[old_name];\n        delete this.outputs[old_name];\n        this._version++;\n\n        if (this.onOutputRenamed) {\n            this.onOutputRenamed(old_name, name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Changes the type of a global graph output\n     * @method changeOutputType\n     * @param {String} name\n     * @param {String} type\n     */\n    LGraph.prototype.changeOutputType = function(name, type) {\n        if (!this.outputs[name]) {\n            return false;\n        }\n\n        if (\n            this.outputs[name].type &&\n            String(this.outputs[name].type).toLowerCase() ==\n                String(type).toLowerCase()\n        ) {\n            return;\n        }\n\n        this.outputs[name].type = type;\n        this._version++;\n        if (this.onOutputTypeChanged) {\n            this.onOutputTypeChanged(name, type);\n        }\n    };\n\n    /**\n     * Removes a global graph output\n     * @method removeOutput\n     * @param {String} name\n     */\n    LGraph.prototype.removeOutput = function(name) {\n        if (!this.outputs[name]) {\n            return false;\n        }\n        delete this.outputs[name];\n        this._version++;\n\n        if (this.onOutputRemoved) {\n            this.onOutputRemoved(name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n        return true;\n    };\n\n    LGraph.prototype.triggerInput = function(name, value) {\n        var nodes = this.findNodesByTitle(name);\n        for (var i = 0; i < nodes.length; ++i) {\n            nodes[i].onTrigger(value);\n        }\n    };\n\n    LGraph.prototype.setCallback = function(name, func) {\n        var nodes = this.findNodesByTitle(name);\n        for (var i = 0; i < nodes.length; ++i) {\n            nodes[i].setTrigger(func);\n        }\n    };\n\n\t//used for undo, called before any change is made to the graph\n    LGraph.prototype.beforeChange = function(info) {\n        if (this.onBeforeChange) {\n            this.onBeforeChange(this,info);\n        }\n        this.sendActionToCanvas(\"onBeforeChange\", this);\n    };\n\n\t//used to resend actions, called after any change is made to the graph\n    LGraph.prototype.afterChange = function(info) {\n        if (this.onAfterChange) {\n            this.onAfterChange(this,info);\n        }\n        this.sendActionToCanvas(\"onAfterChange\", this);\n    };\n\n    LGraph.prototype.connectionChange = function(node, link_info) {\n        this.updateExecutionOrder();\n        if (this.onConnectionChange) {\n            this.onConnectionChange(node);\n        }\n        this._version++;\n        this.sendActionToCanvas(\"onConnectionChange\");\n    };\n\n    /**\n     * returns if the graph is in live mode\n     * @method isLive\n     */\n\n    LGraph.prototype.isLive = function() {\n        if (!this.list_of_graphcanvas) {\n            return false;\n        }\n\n        for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n            var c = this.list_of_graphcanvas[i];\n            if (c.live_mode) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * clears the triggered slot animation in all links (stop visual animation)\n     * @method clearTriggeredSlots\n     */\n    LGraph.prototype.clearTriggeredSlots = function() {\n        for (var i in this.links) {\n            var link_info = this.links[i];\n            if (!link_info) {\n                continue;\n            }\n            if (link_info._last_time) {\n                link_info._last_time = 0;\n            }\n        }\n    };\n\n    /* Called when something visually changed (not the graph!) */\n    LGraph.prototype.change = function() {\n        if (LiteGraph.debug) {\n            console.log(\"Graph changed\");\n        }\n        this.sendActionToCanvas(\"setDirty\", [true, true]);\n        if (this.on_change) {\n            this.on_change(this);\n        }\n    };\n\n    LGraph.prototype.setDirtyCanvas = function(fg, bg) {\n        this.sendActionToCanvas(\"setDirty\", [fg, bg]);\n    };\n\n    /**\n     * Destroys a link\n     * @method removeLink\n     * @param {Number} link_id\n     */\n    LGraph.prototype.removeLink = function(link_id) {\n        var link = this.links[link_id];\n        if (!link) {\n            return;\n        }\n        var node = this.getNodeById(link.target_id);\n        if (node) {\n            node.disconnectInput(link.target_slot);\n        }\n    };\n\n    //save and recover app state ***************************************\n    /**\n     * Creates a Object containing all the info about this graph, it can be serialized\n     * @method serialize\n     * @return {Object} value of the node\n     */\n    LGraph.prototype.serialize = function() {\n        var nodes_info = [];\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            nodes_info.push(this._nodes[i].serialize());\n        }\n\n        //pack link info into a non-verbose format\n        var links = [];\n        for (var i in this.links) {\n            //links is an OBJECT\n            var link = this.links[i];\n            if (!link.serialize) {\n                //weird bug I havent solved yet\n                console.warn(\n                    \"weird LLink bug, link info is not a LLink but a regular object\"\n                );\n                var link2 = new LLink();\n                for (var j in link) { \n                    link2[j] = link[j];\n                }\n                this.links[i] = link2;\n                link = link2;\n            }\n\n            links.push(link.serialize());\n        }\n\n        var groups_info = [];\n        for (var i = 0; i < this._groups.length; ++i) {\n            groups_info.push(this._groups[i].serialize());\n        }\n\n        var data = {\n            last_node_id: this.last_node_id,\n            last_link_id: this.last_link_id,\n            nodes: nodes_info,\n            links: links,\n            groups: groups_info,\n            config: this.config,\n\t\t\textra: this.extra,\n            version: LiteGraph.VERSION\n        };\n\n\t\tif(this.onSerialize)\n\t\t\tthis.onSerialize(data);\n\n        return data;\n    };\n\n    /**\n     * Configure a graph from a JSON string\n     * @method configure\n     * @param {String} str configure a graph from a JSON string\n     * @param {Boolean} returns if there was any error parsing\n     */\n    LGraph.prototype.configure = function(data, keep_old) {\n        if (!data) {\n            return;\n        }\n\n        if (!keep_old) {\n            this.clear();\n        }\n\n        var nodes = data.nodes;\n\n        //decode links info (they are very verbose)\n        if (data.links && data.links.constructor === Array) {\n            var links = [];\n            for (var i = 0; i < data.links.length; ++i) {\n                var link_data = data.links[i];\n\t\t\t\tif(!link_data) //weird bug\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(\"serialized graph link data contains errors, skipping.\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n                var link = new LLink();\n                link.configure(link_data);\n                links[link.id] = link;\n            }\n            data.links = links;\n        }\n\n        //copy all stored fields\n        for (var i in data) {\n\t\t\tif(i == \"nodes\" || i == \"groups\" ) //links must be accepted\n\t\t\t\tcontinue;\n            this[i] = data[i];\n        }\n\n        var error = false;\n\n        //create nodes\n        this._nodes = [];\n        if (nodes) {\n            for (var i = 0, l = nodes.length; i < l; ++i) {\n                var n_info = nodes[i]; //stored info\n                var node = LiteGraph.createNode(n_info.type, n_info.title);\n                if (!node) {\n                    if (LiteGraph.debug) {\n                        console.log(\n                            \"Node not found or has errors: \" + n_info.type\n                        );\n                    }\n\n                    //in case of error we create a replacement node to avoid losing info\n                    node = new LGraphNode();\n                    node.last_serialization = n_info;\n                    node.has_errors = true;\n                    error = true;\n                    //continue;\n                }\n\n                node.id = n_info.id; //id it or it will create a new id\n                this.add(node, true); //add before configure, otherwise configure cannot create links\n            }\n\n            //configure nodes afterwards so they can reach each other\n            for (var i = 0, l = nodes.length; i < l; ++i) {\n                var n_info = nodes[i];\n                var node = this.getNodeById(n_info.id);\n                if (node) {\n                    node.configure(n_info);\n                }\n            }\n        }\n\n        //groups\n        this._groups.length = 0;\n        if (data.groups) {\n            for (var i = 0; i < data.groups.length; ++i) {\n                var group = new LiteGraph.LGraphGroup();\n                group.configure(data.groups[i]);\n                this.add(group);\n            }\n        }\n\n        this.updateExecutionOrder();\n\n\t\tthis.extra = data.extra || {};\n\n\t\tif(this.onConfigure)\n\t\t\tthis.onConfigure(data);\n\n        this._version++;\n        this.setDirtyCanvas(true, true);\n        return error;\n    };\n\n    LGraph.prototype.load = function(url, callback) {\n        var that = this;\n\n\t\t//from file\n\t\tif(url.constructor === File || url.constructor === Blob)\n\t\t{\n\t\t\tvar reader = new FileReader();\n\t\t\treader.addEventListener('load', function(event) {\n\t\t\t\tvar data = JSON.parse(event.target.result);\n\t\t\t\tthat.configure(data);\n\t\t\t\tif(callback)\n\t\t\t\t\tcallback();\n\t\t\t});\n\t\t\t\n\t\t\treader.readAsText(url);\n\t\t\treturn;\n\t\t}\n\n\t\t//is a string, then an URL\n        var req = new XMLHttpRequest();\n        req.open(\"GET\", url, true);\n        req.send(null);\n        req.onload = function(oEvent) {\n            if (req.status !== 200) {\n                console.error(\"Error loading graph:\", req.status, req.response);\n                return;\n            }\n            var data = JSON.parse( req.response );\n            that.configure(data);\n\t\t\tif(callback)\n\t\t\t\tcallback();\n        };\n        req.onerror = function(err) {\n            console.error(\"Error loading graph:\", err);\n        };\n    };\n\n    LGraph.prototype.onNodeTrace = function(node, msg, color) {\n        //TODO\n    };\n\n    //this is the class in charge of storing link information\n    function LLink(id, type, origin_id, origin_slot, target_id, target_slot) {\n        this.id = id;\n        this.type = type;\n        this.origin_id = origin_id;\n        this.origin_slot = origin_slot;\n        this.target_id = target_id;\n        this.target_slot = target_slot;\n\n        this._data = null;\n        this._pos = new Float32Array(2); //center\n    }\n\n    LLink.prototype.configure = function(o) {\n        if (o.constructor === Array) {\n            this.id = o[0];\n            this.origin_id = o[1];\n            this.origin_slot = o[2];\n            this.target_id = o[3];\n            this.target_slot = o[4];\n            this.type = o[5];\n        } else {\n            this.id = o.id;\n            this.type = o.type;\n            this.origin_id = o.origin_id;\n            this.origin_slot = o.origin_slot;\n            this.target_id = o.target_id;\n            this.target_slot = o.target_slot;\n        }\n    };\n\n    LLink.prototype.serialize = function() {\n        return [\n            this.id,\n            this.origin_id,\n            this.origin_slot,\n            this.target_id,\n            this.target_slot,\n            this.type\n        ];\n    };\n\n    LiteGraph.LLink = LLink;\n\n    // *************************************************************\n    //   Node CLASS                                          *******\n    // *************************************************************\n\n    /*\n\ttitle: string\n\tpos: [x,y]\n\tsize: [x,y]\n\n\tinput|output: every connection\n\t\t+  { name:string, type:string, pos: [x,y]=Optional, direction: \"input\"|\"output\", links: Array });\n\n\tgeneral properties:\n\t\t+ clip_area: if you render outside the node, it will be clipped\n\t\t+ unsafe_execution: not allowed for safe execution\n\t\t+ skip_repeated_outputs: when adding new outputs, it wont show if there is one already connected\n\t\t+ resizable: if set to false it wont be resizable with the mouse\n\t\t+ horizontal: slots are distributed horizontally\n\t\t+ widgets_start_y: widgets start at y distance from the top of the node\n\t\n\tflags object:\n\t\t+ collapsed: if it is collapsed\n\n\tsupported callbacks:\n\t\t+ onAdded: when added to graph (warning: this is called BEFORE the node is configured when loading)\n\t\t+ onRemoved: when removed from graph\n\t\t+ onStart:\twhen the graph starts playing\n\t\t+ onStop:\twhen the graph stops playing\n\t\t+ onDrawForeground: render the inside widgets inside the node\n\t\t+ onDrawBackground: render the background area inside the node (only in edit mode)\n\t\t+ onMouseDown\n\t\t+ onMouseMove\n\t\t+ onMouseUp\n\t\t+ onMouseEnter\n\t\t+ onMouseLeave\n\t\t+ onExecute: execute the node\n\t\t+ onPropertyChanged: when a property is changed in the panel (return true to skip default behaviour)\n\t\t+ onGetInputs: returns an array of possible inputs\n\t\t+ onGetOutputs: returns an array of possible outputs\n\t\t+ onBounding: in case this node has a bigger bounding than the node itself (the callback receives the bounding as [x,y,w,h])\n\t\t+ onDblClick: double clicked in the node\n\t\t+ onInputDblClick: input slot double clicked (can be used to automatically create a node connected)\n\t\t+ onOutputDblClick: output slot double clicked (can be used to automatically create a node connected)\n\t\t+ onConfigure: called after the node has been configured\n\t\t+ onSerialize: to add extra info when serializing (the callback receives the object that should be filled with the data)\n\t\t+ onSelected\n\t\t+ onDeselected\n\t\t+ onDropItem : DOM item dropped over the node\n\t\t+ onDropFile : file dropped over the node\n\t\t+ onConnectInput : if returns false the incoming connection will be canceled\n\t\t+ onConnectionsChange : a connection changed (new one or removed) (LiteGraph.INPUT or LiteGraph.OUTPUT, slot, true if connected, link_info, input_info )\n\t\t+ onAction: action slot triggered\n\t\t+ getExtraMenuOptions: to add option to context menu\n*/\n\n    /**\n     * Base Class for all the node type classes\n     * @class LGraphNode\n     * @param {String} name a name for the node\n     */\n\n    function LGraphNode(title) {\n        this._ctor(title);\n    }\n\n    global.LGraphNode = LiteGraph.LGraphNode = LGraphNode;\n\n    LGraphNode.prototype._ctor = function(title) {\n        this.title = title || \"Unnamed\";\n        this.size = [LiteGraph.NODE_WIDTH, 60];\n        this.graph = null;\n\n        this._pos = new Float32Array(10, 10);\n\n        Object.defineProperty(this, \"pos\", {\n            set: function(v) {\n                if (!v || v.length < 2) {\n                    return;\n                }\n                this._pos[0] = v[0];\n                this._pos[1] = v[1];\n            },\n            get: function() {\n                return this._pos;\n            },\n            enumerable: true\n        });\n\n        if (LiteGraph.use_uuids) {\n            this.id = LiteGraph.uuidv4();\n        }\n        else {\n            this.id = -1; //not know till not added\n        }\n        this.type = null;\n\n        //inputs available: array of inputs\n        this.inputs = [];\n        this.outputs = [];\n        this.connections = [];\n\n        //local data\n        this.properties = {}; //for the values\n        this.properties_info = []; //for the info\n\n        this.flags = {};\n    };\n\n    /**\n     * configure a node from an object containing the serialized info\n     * @method configure\n     */\n    LGraphNode.prototype.configure = function(info) {\n        if (this.graph) {\n            this.graph._version++;\n        }\n        for (var j in info) {\n            if (j == \"properties\") {\n                //i don't want to clone properties, I want to reuse the old container\n                for (var k in info.properties) {\n                    this.properties[k] = info.properties[k];\n                    if (this.onPropertyChanged) {\n                        this.onPropertyChanged( k, info.properties[k] );\n                    }\n                }\n                continue;\n            }\n\n            if (info[j] == null) {\n                continue;\n            } else if (typeof info[j] == \"object\") {\n                //object\n                if (this[j] && this[j].configure) {\n                    this[j].configure(info[j]);\n                } else {\n                    this[j] = LiteGraph.cloneObject(info[j], this[j]);\n                }\n            } //value\n            else {\n                this[j] = info[j];\n            }\n        }\n\n        if (!info.title) {\n            this.title = this.constructor.title;\n        }\n\n\t\tif (this.inputs) {\n\t\t\tfor (var i = 0; i < this.inputs.length; ++i) {\n\t\t\t\tvar input = this.inputs[i];\n\t\t\t\tvar link_info = this.graph ? this.graph.links[input.link] : null;\n\t\t\t\tif (this.onConnectionsChange)\n\t\t\t\t\tthis.onConnectionsChange( LiteGraph.INPUT, i, true, link_info, input ); //link_info has been created now, so its updated\n\n\t\t\t\tif( this.onInputAdded )\n\t\t\t\t\tthis.onInputAdded(input);\n\n\t\t\t}\n\t\t}\n\n\t\tif (this.outputs) {\n\t\t\tfor (var i = 0; i < this.outputs.length; ++i) {\n\t\t\t\tvar output = this.outputs[i];\n\t\t\t\tif (!output.links) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor (var j = 0; j < output.links.length; ++j) {\n\t\t\t\t\tvar link_info = this.graph \t? this.graph.links[output.links[j]] : null;\n\t\t\t\t\tif (this.onConnectionsChange)\n\t\t\t\t\t\tthis.onConnectionsChange( LiteGraph.OUTPUT, i, true, link_info, output ); //link_info has been created now, so its updated\n\t\t\t\t}\n\n\t\t\t\tif( this.onOutputAdded )\n\t\t\t\t\tthis.onOutputAdded(output);\n\t\t\t}\n        }\n\n\t\tif( this.widgets )\n\t\t{\n\t\t\tfor (var i = 0; i < this.widgets.length; ++i)\n\t\t\t{\n\t\t\t\tvar w = this.widgets[i];\n\t\t\t\tif(!w)\n\t\t\t\t\tcontinue;\n\t\t\t\tif(w.options && w.options.property && (this.properties[ w.options.property ] != undefined))\n\t\t\t\t\tw.value = JSON.parse( JSON.stringify( this.properties[ w.options.property ] ) );\n\t\t\t}\n\t\t\tif (info.widgets_values) {\n\t\t\t\tfor (var i = 0; i < info.widgets_values.length; ++i) {\n\t\t\t\t\tif (this.widgets[i]) {\n\t\t\t\t\t\tthis.widgets[i].value = info.widgets_values[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n        if (this.onConfigure) {\n            this.onConfigure(info);\n        }\n    };\n\n    /**\n     * serialize the content\n     * @method serialize\n     */\n\n    LGraphNode.prototype.serialize = function() {\n        //create serialization object\n        var o = {\n            id: this.id,\n            type: this.type,\n            pos: this.pos,\n            size: this.size,\n            flags: LiteGraph.cloneObject(this.flags),\n\t\t\torder: this.order,\n            mode: this.mode\n        };\n\n        //special case for when there were errors\n        if (this.constructor === LGraphNode && this.last_serialization) {\n            return this.last_serialization;\n        }\n\n        if (this.inputs) {\n            o.inputs = this.inputs;\n        }\n\n        if (this.outputs) {\n            //clear outputs last data (because data in connections is never serialized but stored inside the outputs info)\n            for (var i = 0; i < this.outputs.length; i++) {\n                delete this.outputs[i]._data;\n            }\n            o.outputs = this.outputs;\n        }\n\n        if (this.title && this.title != this.constructor.title) {\n            o.title = this.title;\n        }\n\n        if (this.properties) {\n            o.properties = LiteGraph.cloneObject(this.properties);\n        }\n\n        if (this.widgets && this.serialize_widgets) {\n            o.widgets_values = [];\n            for (var i = 0; i < this.widgets.length; ++i) {\n\t\t\t\tif(this.widgets[i])\n\t                o.widgets_values[i] = this.widgets[i].value;\n\t\t\t\telse\n\t\t\t\t\to.widgets_values[i] = null;\n            }\n        }\n\n        if (!o.type) {\n            o.type = this.constructor.type;\n        }\n\n        if (this.color) {\n            o.color = this.color;\n        }\n        if (this.bgcolor) {\n            o.bgcolor = this.bgcolor;\n        }\n        if (this.boxcolor) {\n            o.boxcolor = this.boxcolor;\n        }\n        if (this.shape) {\n            o.shape = this.shape;\n        }\n\n        if (this.onSerialize) {\n            if (this.onSerialize(o)) {\n                console.warn(\n                    \"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter\"\n                );\n            }\n        }\n\n        return o;\n    };\n\n    /* Creates a clone of this node */\n    LGraphNode.prototype.clone = function() {\n        var node = LiteGraph.createNode(this.type);\n        if (!node) {\n            return null;\n        }\n\n        //we clone it because serialize returns shared containers\n        var data = LiteGraph.cloneObject(this.serialize());\n\n        //remove links\n        if (data.inputs) {\n            for (var i = 0; i < data.inputs.length; ++i) {\n                data.inputs[i].link = null;\n            }\n        }\n\n        if (data.outputs) {\n            for (var i = 0; i < data.outputs.length; ++i) {\n                if (data.outputs[i].links) {\n                    data.outputs[i].links.length = 0;\n                }\n            }\n        }\n\n        delete data[\"id\"];\n\n        if (LiteGraph.use_uuids) {\n            data[\"id\"] = LiteGraph.uuidv4()\n        }\n\n        //remove links\n        node.configure(data);\n\n        return node;\n    };\n\n    /**\n     * serialize and stringify\n     * @method toString\n     */\n\n    LGraphNode.prototype.toString = function() {\n        return JSON.stringify(this.serialize());\n    };\n    //LGraphNode.prototype.deserialize = function(info) {} //this cannot be done from within, must be done in LiteGraph\n\n    /**\n     * get the title string\n     * @method getTitle\n     */\n\n    LGraphNode.prototype.getTitle = function() {\n        return this.title || this.constructor.title;\n    };\n\n    /**\n     * sets the value of a property\n     * @method setProperty\n     * @param {String} name\n     * @param {*} value\n     */\n    LGraphNode.prototype.setProperty = function(name, value) {\n        if (!this.properties) {\n            this.properties = {};\n        }\n\t\tif( value === this.properties[name] )\n\t\t\treturn;\n\t\tvar prev_value = this.properties[name];\n        this.properties[name] = value;\n        if (this.onPropertyChanged) {\n            if( this.onPropertyChanged(name, value, prev_value) === false ) //abort change\n\t\t\t\tthis.properties[name] = prev_value;\n        }\n\t\tif(this.widgets) //widgets could be linked to properties\n\t\t\tfor(var i = 0; i < this.widgets.length; ++i)\n\t\t\t{\n\t\t\t\tvar w = this.widgets[i];\n\t\t\t\tif(!w)\n\t\t\t\t\tcontinue;\n\t\t\t\tif(w.options.property == name)\n\t\t\t\t{\n\t\t\t\t\tw.value = value;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n    };\n\n    // Execution *************************\n    /**\n     * sets the output data\n     * @method setOutputData\n     * @param {number} slot\n     * @param {*} data\n     */\n    LGraphNode.prototype.setOutputData = function(slot, data) {\n        if (!this.outputs) {\n            return;\n        }\n\n        //this maybe slow and a niche case\n        //if(slot && slot.constructor === String)\n        //\tslot = this.findOutputSlot(slot);\n\n        if (slot == -1 || slot >= this.outputs.length) {\n            return;\n        }\n\n        var output_info = this.outputs[slot];\n        if (!output_info) {\n            return;\n        }\n\n        //store data in the output itself in case we want to debug\n        output_info._data = data;\n\n        //if there are connections, pass the data to the connections\n        if (this.outputs[slot].links) {\n            for (var i = 0; i < this.outputs[slot].links.length; i++) {\n                var link_id = this.outputs[slot].links[i];\n\t\t\t\tvar link = this.graph.links[link_id];\n\t\t\t\tif(link)\n\t\t\t\t\tlink.data = data;\n            }\n        }\n    };\n\n    /**\n     * sets the output data type, useful when you want to be able to overwrite the data type\n     * @method setOutputDataType\n     * @param {number} slot\n     * @param {String} datatype\n     */\n    LGraphNode.prototype.setOutputDataType = function(slot, type) {\n        if (!this.outputs) {\n            return;\n        }\n        if (slot == -1 || slot >= this.outputs.length) {\n            return;\n        }\n        var output_info = this.outputs[slot];\n        if (!output_info) {\n            return;\n        }\n        //store data in the output itself in case we want to debug\n        output_info.type = type;\n\n        //if there are connections, pass the data to the connections\n        if (this.outputs[slot].links) {\n            for (var i = 0; i < this.outputs[slot].links.length; i++) {\n                var link_id = this.outputs[slot].links[i];\n                this.graph.links[link_id].type = type;\n            }\n        }\n    };\n\n    /**\n     * Retrieves the input data (data traveling through the connection) from one slot\n     * @method getInputData\n     * @param {number} slot\n     * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n     * @return {*} data or if it is not connected returns undefined\n     */\n    LGraphNode.prototype.getInputData = function(slot, force_update) {\n        if (!this.inputs) {\n            return;\n        } //undefined;\n\n        if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n            return;\n        }\n\n        var link_id = this.inputs[slot].link;\n        var link = this.graph.links[link_id];\n        if (!link) {\n            //bug: weird case but it happens sometimes\n            return null;\n        }\n\n        if (!force_update) {\n            return link.data;\n        }\n\n        //special case: used to extract data from the incoming connection before the graph has been executed\n        var node = this.graph.getNodeById(link.origin_id);\n        if (!node) {\n            return link.data;\n        }\n\n        if (node.updateOutputData) {\n            node.updateOutputData(link.origin_slot);\n        } else if (node.onExecute) {\n            node.onExecute();\n        }\n\n        return link.data;\n    };\n\n    /**\n     * Retrieves the input data type (in case this supports multiple input types)\n     * @method getInputDataType\n     * @param {number} slot\n     * @return {String} datatype in string format\n     */\n    LGraphNode.prototype.getInputDataType = function(slot) {\n        if (!this.inputs) {\n            return null;\n        } //undefined;\n\n        if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n            return null;\n        }\n        var link_id = this.inputs[slot].link;\n        var link = this.graph.links[link_id];\n        if (!link) {\n            //bug: weird case but it happens sometimes\n            return null;\n        }\n        var node = this.graph.getNodeById(link.origin_id);\n        if (!node) {\n            return link.type;\n        }\n        var output_info = node.outputs[link.origin_slot];\n        if (output_info) {\n            return output_info.type;\n        }\n        return null;\n    };\n\n    /**\n     * Retrieves the input data from one slot using its name instead of slot number\n     * @method getInputDataByName\n     * @param {String} slot_name\n     * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n     * @return {*} data or if it is not connected returns null\n     */\n    LGraphNode.prototype.getInputDataByName = function(\n        slot_name,\n        force_update\n    ) {\n        var slot = this.findInputSlot(slot_name);\n        if (slot == -1) {\n            return null;\n        }\n        return this.getInputData(slot, force_update);\n    };\n\n    /**\n     * tells you if there is a connection in one input slot\n     * @method isInputConnected\n     * @param {number} slot\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isInputConnected = function(slot) {\n        if (!this.inputs) {\n            return false;\n        }\n        return slot < this.inputs.length && this.inputs[slot].link != null;\n    };\n\n    /**\n     * tells you info about an input connection (which node, type, etc)\n     * @method getInputInfo\n     * @param {number} slot\n     * @return {Object} object or null { link: id, name: string, type: string or 0 }\n     */\n    LGraphNode.prototype.getInputInfo = function(slot) {\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot < this.inputs.length) {\n            return this.inputs[slot];\n        }\n        return null;\n    };\n\n    /**\n     * Returns the link info in the connection of an input slot\n     * @method getInputLink\n     * @param {number} slot\n     * @return {LLink} object or null\n     */\n    LGraphNode.prototype.getInputLink = function(slot) {\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot < this.inputs.length) {\n            var slot_info = this.inputs[slot];\n\t\t\treturn this.graph.links[ slot_info.link ];\n        }\n        return null;\n    };\n\n    /**\n     * returns the node connected in the input slot\n     * @method getInputNode\n     * @param {number} slot\n     * @return {LGraphNode} node or null\n     */\n    LGraphNode.prototype.getInputNode = function(slot) {\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot >= this.inputs.length) {\n            return null;\n        }\n        var input = this.inputs[slot];\n        if (!input || input.link === null) {\n            return null;\n        }\n        var link_info = this.graph.links[input.link];\n        if (!link_info) {\n            return null;\n        }\n        return this.graph.getNodeById(link_info.origin_id);\n    };\n\n    /**\n     * returns the value of an input with this name, otherwise checks if there is a property with that name\n     * @method getInputOrProperty\n     * @param {string} name\n     * @return {*} value\n     */\n    LGraphNode.prototype.getInputOrProperty = function(name) {\n        if (!this.inputs || !this.inputs.length) {\n            return this.properties ? this.properties[name] : null;\n        }\n\n        for (var i = 0, l = this.inputs.length; i < l; ++i) {\n            var input_info = this.inputs[i];\n            if (name == input_info.name && input_info.link != null) {\n                var link = this.graph.links[input_info.link];\n                if (link) {\n                    return link.data;\n                }\n            }\n        }\n        return this.properties[name];\n    };\n\n    /**\n     * tells you the last output data that went in that slot\n     * @method getOutputData\n     * @param {number} slot\n     * @return {Object}  object or null\n     */\n    LGraphNode.prototype.getOutputData = function(slot) {\n        if (!this.outputs) {\n            return null;\n        }\n        if (slot >= this.outputs.length) {\n            return null;\n        }\n\n        var info = this.outputs[slot];\n        return info._data;\n    };\n\n    /**\n     * tells you info about an output connection (which node, type, etc)\n     * @method getOutputInfo\n     * @param {number} slot\n     * @return {Object}  object or null { name: string, type: string, links: [ ids of links in number ] }\n     */\n    LGraphNode.prototype.getOutputInfo = function(slot) {\n        if (!this.outputs) {\n            return null;\n        }\n        if (slot < this.outputs.length) {\n            return this.outputs[slot];\n        }\n        return null;\n    };\n\n    /**\n     * tells you if there is a connection in one output slot\n     * @method isOutputConnected\n     * @param {number} slot\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isOutputConnected = function(slot) {\n        if (!this.outputs) {\n            return false;\n        }\n        return (\n            slot < this.outputs.length &&\n            this.outputs[slot].links &&\n            this.outputs[slot].links.length\n        );\n    };\n\n    /**\n     * tells you if there is any connection in the output slots\n     * @method isAnyOutputConnected\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isAnyOutputConnected = function() {\n        if (!this.outputs) {\n            return false;\n        }\n        for (var i = 0; i < this.outputs.length; ++i) {\n            if (this.outputs[i].links && this.outputs[i].links.length) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * retrieves all the nodes connected to this output slot\n     * @method getOutputNodes\n     * @param {number} slot\n     * @return {array}\n     */\n    LGraphNode.prototype.getOutputNodes = function(slot) {\n        if (!this.outputs || this.outputs.length == 0) {\n            return null;\n        }\n\n        if (slot >= this.outputs.length) {\n            return null;\n        }\n\n        var output = this.outputs[slot];\n        if (!output.links || output.links.length == 0) {\n            return null;\n        }\n\n        var r = [];\n        for (var i = 0; i < output.links.length; i++) {\n            var link_id = output.links[i];\n            var link = this.graph.links[link_id];\n            if (link) {\n                var target_node = this.graph.getNodeById(link.target_id);\n                if (target_node) {\n                    r.push(target_node);\n                }\n            }\n        }\n        return r;\n    };\n\n    LGraphNode.prototype.addOnTriggerInput = function(){\n        var trigS = this.findInputSlot(\"onTrigger\");\n        if (trigS == -1){ //!trigS || \n            var input = this.addInput(\"onTrigger\", LiteGraph.EVENT, {optional: true, nameLocked: true});\n            return this.findInputSlot(\"onTrigger\");\n        }\n        return trigS;\n    }\n    \n    LGraphNode.prototype.addOnExecutedOutput = function(){\n        var trigS = this.findOutputSlot(\"onExecuted\");\n        if (trigS == -1){ //!trigS || \n            var output = this.addOutput(\"onExecuted\", LiteGraph.ACTION, {optional: true, nameLocked: true});\n            return this.findOutputSlot(\"onExecuted\");\n        }\n        return trigS;\n    }\n    \n    LGraphNode.prototype.onAfterExecuteNode = function(param, options){\n        var trigS = this.findOutputSlot(\"onExecuted\");\n        if (trigS != -1){\n            \n            //console.debug(this.id+\":\"+this.order+\" triggering slot onAfterExecute\");\n            //console.debug(param);\n            //console.debug(options);\n            this.triggerSlot(trigS, param, null, options);\n            \n        }\n    }    \n    \n    LGraphNode.prototype.changeMode = function(modeTo){\n        switch(modeTo){\n            case LiteGraph.ON_EVENT:\n                // this.addOnExecutedOutput();\n                break;\n                \n            case LiteGraph.ON_TRIGGER:\n                this.addOnTriggerInput();\n                this.addOnExecutedOutput();\n                break;\n                \n            case LiteGraph.NEVER:\n                break;\n                \n            case LiteGraph.ALWAYS:\n                break;\n                \n            case LiteGraph.ON_REQUEST:\n                break;\n            \n            default:\n                return false;\n                break;\n        }\n        this.mode = modeTo;\n        return true;\n    };\n\n    /**\n     * Triggers the execution of actions that were deferred when the action was triggered\n     * @method executePendingActions\n     */    \n    LGraphNode.prototype.executePendingActions = function() {\n        if(!this._waiting_actions || !this._waiting_actions.length)\n            return;\n        for(var i = 0; i < this._waiting_actions.length;++i)\n        {\n            var p = this._waiting_actions[i];\n            this.onAction(p[0],p[1],p[2],p[3],p[4]);\n        }        \n        this._waiting_actions.length = 0;\n    }\n\n    \n    /**\n     * Triggers the node code execution, place a boolean/counter to mark the node as being executed\n     * @method doExecute\n     * @param {*} param\n     * @param {*} options\n     */\n    LGraphNode.prototype.doExecute = function(param, options) {\n        options = options || {};\n        if (this.onExecute){\n            \n            // enable this to give the event an ID\n\t\t\tif (!options.action_call) options.action_call = this.id+\"_exec_\"+Math.floor(Math.random()*9999);\n            \n            this.graph.nodes_executing[this.id] = true; //.push(this.id);\n\n            this.onExecute(param, options);\n            \n            this.graph.nodes_executing[this.id] = false; //.pop();\n            \n            // save execution/action ref\n            this.exec_version = this.graph.iteration;\n            if(options && options.action_call){\n                this.action_call = options.action_call; // if (param)\n                this.graph.nodes_executedAction[this.id] = options.action_call;\n            }\n        }\n        else {\n        }\n        this.execute_triggered = 2; // the nFrames it will be used (-- each step), means \"how old\" is the event\n        if(this.onAfterExecuteNode) this.onAfterExecuteNode(param, options); // callback\n    };\n    \n    /**\n     * Triggers an action, wrapped by logics to control execution flow\n     * @method actionDo\n     * @param {String} action name\n     * @param {*} param\n     */\n    LGraphNode.prototype.actionDo = function(action, param, options, action_slot ) {\n        options = options || {};\n        if (this.onAction){\n            \n\t\t\t// enable this to give the event an ID\n            if (!options.action_call) options.action_call = this.id+\"_\"+(action?action:\"action\")+\"_\"+Math.floor(Math.random()*9999);\n            \n            this.graph.nodes_actioning[this.id] = (action?action:\"actioning\"); //.push(this.id);\n            \n            this.onAction(action, param, options, action_slot);\n            \n            this.graph.nodes_actioning[this.id] = false; //.pop();\n            \n            // save execution/action ref\n            if(options && options.action_call){\n                this.action_call = options.action_call; // if (param)\n                this.graph.nodes_executedAction[this.id] = options.action_call;\n            }\n        }\n        this.action_triggered = 2; // the nFrames it will be used (-- each step), means \"how old\" is the event\n        if(this.onAfterExecuteNode) this.onAfterExecuteNode(param, options);\n    };\n    \n    /**\n     * Triggers an event in this node, this will trigger any output with the same name\n     * @method trigger\n     * @param {String} event name ( \"on_play\", ... ) if action is equivalent to false then the event is send to all\n     * @param {*} param\n     */\n    LGraphNode.prototype.trigger = function(action, param, options) {\n        if (!this.outputs || !this.outputs.length) {\n            return;\n        }\n\n        if (this.graph)\n            this.graph._last_trigger_time = LiteGraph.getTime();\n\n        for (var i = 0; i < this.outputs.length; ++i) {\n            var output = this.outputs[i];\n            if ( !output || output.type !== LiteGraph.EVENT || (action && output.name != action) )\n                continue;\n            this.triggerSlot(i, param, null, options);\n        }\n    };\n\n    /**\n     * Triggers a slot event in this node: cycle output slots and launch execute/action on connected nodes\n     * @method triggerSlot\n     * @param {Number} slot the index of the output slot\n     * @param {*} param\n     * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n     */\n    LGraphNode.prototype.triggerSlot = function(slot, param, link_id, options) {\n        options = options || {};\n        if (!this.outputs) {\n            return;\n        }\n\n\t\tif(slot == null)\n\t\t{\n\t\t\tconsole.error(\"slot must be a number\");\n\t\t\treturn;\n\t\t}\n\n\t\tif(slot.constructor !== Number)\n\t\t\tconsole.warn(\"slot must be a number, use node.trigger('name') if you want to use a string\");\n\n        var output = this.outputs[slot];\n        if (!output) {\n            return;\n        }\n\n        var links = output.links;\n        if (!links || !links.length) {\n            return;\n        }\n\n        if (this.graph) {\n            this.graph._last_trigger_time = LiteGraph.getTime();\n        }\n\n        //for every link attached here\n        for (var k = 0; k < links.length; ++k) {\n            var id = links[k];\n            if (link_id != null && link_id != id) {\n                //to skip links\n                continue;\n            }\n            var link_info = this.graph.links[links[k]];\n            if (!link_info) {\n                //not connected\n                continue;\n            }\n            link_info._last_time = LiteGraph.getTime();\n            var node = this.graph.getNodeById(link_info.target_id);\n            if (!node) {\n                //node not found?\n                continue;\n            }\n\n            //used to mark events in graph\n            var target_connection = node.inputs[link_info.target_slot];\n\n\t\t\tif (node.mode === LiteGraph.ON_TRIGGER)\n\t\t\t{\n\t\t\t\t// generate unique trigger ID if not present\n\t\t\t\tif (!options.action_call) options.action_call = this.id+\"_trigg_\"+Math.floor(Math.random()*9999);\n                if (node.onExecute) {\n                    // -- wrapping node.onExecute(param); --\n                    node.doExecute(param, options);\n                }\n\t\t\t}\n\t\t\telse if (node.onAction) {\n                // generate unique action ID if not present\n\t\t\t\tif (!options.action_call) options.action_call = this.id+\"_act_\"+Math.floor(Math.random()*9999);\n                //pass the action name\n                var target_connection = node.inputs[link_info.target_slot];\n\n                //instead of executing them now, it will be executed in the next graph loop, to ensure data flow\n                if(LiteGraph.use_deferred_actions && node.onExecute)\n                {\n                    if(!node._waiting_actions)\n                        node._waiting_actions = [];\n                    node._waiting_actions.push([target_connection.name, param, options, link_info.target_slot]);\n                }\n                else\n                {\n                    // wrap node.onAction(target_connection.name, param);\n                    node.actionDo( target_connection.name, param, options, link_info.target_slot );\n                }\n            }\n        }\n    };\n\n    /**\n     * clears the trigger slot animation\n     * @method clearTriggeredSlot\n     * @param {Number} slot the index of the output slot\n     * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n     */\n    LGraphNode.prototype.clearTriggeredSlot = function(slot, link_id) {\n        if (!this.outputs) {\n            return;\n        }\n\n        var output = this.outputs[slot];\n        if (!output) {\n            return;\n        }\n\n        var links = output.links;\n        if (!links || !links.length) {\n            return;\n        }\n\n        //for every link attached here\n        for (var k = 0; k < links.length; ++k) {\n            var id = links[k];\n            if (link_id != null && link_id != id) {\n                //to skip links\n                continue;\n            }\n            var link_info = this.graph.links[links[k]];\n            if (!link_info) {\n                //not connected\n                continue;\n            }\n            link_info._last_time = 0;\n        }\n    };\n\n    /**\n     * changes node size and triggers callback\n     * @method setSize\n     * @param {vec2} size\n     */\n    LGraphNode.prototype.setSize = function(size)\n\t{\n\t\tthis.size = size;\n\t\tif(this.onResize)\n\t\t\tthis.onResize(this.size);\n\t}\n\n    /**\n     * add a new property to this node\n     * @method addProperty\n     * @param {string} name\n     * @param {*} default_value\n     * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n     * @param {Object} extra_info this can be used to have special properties of the property (like values, etc)\n     */\n    LGraphNode.prototype.addProperty = function(\n        name,\n        default_value,\n        type,\n        extra_info\n    ) {\n        var o = { name: name, type: type, default_value: default_value };\n        if (extra_info) {\n            for (var i in extra_info) {\n                o[i] = extra_info[i];\n            }\n        }\n        if (!this.properties_info) {\n            this.properties_info = [];\n        }\n        this.properties_info.push(o);\n        if (!this.properties) {\n            this.properties = {};\n        }\n        this.properties[name] = default_value;\n        return o;\n    };\n\n    //connections\n\n    /**\n     * add a new output slot to use in this node\n     * @method addOutput\n     * @param {string} name\n     * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n     * @param {Object} extra_info this can be used to have special properties of an output (label, special color, position, etc)\n     */\n    LGraphNode.prototype.addOutput = function(name, type, extra_info) {\n        var output = { name: name, type: type, links: null };\n        if (extra_info) {\n            for (var i in extra_info) {\n                output[i] = extra_info[i];\n            }\n        }\n\n        if (!this.outputs) {\n            this.outputs = [];\n        }\n        this.outputs.push(output);\n        if (this.onOutputAdded) {\n            this.onOutputAdded(output);\n        }\n        \n        if (LiteGraph.auto_load_slot_types) LiteGraph.registerNodeAndSlotType(this,type,true);\n        \n        this.setSize( this.computeSize() );\n        this.setDirtyCanvas(true, true);\n        return output;\n    };\n\n    /**\n     * add a new output slot to use in this node\n     * @method addOutputs\n     * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n     */\n    LGraphNode.prototype.addOutputs = function(array) {\n        for (var i = 0; i < array.length; ++i) {\n            var info = array[i];\n            var o = { name: info[0], type: info[1], link: null };\n            if (array[2]) {\n                for (var j in info[2]) {\n                    o[j] = info[2][j];\n                }\n            }\n\n            if (!this.outputs) {\n                this.outputs = [];\n            }\n            this.outputs.push(o);\n            if (this.onOutputAdded) {\n                this.onOutputAdded(o);\n            }\n            \n            if (LiteGraph.auto_load_slot_types) LiteGraph.registerNodeAndSlotType(this,info[1],true);\n            \n        }\n\n        this.setSize( this.computeSize() );\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * remove an existing output slot\n     * @method removeOutput\n     * @param {number} slot\n     */\n    LGraphNode.prototype.removeOutput = function(slot) {\n        this.disconnectOutput(slot);\n        this.outputs.splice(slot, 1);\n        for (var i = slot; i < this.outputs.length; ++i) {\n            if (!this.outputs[i] || !this.outputs[i].links) {\n                continue;\n            }\n            var links = this.outputs[i].links;\n            for (var j = 0; j < links.length; ++j) {\n                var link = this.graph.links[links[j]];\n                if (!link) {\n                    continue;\n                }\n                link.origin_slot -= 1;\n            }\n        }\n\n        this.setSize( this.computeSize() );\n        if (this.onOutputRemoved) {\n            this.onOutputRemoved(slot);\n        }\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * add a new input slot to use in this node\n     * @method addInput\n     * @param {string} name\n     * @param {string} type string defining the input type (\"vec3\",\"number\",...), it its a generic one use 0\n     * @param {Object} extra_info this can be used to have special properties of an input (label, color, position, etc)\n     */\n    LGraphNode.prototype.addInput = function(name, type, extra_info) {\n        type = type || 0;\n        var input = { name: name, type: type, link: null };\n        if (extra_info) {\n            for (var i in extra_info) {\n                input[i] = extra_info[i];\n            }\n        }\n\n        if (!this.inputs) {\n            this.inputs = [];\n        }\n\n        this.inputs.push(input);\n        this.setSize( this.computeSize() );\n\n        if (this.onInputAdded) {\n            this.onInputAdded(input);\n\t\t}\n        \n        LiteGraph.registerNodeAndSlotType(this,type);\n\n        this.setDirtyCanvas(true, true);\n        return input;\n    };\n\n    /**\n     * add several new input slots in this node\n     * @method addInputs\n     * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n     */\n    LGraphNode.prototype.addInputs = function(array) {\n        for (var i = 0; i < array.length; ++i) {\n            var info = array[i];\n            var o = { name: info[0], type: info[1], link: null };\n            if (array[2]) {\n                for (var j in info[2]) {\n                    o[j] = info[2][j];\n                }\n            }\n\n            if (!this.inputs) {\n                this.inputs = [];\n            }\n            this.inputs.push(o);\n            if (this.onInputAdded) {\n                this.onInputAdded(o);\n            }\n            \n            LiteGraph.registerNodeAndSlotType(this,info[1]);\n        }\n\n        this.setSize( this.computeSize() );\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * remove an existing input slot\n     * @method removeInput\n     * @param {number} slot\n     */\n    LGraphNode.prototype.removeInput = function(slot) {\n        this.disconnectInput(slot);\n        var slot_info = this.inputs.splice(slot, 1);\n        for (var i = slot; i < this.inputs.length; ++i) {\n            if (!this.inputs[i]) {\n                continue;\n            }\n            var link = this.graph.links[this.inputs[i].link];\n            if (!link) {\n                continue;\n            }\n            link.target_slot -= 1;\n        }\n        this.setSize( this.computeSize() );\n        if (this.onInputRemoved) {\n            this.onInputRemoved(slot, slot_info[0] );\n        }\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * add an special connection to this node (used for special kinds of graphs)\n     * @method addConnection\n     * @param {string} name\n     * @param {string} type string defining the input type (\"vec3\",\"number\",...)\n     * @param {[x,y]} pos position of the connection inside the node\n     * @param {string} direction if is input or output\n     */\n    LGraphNode.prototype.addConnection = function(name, type, pos, direction) {\n        var o = {\n            name: name,\n            type: type,\n            pos: pos,\n            direction: direction,\n            links: null\n        };\n        this.connections.push(o);\n        return o;\n    };\n\n    /**\n     * computes the minimum size of a node according to its inputs and output slots\n     * @method computeSize\n     * @param {vec2} minHeight\n     * @return {vec2} the total size\n     */\n    LGraphNode.prototype.computeSize = function(out) {\n        if (this.constructor.size) {\n            return this.constructor.size.concat();\n        }\n\n        var rows = Math.max(\n            this.inputs ? this.inputs.length : 1,\n            this.outputs ? this.outputs.length : 1\n        );\n        var size = out || new Float32Array([0, 0]);\n        rows = Math.max(rows, 1);\n        var font_size = LiteGraph.NODE_TEXT_SIZE; //although it should be graphcanvas.inner_text_font size\n\n        var title_width = compute_text_size(this.title);\n        var input_width = 0;\n        var output_width = 0;\n\n        if (this.inputs) {\n            for (var i = 0, l = this.inputs.length; i < l; ++i) {\n                var input = this.inputs[i];\n                var text = input.label || input.name || \"\";\n                var text_width = compute_text_size(text);\n                if (input_width < text_width) {\n                    input_width = text_width;\n                }\n            }\n        }\n\n        if (this.outputs) {\n            for (var i = 0, l = this.outputs.length; i < l; ++i) {\n                var output = this.outputs[i];\n                var text = output.label || output.name || \"\";\n                var text_width = compute_text_size(text);\n                if (output_width < text_width) {\n                    output_width = text_width;\n                }\n            }\n        }\n\n        size[0] = Math.max(input_width + output_width + 10, title_width);\n        size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH);\n        if (this.widgets && this.widgets.length) {\n            size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH * 1.5);\n        }\n\n        size[1] = (this.constructor.slot_start_y || 0) + rows * LiteGraph.NODE_SLOT_HEIGHT;\n\n        var widgets_height = 0;\n        if (this.widgets && this.widgets.length) {\n            for (var i = 0, l = this.widgets.length; i < l; ++i) {\n                if (this.widgets[i].computeSize)\n                    widgets_height += this.widgets[i].computeSize(size[0])[1] + 4;\n                else\n                    widgets_height += LiteGraph.NODE_WIDGET_HEIGHT + 4;\n            }\n            widgets_height += 8;\n        }\n\n        //compute height using widgets height\n        if( this.widgets_up )\n            size[1] = Math.max( size[1], widgets_height );\n        else if( this.widgets_start_y != null )\n            size[1] = Math.max( size[1], widgets_height + this.widgets_start_y );\n        else\n            size[1] += widgets_height;\n\n        function compute_text_size(text) {\n            if (!text) {\n                return 0;\n            }\n            return font_size * text.length * 0.6;\n        }\n\n        if (\n            this.constructor.min_height &&\n            size[1] < this.constructor.min_height\n        ) {\n            size[1] = this.constructor.min_height;\n        }\n\n        size[1] += 6; //margin\n\n        return size;\n    };\n\n    /**\n     * returns all the info available about a property of this node.\n     *\n     * @method getPropertyInfo\n     * @param {String} property name of the property\n     * @return {Object} the object with all the available info\n    */\n    LGraphNode.prototype.getPropertyInfo = function( property )\n\t{\n        var info = null;\n\n\t\t//there are several ways to define info about a property\n\t\t//legacy mode\n\t\tif (this.properties_info) {\n            for (var i = 0; i < this.properties_info.length; ++i) {\n                if (this.properties_info[i].name == property) {\n                    info = this.properties_info[i];\n                    break;\n                }\n            }\n        }\n\t\t//litescene mode using the constructor\n\t\tif(this.constructor[\"@\" + property])\n\t\t\tinfo = this.constructor[\"@\" + property];\n\n\t\tif(this.constructor.widgets_info && this.constructor.widgets_info[property])\n\t\t\tinfo = this.constructor.widgets_info[property];\n\n\t\t//litescene mode using the constructor\n\t\tif (!info && this.onGetPropertyInfo) {\n            info = this.onGetPropertyInfo(property);\n        }\n\n        if (!info)\n            info = {};\n\t\tif(!info.type)\n\t\t\tinfo.type = typeof this.properties[property];\n\t\tif(info.widget == \"combo\")\n\t\t\tinfo.type = \"enum\";\n\n\t\treturn info;\n\t}\n\n    /**\n     * Defines a widget inside the node, it will be rendered on top of the node, you can control lots of properties\n     *\n     * @method addWidget\n     * @param {String} type the widget type (could be \"number\",\"string\",\"combo\"\n     * @param {String} name the text to show on the widget\n     * @param {String} value the default value\n     * @param {Function|String} callback function to call when it changes (optionally, it can be the name of the property to modify)\n     * @param {Object} options the object that contains special properties of this widget \n     * @return {Object} the created widget object\n     */\n    LGraphNode.prototype.addWidget = function( type, name, value, callback, options )\n\t{\n        if (!this.widgets) {\n            this.widgets = [];\n        }\n\n\t\tif(!options && callback && callback.constructor === Object)\n\t\t{\n\t\t\toptions = callback;\n\t\t\tcallback = null;\n\t\t}\n\n\t\tif(options && options.constructor === String) //options can be the property name\n\t\t\toptions = { property: options };\n\n\t\tif(callback && callback.constructor === String) //callback can be the property name\n\t\t{\n\t\t\tif(!options)\n\t\t\t\toptions = {};\n\t\t\toptions.property = callback;\n\t\t\tcallback = null;\n\t\t}\n\n\t\tif(callback && callback.constructor !== Function)\n\t\t{\n\t\t\tconsole.warn(\"addWidget: callback must be a function\");\n\t\t\tcallback = null;\n\t\t}\n\n        var w = {\n            type: type.toLowerCase(),\n            name: name,\n            value: value,\n            callback: callback,\n            options: options || {}\n        };\n\n        if (w.options.y !== undefined) {\n            w.y = w.options.y;\n        }\n\n        if (!callback && !w.options.callback && !w.options.property) {\n            console.warn(\"LiteGraph addWidget(...) without a callback or property assigned\");\n        }\n        if (type == \"combo\" && !w.options.values) {\n            throw \"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }\";\n        }\n        this.widgets.push(w);\n\t\tthis.setSize( this.computeSize() );\n        return w;\n    };\n\n    LGraphNode.prototype.addCustomWidget = function(custom_widget) {\n        if (!this.widgets) {\n            this.widgets = [];\n        }\n        this.widgets.push(custom_widget);\n        return custom_widget;\n    };\n\n    /**\n     * returns the bounding of the object, used for rendering purposes\n     * @method getBounding\n     * @param out {Float32Array[4]?} [optional] a place to store the output, to free garbage\n     * @param compute_outer {boolean?} [optional] set to true to include the shadow and connection points in the bounding calculation\n     * @return {Float32Array[4]} the bounding box in format of [topleft_cornerx, topleft_cornery, width, height]\n     */\n    LGraphNode.prototype.getBounding = function(out, compute_outer) {\n        out = out || new Float32Array(4);\n        const nodePos = this.pos;\n        const isCollapsed = this.flags.collapsed;\n        const nodeSize = this.size;\n        \n        let left_offset = 0;\n        // 1 offset due to how nodes are rendered\n        let right_offset =  1 ;\n        let top_offset = 0;\n        let bottom_offset = 0;\n        \n        if (compute_outer) {\n            // 4 offset for collapsed node connection points\n            left_offset = 4;\n            // 6 offset for right shadow and collapsed node connection points\n            right_offset = 6 + left_offset;\n            // 4 offset for collapsed nodes top connection points\n            top_offset = 4;\n            // 5 offset for bottom shadow and collapsed node connection points\n            bottom_offset = 5 + top_offset;\n        }\n        \n        out[0] = nodePos[0] - left_offset;\n        out[1] = nodePos[1] - LiteGraph.NODE_TITLE_HEIGHT - top_offset;\n        out[2] = isCollapsed ?\n            (this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH) + right_offset :\n            nodeSize[0] + right_offset;\n        out[3] = isCollapsed ?\n            LiteGraph.NODE_TITLE_HEIGHT + bottom_offset :\n            nodeSize[1] + LiteGraph.NODE_TITLE_HEIGHT + bottom_offset;\n\n        if (this.onBounding) {\n            this.onBounding(out);\n        }\n        return out;\n    };\n\n    /**\n     * checks if a point is inside the shape of a node\n     * @method isPointInside\n     * @param {number} x\n     * @param {number} y\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isPointInside = function(x, y, margin, skip_title) {\n        margin = margin || 0;\n\n        var margin_top = this.graph && this.graph.isLive() ? 0 : LiteGraph.NODE_TITLE_HEIGHT;\n        if (skip_title) {\n            margin_top = 0;\n        }\n        if (this.flags && this.flags.collapsed) {\n            //if ( distance([x,y], [this.pos[0] + this.size[0]*0.5, this.pos[1] + this.size[1]*0.5]) < LiteGraph.NODE_COLLAPSED_RADIUS)\n            if (\n                isInsideRectangle(\n                    x,\n                    y,\n                    this.pos[0] - margin,\n                    this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT - margin,\n                    (this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH) +\n                        2 * margin,\n                    LiteGraph.NODE_TITLE_HEIGHT + 2 * margin\n                )\n            ) {\n                return true;\n            }\n        } else if (\n            this.pos[0] - 4 - margin < x &&\n            this.pos[0] + this.size[0] + 4 + margin > x &&\n            this.pos[1] - margin_top - margin < y &&\n            this.pos[1] + this.size[1] + margin > y\n        ) {\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * checks if a point is inside a node slot, and returns info about which slot\n     * @method getSlotInPosition\n     * @param {number} x\n     * @param {number} y\n     * @return {Object} if found the object contains { input|output: slot object, slot: number, link_pos: [x,y] }\n     */\n    LGraphNode.prototype.getSlotInPosition = function(x, y) {\n        //search for inputs\n        var link_pos = new Float32Array(2);\n        if (this.inputs) {\n            for (var i = 0, l = this.inputs.length; i < l; ++i) {\n                var input = this.inputs[i];\n                this.getConnectionPos(true, i, link_pos);\n                if (\n                    isInsideRectangle(\n                        x,\n                        y,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        20,\n                        10\n                    )\n                ) {\n                    return { input: input, slot: i, link_pos: link_pos };\n                }\n            }\n        }\n\n        if (this.outputs) {\n            for (var i = 0, l = this.outputs.length; i < l; ++i) {\n                var output = this.outputs[i];\n                this.getConnectionPos(false, i, link_pos);\n                if (\n                    isInsideRectangle(\n                        x,\n                        y,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        20,\n                        10\n                    )\n                ) {\n                    return { output: output, slot: i, link_pos: link_pos };\n                }\n            }\n        }\n\n        return null;\n    };\n\n    /**\n     * returns the input slot with a given name (used for dynamic slots), -1 if not found\n     * @method findInputSlot\n     * @param {string} name the name of the slot\n     * @param {boolean} returnObj if the obj itself wanted\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findInputSlot = function(name,  returnObj) {\n        if (!this.inputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.inputs.length; i < l; ++i) {\n            if (name == this.inputs[i].name) {\n                return !returnObj ? i : this.inputs[i];\n            }\n        }\n        return -1;\n    };\n\n    /**\n     * returns the output slot with a given name (used for dynamic slots), -1 if not found\n     * @method findOutputSlot\n     * @param {string} name the name of the slot\n     * @param {boolean} returnObj if the obj itself wanted\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findOutputSlot = function(name, returnObj) {\n        returnObj = returnObj || false;\n        if (!this.outputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            if (name == this.outputs[i].name) {\n                return !returnObj ? i : this.outputs[i];\n            }\n        }\n        return -1;\n    };\n    \n    // TODO refactor: USE SINGLE findInput/findOutput functions! :: merge options\n    \n    /**\n     * returns the first free input slot\n     * @method findInputSlotFree\n     * @param {object} options\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findInputSlotFree = function(optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = {returnObj: false\n                        ,typesNotAccepted: []\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (!this.inputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.inputs.length; i < l; ++i) {\n            if (this.inputs[i].link && this.inputs[i].link != null) {\n                continue;\n            }\n            if (opts.typesNotAccepted && opts.typesNotAccepted.includes && opts.typesNotAccepted.includes(this.inputs[i].type)){\n                continue;\n            }\n            return !opts.returnObj ? i : this.inputs[i];\n        }\n        return -1;\n    };\n\n    /**\n     * returns the first output slot free\n     * @method findOutputSlotFree\n     * @param {object} options\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findOutputSlotFree = function(optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = { returnObj: false\n                        ,typesNotAccepted: []\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (!this.outputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            if (this.outputs[i].links && this.outputs[i].links != null) {\n                continue;\n            }\n            if (opts.typesNotAccepted && opts.typesNotAccepted.includes && opts.typesNotAccepted.includes(this.outputs[i].type)){\n                continue;\n            }\n            return !opts.returnObj ? i : this.outputs[i];\n        }\n        return -1;\n    };\n    \n    /**\n     * findSlotByType for INPUTS\n     */\n    LGraphNode.prototype.findInputSlotByType = function(type, returnObj, preferFreeSlot, doNotUseOccupied) {\n        return this.findSlotByType(true, type, returnObj, preferFreeSlot, doNotUseOccupied);\n    };\n\n    /**\n     * findSlotByType for OUTPUTS\n     */\n    LGraphNode.prototype.findOutputSlotByType = function(type, returnObj, preferFreeSlot, doNotUseOccupied) {\n        return this.findSlotByType(false, type, returnObj, preferFreeSlot, doNotUseOccupied);\n    };\n    \n    /**\n     * returns the output (or input) slot with a given type, -1 if not found\n     * @method findSlotByType\n     * @param {boolean} input uise inputs instead of outputs\n     * @param {string} type the type of the slot\n     * @param {boolean} returnObj if the obj itself wanted\n     * @param {boolean} preferFreeSlot if we want a free slot (if not found, will return the first of the type anyway)\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findSlotByType = function(input, type, returnObj, preferFreeSlot, doNotUseOccupied) {\n        input = input || false;\n        returnObj = returnObj || false;\n        preferFreeSlot = preferFreeSlot || false;\n        doNotUseOccupied = doNotUseOccupied || false;\n        var aSlots = input ? this.inputs : this.outputs;\n        if (!aSlots) {\n            return -1;\n        }\n\t\t// !! empty string type is considered 0, * !!\n\t\tif (type == \"\" || type == \"*\") type = 0; \n        for (var i = 0, l = aSlots.length; i < l; ++i) {\n            var tFound = false;\n            var aSource = (type+\"\").toLowerCase().split(\",\");\n            var aDest = aSlots[i].type==\"0\"||aSlots[i].type==\"*\"?\"0\":aSlots[i].type;\n\t\t\taDest = (aDest+\"\").toLowerCase().split(\",\");\n            for(var sI=0;sI<aSource.length;sI++){\n                for(var dI=0;dI<aDest.length;dI++){\n\t\t\t\t\tif (aSource[sI]==\"_event_\") aSource[sI] = LiteGraph.EVENT;\n\t\t\t\t\tif (aDest[sI]==\"_event_\") aDest[sI] = LiteGraph.EVENT;\n\t\t\t\t\tif (aSource[sI]==\"*\") aSource[sI] = 0;\n\t\t\t\t\tif (aDest[sI]==\"*\") aDest[sI] = 0;\n\t\t\t\t\tif (aSource[sI] == aDest[dI]) {\n                        if (preferFreeSlot && aSlots[i].links && aSlots[i].links !== null) continue;\n                        return !returnObj ? i : aSlots[i];\n                    }\n                }\n            }\n        }\n        // if didnt find some, stop checking for free slots\n        if (preferFreeSlot && !doNotUseOccupied){\n            for (var i = 0, l = aSlots.length; i < l; ++i) {\n                var tFound = false;\n                var aSource = (type+\"\").toLowerCase().split(\",\");\n                var aDest = aSlots[i].type==\"0\"||aSlots[i].type==\"*\"?\"0\":aSlots[i].type;\n\t\t\t\taDest = (aDest+\"\").toLowerCase().split(\",\");\n                for(var sI=0;sI<aSource.length;sI++){\n                    for(var dI=0;dI<aDest.length;dI++){\n\t\t\t\t\t\tif (aSource[sI]==\"*\") aSource[sI] = 0;\n\t\t\t\t\t\tif (aDest[sI]==\"*\") aDest[sI] = 0;\n                        if (aSource[sI] == aDest[dI]) {\n                            return !returnObj ? i : aSlots[i];\n                        }\n                    }\n                }\n            }\n        }\n        return -1;\n    };\n\n    /**\n     * connect this node output to the input of another node BY TYPE\n     * @method connectByType\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} node the target node\n     * @param {string} target_type the input slot type of the target node\n     * @return {Object} the link_info is created, otherwise null\n     */\n    LGraphNode.prototype.connectByType = function(slot, target_node, target_slotType, optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = { createEventInCase: true\n\t\t\t\t\t   \t,firstFreeIfOutputGeneralInCase: true\n                        ,generalTypeInCase: true\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (target_node && target_node.constructor === Number) {\n            target_node = this.graph.getNodeById(target_node);\n        }\n        var target_slot = target_node.findInputSlotByType(target_slotType, false, true);\n        if (target_slot >= 0 && target_slot !== null){\n            //console.debug(\"CONNbyTYPE type \"+target_slotType+\" for \"+target_slot)\n            return this.connect(slot, target_node, target_slot);\n        }else{\n            //console.log(\"type \"+target_slotType+\" not found or not free?\")\n            if (opts.createEventInCase && target_slotType == LiteGraph.EVENT){\n                // WILL CREATE THE onTrigger IN SLOT\n\t\t\t\t//console.debug(\"connect WILL CREATE THE onTrigger \"+target_slotType+\" to \"+target_node);\n                return this.connect(slot, target_node, -1);\n            }\n\t\t\t// connect to the first general output slot if not found a specific type and \n            if (opts.generalTypeInCase){\n                var target_slot = target_node.findInputSlotByType(0, false, true, true);\n\t\t\t\t//console.debug(\"connect TO a general type (*, 0), if not found the specific type \",target_slotType,\" to \",target_node,\"RES_SLOT:\",target_slot);\n                if (target_slot >= 0){\n                    return this.connect(slot, target_node, target_slot);\n                }\n            }\n            // connect to the first free input slot if not found a specific type and this output is general\n            if (opts.firstFreeIfOutputGeneralInCase && (target_slotType == 0 || target_slotType == \"*\" || target_slotType == \"\")){\n                var target_slot = target_node.findInputSlotFree({typesNotAccepted: [LiteGraph.EVENT] });\n\t\t\t\t//console.debug(\"connect TO TheFirstFREE \",target_slotType,\" to \",target_node,\"RES_SLOT:\",target_slot);\n                if (target_slot >= 0){\n\t\t\t\t\treturn this.connect(slot, target_node, target_slot);\n                }\n            }\n\t\t\t\n\t\t\tconsole.debug(\"no way to connect type: \",target_slotType,\" to targetNODE \",target_node);\n\t\t\t//TODO filter\n\t\t\t\n            return null;\n        }\n    }\n    \n    /**\n     * connect this node input to the output of another node BY TYPE\n     * @method connectByType\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} node the target node\n     * @param {string} target_type the output slot type of the target node\n     * @return {Object} the link_info is created, otherwise null\n     */\n    LGraphNode.prototype.connectByTypeOutput = function(slot, source_node, source_slotType, optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = { createEventInCase: true\n                        ,firstFreeIfInputGeneralInCase: true\n                        ,generalTypeInCase: true\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (source_node && source_node.constructor === Number) {\n            source_node = this.graph.getNodeById(source_node);\n        }\n        var source_slot = source_node.findOutputSlotByType(source_slotType, false, true);\n        if (source_slot >= 0 && source_slot !== null){\n            //console.debug(\"CONNbyTYPE OUT! type \"+source_slotType+\" for \"+source_slot)\n            return source_node.connect(source_slot, this, slot);\n        }else{\n            \n            // connect to the first general output slot if not found a specific type and \n            if (opts.generalTypeInCase){\n                var source_slot = source_node.findOutputSlotByType(0, false, true, true);\n                if (source_slot >= 0){\n                    return source_node.connect(source_slot, this, slot);\n                }\n            }\n            \n            if (opts.createEventInCase && source_slotType == LiteGraph.EVENT){\n                // WILL CREATE THE onExecuted OUT SLOT\n\t\t\t\tif (LiteGraph.do_add_triggers_slots){\n\t\t\t\t\tvar source_slot = source_node.addOnExecutedOutput();\n\t\t\t\t\treturn source_node.connect(source_slot, this, slot);\n\t\t\t\t}\n            }\n            // connect to the first free output slot if not found a specific type and this input is general\n            if (opts.firstFreeIfInputGeneralInCase && (source_slotType == 0 || source_slotType == \"*\" || source_slotType == \"\")){\n                var source_slot = source_node.findOutputSlotFree({typesNotAccepted: [LiteGraph.EVENT] });\n                if (source_slot >= 0){\n                    return source_node.connect(source_slot, this, slot);\n                }\n            }\n            \n\t\t\tconsole.debug(\"no way to connect byOUT type: \",source_slotType,\" to sourceNODE \",source_node);\n\t\t\t//TODO filter\n\t\t\t\n            //console.log(\"type OUT! \"+source_slotType+\" not found or not free?\")\n            return null;\n        }\n    }\n    \n    /**\n     * connect this node output to the input of another node\n     * @method connect\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} node the target node\n     * @param {number_or_string} target_slot the input slot of the target node (could be the number of the slot or the string with the name of the slot, or -1 to connect a trigger)\n     * @return {Object} the link_info is created, otherwise null\n     */\n    LGraphNode.prototype.connect = function(slot, target_node, target_slot) {\n        target_slot = target_slot || 0;\n\n        if (!this.graph) {\n            //could be connected before adding it to a graph\n            console.log(\n                \"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them.\"\n            ); //due to link ids being associated with graphs\n            return null;\n        }\n\n        //seek for the output slot\n        if (slot.constructor === String) {\n            slot = this.findOutputSlot(slot);\n            if (slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\"Connect: Error, no slot of name \" + slot);\n                }\n                return null;\n            }\n        } else if (!this.outputs || slot >= this.outputs.length) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return null;\n        }\n\n        if (target_node && target_node.constructor === Number) {\n            target_node = this.graph.getNodeById(target_node);\n        }\n        if (!target_node) {\n            throw \"target node is null\";\n        }\n\n        //avoid loopback\n        if (target_node == this) {\n            return null;\n        }\n\n        //you can specify the slot by name\n        if (target_slot.constructor === String) {\n            target_slot = target_node.findInputSlot(target_slot);\n            if (target_slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\n                        \"Connect: Error, no slot of name \" + target_slot\n                    );\n                }\n                return null;\n            }\n        } else if (target_slot === LiteGraph.EVENT) {\n            \n            if (LiteGraph.do_add_triggers_slots){\n\t            //search for first slot with event? :: NO this is done outside\n\t\t\t\t//console.log(\"Connect: Creating triggerEvent\");\n\t            // force mode\n\t            target_node.changeMode(LiteGraph.ON_TRIGGER);\n\t            target_slot = target_node.findInputSlot(\"onTrigger\");\n        \t}else{\n            \treturn null; // -- break --\n\t\t\t}\n        } else if (\n            !target_node.inputs ||\n            target_slot >= target_node.inputs.length\n        ) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return null;\n        }\n\n\t\tvar changed = false;\n\n        var input = target_node.inputs[target_slot];\n        var link_info = null;\n        var output = this.outputs[slot];\n        \n        if (!this.outputs[slot]){\n            /*console.debug(\"Invalid slot passed: \"+slot);\n            console.debug(this.outputs);*/\n            return null;\n        }\n\n        // allow target node to change slot\n        if (target_node.onBeforeConnectInput) {\n            // This way node can choose another slot (or make a new one?)\n            target_slot = target_node.onBeforeConnectInput(target_slot); //callback\n        }\n\n\t\t//check target_slot and check connection types\n        if (target_slot===false || target_slot===null || !LiteGraph.isValidConnection(output.type, input.type))\n\t\t{\n\t        this.setDirtyCanvas(false, true);\n\t\t\tif(changed)\n\t\t        this.graph.connectionChange(this, link_info);\n\t\t\treturn null;\n\t\t}else{\n\t\t\t//console.debug(\"valid connection\",output.type, input.type);\n\t\t}\n\n        //allows nodes to block connection, callback\n        if (target_node.onConnectInput) {\n            if ( target_node.onConnectInput(target_slot, output.type, output, this, slot) === false ) {\n                return null;\n            }\n        }\n        if (this.onConnectOutput) { // callback\n            if ( this.onConnectOutput(slot, input.type, input, target_node, target_slot) === false ) {\n                return null;\n            }\n        }\n\n        //if there is something already plugged there, disconnect\n        if (target_node.inputs[target_slot] && target_node.inputs[target_slot].link != null) {\n\t\t\tthis.graph.beforeChange();\n            target_node.disconnectInput(target_slot, {doProcessChange: false});\n\t\t\tchanged = true;\n        }\n        if (output.links !== null && output.links.length){\n            switch(output.type){\n                case LiteGraph.EVENT:\n                    if (!LiteGraph.allow_multi_output_for_events){\n                        this.graph.beforeChange();\n                        this.disconnectOutput(slot, false, {doProcessChange: false}); // Input(target_slot, {doProcessChange: false});\n                        changed = true;\n                    }\n                break;\n                default:\n                break;\n            }\n        }\n\n        var nextId\n        if (LiteGraph.use_uuids)\n            nextId = LiteGraph.uuidv4();\n        else\n            nextId = ++this.graph.last_link_id;\n        \n\t\t//create link class\n\t\tlink_info = new LLink(\n\t\t\tnextId,\n\t\t\tinput.type || output.type,\n\t\t\tthis.id,\n\t\t\tslot,\n\t\t\ttarget_node.id,\n\t\t\ttarget_slot\n\t\t);\n\n\t\t//add to graph links list\n\t\tthis.graph.links[link_info.id] = link_info;\n\n\t\t//connect in output\n\t\tif (output.links == null) {\n\t\t\toutput.links = [];\n\t\t}\n\t\toutput.links.push(link_info.id);\n\t\t//connect in input\n\t\ttarget_node.inputs[target_slot].link = link_info.id;\n\t\tif (this.graph) {\n\t\t\tthis.graph._version++;\n\t\t}\n\t\tif (this.onConnectionsChange) {\n\t\t\tthis.onConnectionsChange(\n\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\tslot,\n\t\t\t\ttrue,\n\t\t\t\tlink_info,\n\t\t\t\toutput\n\t\t\t);\n\t\t} //link_info has been created now, so its updated\n\t\tif (target_node.onConnectionsChange) {\n\t\t\ttarget_node.onConnectionsChange(\n\t\t\t\tLiteGraph.INPUT,\n\t\t\t\ttarget_slot,\n\t\t\t\ttrue,\n\t\t\t\tlink_info,\n\t\t\t\tinput\n\t\t\t);\n\t\t}\n\t\tif (this.graph && this.graph.onNodeConnectionChange) {\n\t\t\tthis.graph.onNodeConnectionChange(\n\t\t\t\tLiteGraph.INPUT,\n\t\t\t\ttarget_node,\n\t\t\t\ttarget_slot,\n\t\t\t\tthis,\n\t\t\t\tslot\n\t\t\t);\n\t\t\tthis.graph.onNodeConnectionChange(\n\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\tthis,\n\t\t\t\tslot,\n\t\t\t\ttarget_node,\n\t\t\t\ttarget_slot\n\t\t\t);\n\t\t}\n\n        this.setDirtyCanvas(false, true);\n\t\tthis.graph.afterChange();\n\t\tthis.graph.connectionChange(this, link_info);\n\n        return link_info;\n    };\n\n    /**\n     * disconnect one output to an specific node\n     * @method disconnectOutput\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} target_node the target node to which this slot is connected [Optional, if not target_node is specified all nodes will be disconnected]\n     * @return {boolean} if it was disconnected successfully\n     */\n    LGraphNode.prototype.disconnectOutput = function(slot, target_node) {\n        if (slot.constructor === String) {\n            slot = this.findOutputSlot(slot);\n            if (slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\"Connect: Error, no slot of name \" + slot);\n                }\n                return false;\n            }\n        } else if (!this.outputs || slot >= this.outputs.length) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return false;\n        }\n\n        //get output slot\n        var output = this.outputs[slot];\n        if (!output || !output.links || output.links.length == 0) {\n            return false;\n        }\n\n        //one of the output links in this slot\n        if (target_node) {\n            if (target_node.constructor === Number) {\n                target_node = this.graph.getNodeById(target_node);\n            }\n            if (!target_node) {\n                throw \"Target Node not found\";\n            }\n\n            for (var i = 0, l = output.links.length; i < l; i++) {\n                var link_id = output.links[i];\n                var link_info = this.graph.links[link_id];\n\n                //is the link we are searching for...\n                if (link_info.target_id == target_node.id) {\n                    output.links.splice(i, 1); //remove here\n                    var input = target_node.inputs[link_info.target_slot];\n                    input.link = null; //remove there\n                    delete this.graph.links[link_id]; //remove the link from the links pool\n                    if (this.graph) {\n                        this.graph._version++;\n                    }\n                    if (target_node.onConnectionsChange) {\n                        target_node.onConnectionsChange(\n                            LiteGraph.INPUT,\n                            link_info.target_slot,\n                            false,\n                            link_info,\n                            input\n                        );\n                    } //link_info hasn't been modified so its ok\n                    if (this.onConnectionsChange) {\n                        this.onConnectionsChange(\n                            LiteGraph.OUTPUT,\n                            slot,\n                            false,\n                            link_info,\n                            output\n                        );\n                    }\n                    if (this.graph && this.graph.onNodeConnectionChange) {\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.OUTPUT,\n                            this,\n                            slot\n                        );\n                    }\n                    if (this.graph && this.graph.onNodeConnectionChange) {\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.OUTPUT,\n                            this,\n                            slot\n                        );\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.INPUT,\n                            target_node,\n                            link_info.target_slot\n                        );\n                    }\n                    break;\n                }\n            }\n        } //all the links in this output slot\n        else {\n            for (var i = 0, l = output.links.length; i < l; i++) {\n                var link_id = output.links[i];\n                var link_info = this.graph.links[link_id];\n                if (!link_info) {\n                    //bug: it happens sometimes\n                    continue;\n                }\n\n                var target_node = this.graph.getNodeById(link_info.target_id);\n                var input = null;\n                if (this.graph) {\n                    this.graph._version++;\n                }\n                if (target_node) {\n                    input = target_node.inputs[link_info.target_slot];\n                    input.link = null; //remove other side link\n                    if (target_node.onConnectionsChange) {\n                        target_node.onConnectionsChange(\n                            LiteGraph.INPUT,\n                            link_info.target_slot,\n                            false,\n                            link_info,\n                            input\n                        );\n                    } //link_info hasn't been modified so its ok\n                    if (this.graph && this.graph.onNodeConnectionChange) {\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.INPUT,\n                            target_node,\n                            link_info.target_slot\n                        );\n                    }\n                }\n                delete this.graph.links[link_id]; //remove the link from the links pool\n                if (this.onConnectionsChange) {\n                    this.onConnectionsChange(\n                        LiteGraph.OUTPUT,\n                        slot,\n                        false,\n                        link_info,\n                        output\n                    );\n                }\n                if (this.graph && this.graph.onNodeConnectionChange) {\n                    this.graph.onNodeConnectionChange(\n                        LiteGraph.OUTPUT,\n                        this,\n                        slot\n                    );\n                    this.graph.onNodeConnectionChange(\n                        LiteGraph.INPUT,\n                        target_node,\n                        link_info.target_slot\n                    );\n                }\n            }\n            output.links = null;\n        }\n\n        this.setDirtyCanvas(false, true);\n        this.graph.connectionChange(this);\n        return true;\n    };\n\n    /**\n     * disconnect one input\n     * @method disconnectInput\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @return {boolean} if it was disconnected successfully\n     */\n    LGraphNode.prototype.disconnectInput = function(slot) {\n        //seek for the output slot\n        if (slot.constructor === String) {\n            slot = this.findInputSlot(slot);\n            if (slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\"Connect: Error, no slot of name \" + slot);\n                }\n                return false;\n            }\n        } else if (!this.inputs || slot >= this.inputs.length) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return false;\n        }\n\n        var input = this.inputs[slot];\n        if (!input) {\n            return false;\n        }\n\n        var link_id = this.inputs[slot].link;\n\t\tif(link_id != null)\n\t\t{\n\t\t\tthis.inputs[slot].link = null;\n\n\t\t\t//remove other side\n\t\t\tvar link_info = this.graph.links[link_id];\n\t\t\tif (link_info) {\n\t\t\t\tvar target_node = this.graph.getNodeById(link_info.origin_id);\n\t\t\t\tif (!target_node) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar output = target_node.outputs[link_info.origin_slot];\n\t\t\t\tif (!output || !output.links || output.links.length == 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t//search in the inputs list for this link\n\t\t\t\tfor (var i = 0, l = output.links.length; i < l; i++) {\n\t\t\t\t\tif (output.links[i] == link_id) {\n\t\t\t\t\t\toutput.links.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdelete this.graph.links[link_id]; //remove from the pool\n\t\t\t\tif (this.graph) {\n\t\t\t\t\tthis.graph._version++;\n\t\t\t\t}\n\t\t\t\tif (this.onConnectionsChange) {\n\t\t\t\t\tthis.onConnectionsChange(\n\t\t\t\t\t\tLiteGraph.INPUT,\n\t\t\t\t\t\tslot,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tlink_info,\n\t\t\t\t\t\tinput\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (target_node.onConnectionsChange) {\n\t\t\t\t\ttarget_node.onConnectionsChange(\n\t\t\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\t\t\ti,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tlink_info,\n\t\t\t\t\t\toutput\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (this.graph && this.graph.onNodeConnectionChange) {\n\t\t\t\t\tthis.graph.onNodeConnectionChange(\n\t\t\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\t\t\ttarget_node,\n\t\t\t\t\t\ti\n\t\t\t\t\t);\n\t\t\t\t\tthis.graph.onNodeConnectionChange(LiteGraph.INPUT, this, slot);\n\t\t\t\t}\n\t\t\t}\n\t\t} //link != null\n\n        this.setDirtyCanvas(false, true);\n\t\tif(this.graph)\n\t        this.graph.connectionChange(this);\n        return true;\n    };\n\n    /**\n     * returns the center of a connection point in canvas coords\n     * @method getConnectionPos\n     * @param {boolean} is_input true if if a input slot, false if it is an output\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {vec2} out [optional] a place to store the output, to free garbage\n     * @return {[x,y]} the position\n     **/\n    LGraphNode.prototype.getConnectionPos = function(\n        is_input,\n        slot_number,\n        out\n    ) {\n        out = out || new Float32Array(2);\n        var num_slots = 0;\n        if (is_input && this.inputs) {\n            num_slots = this.inputs.length;\n        }\n        if (!is_input && this.outputs) {\n            num_slots = this.outputs.length;\n        }\n\n        var offset = LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n\n        if (this.flags.collapsed) {\n            var w = this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH;\n            if (this.horizontal) {\n                out[0] = this.pos[0] + w * 0.5;\n                if (is_input) {\n                    out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n                } else {\n                    out[1] = this.pos[1];\n                }\n            } else {\n                if (is_input) {\n                    out[0] = this.pos[0];\n                } else {\n                    out[0] = this.pos[0] + w;\n                }\n                out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n            }\n            return out;\n        }\n\n        //weird feature that never got finished\n        if (is_input && slot_number == -1) {\n            out[0] = this.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n            out[1] = this.pos[1] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n            return out;\n        }\n\n        //hard-coded pos\n        if (\n            is_input &&\n            num_slots > slot_number &&\n            this.inputs[slot_number].pos\n        ) {\n            out[0] = this.pos[0] + this.inputs[slot_number].pos[0];\n            out[1] = this.pos[1] + this.inputs[slot_number].pos[1];\n            return out;\n        } else if (\n            !is_input &&\n            num_slots > slot_number &&\n            this.outputs[slot_number].pos\n        ) {\n            out[0] = this.pos[0] + this.outputs[slot_number].pos[0];\n            out[1] = this.pos[1] + this.outputs[slot_number].pos[1];\n            return out;\n        }\n\n        //horizontal distributed slots\n        if (this.horizontal) {\n            out[0] =\n                this.pos[0] + (slot_number + 0.5) * (this.size[0] / num_slots);\n            if (is_input) {\n                out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n            } else {\n                out[1] = this.pos[1] + this.size[1];\n            }\n            return out;\n        }\n\n        //default vertical slots\n        if (is_input) {\n            out[0] = this.pos[0] + offset;\n        } else {\n            out[0] = this.pos[0] + this.size[0] + 1 - offset;\n        }\n        out[1] =\n            this.pos[1] +\n            (slot_number + 0.7) * LiteGraph.NODE_SLOT_HEIGHT +\n            (this.constructor.slot_start_y || 0);\n        return out;\n    };\n\n    /* Force align to grid */\n    LGraphNode.prototype.alignToGrid = function() {\n        this.pos[0] =\n            LiteGraph.CANVAS_GRID_SIZE *\n            Math.round(this.pos[0] / LiteGraph.CANVAS_GRID_SIZE);\n        this.pos[1] =\n            LiteGraph.CANVAS_GRID_SIZE *\n            Math.round(this.pos[1] / LiteGraph.CANVAS_GRID_SIZE);\n    };\n\n    /* Console output */\n    LGraphNode.prototype.trace = function(msg) {\n        if (!this.console) {\n            this.console = [];\n        }\n\n        this.console.push(msg);\n        if (this.console.length > LGraphNode.MAX_CONSOLE) {\n            this.console.shift();\n        }\n\n\t\tif(this.graph.onNodeTrace)\n\t        this.graph.onNodeTrace(this, msg);\n    };\n\n    /* Forces to redraw or the main canvas (LGraphNode) or the bg canvas (links) */\n    LGraphNode.prototype.setDirtyCanvas = function(\n        dirty_foreground,\n        dirty_background\n    ) {\n        if (!this.graph) {\n            return;\n        }\n        this.graph.sendActionToCanvas(\"setDirty\", [\n            dirty_foreground,\n            dirty_background\n        ]);\n    };\n\n    LGraphNode.prototype.loadImage = function(url) {\n        var img = new Image();\n        img.src = LiteGraph.node_images_path + url;\n        img.ready = false;\n\n        var that = this;\n        img.onload = function() {\n            this.ready = true;\n            that.setDirtyCanvas(true);\n        };\n        return img;\n    };\n\n    //safe LGraphNode action execution (not sure if safe)\n    /*\nLGraphNode.prototype.executeAction = function(action)\n{\n\tif(action == \"\") return false;\n\n\tif( action.indexOf(\";\") != -1 || action.indexOf(\"}\") != -1)\n\t{\n\t\tthis.trace(\"Error: Action contains unsafe characters\");\n\t\treturn false;\n\t}\n\n\tvar tokens = action.split(\"(\");\n\tvar func_name = tokens[0];\n\tif( typeof(this[func_name]) != \"function\")\n\t{\n\t\tthis.trace(\"Error: Action not found on node: \" + func_name);\n\t\treturn false;\n\t}\n\n\tvar code = action;\n\n\ttry\n\t{\n\t\tvar _foo = eval;\n\t\teval = null;\n\t\t(new Function(\"with(this) { \" + code + \"}\")).call(this);\n\t\teval = _foo;\n\t}\n\tcatch (err)\n\t{\n\t\tthis.trace(\"Error executing action {\" + action + \"} :\" + err);\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n*/\n\n    /* Allows to get onMouseMove and onMouseUp events even if the mouse is out of focus */\n    LGraphNode.prototype.captureInput = function(v) {\n        if (!this.graph || !this.graph.list_of_graphcanvas) {\n            return;\n        }\n\n        var list = this.graph.list_of_graphcanvas;\n\n        for (var i = 0; i < list.length; ++i) {\n            var c = list[i];\n            //releasing somebody elses capture?!\n            if (!v && c.node_capturing_input != this) {\n                continue;\n            }\n\n            //change\n            c.node_capturing_input = v ? this : null;\n        }\n    };\n\n    /**\n     * Collapse the node to make it smaller on the canvas\n     * @method collapse\n     **/\n    LGraphNode.prototype.collapse = function(force) {\n        this.graph._version++;\n        if (this.constructor.collapsable === false && !force) {\n            return;\n        }\n        if (!this.flags.collapsed) {\n            this.flags.collapsed = true;\n        } else {\n            this.flags.collapsed = false;\n        }\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * Forces the node to do not move or realign on Z\n     * @method pin\n     **/\n\n    LGraphNode.prototype.pin = function(v) {\n        this.graph._version++;\n        if (v === undefined) {\n            this.flags.pinned = !this.flags.pinned;\n        } else {\n            this.flags.pinned = v;\n        }\n    };\n\n    LGraphNode.prototype.localToScreen = function(x, y, graphcanvas) {\n        return [\n            (x + this.pos[0]) * graphcanvas.scale + graphcanvas.offset[0],\n            (y + this.pos[1]) * graphcanvas.scale + graphcanvas.offset[1]\n        ];\n    };\n\n    function LGraphGroup(title) {\n        this._ctor(title);\n    }\n\n    global.LGraphGroup = LiteGraph.LGraphGroup = LGraphGroup;\n\n    LGraphGroup.prototype._ctor = function(title) {\n        this.title = title || \"Group\";\n        this.font_size = 24;\n        this.color = LGraphCanvas.node_colors.pale_blue\n            ? LGraphCanvas.node_colors.pale_blue.groupcolor\n            : \"#AAA\";\n        this._bounding = new Float32Array([10, 10, 140, 80]);\n        this._pos = this._bounding.subarray(0, 2);\n        this._size = this._bounding.subarray(2, 4);\n        this._nodes = [];\n        this.graph = null;\n\n        Object.defineProperty(this, \"pos\", {\n            set: function(v) {\n                if (!v || v.length < 2) {\n                    return;\n                }\n                this._pos[0] = v[0];\n                this._pos[1] = v[1];\n            },\n            get: function() {\n                return this._pos;\n            },\n            enumerable: true\n        });\n\n        Object.defineProperty(this, \"size\", {\n            set: function(v) {\n                if (!v || v.length < 2) {\n                    return;\n                }\n                this._size[0] = Math.max(140, v[0]);\n                this._size[1] = Math.max(80, v[1]);\n            },\n            get: function() {\n                return this._size;\n            },\n            enumerable: true\n        });\n    };\n\n    LGraphGroup.prototype.configure = function(o) {\n        this.title = o.title;\n        this._bounding.set(o.bounding);\n        this.color = o.color;\n        this.font_size = o.font_size;\n    };\n\n    LGraphGroup.prototype.serialize = function() {\n        var b = this._bounding;\n        return {\n            title: this.title,\n            bounding: [\n                Math.round(b[0]),\n                Math.round(b[1]),\n                Math.round(b[2]),\n                Math.round(b[3])\n            ],\n            color: this.color,\n            font_size: this.font_size\n        };\n    };\n\n    LGraphGroup.prototype.move = function(deltax, deltay, ignore_nodes) {\n        this._pos[0] += deltax;\n        this._pos[1] += deltay;\n        if (ignore_nodes) {\n            return;\n        }\n        for (var i = 0; i < this._nodes.length; ++i) {\n            var node = this._nodes[i];\n            node.pos[0] += deltax;\n            node.pos[1] += deltay;\n        }\n    };\n\n    LGraphGroup.prototype.recomputeInsideNodes = function() {\n        this._nodes.length = 0;\n        var nodes = this.graph._nodes;\n        var node_bounding = new Float32Array(4);\n\n        for (var i = 0; i < nodes.length; ++i) {\n            var node = nodes[i];\n            node.getBounding(node_bounding);\n            if (!overlapBounding(this._bounding, node_bounding)) {\n                continue;\n            } //out of the visible area\n            this._nodes.push(node);\n        }\n    };\n\n    LGraphGroup.prototype.isPointInside = LGraphNode.prototype.isPointInside;\n    LGraphGroup.prototype.setDirtyCanvas = LGraphNode.prototype.setDirtyCanvas;\n\n    //****************************************\n\n    //Scale and Offset\n    function DragAndScale(element, skip_events) {\n        this.offset = new Float32Array([0, 0]);\n        this.scale = 1;\n        this.max_scale = 10;\n        this.min_scale = 0.1;\n        this.onredraw = null;\n        this.enabled = true;\n        this.last_mouse = [0, 0];\n        this.element = null;\n        this.visible_area = new Float32Array(4);\n\n        if (element) {\n            this.element = element;\n            if (!skip_events) {\n                this.bindEvents(element);\n            }\n        }\n    }\n\n    LiteGraph.DragAndScale = DragAndScale;\n\n    DragAndScale.prototype.bindEvents = function(element) {\n        this.last_mouse = new Float32Array(2);\n\n        this._binded_mouse_callback = this.onMouse.bind(this);\n\n\t\tLiteGraph.pointerListenerAdd(element,\"down\", this._binded_mouse_callback);\n\t\tLiteGraph.pointerListenerAdd(element,\"move\", this._binded_mouse_callback);\n\t\tLiteGraph.pointerListenerAdd(element,\"up\", this._binded_mouse_callback);\n\n        element.addEventListener(\n            \"mousewheel\",\n            this._binded_mouse_callback,\n            false\n        );\n        element.addEventListener(\"wheel\", this._binded_mouse_callback, false);\n    };\n\n    DragAndScale.prototype.computeVisibleArea = function( viewport ) {\n        if (!this.element) {\n            this.visible_area[0] = this.visible_area[1] = this.visible_area[2] = this.visible_area[3] = 0;\n            return;\n        }\n        var width = this.element.width;\n        var height = this.element.height;\n        var startx = -this.offset[0];\n        var starty = -this.offset[1];\n\t\tif( viewport )\n\t\t{\n\t\t\tstartx += viewport[0] / this.scale;\n\t\t\tstarty += viewport[1] / this.scale;\n\t\t\twidth = viewport[2];\n\t\t\theight = viewport[3];\n\t\t}\n        var endx = startx + width / this.scale;\n        var endy = starty + height / this.scale;\n        this.visible_area[0] = startx;\n        this.visible_area[1] = starty;\n        this.visible_area[2] = endx - startx;\n        this.visible_area[3] = endy - starty;\n    };\n\n    DragAndScale.prototype.onMouse = function(e) {\n        if (!this.enabled) {\n            return;\n        }\n\n        var canvas = this.element;\n        var rect = canvas.getBoundingClientRect();\n        var x = e.clientX - rect.left;\n        var y = e.clientY - rect.top;\n        e.canvasx = x;\n        e.canvasy = y;\n        e.dragging = this.dragging;\n        \n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\n\t\t//console.log(\"pointerevents: DragAndScale onMouse \"+e.type+\" \"+is_inside);\n\t\t\n        var ignore = false;\n        if (this.onmouse) {\n            ignore = this.onmouse(e);\n        }\n\n        if (e.type == LiteGraph.pointerevents_method+\"down\" && is_inside) {\n            this.dragging = true;\n\t\t\tLiteGraph.pointerListenerRemove(canvas,\"move\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerAdd(document,\"move\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerAdd(document,\"up\",this._binded_mouse_callback);\n        } else if (e.type == LiteGraph.pointerevents_method+\"move\") {\n            if (!ignore) {\n                var deltax = x - this.last_mouse[0];\n                var deltay = y - this.last_mouse[1];\n                if (this.dragging) {\n                    this.mouseDrag(deltax, deltay);\n                }\n            }\n        } else if (e.type == LiteGraph.pointerevents_method+\"up\") {\n            this.dragging = false;\n\t\t\tLiteGraph.pointerListenerRemove(document,\"move\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerRemove(document,\"up\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerAdd(canvas,\"move\",this._binded_mouse_callback);\n        } else if ( is_inside &&\n            (e.type == \"mousewheel\" ||\n            e.type == \"wheel\" ||\n            e.type == \"DOMMouseScroll\")\n        ) {\n            e.eventType = \"mousewheel\";\n            if (e.type == \"wheel\") {\n                e.wheel = -e.deltaY;\n            } else {\n                e.wheel =\n                    e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n            }\n\n            //from stack overflow\n            e.delta = e.wheelDelta\n                ? e.wheelDelta / 40\n                : e.deltaY\n                ? -e.deltaY / 3\n                : 0;\n            this.changeDeltaScale(1.0 + e.delta * 0.05);\n        }\n\n        this.last_mouse[0] = x;\n        this.last_mouse[1] = y;\n\n\t\tif(is_inside)\n\t\t{\n\t        e.preventDefault();\n\t\t    e.stopPropagation();\n\t\t    return false;\n\t\t}\n    };\n\n    DragAndScale.prototype.toCanvasContext = function(ctx) {\n        ctx.scale(this.scale, this.scale);\n        ctx.translate(this.offset[0], this.offset[1]);\n    };\n\n    DragAndScale.prototype.convertOffsetToCanvas = function(pos) {\n        //return [pos[0] / this.scale - this.offset[0], pos[1] / this.scale - this.offset[1]];\n        return [\n            (pos[0] + this.offset[0]) * this.scale,\n            (pos[1] + this.offset[1]) * this.scale\n        ];\n    };\n\n    DragAndScale.prototype.convertCanvasToOffset = function(pos, out) {\n        out = out || [0, 0];\n        out[0] = pos[0] / this.scale - this.offset[0];\n        out[1] = pos[1] / this.scale - this.offset[1];\n        return out;\n    };\n\n    DragAndScale.prototype.mouseDrag = function(x, y) {\n        this.offset[0] += x / this.scale;\n        this.offset[1] += y / this.scale;\n\n        if (this.onredraw) {\n            this.onredraw(this);\n        }\n    };\n\n    DragAndScale.prototype.changeScale = function(value, zooming_center) {\n        if (value < this.min_scale) {\n            value = this.min_scale;\n        } else if (value > this.max_scale) {\n            value = this.max_scale;\n        }\n\n        if (value == this.scale) {\n            return;\n        }\n\n        if (!this.element) {\n            return;\n        }\n\n        var rect = this.element.getBoundingClientRect();\n        if (!rect) {\n            return;\n        }\n\n        zooming_center = zooming_center || [\n            rect.width * 0.5,\n            rect.height * 0.5\n        ];\n        var center = this.convertCanvasToOffset(zooming_center);\n        this.scale = value;\n        if (Math.abs(this.scale - 1) < 0.01) {\n            this.scale = 1;\n        }\n\n        var new_center = this.convertCanvasToOffset(zooming_center);\n        var delta_offset = [\n            new_center[0] - center[0],\n            new_center[1] - center[1]\n        ];\n\n        this.offset[0] += delta_offset[0];\n        this.offset[1] += delta_offset[1];\n\n        if (this.onredraw) {\n            this.onredraw(this);\n        }\n    };\n\n    DragAndScale.prototype.changeDeltaScale = function(value, zooming_center) {\n        this.changeScale(this.scale * value, zooming_center);\n    };\n\n    DragAndScale.prototype.reset = function() {\n        this.scale = 1;\n        this.offset[0] = 0;\n        this.offset[1] = 0;\n    };\n\n    //*********************************************************************************\n    // LGraphCanvas: LGraph renderer CLASS\n    //*********************************************************************************\n\n    /**\n     * This class is in charge of rendering one graph inside a canvas. And provides all the interaction required.\n     * Valid callbacks are: onNodeSelected, onNodeDeselected, onShowNodePanel, onNodeDblClicked\n     *\n     * @class LGraphCanvas\n     * @constructor\n     * @param {HTMLCanvas} canvas the canvas where you want to render (it accepts a selector in string format or the canvas element itself)\n     * @param {LGraph} graph [optional]\n     * @param {Object} options [optional] { skip_rendering, autoresize, viewport }\n     */\n    function LGraphCanvas(canvas, graph, options) {\n        this.options = options = options || {};\n\n        //if(graph === undefined)\n        //\tthrow (\"No graph assigned\");\n        this.background_image = LGraphCanvas.DEFAULT_BACKGROUND_IMAGE;\n\n        if (canvas && canvas.constructor === String) {\n            canvas = document.querySelector(canvas);\n        }\n\n        this.ds = new DragAndScale();\n        this.zoom_modify_alpha = true; //otherwise it generates ugly patterns when scaling down too much\n\n        this.title_text_font = \"\" + LiteGraph.NODE_TEXT_SIZE + \"px Arial\";\n        this.inner_text_font =\n            \"normal \" + LiteGraph.NODE_SUBTEXT_SIZE + \"px Arial\";\n        this.node_title_color = LiteGraph.NODE_TITLE_COLOR;\n        this.default_link_color = LiteGraph.LINK_COLOR;\n        this.default_connection_color = {\n            input_off: \"#778\",\n            input_on: \"#7F7\", //\"#BBD\"\n            output_off: \"#778\",\n            output_on: \"#7F7\" //\"#BBD\"\n\t\t};\n        this.default_connection_color_byType = {\n            /*number: \"#7F7\",\n            string: \"#77F\",\n            boolean: \"#F77\",*/\n        }\n        this.default_connection_color_byTypeOff = {\n            /*number: \"#474\",\n            string: \"#447\",\n            boolean: \"#744\",*/\n        };\n\n        this.highquality_render = true;\n        this.use_gradients = false; //set to true to render titlebar with gradients\n        this.editor_alpha = 1; //used for transition\n        this.pause_rendering = false;\n        this.clear_background = true;\n        this.clear_background_color = \"#222\";\n\n\t\tthis.read_only = false; //if set to true users cannot modify the graph\n        this.render_only_selected = true;\n        this.live_mode = false;\n        this.show_info = true;\n        this.allow_dragcanvas = true;\n        this.allow_dragnodes = true;\n        this.allow_interaction = true; //allow to control widgets, buttons, collapse, etc\n        this.multi_select = false; //allow selecting multi nodes without pressing extra keys\n        this.allow_searchbox = true;\n        this.allow_reconnect_links = true; //allows to change a connection with having to redo it again\n\t\tthis.align_to_grid = false; //snap to grid\n\n        this.drag_mode = false;\n        this.dragging_rectangle = null;\n\n        this.filter = null; //allows to filter to only accept some type of nodes in a graph\n\n\t\tthis.set_canvas_dirty_on_mouse_event = true; //forces to redraw the canvas if the mouse does anything\n        this.always_render_background = false;\n        this.render_shadows = true;\n        this.render_canvas_border = true;\n        this.render_connections_shadows = false; //too much cpu\n        this.render_connections_border = true;\n        this.render_curved_connections = false;\n        this.render_connection_arrows = false;\n        this.render_collapsed_slots = true;\n        this.render_execution_order = false;\n        this.render_title_colored = true;\n\t\tthis.render_link_tooltip = true;\n\n        this.links_render_mode = LiteGraph.SPLINE_LINK;\n\n        this.mouse = [0, 0]; //mouse in canvas coordinates, where 0,0 is the top-left corner of the blue rectangle\n        this.graph_mouse = [0, 0]; //mouse in graph coordinates, where 0,0 is the top-left corner of the blue rectangle\n\t\tthis.canvas_mouse = this.graph_mouse; //LEGACY: REMOVE THIS, USE GRAPH_MOUSE INSTEAD\n\n        //to personalize the search box\n        this.onSearchBox = null;\n        this.onSearchBoxSelection = null;\n\n        //callbacks\n        this.onMouse = null;\n        this.onDrawBackground = null; //to render background objects (behind nodes and connections) in the canvas affected by transform\n        this.onDrawForeground = null; //to render foreground objects (above nodes and connections) in the canvas affected by transform\n        this.onDrawOverlay = null; //to render foreground objects not affected by transform (for GUIs)\n\t\tthis.onDrawLinkTooltip = null; //called when rendering a tooltip\n\t\tthis.onNodeMoved = null; //called after moving a node\n\t\tthis.onSelectionChange = null; //called if the selection changes\n\t\tthis.onConnectingChange = null; //called before any link changes\n\t\tthis.onBeforeChange = null; //called before modifying the graph\n\t\tthis.onAfterChange = null; //called after modifying the graph\n\n        this.connections_width = 3;\n        this.round_radius = 8;\n\n        this.current_node = null;\n        this.node_widget = null; //used for widgets\n\t\tthis.over_link_center = null;\n        this.last_mouse_position = [0, 0];\n        this.visible_area = this.ds.visible_area;\n        this.visible_links = [];\n\n\t\tthis.viewport = options.viewport || null; //to constraint render area to a portion of the canvas\n\n        //link canvas and graph\n        if (graph) {\n            graph.attachCanvas(this);\n        }\n\n        this.setCanvas(canvas,options.skip_events);\n        this.clear();\n\n        if (!options.skip_render) {\n            this.startRendering();\n        }\n\n        this.autoresize = options.autoresize;\n    }\n\n    global.LGraphCanvas = LiteGraph.LGraphCanvas = LGraphCanvas;\n\n\tLGraphCanvas.DEFAULT_BACKGROUND_IMAGE = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=\";\n\n    LGraphCanvas.link_type_colors = {\n        \"-1\": LiteGraph.EVENT_LINK_COLOR,\n        number: \"#AAA\",\n        node: \"#DCA\"\n    };\n    LGraphCanvas.gradients = {}; //cache of gradients\n\n    /**\n     * clears all the data inside\n     *\n     * @method clear\n     */\n    LGraphCanvas.prototype.clear = function() {\n        this.frame = 0;\n        this.last_draw_time = 0;\n        this.render_time = 0;\n        this.fps = 0;\n\n        //this.scale = 1;\n        //this.offset = [0,0];\n\n        this.dragging_rectangle = null;\n\n        this.selected_nodes = {};\n        this.selected_group = null;\n\n        this.visible_nodes = [];\n        this.node_dragged = null;\n        this.node_over = null;\n        this.node_capturing_input = null;\n        this.connecting_node = null;\n        this.highlighted_links = {};\n\n\t\tthis.dragging_canvas = false;\n\n        this.dirty_canvas = true;\n        this.dirty_bgcanvas = true;\n        this.dirty_area = null;\n\n        this.node_in_panel = null;\n        this.node_widget = null;\n\n        this.last_mouse = [0, 0];\n        this.last_mouseclick = 0;\n\t  \tthis.pointer_is_down = false;\n\t  \tthis.pointer_is_double = false;\n        this.visible_area.set([0, 0, 0, 0]);\n\n        if (this.onClear) {\n            this.onClear();\n        }\n    };\n\n    /**\n     * assigns a graph, you can reassign graphs to the same canvas\n     *\n     * @method setGraph\n     * @param {LGraph} graph\n     */\n    LGraphCanvas.prototype.setGraph = function(graph, skip_clear) {\n        if (this.graph == graph) {\n            return;\n        }\n\n        if (!skip_clear) {\n            this.clear();\n        }\n\n        if (!graph && this.graph) {\n            this.graph.detachCanvas(this);\n            return;\n        }\n\n        graph.attachCanvas(this);\n\n\t\t//remove the graph stack in case a subgraph was open\n\t\tif (this._graph_stack)\n\t\t\tthis._graph_stack = null;\n\n        this.setDirty(true, true);\n    };\n\n    /**\n     * returns the top level graph (in case there are subgraphs open on the canvas)\n     *\n     * @method getTopGraph\n     * @return {LGraph} graph\n     */\n\tLGraphCanvas.prototype.getTopGraph = function()\n\t{\n\t\tif(this._graph_stack.length)\n\t\t\treturn this._graph_stack[0];\n\t\treturn this.graph;\n\t}\n\n    /**\n     * opens a graph contained inside a node in the current graph\n     *\n     * @method openSubgraph\n     * @param {LGraph} graph\n     */\n    LGraphCanvas.prototype.openSubgraph = function(graph) {\n        if (!graph) {\n            throw \"graph cannot be null\";\n        }\n\n        if (this.graph == graph) {\n            throw \"graph cannot be the same\";\n        }\n\n        this.clear();\n\n        if (this.graph) {\n            if (!this._graph_stack) {\n                this._graph_stack = [];\n            }\n            this._graph_stack.push(this.graph);\n        }\n\n        graph.attachCanvas(this);\n\t\tthis.checkPanels();\n        this.setDirty(true, true);\n    };\n\n    /**\n     * closes a subgraph contained inside a node\n     *\n     * @method closeSubgraph\n     * @param {LGraph} assigns a graph\n     */\n    LGraphCanvas.prototype.closeSubgraph = function() {\n        if (!this._graph_stack || this._graph_stack.length == 0) {\n            return;\n        }\n        var subgraph_node = this.graph._subgraph_node;\n        var graph = this._graph_stack.pop();\n        this.selected_nodes = {};\n        this.highlighted_links = {};\n        graph.attachCanvas(this);\n        this.setDirty(true, true);\n        if (subgraph_node) {\n            this.centerOnNode(subgraph_node);\n            this.selectNodes([subgraph_node]);\n        }\n        // when close sub graph back to offset [0, 0] scale 1\n        this.ds.offset = [0, 0]\n        this.ds.scale = 1\n    };\n\n    /**\n     * returns the visually active graph (in case there are more in the stack)\n     * @method getCurrentGraph\n     * @return {LGraph} the active graph\n     */\n    LGraphCanvas.prototype.getCurrentGraph = function() {\n        return this.graph;\n    };\n\n    /**\n     * assigns a canvas\n     *\n     * @method setCanvas\n     * @param {Canvas} assigns a canvas (also accepts the ID of the element (not a selector)\n     */\n    LGraphCanvas.prototype.setCanvas = function(canvas, skip_events) {\n        var that = this;\n\n        if (canvas) {\n            if (canvas.constructor === String) {\n                canvas = document.getElementById(canvas);\n                if (!canvas) {\n                    throw \"Error creating LiteGraph canvas: Canvas not found\";\n                }\n            }\n        }\n\n        if (canvas === this.canvas) {\n            return;\n        }\n\n        if (!canvas && this.canvas) {\n            //maybe detach events from old_canvas\n            if (!skip_events) {\n                this.unbindEvents();\n            }\n        }\n\n        this.canvas = canvas;\n        this.ds.element = canvas;\n\n        if (!canvas) {\n            return;\n        }\n\n        //this.canvas.tabindex = \"1000\";\n        canvas.className += \" lgraphcanvas\";\n        canvas.data = this;\n        canvas.tabindex = \"1\"; //to allow key events\n\n        //bg canvas: used for non changing stuff\n        this.bgcanvas = null;\n        if (!this.bgcanvas) {\n            this.bgcanvas = document.createElement(\"canvas\");\n            this.bgcanvas.width = this.canvas.width;\n            this.bgcanvas.height = this.canvas.height;\n        }\n\n        if (canvas.getContext == null) {\n            if (canvas.localName != \"canvas\") {\n                throw \"Element supplied for LGraphCanvas must be a <canvas> element, you passed a \" +\n                    canvas.localName;\n            }\n            throw \"This browser doesn't support Canvas\";\n        }\n\n        var ctx = (this.ctx = canvas.getContext(\"2d\"));\n        if (ctx == null) {\n            if (!canvas.webgl_enabled) {\n                console.warn(\n                    \"This canvas seems to be WebGL, enabling WebGL renderer\"\n                );\n            }\n            this.enableWebGL();\n        }\n\n        //input:  (move and up could be unbinded)\n        // why here? this._mousemove_callback = this.processMouseMove.bind(this);\n        // why here? this._mouseup_callback = this.processMouseUp.bind(this);\n\n        if (!skip_events) {\n            this.bindEvents();\n        }\n    };\n\n    //used in some events to capture them\n    LGraphCanvas.prototype._doNothing = function doNothing(e) {\n    \t//console.log(\"pointerevents: _doNothing \"+e.type);\n        e.preventDefault();\n        return false;\n    };\n    LGraphCanvas.prototype._doReturnTrue = function doNothing(e) {\n        e.preventDefault();\n        return true;\n    };\n\n    /**\n     * binds mouse, keyboard, touch and drag events to the canvas\n     * @method bindEvents\n     **/\n    LGraphCanvas.prototype.bindEvents = function() {\n        if (this._events_binded) {\n            console.warn(\"LGraphCanvas: events already binded\");\n            return;\n        }\n\n        //console.log(\"pointerevents: bindEvents\");\n        \n        var canvas = this.canvas;\n\n        var ref_window = this.getCanvasWindow();\n        var document = ref_window.document; //hack used when moving canvas between windows\n\n        this._mousedown_callback = this.processMouseDown.bind(this);\n        this._mousewheel_callback = this.processMouseWheel.bind(this);\n        // why mousemove and mouseup were not binded here?\n        this._mousemove_callback = this.processMouseMove.bind(this);\n        this._mouseup_callback = this.processMouseUp.bind(this);\n        \n        //touch events -- TODO IMPLEMENT\n        //this._touch_callback = this.touchHandler.bind(this);\n\n\t\tLiteGraph.pointerListenerAdd(canvas,\"down\", this._mousedown_callback, true); //down do not need to store the binded\n        canvas.addEventListener(\"mousewheel\", this._mousewheel_callback, false);\n\n        LiteGraph.pointerListenerAdd(canvas,\"up\", this._mouseup_callback, true); // CHECK: ??? binded or not\n\t\tLiteGraph.pointerListenerAdd(canvas,\"move\", this._mousemove_callback);\n        \n        canvas.addEventListener(\"contextmenu\", this._doNothing);\n        canvas.addEventListener(\n            \"DOMMouseScroll\",\n            this._mousewheel_callback,\n            false\n        );\n\n        //touch events -- THIS WAY DOES NOT WORK, finish implementing pointerevents, than clean the touchevents\n        /*if( 'touchstart' in document.documentElement )\n        {\n            canvas.addEventListener(\"touchstart\", this._touch_callback, true);\n            canvas.addEventListener(\"touchmove\", this._touch_callback, true);\n            canvas.addEventListener(\"touchend\", this._touch_callback, true);\n            canvas.addEventListener(\"touchcancel\", this._touch_callback, true);\n        }*/\n\n        //Keyboard ******************\n        this._key_callback = this.processKey.bind(this);\n        canvas.setAttribute(\"tabindex\",1); //otherwise key events are ignored\n        canvas.addEventListener(\"keydown\", this._key_callback, true);\n        document.addEventListener(\"keyup\", this._key_callback, true); //in document, otherwise it doesn't fire keyup\n\n        //Dropping Stuff over nodes ************************************\n        this._ondrop_callback = this.processDrop.bind(this);\n\n        canvas.addEventListener(\"dragover\", this._doNothing, false);\n        canvas.addEventListener(\"dragend\", this._doNothing, false);\n        canvas.addEventListener(\"drop\", this._ondrop_callback, false);\n        canvas.addEventListener(\"dragenter\", this._doReturnTrue, false);\n\n        this._events_binded = true;\n    };\n\n    /**\n     * unbinds mouse events from the canvas\n     * @method unbindEvents\n     **/\n    LGraphCanvas.prototype.unbindEvents = function() {\n        if (!this._events_binded) {\n            console.warn(\"LGraphCanvas: no events binded\");\n            return;\n        }\n\n        //console.log(\"pointerevents: unbindEvents\");\n        \n        var ref_window = this.getCanvasWindow();\n        var document = ref_window.document;\n\n\t\tLiteGraph.pointerListenerRemove(this.canvas,\"move\", this._mousedown_callback);\n        LiteGraph.pointerListenerRemove(this.canvas,\"up\", this._mousedown_callback);\n        LiteGraph.pointerListenerRemove(this.canvas,\"down\", this._mousedown_callback);\n        this.canvas.removeEventListener(\n            \"mousewheel\",\n            this._mousewheel_callback\n        );\n        this.canvas.removeEventListener(\n            \"DOMMouseScroll\",\n            this._mousewheel_callback\n        );\n        this.canvas.removeEventListener(\"keydown\", this._key_callback);\n        document.removeEventListener(\"keyup\", this._key_callback);\n        this.canvas.removeEventListener(\"contextmenu\", this._doNothing);\n        this.canvas.removeEventListener(\"drop\", this._ondrop_callback);\n        this.canvas.removeEventListener(\"dragenter\", this._doReturnTrue);\n\n        //touch events -- THIS WAY DOES NOT WORK, finish implementing pointerevents, than clean the touchevents\n        /*this.canvas.removeEventListener(\"touchstart\", this._touch_callback );\n        this.canvas.removeEventListener(\"touchmove\", this._touch_callback );\n        this.canvas.removeEventListener(\"touchend\", this._touch_callback );\n        this.canvas.removeEventListener(\"touchcancel\", this._touch_callback );*/\n\n        this._mousedown_callback = null;\n        this._mousewheel_callback = null;\n        this._key_callback = null;\n        this._ondrop_callback = null;\n\n        this._events_binded = false;\n    };\n\n    LGraphCanvas.getFileExtension = function(url) {\n        var question = url.indexOf(\"?\");\n        if (question != -1) {\n            url = url.substr(0, question);\n        }\n        var point = url.lastIndexOf(\".\");\n        if (point == -1) {\n            return \"\";\n        }\n        return url.substr(point + 1).toLowerCase();\n    };\n\n    /**\n     * this function allows to render the canvas using WebGL instead of Canvas2D\n     * this is useful if you plant to render 3D objects inside your nodes, it uses litegl.js for webgl and canvas2DtoWebGL to emulate the Canvas2D calls in webGL\n     * @method enableWebGL\n     **/\n    LGraphCanvas.prototype.enableWebGL = function() {\n        if (typeof GL === \"undefined\") {\n            throw \"litegl.js must be included to use a WebGL canvas\";\n        }\n        if (typeof enableWebGLCanvas === \"undefined\") {\n            throw \"webglCanvas.js must be included to use this feature\";\n        }\n\n        this.gl = this.ctx = enableWebGLCanvas(this.canvas);\n        this.ctx.webgl = true;\n        this.bgcanvas = this.canvas;\n        this.bgctx = this.gl;\n        this.canvas.webgl_enabled = true;\n\n        /*\n\tGL.create({ canvas: this.bgcanvas });\n\tthis.bgctx = enableWebGLCanvas( this.bgcanvas );\n\twindow.gl = this.gl;\n\t*/\n    };\n\n    /**\n     * marks as dirty the canvas, this way it will be rendered again\n     *\n     * @class LGraphCanvas\n     * @method setDirty\n     * @param {bool} fgcanvas if the foreground canvas is dirty (the one containing the nodes)\n     * @param {bool} bgcanvas if the background canvas is dirty (the one containing the wires)\n     */\n    LGraphCanvas.prototype.setDirty = function(fgcanvas, bgcanvas) {\n        if (fgcanvas) {\n            this.dirty_canvas = true;\n        }\n        if (bgcanvas) {\n            this.dirty_bgcanvas = true;\n        }\n    };\n\n    /**\n     * Used to attach the canvas in a popup\n     *\n     * @method getCanvasWindow\n     * @return {window} returns the window where the canvas is attached (the DOM root node)\n     */\n    LGraphCanvas.prototype.getCanvasWindow = function() {\n        if (!this.canvas) {\n            return window;\n        }\n        var doc = this.canvas.ownerDocument;\n        return doc.defaultView || doc.parentWindow;\n    };\n\n    /**\n     * starts rendering the content of the canvas when needed\n     *\n     * @method startRendering\n     */\n    LGraphCanvas.prototype.startRendering = function() {\n        if (this.is_rendering) {\n            return;\n        } //already rendering\n\n        this.is_rendering = true;\n        renderFrame.call(this);\n\n        function renderFrame() {\n            if (!this.pause_rendering) {\n                this.draw();\n            }\n\n            var window = this.getCanvasWindow();\n            if (this.is_rendering) {\n                window.requestAnimationFrame(renderFrame.bind(this));\n            }\n        }\n    };\n\n    /**\n     * stops rendering the content of the canvas (to save resources)\n     *\n     * @method stopRendering\n     */\n    LGraphCanvas.prototype.stopRendering = function() {\n        this.is_rendering = false;\n        /*\n\tif(this.rendering_timer_id)\n\t{\n\t\tclearInterval(this.rendering_timer_id);\n\t\tthis.rendering_timer_id = null;\n\t}\n\t*/\n    };\n\n    /* LiteGraphCanvas input */\n\n\t//used to block future mouse events (because of im gui)\n\tLGraphCanvas.prototype.blockClick = function()\n\t{\n\t\tthis.block_click = true;\n\t\tthis.last_mouseclick = 0;\n\t}\n\t\n    LGraphCanvas.prototype.processMouseDown = function(e) {\n    \t\n\t\tif( this.set_canvas_dirty_on_mouse_event )\n\t\t\tthis.dirty_canvas = true;\n\t\t\n\t\tif (!this.graph) {\n            return;\n        }\n\n        this.adjustMouseEvent(e);\n\n        var ref_window = this.getCanvasWindow();\n        var document = ref_window.document;\n        LGraphCanvas.active_canvas = this;\n        var that = this;\n\n\t\tvar x = e.clientX;\n\t\tvar y = e.clientY;\n\t\t//console.log(y,this.viewport);\n\t\t//console.log(\"pointerevents: processMouseDown pointerId:\"+e.pointerId+\" which:\"+e.which+\" isPrimary:\"+e.isPrimary+\" :: x y \"+x+\" \"+y);\n\n\t\tthis.ds.viewport = this.viewport;\n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\n        //move mouse move event to the window in case it drags outside of the canvas\n\t\tif(!this.options.skip_events)\n\t\t{\n\t\t\tLiteGraph.pointerListenerRemove(this.canvas,\"move\", this._mousemove_callback);\n\t\t\tLiteGraph.pointerListenerAdd(ref_window.document,\"move\", this._mousemove_callback,true); //catch for the entire window\n\t\t\tLiteGraph.pointerListenerAdd(ref_window.document,\"up\", this._mouseup_callback,true);\n\t\t}\n\n\t\tif(!is_inside){\n\t\t\treturn;\n\t\t}\n\n        var node = this.graph.getNodeOnPos( e.canvasX, e.canvasY, this.visible_nodes, 5 );\n        var skip_dragging = false;\n        var skip_action = false;\n        var now = LiteGraph.getTime();\n\t\tvar is_primary = (e.isPrimary === undefined || !e.isPrimary);\n        var is_double_click = (now - this.last_mouseclick < 300) && is_primary;\n\t\tthis.mouse[0] = e.clientX;\n\t\tthis.mouse[1] = e.clientY;\n        this.graph_mouse[0] = e.canvasX;\n        this.graph_mouse[1] = e.canvasY;\n\t\tthis.last_click_position = [this.mouse[0],this.mouse[1]];\n\t  \t\n\t  \tif (this.pointer_is_down && is_primary ){\n\t\t  this.pointer_is_double = true;\n\t\t  //console.log(\"pointerevents: pointer_is_double start\");\n\t\t}else{\n\t\t  this.pointer_is_double = false;\n\t\t}\n\t  \tthis.pointer_is_down = true;\n\t  \n\t  \t\n        this.canvas.focus();\n\n        LiteGraph.closeAllContextMenus(ref_window);\n\n        if (this.onMouse)\n\t\t{\n            if (this.onMouse(e) == true)\n                return;\n        }\n\n\t\t//left button mouse / single finger\n        if (e.which == 1 && !this.pointer_is_double)\n\t\t{\n            if (e.ctrlKey)\n\t\t\t{\n                this.dragging_rectangle = new Float32Array(4);\n                this.dragging_rectangle[0] = e.canvasX;\n                this.dragging_rectangle[1] = e.canvasY;\n                this.dragging_rectangle[2] = 1;\n                this.dragging_rectangle[3] = 1;\n                skip_action = true;\n            }\n\n            // clone node ALT dragging\n            if (LiteGraph.alt_drag_do_clone_nodes && e.altKey && node && this.allow_interaction && !skip_action && !this.read_only)\n            {\n                if (cloned = node.clone()){\n                    cloned.pos[0] += 5;\n                    cloned.pos[1] += 5;\n                    this.graph.add(cloned,false,{doCalcSize: false});\n                    node = cloned;\n                    skip_action = true;\n                    if (!block_drag_node) {\n                        if (this.allow_dragnodes) {\n\t\t\t\t\t\t\tthis.graph.beforeChange();\n                            this.node_dragged = node;\n                        }\n                        if (!this.selected_nodes[node.id]) {\n                            this.processNodeSelected(node, e);\n                        }\n                    }\n                }\n            }\n            \n            var clicking_canvas_bg = false;\n\n            //when clicked on top of a node\n            //and it is not interactive\n            if (node && (this.allow_interaction || node.flags.allow_interaction) && !skip_action && !this.read_only) {\n                if (!this.live_mode && !node.flags.pinned) {\n                    this.bringToFront(node);\n                } //if it wasn't selected?\n\n                //not dragging mouse to connect two slots\n                if ( this.allow_interaction && !this.connecting_node && !node.flags.collapsed && !this.live_mode ) {\n                    //Search for corner for resize\n                    if ( !skip_action &&\n                        node.resizable !== false &&\n                        isInsideRectangle( e.canvasX,\n                            e.canvasY,\n                            node.pos[0] + node.size[0] - 5,\n                            node.pos[1] + node.size[1] - 5,\n                            10,\n                            10\n                        )\n                    ) {\n\t\t\t\t\t\tthis.graph.beforeChange();\n                        this.resizing_node = node;\n                        this.canvas.style.cursor = \"se-resize\";\n                        skip_action = true;\n                    } else {\n                        //search for outputs\n                        if (node.outputs) {\n                            for ( var i = 0, l = node.outputs.length; i < l; ++i ) {\n                                var output = node.outputs[i];\n                                var link_pos = node.getConnectionPos(false, i);\n                                if (\n                                    isInsideRectangle(\n                                        e.canvasX,\n                                        e.canvasY,\n                                        link_pos[0] - 15,\n                                        link_pos[1] - 10,\n                                        30,\n                                        20\n                                    )\n                                ) {\n                                    this.connecting_node = node;\n                                    this.connecting_output = output;\n                                    this.connecting_output.slot_index = i;\n                                    this.connecting_pos = node.getConnectionPos( false, i );\n                                    this.connecting_slot = i;\n\n                                    if (LiteGraph.shift_click_do_break_link_from){\n                                        if (e.shiftKey) {\n                                            node.disconnectOutput(i);\n                                        }\n                                    }\n\n                                    if (is_double_click) {\n                                        if (node.onOutputDblClick) {\n                                            node.onOutputDblClick(i, e);\n                                        }\n                                    } else {\n                                        if (node.onOutputClick) {\n                                            node.onOutputClick(i, e);\n                                        }\n                                    }\n\n                                    skip_action = true;\n                                    break;\n                                }\n                            }\n                        }\n\n                        //search for inputs\n                        if (node.inputs) {\n                            for ( var i = 0, l = node.inputs.length; i < l; ++i ) {\n                                var input = node.inputs[i];\n                                var link_pos = node.getConnectionPos(true, i);\n                                if (\n                                    isInsideRectangle(\n                                        e.canvasX,\n                                        e.canvasY,\n                                        link_pos[0] - 15,\n                                        link_pos[1] - 10,\n                                        30,\n                                        20\n                                    )\n                                ) {\n                                    if (is_double_click) {\n                                        if (node.onInputDblClick) {\n                                            node.onInputDblClick(i, e);\n                                        }\n                                    } else {\n                                        if (node.onInputClick) {\n                                            node.onInputClick(i, e);\n                                        }\n                                    }\n\n                                    if (input.link !== null) {\n                                        var link_info = this.graph.links[\n                                            input.link\n                                        ]; //before disconnecting\n                                        if (LiteGraph.click_do_break_link_to){\n                                            node.disconnectInput(i);\n                                            this.dirty_bgcanvas = true;\n                                            skip_action = true;\n                                        }else{\n                                            // do same action as has not node ?\n                                        }\n\n                                        if (\n                                            this.allow_reconnect_links ||\n\t\t\t\t\t\t\t\t\t\t\t//this.move_destination_link_without_shift ||\n                                            e.shiftKey\n                                        ) {\n                                            if (!LiteGraph.click_do_break_link_to){\n                                                node.disconnectInput(i);\n                                            }\n                                            this.connecting_node = this.graph._nodes_by_id[\n                                                link_info.origin_id\n                                            ];\n                                            this.connecting_slot =\n                                                link_info.origin_slot;\n                                            this.connecting_output = this.connecting_node.outputs[\n                                                this.connecting_slot\n                                            ];\n                                            this.connecting_pos = this.connecting_node.getConnectionPos( false, this.connecting_slot );\n                                            \n                                            this.dirty_bgcanvas = true;\n                                            skip_action = true;\n                                        }\n\n                                        \n                                    }else{\n                                        // has not node\n                                    }\n                                    \n                                    if (!skip_action){\n                                        // connect from in to out, from to to from\n                                        this.connecting_node = node;\n                                        this.connecting_input = input;\n                                        this.connecting_input.slot_index = i;\n                                        this.connecting_pos = node.getConnectionPos( true, i );\n                                        this.connecting_slot = i;\n                                        \n                                        this.dirty_bgcanvas = true;\n                                        skip_action = true;\n                                    }\n                                }\n                            }\n                        }\n                    } //not resizing\n                }\n\n                //it wasn't clicked on the links boxes\n                if (!skip_action) {\n                    var block_drag_node = false;\n\t\t\t\t\tvar pos = [e.canvasX - node.pos[0], e.canvasY - node.pos[1]];\n\n                    //widgets\n                    var widget = this.processNodeWidgets( node, this.graph_mouse, e );\n                    if (widget) {\n                        block_drag_node = true;\n                        this.node_widget = [node, widget];\n                    }\n\n                    //double clicking\n                    if (this.allow_interaction && is_double_click && this.selected_nodes[node.id]) {\n                        //double click node\n                        if (node.onDblClick) {\n                            node.onDblClick( e, pos, this );\n                        }\n                        this.processNodeDblClicked(node);\n                        block_drag_node = true;\n                    }\n\n                    //if do not capture mouse\n                    if ( node.onMouseDown && node.onMouseDown( e, pos, this ) ) {\n                        block_drag_node = true;\n                    } else {\n\t\t\t\t\t\t//open subgraph button\n\t\t\t\t\t\tif(node.subgraph && !node.skip_subgraph_button)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ( !node.flags.collapsed && pos[0] > node.size[0] - LiteGraph.NODE_TITLE_HEIGHT && pos[1] < 0 ) {\n\t\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tthat.openSubgraph(node.subgraph);\n\t\t\t\t\t\t\t\t}, 10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.live_mode) {\n\t\t\t\t\t\t\tclicking_canvas_bg = true;\n\t                        block_drag_node = true;\n\t\t\t\t\t\t}\n                    }\n\n                    if (!block_drag_node) {\n                        if (this.allow_dragnodes) {\n\t\t\t\t\t\t\tthis.graph.beforeChange();\n                            this.node_dragged = node;\n                        }\n                        this.processNodeSelected(node, e);\n                    } else { // double-click\n                        /**\n                         * Don't call the function if the block is already selected.\n                         * Otherwise, it could cause the block to be unselected while its panel is open.\n                         */\n                        if (!node.is_selected) this.processNodeSelected(node, e);\n                    }\n\n                    this.dirty_canvas = true;\n                }\n            } //clicked outside of nodes\n            else {\n\t\t\t\tif (!skip_action){\n\t\t\t\t\t//search for link connector\n\t\t\t\t\tif(!this.read_only) {\n\t\t\t\t\t\tfor (var i = 0; i < this.visible_links.length; ++i) {\n\t\t\t\t\t\t\tvar link = this.visible_links[i];\n\t\t\t\t\t\t\tvar center = link._pos;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!center ||\n\t\t\t\t\t\t\t\te.canvasX < center[0] - 4 ||\n\t\t\t\t\t\t\t\te.canvasX > center[0] + 4 ||\n\t\t\t\t\t\t\t\te.canvasY < center[1] - 4 ||\n\t\t\t\t\t\t\t\te.canvasY > center[1] + 4\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//link clicked\n\t\t\t\t\t\t\tthis.showLinkMenu(link, e);\n\t\t\t\t\t\t\tthis.over_link_center = null; //clear tooltip\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selected_group = this.graph.getGroupOnPos( e.canvasX, e.canvasY );\n\t\t\t\t\tthis.selected_group_resizing = false;\n\t\t\t\t\tif (this.selected_group && !this.read_only ) {\n\t\t\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\t\t\tthis.dragging_rectangle = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar dist = distance( [e.canvasX, e.canvasY], [ this.selected_group.pos[0] + this.selected_group.size[0], this.selected_group.pos[1] + this.selected_group.size[1] ] );\n\t\t\t\t\t\tif (dist * this.ds.scale < 10) {\n\t\t\t\t\t\t\tthis.selected_group_resizing = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.selected_group.recomputeInsideNodes();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (is_double_click && !this.read_only && this.allow_searchbox) {\n\t\t\t\t\t\tthis.showSearchBox(e);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}\n\n\t\t\t\t\tclicking_canvas_bg = true;\n\t\t\t\t}\n            }\n\n            if (!skip_action && clicking_canvas_bg && this.allow_dragcanvas) {\n            \t//console.log(\"pointerevents: dragging_canvas start\");\n            \tthis.dragging_canvas = true;\n            }\n            \n        } else if (e.which == 2) {\n            //middle button\n        \t\n\t\t\tif (LiteGraph.middle_click_slot_add_default_node){\n\t\t\t\tif (node && this.allow_interaction && !skip_action && !this.read_only){\n\t\t\t\t\t//not dragging mouse to connect two slots\n\t\t\t\t\tif (\n\t\t\t\t\t\t!this.connecting_node &&\n\t\t\t\t\t\t!node.flags.collapsed &&\n\t\t\t\t\t\t!this.live_mode\n\t\t\t\t\t) {\n\t\t\t\t\t\tvar mClikSlot = false;\n\t\t\t\t\t\tvar mClikSlot_index = false;\n\t\t\t\t\t\tvar mClikSlot_isOut = false;\n\t\t\t\t\t\t//search for outputs\n\t\t\t\t\t\tif (node.outputs) {\n\t\t\t\t\t\t\tfor ( var i = 0, l = node.outputs.length; i < l; ++i ) {\n\t\t\t\t\t\t\t\tvar output = node.outputs[i];\n\t\t\t\t\t\t\t\tvar link_pos = node.getConnectionPos(false, i);\n\t\t\t\t\t\t\t\tif (isInsideRectangle(e.canvasX,e.canvasY,link_pos[0] - 15,link_pos[1] - 10,30,20)) {\n\t\t\t\t\t\t\t\t\tmClikSlot = output;\n\t\t\t\t\t\t\t\t\tmClikSlot_index = i;\n\t\t\t\t\t\t\t\t\tmClikSlot_isOut = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//search for inputs\n\t\t\t\t\t\tif (node.inputs) {\n\t\t\t\t\t\t\tfor ( var i = 0, l = node.inputs.length; i < l; ++i ) {\n\t\t\t\t\t\t\t\tvar input = node.inputs[i];\n\t\t\t\t\t\t\t\tvar link_pos = node.getConnectionPos(true, i);\n\t\t\t\t\t\t\t\tif (isInsideRectangle(e.canvasX,e.canvasY,link_pos[0] - 15,link_pos[1] - 10,30,20)) {\n\t\t\t\t\t\t\t\t\tmClikSlot = input;\n\t\t\t\t\t\t\t\t\tmClikSlot_index = i;\n\t\t\t\t\t\t\t\t\tmClikSlot_isOut = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//console.log(\"middleClickSlots? \"+mClikSlot+\" & \"+(mClikSlot_index!==false));\n\t\t\t\t\t\tif (mClikSlot && mClikSlot_index!==false){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar alphaPosY = 0.5-((mClikSlot_index+1)/((mClikSlot_isOut?node.outputs.length:node.inputs.length)));\n\t\t\t\t\t\t\tvar node_bounding = node.getBounding();\n\t\t\t\t\t\t\t// estimate a position: this is a bad semi-bad-working mess .. REFACTOR with a correct autoplacement that knows about the others slots and nodes\n\t\t\t\t\t\t\tvar posRef = [\t(!mClikSlot_isOut?node_bounding[0]:node_bounding[0]+node_bounding[2])// + node_bounding[0]/this.canvas.width*150\n\t\t\t\t\t\t\t\t\t\t\t,e.canvasY-80// + node_bounding[0]/this.canvas.width*66 // vertical \"derive\"\n\t\t\t\t\t\t\t\t\t\t  ];\n\t\t\t\t\t\t\tvar nodeCreated = this.createDefaultNodeForSlot({   \tnodeFrom: !mClikSlot_isOut?null:node\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotFrom: !mClikSlot_isOut?null:mClikSlot_index\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeTo: !mClikSlot_isOut?node:null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotTo: !mClikSlot_isOut?mClikSlot_index:null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,position: posRef //,e: e\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeType: \"AUTO\" //nodeNewType\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,posAdd:[!mClikSlot_isOut?-30:30, -alphaPosY*130] //-alphaPosY*30]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,posSizeFix:[!mClikSlot_isOut?-1:0, 0] //-alphaPosY*2*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (!skip_action && this.allow_dragcanvas) {\n            \t//console.log(\"pointerevents: dragging_canvas start from middle button\");\n            \tthis.dragging_canvas = true;\n            }\n\n        \t\n        } else if (e.which == 3 || this.pointer_is_double) {\n\t\t\t\n            //right button\n\t\t\tif (this.allow_interaction && !skip_action && !this.read_only){\n\t\t\t\t\n\t\t\t\t// is it hover a node ?\n\t\t\t\tif (node){\n\t\t\t\t\tif(Object.keys(this.selected_nodes).length\n\t\t\t\t\t   && (this.selected_nodes[node.id] || e.shiftKey || e.ctrlKey || e.metaKey)\n\t\t\t\t\t){\n\t\t\t\t\t\t// is multiselected or using shift to include the now node\n\t\t\t\t\t\tif (!this.selected_nodes[node.id]) this.selectNodes([node],true); // add this if not present\n\t\t\t\t\t}else{\n\t\t\t\t\t\t// update selection\n\t\t\t\t\t\tthis.selectNodes([node]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// show menu on this node\n\t\t\t\tthis.processContextMenu(node, e);\n\t\t\t}\n\t\t\t\n        }\n\n        //TODO\n        //if(this.node_selected != prev_selected)\n        //\tthis.onNodeSelectionChange(this.node_selected);\n\n        this.last_mouse[0] = e.clientX;\n        this.last_mouse[1] = e.clientY;\n        this.last_mouseclick = LiteGraph.getTime();\n        this.last_mouse_dragging = true;\n\n        /*\n\tif( (this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n\t\tthis.draw();\n\t*/\n\n        this.graph.change();\n\n        //this is to ensure to defocus(blur) if a text input element is on focus\n        if (\n            !ref_window.document.activeElement ||\n            (ref_window.document.activeElement.nodeName.toLowerCase() !=\n                \"input\" &&\n                ref_window.document.activeElement.nodeName.toLowerCase() !=\n                    \"textarea\")\n        ) {\n            e.preventDefault();\n        }\n        e.stopPropagation();\n\n        if (this.onMouseDown) {\n            this.onMouseDown(e);\n        }\n\n        return false;\n    };\n\n    /**\n     * Called when a mouse move event has to be processed\n     * @method processMouseMove\n     **/\n    LGraphCanvas.prototype.processMouseMove = function(e) {\n        if (this.autoresize) {\n            this.resize();\n        }\n\n\t\tif( this.set_canvas_dirty_on_mouse_event )\n\t\t\tthis.dirty_canvas = true;\n\n        if (!this.graph) {\n            return;\n        }\n\n        LGraphCanvas.active_canvas = this;\n        this.adjustMouseEvent(e);\n        var mouse = [e.clientX, e.clientY];\n\t\tthis.mouse[0] = mouse[0];\n\t\tthis.mouse[1] = mouse[1];\n        var delta = [\n            mouse[0] - this.last_mouse[0],\n            mouse[1] - this.last_mouse[1]\n        ];\n        this.last_mouse = mouse;\n        this.graph_mouse[0] = e.canvasX;\n        this.graph_mouse[1] = e.canvasY;\n\n        //console.log(\"pointerevents: processMouseMove \"+e.pointerId+\" \"+e.isPrimary);\n        \n\t\tif(this.block_click)\n\t\t{\n\t\t\t//console.log(\"pointerevents: processMouseMove block_click\");\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n        e.dragging = this.last_mouse_dragging;\n\n        if (this.node_widget) {\n            this.processNodeWidgets(\n                this.node_widget[0],\n                this.graph_mouse,\n                e,\n                this.node_widget[1]\n            );\n            this.dirty_canvas = true;\n        }\n\n        //get node over\n        var node = this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);\n\n        if (this.dragging_rectangle)\n\t\t{\n            this.dragging_rectangle[2] = e.canvasX - this.dragging_rectangle[0];\n            this.dragging_rectangle[3] = e.canvasY - this.dragging_rectangle[1];\n            this.dirty_canvas = true;\n        } \n\t\telse if (this.selected_group && !this.read_only)\n\t\t{\n            //moving/resizing a group\n            if (this.selected_group_resizing) {\n                this.selected_group.size = [\n                    e.canvasX - this.selected_group.pos[0],\n                    e.canvasY - this.selected_group.pos[1]\n                ];\n            } else {\n                var deltax = delta[0] / this.ds.scale;\n                var deltay = delta[1] / this.ds.scale;\n                this.selected_group.move(deltax, deltay, e.ctrlKey);\n                if (this.selected_group._nodes.length) {\n                    this.dirty_canvas = true;\n                }\n            }\n            this.dirty_bgcanvas = true;\n        } else if (this.dragging_canvas) {\n        \t////console.log(\"pointerevents: processMouseMove is dragging_canvas\");\n            this.ds.offset[0] += delta[0] / this.ds.scale;\n            this.ds.offset[1] += delta[1] / this.ds.scale;\n            this.dirty_canvas = true;\n            this.dirty_bgcanvas = true;\n        } else if ((this.allow_interaction || (node && node.flags.allow_interaction)) && !this.read_only) {\n            if (this.connecting_node) {\n                this.dirty_canvas = true;\n            }\n\n            //remove mouseover flag\n            for (var i = 0, l = this.graph._nodes.length; i < l; ++i) {\n                if (this.graph._nodes[i].mouseOver && node != this.graph._nodes[i] ) {\n                    //mouse leave\n                    this.graph._nodes[i].mouseOver = false;\n                    if (this.node_over && this.node_over.onMouseLeave) {\n                        this.node_over.onMouseLeave(e);\n                    }\n                    this.node_over = null;\n                    this.dirty_canvas = true;\n                }\n            }\n\n            //mouse over a node\n            if (node) {\n\n\t\t\t\tif(node.redraw_on_mouse)\n                    this.dirty_canvas = true;\n\n                //this.canvas.style.cursor = \"move\";\n                if (!node.mouseOver) {\n                    //mouse enter\n                    node.mouseOver = true;\n                    this.node_over = node;\n                    this.dirty_canvas = true;\n\n                    if (node.onMouseEnter) {\n                        node.onMouseEnter(e);\n                    }\n                }\n\n                //in case the node wants to do something\n                if (node.onMouseMove) {\n                    node.onMouseMove( e, [e.canvasX - node.pos[0], e.canvasY - node.pos[1]], this );\n                }\n\n                //if dragging a link\n                if (this.connecting_node) {\n                    \n                    if (this.connecting_output){\n                        \n                        var pos = this._highlight_input || [0, 0]; //to store the output of isOverNodeInput\n\n                        //on top of input\n                        if (this.isOverNodeBox(node, e.canvasX, e.canvasY)) {\n                            //mouse on top of the corner box, don't know what to do\n                        } else {\n                            //check if I have a slot below de mouse\n                            var slot = this.isOverNodeInput( node, e.canvasX, e.canvasY, pos );\n                            if (slot != -1 && node.inputs[slot]) {\n                                var slot_type = node.inputs[slot].type;\n                                if ( LiteGraph.isValidConnection( this.connecting_output.type, slot_type ) ) {\n                                    this._highlight_input = pos;\n\t\t\t\t\t\t\t\t\tthis._highlight_input_slot = node.inputs[slot]; // XXX CHECK THIS\n                                }\n                            } else {\n                                this._highlight_input = null;\n\t\t\t\t\t\t\t\tthis._highlight_input_slot = null;  // XXX CHECK THIS\n                            }\n                        }\n                        \n                    }else if(this.connecting_input){\n                        \n                        var pos = this._highlight_output || [0, 0]; //to store the output of isOverNodeOutput\n\n                        //on top of output\n                        if (this.isOverNodeBox(node, e.canvasX, e.canvasY)) {\n                            //mouse on top of the corner box, don't know what to do\n                        } else {\n                            //check if I have a slot below de mouse\n                            var slot = this.isOverNodeOutput( node, e.canvasX, e.canvasY, pos );\n                            if (slot != -1 && node.outputs[slot]) {\n                                var slot_type = node.outputs[slot].type;\n                                if ( LiteGraph.isValidConnection( this.connecting_input.type, slot_type ) ) {\n                                    this._highlight_output = pos;\n                                }\n                            } else {\n                                this._highlight_output = null;\n                            }\n                        }\n                    }\n                }\n\n                //Search for corner\n                if (this.canvas) {\n                    if (\n                        isInsideRectangle(\n                            e.canvasX,\n                            e.canvasY,\n                            node.pos[0] + node.size[0] - 5,\n                            node.pos[1] + node.size[1] - 5,\n                            5,\n                            5\n                        )\n                    ) {\n                        this.canvas.style.cursor = \"se-resize\";\n                    } else {\n                        this.canvas.style.cursor = \"crosshair\";\n                    }\n                }\n            } else { //not over a node\n\n                //search for link connector\n\t\t\t\tvar over_link = null;\n\t\t\t\tfor (var i = 0; i < this.visible_links.length; ++i) {\n\t\t\t\t\tvar link = this.visible_links[i];\n\t\t\t\t\tvar center = link._pos;\n\t\t\t\t\tif (\n\t\t\t\t\t\t!center ||\n\t\t\t\t\t\te.canvasX < center[0] - 4 ||\n\t\t\t\t\t\te.canvasX > center[0] + 4 ||\n\t\t\t\t\t\te.canvasY < center[1] - 4 ||\n\t\t\t\t\t\te.canvasY > center[1] + 4\n\t\t\t\t\t) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tover_link = link;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif( over_link != this.over_link_center )\n\t\t\t\t{\n\t\t\t\t\tthis.over_link_center = over_link;\n\t                this.dirty_canvas = true;\n\t\t\t\t}\n\n\t\t\t\tif (this.canvas) {\n\t                this.canvas.style.cursor = \"\";\n\t\t\t\t}\n\t\t\t} //end\n\n\t\t\t//send event to node if capturing input (used with widgets that allow drag outside of the area of the node)\n            if ( this.node_capturing_input && this.node_capturing_input != node && this.node_capturing_input.onMouseMove ) {\n                this.node_capturing_input.onMouseMove(e,[e.canvasX - this.node_capturing_input.pos[0],e.canvasY - this.node_capturing_input.pos[1]], this);\n            }\n\n\t\t\t//node being dragged\n            if (this.node_dragged && !this.live_mode) {\n\t\t\t\t//console.log(\"draggin!\",this.selected_nodes);\n                for (var i in this.selected_nodes) {\n                    var n = this.selected_nodes[i];\n                    n.pos[0] += delta[0] / this.ds.scale;\n                    n.pos[1] += delta[1] / this.ds.scale;\n                    if (!n.is_selected) this.processNodeSelected(n, e); /*\n                     * Don't call the function if the block is already selected.\n                     * Otherwise, it could cause the block to be unselected while dragging.\n                     */\n                }\n\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n            }\n\n            if (this.resizing_node && !this.live_mode) {\n                //convert mouse to node space\n\t\t\t\tvar desired_size = [ e.canvasX - this.resizing_node.pos[0], e.canvasY - this.resizing_node.pos[1] ];\n\t\t\t\tvar min_size = this.resizing_node.computeSize();\n\t\t\t\tdesired_size[0] = Math.max( min_size[0], desired_size[0] );\n\t\t\t\tdesired_size[1] = Math.max( min_size[1], desired_size[1] );\n\t\t\t\tthis.resizing_node.setSize( desired_size );\n\n                this.canvas.style.cursor = \"se-resize\";\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n            }\n        }\n\n        e.preventDefault();\n        return false;\n    };\n\n    /**\n     * Called when a mouse up event has to be processed\n     * @method processMouseUp\n     **/\n    LGraphCanvas.prototype.processMouseUp = function(e) {\n\n\t\tvar is_primary = ( e.isPrimary === undefined || e.isPrimary );\n\n    \t//early exit for extra pointer\n    \tif(!is_primary){\n    \t\t/*e.stopPropagation();\n        \te.preventDefault();*/\n    \t\t//console.log(\"pointerevents: processMouseUp pointerN_stop \"+e.pointerId+\" \"+e.isPrimary);\n    \t\treturn false;\n    \t}\n    \t\n    \t//console.log(\"pointerevents: processMouseUp \"+e.pointerId+\" \"+e.isPrimary+\" :: \"+e.clientX+\" \"+e.clientY);\n    \t\n\t\tif( this.set_canvas_dirty_on_mouse_event )\n\t\t\tthis.dirty_canvas = true;\n\n        if (!this.graph)\n            return;\n\n        var window = this.getCanvasWindow();\n        var document = window.document;\n        LGraphCanvas.active_canvas = this;\n\n        //restore the mousemove event back to the canvas\n\t\tif(!this.options.skip_events)\n\t\t{\n\t\t\t//console.log(\"pointerevents: processMouseUp adjustEventListener\");\n\t\t\tLiteGraph.pointerListenerRemove(document,\"move\", this._mousemove_callback,true);\n\t\t\tLiteGraph.pointerListenerAdd(this.canvas,\"move\", this._mousemove_callback,true);\n\t\t\tLiteGraph.pointerListenerRemove(document,\"up\", this._mouseup_callback,true);\n\t\t}\n\n        this.adjustMouseEvent(e);\n        var now = LiteGraph.getTime();\n        e.click_time = now - this.last_mouseclick;\n        this.last_mouse_dragging = false;\n\t\tthis.last_click_position = null;\n\n\t\tif(this.block_click)\n\t\t{\n\t\t\t//console.log(\"pointerevents: processMouseUp block_clicks\");\n\t\t\tthis.block_click = false; //used to avoid sending twice a click in a immediate button\n\t\t}\n\n\t\t//console.log(\"pointerevents: processMouseUp which: \"+e.which);\n\t\t\n        if (e.which == 1) {\n\n\t\t\tif( this.node_widget )\n\t\t\t{\n\t\t\t\tthis.processNodeWidgets( this.node_widget[0], this.graph_mouse, e );\n\t\t\t}\n\n            //left button\n            this.node_widget = null;\n\n            if (this.selected_group) {\n                var diffx =\n                    this.selected_group.pos[0] -\n                    Math.round(this.selected_group.pos[0]);\n                var diffy =\n                    this.selected_group.pos[1] -\n                    Math.round(this.selected_group.pos[1]);\n                this.selected_group.move(diffx, diffy, e.ctrlKey);\n                this.selected_group.pos[0] = Math.round(\n                    this.selected_group.pos[0]\n                );\n                this.selected_group.pos[1] = Math.round(\n                    this.selected_group.pos[1]\n                );\n                if (this.selected_group._nodes.length) {\n                    this.dirty_canvas = true;\n                }\n                this.selected_group = null;\n            }\n            this.selected_group_resizing = false;\n\n\t\t\tvar node = this.graph.getNodeOnPos(\n\t\t\t\t\t\t\te.canvasX,\n\t\t\t\t\t\t\te.canvasY,\n\t\t\t\t\t\t\tthis.visible_nodes\n\t\t\t\t\t\t);\n\t\t\t\n            if (this.dragging_rectangle) {\n                if (this.graph) {\n                    var nodes = this.graph._nodes;\n                    var node_bounding = new Float32Array(4);\n                    \n                    //compute bounding and flip if left to right\n                    var w = Math.abs(this.dragging_rectangle[2]);\n                    var h = Math.abs(this.dragging_rectangle[3]);\n                    var startx =\n                        this.dragging_rectangle[2] < 0\n                            ? this.dragging_rectangle[0] - w\n                            : this.dragging_rectangle[0];\n                    var starty =\n                        this.dragging_rectangle[3] < 0\n                            ? this.dragging_rectangle[1] - h\n                            : this.dragging_rectangle[1];\n                    this.dragging_rectangle[0] = startx;\n                    this.dragging_rectangle[1] = starty;\n                    this.dragging_rectangle[2] = w;\n                    this.dragging_rectangle[3] = h;\n\n\t\t\t\t\t// test dragging rect size, if minimun simulate a click\n\t\t\t\t\tif (!node || (w > 10 && h > 10 )){\n\t\t\t\t\t\t//test against all nodes (not visible because the rectangle maybe start outside\n\t\t\t\t\t\tvar to_select = [];\n\t\t\t\t\t\tfor (var i = 0; i < nodes.length; ++i) {\n\t\t\t\t\t\t\tvar nodeX = nodes[i];\n\t\t\t\t\t\t\tnodeX.getBounding(node_bounding);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!overlapBounding(\n\t\t\t\t\t\t\t\t\tthis.dragging_rectangle,\n\t\t\t\t\t\t\t\t\tnode_bounding\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} //out of the visible area\n\t\t\t\t\t\t\tto_select.push(nodeX);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (to_select.length) {\n\t\t\t\t\t\t\tthis.selectNodes(to_select,e.shiftKey); // add to selection with shift\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\t// will select of update selection\n\t\t\t\t\t\tthis.selectNodes([node],e.shiftKey||e.ctrlKey); // add to selection add to selection with ctrlKey or shiftKey\n\t\t\t\t\t}\n\t\t\t\t\t\n                }\n                this.dragging_rectangle = null;\n            } else if (this.connecting_node) {\n                //dragging a connection\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n\n                var connInOrOut = this.connecting_output || this.connecting_input;\n                var connType = connInOrOut.type;\n                \n                //node below mouse\n                if (node) {\n                    \n                    /* no need to condition on event type.. just another type\n                    if (\n                        connType == LiteGraph.EVENT &&\n                        this.isOverNodeBox(node, e.canvasX, e.canvasY)\n                    ) {\n                        \n                        this.connecting_node.connect(\n                            this.connecting_slot,\n                            node,\n                            LiteGraph.EVENT\n                        );\n                        \n                    } else {*/\n                        \n                        //slot below mouse? connect\n                        \n                        if (this.connecting_output){\n                            \n                            var slot = this.isOverNodeInput(\n                                node,\n                                e.canvasX,\n                                e.canvasY\n                            );\n                            if (slot != -1) {\n                                this.connecting_node.connect(this.connecting_slot, node, slot);\n                            } else {\n                                //not on top of an input\n                                // look for a good slot\n                                this.connecting_node.connectByType(this.connecting_slot,node,connType);\n                            }\n                            \n                        }else if (this.connecting_input){\n                            \n                            var slot = this.isOverNodeOutput(\n                                node,\n                                e.canvasX,\n                                e.canvasY\n                            );\n\n                            if (slot != -1) {\n                                node.connect(slot, this.connecting_node, this.connecting_slot); // this is inverted has output-input nature like\n                            } else {\n                                //not on top of an input\n                                // look for a good slot\n                                this.connecting_node.connectByTypeOutput(this.connecting_slot,node,connType);\n                            }\n                            \n                        }\n                        \n                        \n                    //}\n                    \n                }else{\n                    \n                    // add menu when releasing link in empty space\n                \tif (LiteGraph.release_link_on_empty_shows_menu){\n\t                    if (e.shiftKey && this.allow_searchbox){\n\t                        if(this.connecting_output){\n\t                            this.showSearchBox(e,{node_from: this.connecting_node, slot_from: this.connecting_output, type_filter_in: this.connecting_output.type});\n\t                        }else if(this.connecting_input){\n\t                            this.showSearchBox(e,{node_to: this.connecting_node, slot_from: this.connecting_input, type_filter_out: this.connecting_input.type});\n\t                        }\n\t                    }else{\n\t                        if(this.connecting_output){\n\t                            this.showConnectionMenu({nodeFrom: this.connecting_node, slotFrom: this.connecting_output, e: e});\n\t                        }else if(this.connecting_input){\n\t                            this.showConnectionMenu({nodeTo: this.connecting_node, slotTo: this.connecting_input, e: e});\n\t                        }\n\t                    }\n                \t}\n                }\n\n                this.connecting_output = null;\n                this.connecting_input = null;\n                this.connecting_pos = null;\n                this.connecting_node = null;\n                this.connecting_slot = -1;\n            } //not dragging connection\n            else if (this.resizing_node) {\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n\t\t\t\tthis.graph.afterChange(this.resizing_node);\n                this.resizing_node = null;\n            } else if (this.node_dragged) {\n                //node being dragged?\n                var node = this.node_dragged;\n                if (\n                    node &&\n                    e.click_time < 300 &&\n                    isInsideRectangle( e.canvasX, e.canvasY, node.pos[0], node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT )\n                ) {\n                    node.collapse();\n                }\n\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n                this.node_dragged.pos[0] = Math.round(this.node_dragged.pos[0]);\n                this.node_dragged.pos[1] = Math.round(this.node_dragged.pos[1]);\n                if (this.graph.config.align_to_grid || this.align_to_grid ) {\n                    this.node_dragged.alignToGrid();\n                }\n\t\t\t\tif( this.onNodeMoved )\n\t\t\t\t\tthis.onNodeMoved( this.node_dragged );\n\t\t\t\tthis.graph.afterChange(this.node_dragged);\n                this.node_dragged = null;\n            } //no node being dragged\n            else {\n                //get node over\n                var node = this.graph.getNodeOnPos(\n                    e.canvasX,\n                    e.canvasY,\n                    this.visible_nodes\n                );\n\n                if (!node && e.click_time < 300) {\n                    this.deselectAllNodes();\n                }\n\n                this.dirty_canvas = true;\n                this.dragging_canvas = false;\n\n                if (this.node_over && this.node_over.onMouseUp) {\n                    this.node_over.onMouseUp( e, [ e.canvasX - this.node_over.pos[0], e.canvasY - this.node_over.pos[1] ], this );\n                }\n                if (\n                    this.node_capturing_input &&\n                    this.node_capturing_input.onMouseUp\n                ) {\n                    this.node_capturing_input.onMouseUp(e, [\n                        e.canvasX - this.node_capturing_input.pos[0],\n                        e.canvasY - this.node_capturing_input.pos[1]\n                    ]);\n                }\n            }\n        } else if (e.which == 2) {\n            //middle button\n            //trace(\"middle\");\n            this.dirty_canvas = true;\n            this.dragging_canvas = false;\n        } else if (e.which == 3) {\n            //right button\n            //trace(\"right\");\n            this.dirty_canvas = true;\n            this.dragging_canvas = false;\n        }\n\n        /*\n\t\tif((this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n\t\t\tthis.draw();\n\t\t*/\n\n\t  \tif (is_primary)\n\t\t{\n\t\t\tthis.pointer_is_down = false;\n\t\t\tthis.pointer_is_double = false;\n\t\t}\n\t  \n        this.graph.change();\n\n        //console.log(\"pointerevents: processMouseUp stopPropagation\");\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n    };\n\n    /**\n     * Called when a mouse wheel event has to be processed\n     * @method processMouseWheel\n     **/\n    LGraphCanvas.prototype.processMouseWheel = function(e) {\n        if (!this.graph || !this.allow_dragcanvas) {\n            return;\n        }\n\n        var delta = e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n\n        this.adjustMouseEvent(e);\n\n\t\tvar x = e.clientX;\n\t\tvar y = e.clientY;\n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\t\tif(!is_inside)\n\t\t\treturn;\n\n        var scale = this.ds.scale;\n\n        if (delta > 0) {\n            scale *= 1.1;\n        } else if (delta < 0) {\n            scale *= 1 / 1.1;\n        }\n\n        //this.setZoom( scale, [ e.clientX, e.clientY ] );\n        this.ds.changeScale(scale, [e.clientX, e.clientY]);\n\n        this.graph.change();\n\n        e.preventDefault();\n        return false; // prevent default\n    };\n\n    /**\n     * returns true if a position (in graph space) is on top of a node little corner box\n     * @method isOverNodeBox\n     **/\n    LGraphCanvas.prototype.isOverNodeBox = function(node, canvasx, canvasy) {\n        var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n        if (\n            isInsideRectangle(\n                canvasx,\n                canvasy,\n                node.pos[0] + 2,\n                node.pos[1] + 2 - title_height,\n                title_height - 4,\n                title_height - 4\n            )\n        ) {\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * returns the INDEX if a position (in graph space) is on top of a node input slot\n     * @method isOverNodeInput\n     **/\n    LGraphCanvas.prototype.isOverNodeInput = function(\n        node,\n        canvasx,\n        canvasy,\n        slot_pos\n    ) {\n        if (node.inputs) {\n            for (var i = 0, l = node.inputs.length; i < l; ++i) {\n                var input = node.inputs[i];\n                var link_pos = node.getConnectionPos(true, i);\n                var is_inside = false;\n                if (node.horizontal) {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 5,\n                        link_pos[1] - 10,\n                        10,\n                        20\n                    );\n                } else {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        40,\n                        10\n                    );\n                }\n                if (is_inside) {\n                    if (slot_pos) {\n                        slot_pos[0] = link_pos[0];\n                        slot_pos[1] = link_pos[1];\n                    }\n                    return i;\n                }\n            }\n        }\n        return -1;\n    };\n    \n    /**\n     * returns the INDEX if a position (in graph space) is on top of a node output slot\n     * @method isOverNodeOuput\n     **/\n    LGraphCanvas.prototype.isOverNodeOutput = function(\n        node,\n        canvasx,\n        canvasy,\n        slot_pos\n    ) {\n        if (node.outputs) {\n            for (var i = 0, l = node.outputs.length; i < l; ++i) {\n                var output = node.outputs[i];\n                var link_pos = node.getConnectionPos(false, i);\n                var is_inside = false;\n                if (node.horizontal) {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 5,\n                        link_pos[1] - 10,\n                        10,\n                        20\n                    );\n                } else {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        40,\n                        10\n                    );\n                }\n                if (is_inside) {\n                    if (slot_pos) {\n                        slot_pos[0] = link_pos[0];\n                        slot_pos[1] = link_pos[1];\n                    }\n                    return i;\n                }\n            }\n        }\n        return -1;\n    };\n\n    /**\n     * process a key event\n     * @method processKey\n     **/\n    LGraphCanvas.prototype.processKey = function(e) {\n        if (!this.graph) {\n            return;\n        }\n\n        var block_default = false;\n        //console.log(e); //debug\n\n        if (e.target.localName == \"input\") {\n            return;\n        }\n\n        if (e.type == \"keydown\") {\n            if (e.keyCode == 32) {\n                //space\n                this.dragging_canvas = true;\n                block_default = true;\n            }\n            \n            if (e.keyCode == 27) {\n                //esc\n                if(this.node_panel) this.node_panel.close();\n                if(this.options_panel) this.options_panel.close();\n                block_default = true;\n            }\n\n            //select all Control A\n            if (e.keyCode == 65 && e.ctrlKey) {\n                this.selectNodes();\n                block_default = true;\n            }\n\n            if ((e.keyCode === 67) && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n                //copy\n                if (this.selected_nodes) {\n                    this.copyToClipboard();\n                    block_default = true;\n                }\n            }\n\n            if ((e.keyCode === 86) && (e.metaKey || e.ctrlKey)) {\n                //paste\n                this.pasteFromClipboard(e.shiftKey);\n            }\n\n            //delete or backspace\n            if (e.keyCode == 46 || e.keyCode == 8) {\n                if (\n                    e.target.localName != \"input\" &&\n                    e.target.localName != \"textarea\"\n                ) {\n                    this.deleteSelectedNodes();\n                    block_default = true;\n                }\n            }\n\n            //collapse\n            //...\n\n            //TODO\n            if (this.selected_nodes) {\n                for (var i in this.selected_nodes) {\n                    if (this.selected_nodes[i].onKeyDown) {\n                        this.selected_nodes[i].onKeyDown(e);\n                    }\n                }\n            }\n        } else if (e.type == \"keyup\") {\n            if (e.keyCode == 32) {\n                // space\n                this.dragging_canvas = false;\n            }\n\n            if (this.selected_nodes) {\n                for (var i in this.selected_nodes) {\n                    if (this.selected_nodes[i].onKeyUp) {\n                        this.selected_nodes[i].onKeyUp(e);\n                    }\n                }\n            }\n        }\n\n        this.graph.change();\n\n        if (block_default) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            return false;\n        }\n    };\n\n    LGraphCanvas.prototype.copyToClipboard = function() {\n        var clipboard_info = {\n            nodes: [],\n            links: []\n        };\n        var index = 0;\n        var selected_nodes_array = [];\n        for (var i in this.selected_nodes) {\n            var node = this.selected_nodes[i];\n            if (node.clonable === false)\n                continue;\n            node._relative_id = index;\n            selected_nodes_array.push(node);\n            index += 1;\n        }\n\n        for (var i = 0; i < selected_nodes_array.length; ++i) {\n            var node = selected_nodes_array[i];\n            if(node.clonable === false)\n                continue;\n            var cloned = node.clone();\n            if(!cloned)\n            {\n                console.warn(\"node type not found: \" + node.type );\n                continue;\n            }\n            clipboard_info.nodes.push(cloned.serialize());\n            if (node.inputs && node.inputs.length) {\n                for (var j = 0; j < node.inputs.length; ++j) {\n                    var input = node.inputs[j];\n                    if (!input || input.link == null) {\n                        continue;\n                    }\n                    var link_info = this.graph.links[input.link];\n                    if (!link_info) {\n                        continue;\n                    }\n                    var target_node = this.graph.getNodeById(\n                        link_info.origin_id\n                    );\n                    if (!target_node) {\n                        continue;\n                    }\n                    clipboard_info.links.push([\n                        target_node._relative_id,\n                        link_info.origin_slot, //j,\n                        node._relative_id,\n                        link_info.target_slot,\n                        target_node.id\n                    ]);\n                }\n            }\n        }\n        localStorage.setItem(\n            \"litegrapheditor_clipboard\",\n            JSON.stringify(clipboard_info)\n        );\n    };\n\n    LGraphCanvas.prototype.pasteFromClipboard = function(isConnectUnselected = false) {\n        // if ctrl + shift + v is off, return when isConnectUnselected is true (shift is pressed) to maintain old behavior\n        if (!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs && isConnectUnselected) {\n            return;\n        }\n        var data = localStorage.getItem(\"litegrapheditor_clipboard\");\n        if (!data) {\n            return;\n        }\n\n\t\tthis.graph.beforeChange();\n\n        //create nodes\n        var clipboard_info = JSON.parse(data);\n        // calculate top-left node, could work without this processing but using diff with last node pos :: clipboard_info.nodes[clipboard_info.nodes.length-1].pos\n        var posMin = false;\n        var posMinIndexes = false;\n        for (var i = 0; i < clipboard_info.nodes.length; ++i) {\n            if (posMin){\n                if(posMin[0]>clipboard_info.nodes[i].pos[0]){\n                    posMin[0] = clipboard_info.nodes[i].pos[0];\n                    posMinIndexes[0] = i;\n                }\n                if(posMin[1]>clipboard_info.nodes[i].pos[1]){\n                    posMin[1] = clipboard_info.nodes[i].pos[1];\n                    posMinIndexes[1] = i;\n                }\n            }\n            else{\n                posMin = [clipboard_info.nodes[i].pos[0], clipboard_info.nodes[i].pos[1]];\n                posMinIndexes = [i, i];\n            }\n        }\n        var nodes = [];\n        for (var i = 0; i < clipboard_info.nodes.length; ++i) {\n            var node_data = clipboard_info.nodes[i];\n            var node = LiteGraph.createNode(node_data.type);\n            if (node) {\n                node.configure(node_data);\n        \n\t\t\t\t//paste in last known mouse position\n                node.pos[0] += this.graph_mouse[0] - posMin[0]; //+= 5;\n                node.pos[1] += this.graph_mouse[1] - posMin[1]; //+= 5;\n\n                this.graph.add(node,{doProcessChange:false});\n                \n                nodes.push(node);\n            }\n        }\n\n        //create links\n        for (var i = 0; i < clipboard_info.links.length; ++i) {\n            var link_info = clipboard_info.links[i];\n            var origin_node;\n            var origin_node_relative_id = link_info[0];\n            if (origin_node_relative_id != null) {\n                origin_node = nodes[origin_node_relative_id];\n            } else if (LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs && isConnectUnselected) {\n                var origin_node_id = link_info[4];\n                if (origin_node_id) {\n                    origin_node = this.graph.getNodeById(origin_node_id);\n                }\n            }\n            var target_node = nodes[link_info[2]];\n\t\t\tif( origin_node && target_node )\n\t            origin_node.connect(link_info[1], target_node, link_info[3]);\n\t\t\telse\n\t\t\t\tconsole.warn(\"Warning, nodes missing on pasting\");\n        }\n\n        this.selectNodes(nodes);\n\n\t\tthis.graph.afterChange();\n    };\n\n    /**\n     * process a item drop event on top the canvas\n     * @method processDrop\n     **/\n    LGraphCanvas.prototype.processDrop = function(e) {\n        e.preventDefault();\n        this.adjustMouseEvent(e);\n\t\tvar x = e.clientX;\n\t\tvar y = e.clientY;\n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\t\tif(!is_inside){\n\t\t\treturn;\n\t\t\t// --- BREAK ---\n\t\t}\n\n        var pos = [e.canvasX, e.canvasY];\n\n\n        var node = this.graph ? this.graph.getNodeOnPos(pos[0], pos[1]) : null;\n\n        if (!node) {\n            var r = null;\n            if (this.onDropItem) {\n                r = this.onDropItem(event);\n            }\n            if (!r) {\n                this.checkDropItem(e);\n            }\n            return;\n        }\n\n        if (node.onDropFile || node.onDropData) {\n            var files = e.dataTransfer.files;\n            if (files && files.length) {\n                for (var i = 0; i < files.length; i++) {\n                    var file = e.dataTransfer.files[0];\n                    var filename = file.name;\n                    var ext = LGraphCanvas.getFileExtension(filename);\n                    //console.log(file);\n\n                    if (node.onDropFile) {\n                        node.onDropFile(file);\n                    }\n\n                    if (node.onDropData) {\n                        //prepare reader\n                        var reader = new FileReader();\n                        reader.onload = function(event) {\n                            //console.log(event.target);\n                            var data = event.target.result;\n                            node.onDropData(data, filename, file);\n                        };\n\n                        //read data\n                        var type = file.type.split(\"/\")[0];\n                        if (type == \"text\" || type == \"\") {\n                            reader.readAsText(file);\n                        } else if (type == \"image\") {\n                            reader.readAsDataURL(file);\n                        } else {\n                            reader.readAsArrayBuffer(file);\n                        }\n                    }\n                }\n            }\n        }\n\n        if (node.onDropItem) {\n            if (node.onDropItem(event)) {\n                return true;\n            }\n        }\n\n        if (this.onDropItem) {\n            return this.onDropItem(event);\n        }\n\n        return false;\n    };\n\n    //called if the graph doesn't have a default drop item behaviour\n    LGraphCanvas.prototype.checkDropItem = function(e) {\n        if (e.dataTransfer.files.length) {\n            var file = e.dataTransfer.files[0];\n            var ext = LGraphCanvas.getFileExtension(file.name).toLowerCase();\n            var nodetype = LiteGraph.node_types_by_file_extension[ext];\n            if (nodetype) {\n\t\t\t\tthis.graph.beforeChange();\n                var node = LiteGraph.createNode(nodetype.type);\n                node.pos = [e.canvasX, e.canvasY];\n                this.graph.add(node);\n                if (node.onDropFile) {\n                    node.onDropFile(file);\n                }\n\t\t\t\tthis.graph.afterChange();\n            }\n        }\n    };\n\n    LGraphCanvas.prototype.processNodeDblClicked = function(n) {\n        if (this.onShowNodePanel) {\n            this.onShowNodePanel(n);\n        }\n\t\telse\n\t\t{\n\t\t\tthis.showShowNodePanel(n);\n\t\t}\n\n        if (this.onNodeDblClicked) {\n            this.onNodeDblClicked(n);\n        }\n\n        this.setDirty(true);\n    };\n\n    LGraphCanvas.prototype.processNodeSelected = function(node, e) {\n        this.selectNode(node, e && (e.shiftKey || e.ctrlKey || this.multi_select));\n        if (this.onNodeSelected) {\n            this.onNodeSelected(node);\n        }\n    };\n\n    /**\n     * selects a given node (or adds it to the current selection)\n     * @method selectNode\n     **/\n    LGraphCanvas.prototype.selectNode = function(\n        node,\n        add_to_current_selection\n    ) {\n        if (node == null) {\n            this.deselectAllNodes();\n        } else {\n            this.selectNodes([node], add_to_current_selection);\n        }\n    };\n\n    /**\n     * selects several nodes (or adds them to the current selection)\n     * @method selectNodes\n     **/\n    LGraphCanvas.prototype.selectNodes = function( nodes, add_to_current_selection )\n\t{\n\t\tif (!add_to_current_selection) {\n            this.deselectAllNodes();\n        }\n\n        nodes = nodes || this.graph._nodes;\n\t\tif (typeof nodes == \"string\") nodes = [nodes];\n        for (var i in nodes) {\n            var node = nodes[i];\n            if (node.is_selected) {\n                this.deselectNode(node);\n                continue;\n            }\n\n            if (!node.is_selected && node.onSelected) {\n                node.onSelected();\n            }\n            node.is_selected = true;\n            this.selected_nodes[node.id] = node;\n\n            if (node.inputs) {\n                for (var j = 0; j < node.inputs.length; ++j) {\n                    this.highlighted_links[node.inputs[j].link] = true;\n                }\n            }\n            if (node.outputs) {\n                for (var j = 0; j < node.outputs.length; ++j) {\n                    var out = node.outputs[j];\n                    if (out.links) {\n                        for (var k = 0; k < out.links.length; ++k) {\n                            this.highlighted_links[out.links[k]] = true;\n                        }\n                    }\n                }\n            }\n        }\n\n\t\tif(\tthis.onSelectionChange )\n\t\t\tthis.onSelectionChange( this.selected_nodes );\n\n        this.setDirty(true);\n    };\n\n    /**\n     * removes a node from the current selection\n     * @method deselectNode\n     **/\n    LGraphCanvas.prototype.deselectNode = function(node) {\n        if (!node.is_selected) {\n            return;\n        }\n        if (node.onDeselected) {\n            node.onDeselected();\n        }\n        node.is_selected = false;\n\n        if (this.onNodeDeselected) {\n            this.onNodeDeselected(node);\n        }\n\n        //remove highlighted\n        if (node.inputs) {\n            for (var i = 0; i < node.inputs.length; ++i) {\n                delete this.highlighted_links[node.inputs[i].link];\n            }\n        }\n        if (node.outputs) {\n            for (var i = 0; i < node.outputs.length; ++i) {\n                var out = node.outputs[i];\n                if (out.links) {\n                    for (var j = 0; j < out.links.length; ++j) {\n                        delete this.highlighted_links[out.links[j]];\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     * removes all nodes from the current selection\n     * @method deselectAllNodes\n     **/\n    LGraphCanvas.prototype.deselectAllNodes = function() {\n        if (!this.graph) {\n            return;\n        }\n        var nodes = this.graph._nodes;\n        for (var i = 0, l = nodes.length; i < l; ++i) {\n            var node = nodes[i];\n            if (!node.is_selected) {\n                continue;\n            }\n            if (node.onDeselected) {\n                node.onDeselected();\n            }\n            node.is_selected = false;\n\t\t\tif (this.onNodeDeselected) {\n\t\t\t\tthis.onNodeDeselected(node);\n\t\t\t}\n        }\n        this.selected_nodes = {};\n        this.current_node = null;\n        this.highlighted_links = {};\n\t\tif(\tthis.onSelectionChange )\n\t\t\tthis.onSelectionChange( this.selected_nodes );\n        this.setDirty(true);\n    };\n\n    /**\n     * deletes all nodes in the current selection from the graph\n     * @method deleteSelectedNodes\n     **/\n    LGraphCanvas.prototype.deleteSelectedNodes = function() {\n\n\t\tthis.graph.beforeChange();\n\n        for (var i in this.selected_nodes) {\n            var node = this.selected_nodes[i];\n\n\t\t\tif(node.block_delete)\n\t\t\t\tcontinue;\n\n\t\t\t//autoconnect when possible (very basic, only takes into account first input-output)\n\t\t\tif(node.inputs && node.inputs.length && node.outputs && node.outputs.length && LiteGraph.isValidConnection( node.inputs[0].type, node.outputs[0].type ) && node.inputs[0].link && node.outputs[0].links && node.outputs[0].links.length ) \n\t\t\t{\n\t\t\t\tvar input_link = node.graph.links[ node.inputs[0].link ];\n\t\t\t\tvar output_link = node.graph.links[ node.outputs[0].links[0] ];\n\t\t\t\tvar input_node = node.getInputNode(0);\n\t\t\t\tvar output_node = node.getOutputNodes(0)[0];\n\t\t\t\tif(input_node && output_node)\n\t\t\t\t\tinput_node.connect( input_link.origin_slot, output_node, output_link.target_slot );\n\t\t\t}\n            this.graph.remove(node);\n\t\t\tif (this.onNodeDeselected) {\n\t\t\t\tthis.onNodeDeselected(node);\n\t\t\t}\n        }\n        this.selected_nodes = {};\n        this.current_node = null;\n        this.highlighted_links = {};\n        this.setDirty(true);\n\t\tthis.graph.afterChange();\n    };\n    \n    /**\n     * centers the camera on a given node\n     * @method centerOnNode\n     **/\n    LGraphCanvas.prototype.centerOnNode = function(node) {\n        this.ds.offset[0] =\n            -node.pos[0] -\n            node.size[0] * 0.5 +\n            (this.canvas.width * 0.5) / this.ds.scale;\n        this.ds.offset[1] =\n            -node.pos[1] -\n            node.size[1] * 0.5 +\n            (this.canvas.height * 0.5) / this.ds.scale;\n        this.setDirty(true, true);\n    };\n\n    /**\n     * adds some useful properties to a mouse event, like the position in graph coordinates\n     * @method adjustMouseEvent\n     **/\n    LGraphCanvas.prototype.adjustMouseEvent = function(e) {\n\tvar clientX_rel = 0;\n        var clientY_rel = 0;\n\t    \n    \tif (this.canvas) {\n            var b = this.canvas.getBoundingClientRect();\n            clientX_rel = e.clientX - b.left;\n            clientY_rel = e.clientY - b.top;\n        } else {\n        \tclientX_rel = e.clientX;\n        \tclientY_rel = e.clientY;\n        }\n    \t\n        // e.deltaX = clientX_rel - this.last_mouse_position[0];\n        // e.deltaY = clientY_rel- this.last_mouse_position[1];\n\n        this.last_mouse_position[0] = clientX_rel;\n        this.last_mouse_position[1] = clientY_rel;\n\n        e.canvasX = clientX_rel / this.ds.scale - this.ds.offset[0];\n        e.canvasY = clientY_rel / this.ds.scale - this.ds.offset[1];\n        \n        //console.log(\"pointerevents: adjustMouseEvent \"+e.clientX+\":\"+e.clientY+\" \"+clientX_rel+\":\"+clientY_rel+\" \"+e.canvasX+\":\"+e.canvasY);\n    };\n\n    /**\n     * changes the zoom level of the graph (default is 1), you can pass also a place used to pivot the zoom\n     * @method setZoom\n     **/\n    LGraphCanvas.prototype.setZoom = function(value, zooming_center) {\n        this.ds.changeScale(value, zooming_center);\n        /*\n\tif(!zooming_center && this.canvas)\n\t\tzooming_center = [this.canvas.width * 0.5,this.canvas.height * 0.5];\n\n\tvar center = this.convertOffsetToCanvas( zooming_center );\n\n\tthis.ds.scale = value;\n\n\tif(this.scale > this.max_zoom)\n\t\tthis.scale = this.max_zoom;\n\telse if(this.scale < this.min_zoom)\n\t\tthis.scale = this.min_zoom;\n\n\tvar new_center = this.convertOffsetToCanvas( zooming_center );\n\tvar delta_offset = [new_center[0] - center[0], new_center[1] - center[1]];\n\n\tthis.offset[0] += delta_offset[0];\n\tthis.offset[1] += delta_offset[1];\n\t*/\n\n        this.dirty_canvas = true;\n        this.dirty_bgcanvas = true;\n    };\n\n    /**\n     * converts a coordinate from graph coordinates to canvas2D coordinates\n     * @method convertOffsetToCanvas\n     **/\n    LGraphCanvas.prototype.convertOffsetToCanvas = function(pos, out) {\n        return this.ds.convertOffsetToCanvas(pos, out);\n    };\n\n    /**\n     * converts a coordinate from Canvas2D coordinates to graph space\n     * @method convertCanvasToOffset\n     **/\n    LGraphCanvas.prototype.convertCanvasToOffset = function(pos, out) {\n        return this.ds.convertCanvasToOffset(pos, out);\n    };\n\n    //converts event coordinates from canvas2D to graph coordinates\n    LGraphCanvas.prototype.convertEventToCanvasOffset = function(e) {\n        var rect = this.canvas.getBoundingClientRect();\n        return this.convertCanvasToOffset([\n            e.clientX - rect.left,\n            e.clientY - rect.top\n        ]);\n    };\n\n    /**\n     * brings a node to front (above all other nodes)\n     * @method bringToFront\n     **/\n    LGraphCanvas.prototype.bringToFront = function(node) {\n        var i = this.graph._nodes.indexOf(node);\n        if (i == -1) {\n            return;\n        }\n\n        this.graph._nodes.splice(i, 1);\n        this.graph._nodes.push(node);\n    };\n\n    /**\n     * sends a node to the back (below all other nodes)\n     * @method sendToBack\n     **/\n    LGraphCanvas.prototype.sendToBack = function(node) {\n        var i = this.graph._nodes.indexOf(node);\n        if (i == -1) {\n            return;\n        }\n\n        this.graph._nodes.splice(i, 1);\n        this.graph._nodes.unshift(node);\n    };\n\n    /* Interaction */\n\n    /* LGraphCanvas render */\n    var temp = new Float32Array(4);\n\n    /**\n     * checks which nodes are visible (inside the camera area)\n     * @method computeVisibleNodes\n     **/\n    LGraphCanvas.prototype.computeVisibleNodes = function(nodes, out) {\n        var visible_nodes = out || [];\n        visible_nodes.length = 0;\n        nodes = nodes || this.graph._nodes;\n        for (var i = 0, l = nodes.length; i < l; ++i) {\n            var n = nodes[i];\n\n            //skip rendering nodes in live mode\n            if (this.live_mode && !n.onDrawBackground && !n.onDrawForeground) {\n                continue;\n            }\n\n            if (!overlapBounding(this.visible_area, n.getBounding(temp, true))) {\n                continue;\n            } //out of the visible area\n\n            visible_nodes.push(n);\n        }\n        return visible_nodes;\n    };\n\n    /**\n     * renders the whole canvas content, by rendering in two separated canvas, one containing the background grid and the connections, and one containing the nodes)\n     * @method draw\n     **/\n    LGraphCanvas.prototype.draw = function(force_canvas, force_bgcanvas) {\n        if (!this.canvas || this.canvas.width == 0 || this.canvas.height == 0) {\n            return;\n        }\n\n        //fps counting\n        var now = LiteGraph.getTime();\n        this.render_time = (now - this.last_draw_time) * 0.001;\n        this.last_draw_time = now;\n\n        if (this.graph) {\n            this.ds.computeVisibleArea(this.viewport);\n        }\n\n        if (\n            this.dirty_bgcanvas ||\n            force_bgcanvas ||\n            this.always_render_background ||\n            (this.graph &&\n                this.graph._last_trigger_time &&\n                now - this.graph._last_trigger_time < 1000)\n        ) {\n            this.drawBackCanvas();\n        }\n\n        if (this.dirty_canvas || force_canvas) {\n            this.drawFrontCanvas();\n        }\n\n        this.fps = this.render_time ? 1.0 / this.render_time : 0;\n        this.frame += 1;\n    };\n\n    /**\n     * draws the front canvas (the one containing all the nodes)\n     * @method drawFrontCanvas\n     **/\n    LGraphCanvas.prototype.drawFrontCanvas = function() {\n        this.dirty_canvas = false;\n\n        if (!this.ctx) {\n            this.ctx = this.bgcanvas.getContext(\"2d\");\n        }\n        var ctx = this.ctx;\n        if (!ctx) {\n            //maybe is using webgl...\n            return;\n        }\n\n        var canvas = this.canvas;\n        if ( ctx.start2D && !this.viewport ) {\n            ctx.start2D();\n\t\t\tctx.restore();\n\t\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\n        }\n\n        //clip dirty area if there is one, otherwise work in full canvas\n\t\tvar area = this.viewport || this.dirty_area;\n        if (area) {\n            ctx.save();\n            ctx.beginPath();\n            ctx.rect( area[0],area[1],area[2],area[3] );\n            ctx.clip();\n        }\n\n        //clear\n        //canvas.width = canvas.width;\n        if (this.clear_background) {\n\t\t\tif(area)\n\t            ctx.clearRect( area[0],area[1],area[2],area[3] );\n\t\t\telse\n\t            ctx.clearRect(0, 0, canvas.width, canvas.height);\n        }\n\n        //draw bg canvas\n        if (this.bgcanvas == this.canvas) {\n            this.drawBackCanvas();\n        } else {\n            ctx.drawImage( this.bgcanvas, 0, 0 );\n        }\n\n        //rendering\n        if (this.onRender) {\n            this.onRender(canvas, ctx);\n        }\n\n        //info widget\n        if (this.show_info) {\n            this.renderInfo(ctx, area ? area[0] : 0, area ? area[1] : 0 );\n        }\n\n        if (this.graph) {\n            //apply transformations\n            ctx.save();\n            this.ds.toCanvasContext(ctx);\n\n            //draw nodes\n            var drawn_nodes = 0;\n            var visible_nodes = this.computeVisibleNodes(\n                null,\n                this.visible_nodes\n            );\n\n            for (var i = 0; i < visible_nodes.length; ++i) {\n                var node = visible_nodes[i];\n\n                //transform coords system\n                ctx.save();\n                ctx.translate(node.pos[0], node.pos[1]);\n\n                //Draw\n                this.drawNode(node, ctx);\n                drawn_nodes += 1;\n\n                //Restore\n                ctx.restore();\n            }\n\n            //on top (debug)\n            if (this.render_execution_order) {\n                this.drawExecutionOrder(ctx);\n            }\n\n            //connections ontop?\n            if (this.graph.config.links_ontop) {\n                if (!this.live_mode) {\n                    this.drawConnections(ctx);\n                }\n            }\n\n            //current connection (the one being dragged by the mouse)\n            if (this.connecting_pos != null) {\n                ctx.lineWidth = this.connections_width;\n                var link_color = null;\n                \n                var connInOrOut = this.connecting_output || this.connecting_input;\n\n                var connType = connInOrOut.type;\n                var connDir = connInOrOut.dir;\n\t\t\t\tif(connDir == null)\n\t\t\t\t{\n\t\t\t\t\tif (this.connecting_output)\n\t\t\t\t\t\tconnDir = this.connecting_node.horizontal ? LiteGraph.DOWN : LiteGraph.RIGHT;\n\t\t\t\t\telse\n\t\t\t\t\t\tconnDir = this.connecting_node.horizontal ? LiteGraph.UP : LiteGraph.LEFT;\n\t\t\t\t}\n                var connShape = connInOrOut.shape;\n                \n                switch (connType) {\n                    case LiteGraph.EVENT:\n                        link_color = LiteGraph.EVENT_LINK_COLOR;\n                        break;\n                    default:\n                        link_color = LiteGraph.CONNECTING_LINK_COLOR;\n                }\n\n                //the connection being dragged by the mouse\n                this.renderLink(\n                    ctx,\n                    this.connecting_pos,\n                    [this.graph_mouse[0], this.graph_mouse[1]],\n                    null,\n                    false,\n                    null,\n                    link_color,\n                    connDir,\n                    LiteGraph.CENTER\n                );\n\n                ctx.beginPath();\n                if (\n                    connType === LiteGraph.EVENT ||\n                    connShape === LiteGraph.BOX_SHAPE\n                ) {\n                    ctx.rect(\n                        this.connecting_pos[0] - 6 + 0.5,\n                        this.connecting_pos[1] - 5 + 0.5,\n                        14,\n                        10\n                    );\n\t                ctx.fill();\n\t\t\t\t\tctx.beginPath();\n                    ctx.rect(\n                        this.graph_mouse[0] - 6 + 0.5,\n                        this.graph_mouse[1] - 5 + 0.5,\n                        14,\n                        10\n                    );\n                } else if (connShape === LiteGraph.ARROW_SHAPE) {\n                    ctx.moveTo(this.connecting_pos[0] + 8, this.connecting_pos[1] + 0.5);\n                    ctx.lineTo(this.connecting_pos[0] - 4, this.connecting_pos[1] + 6 + 0.5);\n                    ctx.lineTo(this.connecting_pos[0] - 4, this.connecting_pos[1] - 6 + 0.5);\n                    ctx.closePath();\n                } \n                else {\n                    ctx.arc(\n                        this.connecting_pos[0],\n                        this.connecting_pos[1],\n                        4,\n                        0,\n                        Math.PI * 2\n                    );\n\t                ctx.fill();\n\t\t\t\t\tctx.beginPath();\n                    ctx.arc(\n                        this.graph_mouse[0],\n                        this.graph_mouse[1],\n                        4,\n                        0,\n                        Math.PI * 2\n                    );\n                }\n                ctx.fill();\n\n                ctx.fillStyle = \"#ffcc00\";\n                if (this._highlight_input) {\n                    ctx.beginPath();\n                    var shape = this._highlight_input_slot.shape;\n                    if (shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(this._highlight_input[0] + 8, this._highlight_input[1] + 0.5);\n                        ctx.lineTo(this._highlight_input[0] - 4, this._highlight_input[1] + 6 + 0.5);\n                        ctx.lineTo(this._highlight_input[0] - 4, this._highlight_input[1] - 6 + 0.5);\n                        ctx.closePath();\n                    } else {\n                        ctx.arc(\n                            this._highlight_input[0],\n                            this._highlight_input[1],\n                            6,\n                            0,\n                            Math.PI * 2\n                        );\n                    }\n                    ctx.fill();\n                }\n                if (this._highlight_output) {\n                    ctx.beginPath();\n                    if (shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(this._highlight_output[0] + 8, this._highlight_output[1] + 0.5);\n                        ctx.lineTo(this._highlight_output[0] - 4, this._highlight_output[1] + 6 + 0.5);\n                        ctx.lineTo(this._highlight_output[0] - 4, this._highlight_output[1] - 6 + 0.5);\n                        ctx.closePath();\n                    } else {\n                        ctx.arc(\n                            this._highlight_output[0],\n                            this._highlight_output[1],\n                            6,\n                            0,\n                            Math.PI * 2\n                        );\n                    }\n                    ctx.fill();\n                }\n            }\n\n\t\t\t//the selection rectangle\n            if (this.dragging_rectangle) {\n                ctx.strokeStyle = \"#FFF\";\n                ctx.strokeRect(\n                    this.dragging_rectangle[0],\n                    this.dragging_rectangle[1],\n                    this.dragging_rectangle[2],\n                    this.dragging_rectangle[3]\n                );\n            }\n\n\t\t\t//on top of link center\n\t\t\tif(this.over_link_center && this.render_link_tooltip)\n\t\t\t\tthis.drawLinkTooltip( ctx, this.over_link_center );\n\t\t\telse\n\t\t\t\tif(this.onDrawLinkTooltip) //to remove\n\t\t\t\t\tthis.onDrawLinkTooltip(ctx,null);\n\n\t\t\t//custom info\n            if (this.onDrawForeground) {\n                this.onDrawForeground(ctx, this.visible_rect);\n            }\n\n            ctx.restore();\n        }\n\n\t\t//draws panel in the corner \n\t\tif (this._graph_stack && this._graph_stack.length) {\n\t\t\tthis.drawSubgraphPanel( ctx );\n\t\t}\n\n\n        if (this.onDrawOverlay) {\n            this.onDrawOverlay(ctx);\n        }\n\n        if (area){\n            ctx.restore();\n        }\n\n        if (ctx.finish2D) {\n            //this is a function I use in webgl renderer\n            ctx.finish2D();\n        }\n    };\n\n    /**\n     * draws the panel in the corner that shows subgraph properties\n     * @method drawSubgraphPanel\n     **/\n    LGraphCanvas.prototype.drawSubgraphPanel = function (ctx) {\n        var subgraph = this.graph;\n        var subnode = subgraph._subgraph_node;\n        if (!subnode) {\n            console.warn(\"subgraph without subnode\");\n            return;\n        }\n        this.drawSubgraphPanelLeft(subgraph, subnode, ctx)\n        this.drawSubgraphPanelRight(subgraph, subnode, ctx)\n    }\n\n    LGraphCanvas.prototype.drawSubgraphPanelLeft = function (subgraph, subnode, ctx) {\n        var num = subnode.inputs ? subnode.inputs.length : 0;\n        var w = 200;\n        var h = Math.floor(LiteGraph.NODE_SLOT_HEIGHT * 1.6);\n\n        ctx.fillStyle = \"#111\";\n        ctx.globalAlpha = 0.8;\n        ctx.beginPath();\n        ctx.roundRect(10, 10, w, (num + 1) * h + 50, [8]);\n        ctx.fill();\n        ctx.globalAlpha = 1;\n\n        ctx.fillStyle = \"#888\";\n        ctx.font = \"14px Arial\";\n        ctx.textAlign = \"left\";\n        ctx.fillText(\"Graph Inputs\", 20, 34);\n        // var pos = this.mouse;\n\n        if (this.drawButton(w - 20, 20, 20, 20, \"X\", \"#151515\")) {\n            this.closeSubgraph();\n            return;\n        }\n\n        var y = 50;\n        ctx.font = \"14px Arial\";\n        if (subnode.inputs)\n            for (var i = 0; i < subnode.inputs.length; ++i) {\n                var input = subnode.inputs[i];\n                if (input.not_subgraph_input)\n                    continue;\n\n                //input button clicked\n                if (this.drawButton(20, y + 2, w - 20, h - 2)) {\n                    var type = subnode.constructor.input_node_type || \"graph/input\";\n                    this.graph.beforeChange();\n                    var newnode = LiteGraph.createNode(type);\n                    if (newnode) {\n                        subgraph.add(newnode);\n                        this.block_click = false;\n                        this.last_click_position = null;\n                        this.selectNodes([newnode]);\n                        this.node_dragged = newnode;\n                        this.dragging_canvas = false;\n                        newnode.setProperty(\"name\", input.name);\n                        newnode.setProperty(\"type\", input.type);\n                        this.node_dragged.pos[0] = this.graph_mouse[0] - 5;\n                        this.node_dragged.pos[1] = this.graph_mouse[1] - 5;\n                        this.graph.afterChange();\n                    }\n                    else\n                        console.error(\"graph input node not found:\", type);\n                }\n                ctx.fillStyle = \"#9C9\";\n                ctx.beginPath();\n                ctx.arc(w - 16, y + h * 0.5, 5, 0, 2 * Math.PI);\n                ctx.fill();\n                ctx.fillStyle = \"#AAA\";\n                ctx.fillText(input.name, 30, y + h * 0.75);\n                // var tw = ctx.measureText(input.name);\n                ctx.fillStyle = \"#777\";\n                ctx.fillText(input.type, 130, y + h * 0.75);\n                y += h;\n            }\n        //add + button\n        if (this.drawButton(20, y + 2, w - 20, h - 2, \"+\", \"#151515\", \"#222\")) {\n            this.showSubgraphPropertiesDialog(subnode);\n        }\n    }\n    LGraphCanvas.prototype.drawSubgraphPanelRight = function (subgraph, subnode, ctx) {\n        var num = subnode.outputs ? subnode.outputs.length : 0;\n        var canvas_w = this.bgcanvas.width\n        var w = 200;\n        var h = Math.floor(LiteGraph.NODE_SLOT_HEIGHT * 1.6);\n\n        ctx.fillStyle = \"#111\";\n        ctx.globalAlpha = 0.8;\n        ctx.beginPath();\n        ctx.roundRect(canvas_w - w - 10, 10, w, (num + 1) * h + 50, [8]);\n        ctx.fill();\n        ctx.globalAlpha = 1;\n\n        ctx.fillStyle = \"#888\";\n        ctx.font = \"14px Arial\";\n        ctx.textAlign = \"left\";\n        var title_text = \"Graph Outputs\"\n        var tw = ctx.measureText(title_text).width\n        ctx.fillText(title_text, (canvas_w - tw) - 20, 34);\n        // var pos = this.mouse;\n        if (this.drawButton(canvas_w - w, 20, 20, 20, \"X\", \"#151515\")) {\n            this.closeSubgraph();\n            return;\n        }\n\n        var y = 50;\n        ctx.font = \"14px Arial\";\n        if (subnode.outputs)\n            for (var i = 0; i < subnode.outputs.length; ++i) {\n                var output = subnode.outputs[i];\n                if (output.not_subgraph_input)\n                    continue;\n\n                //output button clicked\n                if (this.drawButton(canvas_w - w, y + 2, w - 20, h - 2)) {\n                    var type = subnode.constructor.output_node_type || \"graph/output\";\n                    this.graph.beforeChange();\n                    var newnode = LiteGraph.createNode(type);\n                    if (newnode) {\n                        subgraph.add(newnode);\n                        this.block_click = false;\n                        this.last_click_position = null;\n                        this.selectNodes([newnode]);\n                        this.node_dragged = newnode;\n                        this.dragging_canvas = false;\n                        newnode.setProperty(\"name\", output.name);\n                        newnode.setProperty(\"type\", output.type);\n                        this.node_dragged.pos[0] = this.graph_mouse[0] - 5;\n                        this.node_dragged.pos[1] = this.graph_mouse[1] - 5;\n                        this.graph.afterChange();\n                    }\n                    else\n                        console.error(\"graph input node not found:\", type);\n                }\n                ctx.fillStyle = \"#9C9\";\n                ctx.beginPath();\n                ctx.arc(canvas_w - w + 16, y + h * 0.5, 5, 0, 2 * Math.PI);\n                ctx.fill();\n                ctx.fillStyle = \"#AAA\";\n                ctx.fillText(output.name, canvas_w - w + 30, y + h * 0.75);\n                // var tw = ctx.measureText(input.name);\n                ctx.fillStyle = \"#777\";\n                ctx.fillText(output.type, canvas_w - w + 130, y + h * 0.75);\n                y += h;\n            }\n        //add + button\n        if (this.drawButton(canvas_w - w, y + 2, w - 20, h - 2, \"+\", \"#151515\", \"#222\")) {\n            this.showSubgraphPropertiesDialogRight(subnode);\n        }\n    }\n\t//Draws a button into the canvas overlay and computes if it was clicked using the immediate gui paradigm\n\tLGraphCanvas.prototype.drawButton = function( x,y,w,h, text, bgcolor, hovercolor, textcolor )\n\t{\n\t\tvar ctx = this.ctx;\n\t\tbgcolor = bgcolor || LiteGraph.NODE_DEFAULT_COLOR;\n\t\thovercolor = hovercolor || \"#555\";\n\t\ttextcolor = textcolor || LiteGraph.NODE_TEXT_COLOR;\n\t\tvar pos = this.ds.convertOffsetToCanvas(this.graph_mouse);\n\t\tvar hover = LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\t\tpos = this.last_click_position ? [this.last_click_position[0], this.last_click_position[1]] : null;\n        if(pos) {\n            var rect = this.canvas.getBoundingClientRect();\n            pos[0] -= rect.left;\n            pos[1] -= rect.top;\n        }\n\t\tvar clicked = pos && LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\n\t\tctx.fillStyle = hover ? hovercolor : bgcolor;\n\t\tif(clicked)\n\t\t\tctx.fillStyle = \"#AAA\";\n\t\tctx.beginPath();\n\t\tctx.roundRect(x,y,w,h,[4] );\n\t\tctx.fill();\n\n\t\tif(text != null)\n\t\t{\n\t\t\tif(text.constructor == String)\n\t\t\t{\n\t\t\t\tctx.fillStyle = textcolor;\n\t\t\t\tctx.textAlign = \"center\";\n\t\t\t\tctx.font = ((h * 0.65)|0) + \"px Arial\";\n\t\t\t\tctx.fillText( text, x + w * 0.5,y + h * 0.75 );\n\t\t\t\tctx.textAlign = \"left\";\n\t\t\t}\n\t\t}\n\n\t\tvar was_clicked = clicked && !this.block_click;\n\t\tif(clicked)\n\t\t\tthis.blockClick();\n\t\treturn was_clicked;\n\t}\n\n\tLGraphCanvas.prototype.isAreaClicked = function( x,y,w,h, hold_click )\n\t{\n\t\tvar pos = this.mouse;\n\t\tvar hover = LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\t\tpos = this.last_click_position;\n\t\tvar clicked = pos && LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\t\tvar was_clicked = clicked && !this.block_click;\n\t\tif(clicked && hold_click)\n\t\t\tthis.blockClick();\n\t\treturn was_clicked;\n\t}\n\n    /**\n     * draws some useful stats in the corner of the canvas\n     * @method renderInfo\n     **/\n    LGraphCanvas.prototype.renderInfo = function(ctx, x, y) {\n        x = x || 10;\n        y = y || this.canvas.height - 80;\n\n        ctx.save();\n        ctx.translate(x, y);\n\n        ctx.font = \"10px Arial\";\n        ctx.fillStyle = \"#888\";\n\t\tctx.textAlign = \"left\";\n        if (this.graph) {\n            ctx.fillText( \"T: \" + this.graph.globaltime.toFixed(2) + \"s\", 5, 13 * 1 );\n            ctx.fillText(\"I: \" + this.graph.iteration, 5, 13 * 2 );\n            ctx.fillText(\"N: \" + this.graph._nodes.length + \" [\" + this.visible_nodes.length + \"]\", 5, 13 * 3 );\n            ctx.fillText(\"V: \" + this.graph._version, 5, 13 * 4);\n            ctx.fillText(\"FPS:\" + this.fps.toFixed(2), 5, 13 * 5);\n        } else {\n            ctx.fillText(\"No graph selected\", 5, 13 * 1);\n        }\n        ctx.restore();\n    };\n\n    /**\n     * draws the back canvas (the one containing the background and the connections)\n     * @method drawBackCanvas\n     **/\n    LGraphCanvas.prototype.drawBackCanvas = function() {\n        var canvas = this.bgcanvas;\n        if (\n            canvas.width != this.canvas.width ||\n            canvas.height != this.canvas.height\n        ) {\n            canvas.width = this.canvas.width;\n            canvas.height = this.canvas.height;\n        }\n\n        if (!this.bgctx) {\n            this.bgctx = this.bgcanvas.getContext(\"2d\");\n        }\n        var ctx = this.bgctx;\n        if (ctx.start) {\n            ctx.start();\n        }\n\n\t\tvar viewport = this.viewport || [0,0,ctx.canvas.width,ctx.canvas.height];\n\n        //clear\n        if (this.clear_background) {\n            ctx.clearRect( viewport[0], viewport[1], viewport[2], viewport[3] );\n        }\n\n\t\t//show subgraph stack header\n        if (this._graph_stack && this._graph_stack.length) {\n            ctx.save();\n            var parent_graph = this._graph_stack[this._graph_stack.length - 1];\n            var subgraph_node = this.graph._subgraph_node;\n            ctx.strokeStyle = subgraph_node.bgcolor;\n            ctx.lineWidth = 10;\n            ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);\n            ctx.lineWidth = 1;\n            ctx.font = \"40px Arial\";\n            ctx.textAlign = \"center\";\n            ctx.fillStyle = subgraph_node.bgcolor || \"#AAA\";\n            var title = \"\";\n            for (var i = 1; i < this._graph_stack.length; ++i) {\n                title +=\n                    this._graph_stack[i]._subgraph_node.getTitle() + \" >> \";\n            }\n            ctx.fillText(\n                title + subgraph_node.getTitle(),\n                canvas.width * 0.5,\n                40\n            );\n            ctx.restore();\n        }\n\n        var bg_already_painted = false;\n        if (this.onRenderBackground) {\n            bg_already_painted = this.onRenderBackground(canvas, ctx);\n        }\n\n        //reset in case of error\n        if ( !this.viewport )\n\t\t{\n\t        ctx.restore();\n\t\t    ctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\t}\n        this.visible_links.length = 0;\n\n        if (this.graph) {\n            //apply transformations\n            ctx.save();\n            this.ds.toCanvasContext(ctx);\n\n            //render BG\n            if ( this.ds.scale < 1.5 && !bg_already_painted && this.clear_background_color )\n            {\n                ctx.fillStyle = this.clear_background_color;\n                ctx.fillRect(\n                    this.visible_area[0],\n                    this.visible_area[1],\n                    this.visible_area[2],\n                    this.visible_area[3]\n                );\n            }\n\n            if (\n                this.background_image &&\n                this.ds.scale > 0.5 &&\n                !bg_already_painted\n            ) {\n                if (this.zoom_modify_alpha) {\n                    ctx.globalAlpha =\n                        (1.0 - 0.5 / this.ds.scale) * this.editor_alpha;\n                } else {\n                    ctx.globalAlpha = this.editor_alpha;\n                }\n                ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled = false; // ctx.mozImageSmoothingEnabled = \n                if (\n                    !this._bg_img ||\n                    this._bg_img.name != this.background_image\n                ) {\n                    this._bg_img = new Image();\n                    this._bg_img.name = this.background_image;\n                    this._bg_img.src = this.background_image;\n                    var that = this;\n                    this._bg_img.onload = function() {\n                        that.draw(true, true);\n                    };\n                }\n\n                var pattern = null;\n                if (this._pattern == null && this._bg_img.width > 0) {\n                    pattern = ctx.createPattern(this._bg_img, \"repeat\");\n                    this._pattern_img = this._bg_img;\n                    this._pattern = pattern;\n                } else {\n                    pattern = this._pattern;\n                }\n                if (pattern) {\n                    ctx.fillStyle = pattern;\n                    ctx.fillRect(\n                        this.visible_area[0],\n                        this.visible_area[1],\n                        this.visible_area[2],\n                        this.visible_area[3]\n                    );\n                    ctx.fillStyle = \"transparent\";\n                }\n\n                ctx.globalAlpha = 1.0;\n                ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled = true; //= ctx.mozImageSmoothingEnabled\n            }\n\n            //groups\n            if (this.graph._groups.length && !this.live_mode) {\n                this.drawGroups(canvas, ctx);\n            }\n\n            if (this.onDrawBackground) {\n                this.onDrawBackground(ctx, this.visible_area);\n            }\n            if (this.onBackgroundRender) {\n                //LEGACY\n                console.error(\n                    \"WARNING! onBackgroundRender deprecated, now is named onDrawBackground \"\n                );\n                this.onBackgroundRender = null;\n            }\n\n            //DEBUG: show clipping area\n            //ctx.fillStyle = \"red\";\n            //ctx.fillRect( this.visible_area[0] + 10, this.visible_area[1] + 10, this.visible_area[2] - 20, this.visible_area[3] - 20);\n\n            //bg\n            if (this.render_canvas_border) {\n                ctx.strokeStyle = \"#235\";\n                ctx.strokeRect(0, 0, canvas.width, canvas.height);\n            }\n\n            if (this.render_connections_shadows) {\n                ctx.shadowColor = \"#000\";\n                ctx.shadowOffsetX = 0;\n                ctx.shadowOffsetY = 0;\n                ctx.shadowBlur = 6;\n            } else {\n                ctx.shadowColor = \"rgba(0,0,0,0)\";\n            }\n\n            //draw connections\n            if (!this.live_mode) {\n                this.drawConnections(ctx);\n            }\n\n            ctx.shadowColor = \"rgba(0,0,0,0)\";\n\n            //restore state\n            ctx.restore();\n        }\n\n        if (ctx.finish) {\n            ctx.finish();\n        }\n\n        this.dirty_bgcanvas = false;\n        this.dirty_canvas = true; //to force to repaint the front canvas with the bgcanvas\n    };\n\n    var temp_vec2 = new Float32Array(2);\n\n    /**\n     * draws the given node inside the canvas\n     * @method drawNode\n     **/\n    LGraphCanvas.prototype.drawNode = function(node, ctx) {\n        var glow = false;\n        this.current_node = node;\n\n        var color = node.color || node.constructor.color || LiteGraph.NODE_DEFAULT_COLOR;\n        var bgcolor = node.bgcolor || node.constructor.bgcolor || LiteGraph.NODE_DEFAULT_BGCOLOR;\n\n        //shadow and glow\n        if (node.mouseOver) {\n            glow = true;\n        }\n\n        var low_quality = this.ds.scale < 0.6; //zoomed out\n\n        //only render if it forces it to do it\n        if (this.live_mode) {\n            if (!node.flags.collapsed) {\n                ctx.shadowColor = \"transparent\";\n                if (node.onDrawForeground) {\n                    node.onDrawForeground(ctx, this, this.canvas);\n                }\n            }\n            return;\n        }\n\n        var editor_alpha = this.editor_alpha;\n        ctx.globalAlpha = editor_alpha;\n\n        if (this.render_shadows && !low_quality) {\n            ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n            ctx.shadowOffsetX = 2 * this.ds.scale;\n            ctx.shadowOffsetY = 2 * this.ds.scale;\n            ctx.shadowBlur = 3 * this.ds.scale;\n        } else {\n            ctx.shadowColor = \"transparent\";\n        }\n\n        //custom draw collapsed method (draw after shadows because they are affected)\n        if (\n            node.flags.collapsed &&\n            node.onDrawCollapsed &&\n            node.onDrawCollapsed(ctx, this) == true\n        ) {\n            return;\n        }\n\n        //clip if required (mask)\n        var shape = node._shape || LiteGraph.BOX_SHAPE;\n        var size = temp_vec2;\n        temp_vec2.set(node.size);\n        var horizontal = node.horizontal; // || node.flags.horizontal;\n\n        if (node.flags.collapsed) {\n            ctx.font = this.inner_text_font;\n            var title = node.getTitle ? node.getTitle() : node.title;\n            if (title != null) {\n                node._collapsed_width = Math.min(\n                    node.size[0],\n                    ctx.measureText(title).width +\n                        LiteGraph.NODE_TITLE_HEIGHT * 2\n                ); //LiteGraph.NODE_COLLAPSED_WIDTH;\n                size[0] = node._collapsed_width;\n                size[1] = 0;\n            }\n        }\n\n        if (node.clip_area) {\n            //Start clipping\n            ctx.save();\n            ctx.beginPath();\n            if (shape == LiteGraph.BOX_SHAPE) {\n                ctx.rect(0, 0, size[0], size[1]);\n            } else if (shape == LiteGraph.ROUND_SHAPE) {\n                ctx.roundRect(0, 0, size[0], size[1], [10]);\n            } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n                ctx.arc(\n                    size[0] * 0.5,\n                    size[1] * 0.5,\n                    size[0] * 0.5,\n                    0,\n                    Math.PI * 2\n                );\n            }\n            ctx.clip();\n        }\n\n        //draw shape\n        if (node.has_errors) {\n            bgcolor = \"red\";\n        }\n        this.drawNodeShape(\n            node,\n            ctx,\n            size,\n            color,\n            bgcolor,\n            node.is_selected,\n            node.mouseOver\n        );\n        ctx.shadowColor = \"transparent\";\n\n        //draw foreground\n        if (node.onDrawForeground) {\n            node.onDrawForeground(ctx, this, this.canvas);\n        }\n\n        //connection slots\n        ctx.textAlign = horizontal ? \"center\" : \"left\";\n        ctx.font = this.inner_text_font;\n\n        var render_text = !low_quality;\n\n        var out_slot = this.connecting_output;\n        var in_slot = this.connecting_input;\n        ctx.lineWidth = 1;\n\n        var max_y = 0;\n        var slot_pos = new Float32Array(2); //to reuse\n\n        //render inputs and outputs\n        if (!node.flags.collapsed) {\n            //input connection slots\n            if (node.inputs) {\n                for (var i = 0; i < node.inputs.length; i++) {\n                    var slot = node.inputs[i];\n                    \n                    var slot_type = slot.type;\n                    var slot_shape = slot.shape;\n                    \n                    ctx.globalAlpha = editor_alpha;\n                    //change opacity of incompatible slots when dragging a connection\n                    if ( this.connecting_output && !LiteGraph.isValidConnection( slot.type , out_slot.type) ) {\n                        ctx.globalAlpha = 0.4 * editor_alpha;\n                    }\n\n                    ctx.fillStyle =\n                        slot.link != null\n                            ? slot.color_on ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.input_on\n                            : slot.color_off ||\n                              this.default_connection_color_byTypeOff[slot_type] ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.input_off;\n\n                    var pos = node.getConnectionPos(true, i, slot_pos);\n                    pos[0] -= node.pos[0];\n                    pos[1] -= node.pos[1];\n                    if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                        max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                    }\n\n                    ctx.beginPath();\n\n\t\t\t\t\tif (slot_type == \"array\"){\n                        slot_shape = LiteGraph.GRID_SHAPE; // place in addInput? addOutput instead?\n                    }\n                    \n                    var doStroke = true;\n                    \n                    if (\n                        slot.type === LiteGraph.EVENT ||\n                        slot.shape === LiteGraph.BOX_SHAPE\n                    ) {\n                        if (horizontal) {\n                            ctx.rect(\n                                pos[0] - 5 + 0.5,\n                                pos[1] - 8 + 0.5,\n                                10,\n                                14\n                            );\n                        } else {\n                            ctx.rect(\n                                pos[0] - 6 + 0.5,\n                                pos[1] - 5 + 0.5,\n                                14,\n                                10\n                            );\n                        }\n                    } else if (slot_shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                        ctx.closePath();\n                    } else if (slot_shape === LiteGraph.GRID_SHAPE) {\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] + 2, 2, 2);\n                        doStroke = false;\n                    } else {\n\t\t\t\t\t\tif(low_quality)\n\t                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 ); //faster\n\t\t\t\t\t\telse\n\t                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                    }\n                    ctx.fill();\n\n                    //render name\n                    if (render_text) {\n                        var text = slot.label != null ? slot.label : slot.name;\n                        if (text) {\n                            ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                            if (horizontal || slot.dir == LiteGraph.UP) {\n                                ctx.fillText(text, pos[0], pos[1] - 10);\n                            } else {\n                                ctx.fillText(text, pos[0] + 10, pos[1] + 5);\n                            }\n                        }\n                    }\n                }\n            }\n\n            //output connection slots\n\n            ctx.textAlign = horizontal ? \"center\" : \"right\";\n            ctx.strokeStyle = \"black\";\n            if (node.outputs) {\n                for (var i = 0; i < node.outputs.length; i++) {\n                    var slot = node.outputs[i];\n                    \n                    var slot_type = slot.type;\n                    var slot_shape = slot.shape;\n                    \n                    //change opacity of incompatible slots when dragging a connection\n                    if (this.connecting_input && !LiteGraph.isValidConnection( slot_type , in_slot.type) ) {\n                        ctx.globalAlpha = 0.4 * editor_alpha;\n                    }\n                    \n                    var pos = node.getConnectionPos(false, i, slot_pos);\n                    pos[0] -= node.pos[0];\n                    pos[1] -= node.pos[1];\n                    if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                        max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                    }\n\n                    ctx.fillStyle =\n                        slot.links && slot.links.length\n                            ? slot.color_on ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.output_on\n                            : slot.color_off ||\n                              this.default_connection_color_byTypeOff[slot_type] ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.output_off;\n                    ctx.beginPath();\n                    //ctx.rect( node.size[0] - 14,i*14,10,10);\n\n\t\t\t\t\tif (slot_type == \"array\"){\n                        slot_shape = LiteGraph.GRID_SHAPE;\n                    }\n                    \n                    var doStroke = true;\n                    \n                    if (\n                        slot_type === LiteGraph.EVENT ||\n                        slot_shape === LiteGraph.BOX_SHAPE\n                    ) {\n                        if (horizontal) {\n                            ctx.rect(\n                                pos[0] - 5 + 0.5,\n                                pos[1] - 8 + 0.5,\n                                10,\n                                14\n                            );\n                        } else {\n                            ctx.rect(\n                                pos[0] - 6 + 0.5,\n                                pos[1] - 5 + 0.5,\n                                14,\n                                10\n                            );\n                        }\n                    } else if (slot_shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                        ctx.closePath();\n                    }  else if (slot_shape === LiteGraph.GRID_SHAPE) {\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] + 2, 2, 2);\n                        doStroke = false;\n                    } else {\n\t\t\t\t\t\tif(low_quality)\n\t                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 );\n\t\t\t\t\t\telse\n\t                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                    }\n\n                    //trigger\n                    //if(slot.node_id != null && slot.slot == -1)\n                    //\tctx.fillStyle = \"#F85\";\n\n                    //if(slot.links != null && slot.links.length)\n                    ctx.fill();\n\t\t\t\t\tif(!low_quality && doStroke)\n\t                    ctx.stroke();\n\n                    //render output name\n                    if (render_text) {\n                        var text = slot.label != null ? slot.label : slot.name;\n                        if (text) {\n                            ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                            if (horizontal || slot.dir == LiteGraph.DOWN) {\n                                ctx.fillText(text, pos[0], pos[1] - 8);\n                            } else {\n                                ctx.fillText(text, pos[0] - 10, pos[1] + 5);\n                            }\n                        }\n                    }\n                }\n            }\n\n            ctx.textAlign = \"left\";\n            ctx.globalAlpha = 1;\n\n            if (node.widgets) {\n\t\t\t\tvar widgets_y = max_y;\n                if (horizontal || node.widgets_up) {\n                    widgets_y = 2;\n                }\n\t\t\t\tif( node.widgets_start_y != null )\n                    widgets_y = node.widgets_start_y;\n                this.drawNodeWidgets(\n                    node,\n                    widgets_y,\n                    ctx,\n                    this.node_widget && this.node_widget[0] == node\n                        ? this.node_widget[1]\n                        : null\n                );\n            }\n        } else if (this.render_collapsed_slots) {\n            //if collapsed\n            var input_slot = null;\n            var output_slot = null;\n\n            //get first connected slot to render\n            if (node.inputs) {\n                for (var i = 0; i < node.inputs.length; i++) {\n                    var slot = node.inputs[i];\n                    if (slot.link == null) {\n                        continue;\n                    }\n                    input_slot = slot;\n                    break;\n                }\n            }\n            if (node.outputs) {\n                for (var i = 0; i < node.outputs.length; i++) {\n                    var slot = node.outputs[i];\n                    if (!slot.links || !slot.links.length) {\n                        continue;\n                    }\n                    output_slot = slot;\n                }\n            }\n\n            if (input_slot) {\n                var x = 0;\n                var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n                if (horizontal) {\n                    x = node._collapsed_width * 0.5;\n                    y = -LiteGraph.NODE_TITLE_HEIGHT;\n                }\n                ctx.fillStyle = \"#686\";\n                ctx.beginPath();\n                if (\n                    slot.type === LiteGraph.EVENT ||\n                    slot.shape === LiteGraph.BOX_SHAPE\n                ) {\n                    ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n                } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                    ctx.moveTo(x + 8, y);\n                    ctx.lineTo(x + -4, y - 4);\n                    ctx.lineTo(x + -4, y + 4);\n                    ctx.closePath();\n                } else {\n                    ctx.arc(x, y, 4, 0, Math.PI * 2);\n                }\n                ctx.fill();\n            }\n\n            if (output_slot) {\n                var x = node._collapsed_width;\n                var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n                if (horizontal) {\n                    x = node._collapsed_width * 0.5;\n                    y = 0;\n                }\n                ctx.fillStyle = \"#686\";\n                ctx.strokeStyle = \"black\";\n                ctx.beginPath();\n                if (\n                    slot.type === LiteGraph.EVENT ||\n                    slot.shape === LiteGraph.BOX_SHAPE\n                ) {\n                    ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n                } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                    ctx.moveTo(x + 6, y);\n                    ctx.lineTo(x - 6, y - 4);\n                    ctx.lineTo(x - 6, y + 4);\n                    ctx.closePath();\n                } else {\n                    ctx.arc(x, y, 4, 0, Math.PI * 2);\n                }\n                ctx.fill();\n                //ctx.stroke();\n            }\n        }\n\n        if (node.clip_area) {\n            ctx.restore();\n        }\n\n        ctx.globalAlpha = 1.0;\n    };\n\n\t//used by this.over_link_center\n\tLGraphCanvas.prototype.drawLinkTooltip = function( ctx, link )\n\t{\n\t\tvar pos = link._pos;\n\t\tctx.fillStyle = \"black\";\n\t\tctx.beginPath();\n\t\tctx.arc( pos[0], pos[1], 3, 0, Math.PI * 2 );\n\t\tctx.fill();\n\n\t\tif(link.data == null)\n\t\t\treturn;\n\n\t\tif(this.onDrawLinkTooltip)\n\t\t\tif( this.onDrawLinkTooltip(ctx,link,this) == true )\n\t\t\t\treturn;\n\n\t\tvar data = link.data;\n\t\tvar text = null;\n\n\t\tif( data.constructor === Number )\n\t\t\ttext = data.toFixed(2);\n\t\telse if( data.constructor === String )\n\t\t\ttext = \"\\\"\" + data + \"\\\"\";\n\t\telse if( data.constructor === Boolean )\n\t\t\ttext = String(data);\n\t\telse if (data.toToolTip)\n\t\t\ttext = data.toToolTip();\n\t\telse\n\t\t\ttext = \"[\" + data.constructor.name + \"]\";\n\n\t\tif(text == null)\n\t\t\treturn;\n\t\ttext = text.substr(0,30); //avoid weird\n\n\t\tctx.font = \"14px Courier New\";\n\t\tvar info = ctx.measureText(text);\n\t\tvar w = info.width + 20;\n\t\tvar h = 24;\n\t\tctx.shadowColor = \"black\";\n\t\tctx.shadowOffsetX = 2;\n\t\tctx.shadowOffsetY = 2;\n\t\tctx.shadowBlur = 3;\n\t\tctx.fillStyle = \"#454\";\n\t\tctx.beginPath();\n\t\tctx.roundRect( pos[0] - w*0.5, pos[1] - 15 - h, w, h, [3]);\n\t\tctx.moveTo( pos[0] - 10, pos[1] - 15 );\n\t\tctx.lineTo( pos[0] + 10, pos[1] - 15 );\n\t\tctx.lineTo( pos[0], pos[1] - 5 );\n\t\tctx.fill();\n        ctx.shadowColor = \"transparent\";\n\t\tctx.textAlign = \"center\";\n\t\tctx.fillStyle = \"#CEC\";\n\t\tctx.fillText(text, pos[0], pos[1] - 15 - h * 0.3);\n\t}\n\n    /**\n     * draws the shape of the given node in the canvas\n     * @method drawNodeShape\n     **/\n    var tmp_area = new Float32Array(4);\n\n    LGraphCanvas.prototype.drawNodeShape = function(\n        node,\n        ctx,\n        size,\n        fgcolor,\n        bgcolor,\n        selected,\n        mouse_over\n    ) {\n        //bg rect\n        ctx.strokeStyle = fgcolor;\n        ctx.fillStyle = bgcolor;\n\n        var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n        var low_quality = this.ds.scale < 0.5;\n\n        //render node area depending on shape\n        var shape =\n            node._shape || node.constructor.shape || LiteGraph.ROUND_SHAPE;\n\n        var title_mode = node.constructor.title_mode;\n\n        var render_title = true;\n        if (title_mode == LiteGraph.TRANSPARENT_TITLE || title_mode == LiteGraph.NO_TITLE) {\n            render_title = false;\n        } else if (title_mode == LiteGraph.AUTOHIDE_TITLE && mouse_over) {\n            render_title = true;\n        }\n\n        var area = tmp_area;\n        area[0] = 0; //x\n        area[1] = render_title ? -title_height : 0; //y\n        area[2] = size[0] + 1; //w\n        area[3] = render_title ? size[1] + title_height : size[1]; //h\n\n        var old_alpha = ctx.globalAlpha;\n\n        //full node shape\n        //if(node.flags.collapsed)\n        {\n            ctx.beginPath();\n            if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n                ctx.fillRect(area[0], area[1], area[2], area[3]);\n            } else if (\n                shape == LiteGraph.ROUND_SHAPE ||\n                shape == LiteGraph.CARD_SHAPE\n            ) {\n                ctx.roundRect(\n                    area[0],\n                    area[1],\n                    area[2],\n                    area[3],\n                    shape == LiteGraph.CARD_SHAPE ? [this.round_radius,this.round_radius,0,0] : [this.round_radius] \n                );\n            } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n                ctx.arc(\n                    size[0] * 0.5,\n                    size[1] * 0.5,\n                    size[0] * 0.5,\n                    0,\n                    Math.PI * 2\n                );\n            }\n            ctx.fill();\n\n\t\t\t//separator\n\t\t\tif(!node.flags.collapsed && render_title)\n\t\t\t{\n\t\t\t\tctx.shadowColor = \"transparent\";\n\t\t\t\tctx.fillStyle = \"rgba(0,0,0,0.2)\";\n\t\t\t\tctx.fillRect(0, -1, area[2], 2);\n\t\t\t}\n        }\n        ctx.shadowColor = \"transparent\";\n\n        if (node.onDrawBackground) {\n            node.onDrawBackground(ctx, this, this.canvas, this.graph_mouse );\n        }\n\n        //title bg (remember, it is rendered ABOVE the node)\n        if (render_title || title_mode == LiteGraph.TRANSPARENT_TITLE) {\n            //title bar\n            if (node.onDrawTitleBar) {\n                node.onDrawTitleBar( ctx, title_height, size, this.ds.scale, fgcolor );\n            } else if (\n                title_mode != LiteGraph.TRANSPARENT_TITLE &&\n                (node.constructor.title_color || this.render_title_colored)\n            ) {\n                var title_color = node.constructor.title_color || fgcolor;\n\n                if (node.flags.collapsed) {\n                    ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n                }\n\n                //* gradient test\n                if (this.use_gradients) {\n                    var grad = LGraphCanvas.gradients[title_color];\n                    if (!grad) {\n                        grad = LGraphCanvas.gradients[ title_color ] = ctx.createLinearGradient(0, 0, 400, 0);\n                        grad.addColorStop(0, title_color); // TODO refactor: validate color !! prevent DOMException\n                        grad.addColorStop(1, \"#000\");\n                    }\n                    ctx.fillStyle = grad;\n                } else {\n                    ctx.fillStyle = title_color;\n                }\n\n                //ctx.globalAlpha = 0.5 * old_alpha;\n                ctx.beginPath();\n                if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n                    ctx.rect(0, -title_height, size[0] + 1, title_height);\n                } else if (  shape == LiteGraph.ROUND_SHAPE || shape == LiteGraph.CARD_SHAPE ) {\n                    ctx.roundRect(\n                        0,\n                        -title_height,\n                        size[0] + 1,\n                        title_height,\n                        node.flags.collapsed ? [this.round_radius] : [this.round_radius,this.round_radius,0,0]\n                    );\n                }\n                ctx.fill();\n                ctx.shadowColor = \"transparent\";\n            }\n\n            var colState = false;\n            if (LiteGraph.node_box_coloured_by_mode){\n                if(LiteGraph.NODE_MODES_COLORS[node.mode]){\n                    colState = LiteGraph.NODE_MODES_COLORS[node.mode];\n                }\n            }\n            if (LiteGraph.node_box_coloured_when_on){\n                colState = node.action_triggered ? \"#FFF\" : (node.execute_triggered ? \"#AAA\" : colState);\n            }\n            \n            //title box\n            var box_size = 10;\n            if (node.onDrawTitleBox) {\n                node.onDrawTitleBox(ctx, title_height, size, this.ds.scale);\n            } else if (\n                shape == LiteGraph.ROUND_SHAPE ||\n                shape == LiteGraph.CIRCLE_SHAPE ||\n                shape == LiteGraph.CARD_SHAPE\n            ) {\n                if (low_quality) {\n                    ctx.fillStyle = \"black\";\n                    ctx.beginPath();\n                    ctx.arc(\n                        title_height * 0.5,\n                        title_height * -0.5,\n                        box_size * 0.5 + 1,\n                        0,\n                        Math.PI * 2\n                    );\n                    ctx.fill();\n                }\n                \n                ctx.fillStyle = node.boxcolor || colState || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n\t\t\t\tif(low_quality)\n\t\t\t\t\tctx.fillRect( title_height * 0.5 - box_size *0.5, title_height * -0.5 - box_size *0.5, box_size , box_size  );\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.arc(\n\t\t\t\t\t\ttitle_height * 0.5,\n\t\t\t\t\t\ttitle_height * -0.5,\n\t\t\t\t\t\tbox_size * 0.5,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tMath.PI * 2\n\t\t\t\t\t);\n\t\t\t\t\tctx.fill();\n\t\t\t\t}\n            } else {\n                if (low_quality) {\n                    ctx.fillStyle = \"black\";\n                    ctx.fillRect(\n                        (title_height - box_size) * 0.5 - 1,\n                        (title_height + box_size) * -0.5 - 1,\n                        box_size + 2,\n                        box_size + 2\n                    );\n                }\n                ctx.fillStyle = node.boxcolor || colState || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n                ctx.fillRect(\n                    (title_height - box_size) * 0.5,\n                    (title_height + box_size) * -0.5,\n                    box_size,\n                    box_size\n                );\n            }\n            ctx.globalAlpha = old_alpha;\n\n            //title text\n            if (node.onDrawTitleText) {\n                node.onDrawTitleText(\n                    ctx,\n                    title_height,\n                    size,\n                    this.ds.scale,\n                    this.title_text_font,\n                    selected\n                );\n            }\n            if (!low_quality) {\n                ctx.font = this.title_text_font;\n                var title = String(node.getTitle());\n                if (title) {\n                    if (selected) {\n                        ctx.fillStyle = LiteGraph.NODE_SELECTED_TITLE_COLOR;\n                    } else {\n                        ctx.fillStyle =\n                            node.constructor.title_text_color ||\n                            this.node_title_color;\n                    }\n                    if (node.flags.collapsed) {\n                        ctx.textAlign = \"left\";\n                        var measure = ctx.measureText(title);\n                        ctx.fillText(\n                            title.substr(0,20), //avoid urls too long\n                            title_height,// + measure.width * 0.5,\n                            LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                        );\n                        ctx.textAlign = \"left\";\n                    } else {\n                        ctx.textAlign = \"left\";\n                        ctx.fillText(\n                            title,\n                            title_height,\n                            LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                        );\n                    }\n                }\n            }\n\n\t\t\t//subgraph box\n\t\t\tif (!node.flags.collapsed && node.subgraph && !node.skip_subgraph_button) {\n\t\t\t\tvar w = LiteGraph.NODE_TITLE_HEIGHT;\n\t\t\t\tvar x = node.size[0] - w;\n\t\t\t\tvar over = LiteGraph.isInsideRectangle( this.graph_mouse[0] - node.pos[0], this.graph_mouse[1] - node.pos[1], x+2, -w+2, w-4, w-4 );\n\t\t\t\tctx.fillStyle = over ? \"#888\" : \"#555\";\n\t\t\t\tif( shape == LiteGraph.BOX_SHAPE || low_quality)\n\t\t\t\t\tctx.fillRect(x+2, -w+2, w-4, w-4);\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.roundRect(x+2, -w+2, w-4, w-4,[4]);\n\t\t\t\t\tctx.fill();\n\t\t\t\t}\n\t\t\t\tctx.fillStyle = \"#333\";\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.moveTo(x + w * 0.2, -w * 0.6);\n\t\t\t\tctx.lineTo(x + w * 0.8, -w * 0.6);\n\t\t\t\tctx.lineTo(x + w * 0.5, -w * 0.3);\n\t\t\t\tctx.fill();\n\t\t\t}\n\n\t\t\t//custom title render\n            if (node.onDrawTitle) {\n                node.onDrawTitle(ctx);\n            }\n        }\n\n        //render selection marker\n        if (selected) {\n            if (node.onBounding) {\n                node.onBounding(area);\n            }\n\n            if (title_mode == LiteGraph.TRANSPARENT_TITLE) {\n                area[1] -= title_height;\n                area[3] += title_height;\n            }\n            ctx.lineWidth = 1;\n            ctx.globalAlpha = 0.8;\n            ctx.beginPath();\n            if (shape == LiteGraph.BOX_SHAPE) {\n                ctx.rect(\n                    -6 + area[0],\n                    -6 + area[1],\n                    12 + area[2],\n                    12 + area[3]\n                );\n            } else if (\n                shape == LiteGraph.ROUND_SHAPE ||\n                (shape == LiteGraph.CARD_SHAPE && node.flags.collapsed)\n            ) {\n                ctx.roundRect(\n                    -6 + area[0],\n                    -6 + area[1],\n                    12 + area[2],\n                    12 + area[3],\n                    [this.round_radius * 2]\n                );\n            } else if (shape == LiteGraph.CARD_SHAPE) {\n                ctx.roundRect(\n                    -6 + area[0],\n                    -6 + area[1],\n                    12 + area[2],\n                    12 + area[3],\n                    [this.round_radius * 2,2,this.round_radius * 2,2]\n                );\n            } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n                ctx.arc(\n                    size[0] * 0.5,\n                    size[1] * 0.5,\n                    size[0] * 0.5 + 6,\n                    0,\n                    Math.PI * 2\n                );\n            }\n            ctx.strokeStyle = LiteGraph.NODE_BOX_OUTLINE_COLOR;\n            ctx.stroke();\n            ctx.strokeStyle = fgcolor;\n            ctx.globalAlpha = 1;\n        }\n        \n        // these counter helps in conditioning drawing based on if the node has been executed or an action occurred\n        if (node.execute_triggered>0) node.execute_triggered--;\n        if (node.action_triggered>0) node.action_triggered--;\n    };\n\n    var margin_area = new Float32Array(4);\n    var link_bounding = new Float32Array(4);\n    var tempA = new Float32Array(2);\n    var tempB = new Float32Array(2);\n\n    /**\n     * draws every connection visible in the canvas\n     * OPTIMIZE THIS: pre-catch connections position instead of recomputing them every time\n     * @method drawConnections\n     **/\n    LGraphCanvas.prototype.drawConnections = function(ctx) {\n        var now = LiteGraph.getTime();\n        var visible_area = this.visible_area;\n        margin_area[0] = visible_area[0] - 20;\n        margin_area[1] = visible_area[1] - 20;\n        margin_area[2] = visible_area[2] + 40;\n        margin_area[3] = visible_area[3] + 40;\n\n        //draw connections\n        ctx.lineWidth = this.connections_width;\n\n        ctx.fillStyle = \"#AAA\";\n        ctx.strokeStyle = \"#AAA\";\n        ctx.globalAlpha = this.editor_alpha;\n        //for every node\n        var nodes = this.graph._nodes;\n        for (var n = 0, l = nodes.length; n < l; ++n) {\n            var node = nodes[n];\n            //for every input (we render just inputs because it is easier as every slot can only have one input)\n            if (!node.inputs || !node.inputs.length) {\n                continue;\n            }\n\n            for (var i = 0; i < node.inputs.length; ++i) {\n                var input = node.inputs[i];\n                if (!input || input.link == null) {\n                    continue;\n                }\n                var link_id = input.link;\n                var link = this.graph.links[link_id];\n                if (!link) {\n                    continue;\n                }\n\n                //find link info\n                var start_node = this.graph.getNodeById(link.origin_id);\n                if (start_node == null) {\n                    continue;\n                }\n                var start_node_slot = link.origin_slot;\n                var start_node_slotpos = null;\n                if (start_node_slot == -1) {\n                    start_node_slotpos = [\n                        start_node.pos[0] + 10,\n                        start_node.pos[1] + 10\n                    ];\n                } else {\n                    start_node_slotpos = start_node.getConnectionPos(\n                        false,\n                        start_node_slot,\n                        tempA\n                    );\n                }\n                var end_node_slotpos = node.getConnectionPos(true, i, tempB);\n\n                //compute link bounding\n                link_bounding[0] = start_node_slotpos[0];\n                link_bounding[1] = start_node_slotpos[1];\n                link_bounding[2] = end_node_slotpos[0] - start_node_slotpos[0];\n                link_bounding[3] = end_node_slotpos[1] - start_node_slotpos[1];\n                if (link_bounding[2] < 0) {\n                    link_bounding[0] += link_bounding[2];\n                    link_bounding[2] = Math.abs(link_bounding[2]);\n                }\n                if (link_bounding[3] < 0) {\n                    link_bounding[1] += link_bounding[3];\n                    link_bounding[3] = Math.abs(link_bounding[3]);\n                }\n\n                //skip links outside of the visible area of the canvas\n                if (!overlapBounding(link_bounding, margin_area)) {\n                    continue;\n                }\n\n                var start_slot = start_node.outputs[start_node_slot];\n                var end_slot = node.inputs[i];\n                if (!start_slot || !end_slot) {\n                    continue;\n                }\n                var start_dir =\n                    start_slot.dir ||\n                    (start_node.horizontal ? LiteGraph.DOWN : LiteGraph.RIGHT);\n                var end_dir =\n                    end_slot.dir ||\n                    (node.horizontal ? LiteGraph.UP : LiteGraph.LEFT);\n\n                this.renderLink(\n                    ctx,\n                    start_node_slotpos,\n                    end_node_slotpos,\n                    link,\n                    false,\n                    0,\n                    null,\n                    start_dir,\n                    end_dir\n                );\n\n                //event triggered rendered on top\n                if (link && link._last_time && now - link._last_time < 1000) {\n                    var f = 2.0 - (now - link._last_time) * 0.002;\n                    var tmp = ctx.globalAlpha;\n                    ctx.globalAlpha = tmp * f;\n                    this.renderLink(\n                        ctx,\n                        start_node_slotpos,\n                        end_node_slotpos,\n                        link,\n                        true,\n                        f,\n                        \"white\",\n                        start_dir,\n                        end_dir\n                    );\n                    ctx.globalAlpha = tmp;\n                }\n            }\n        }\n        ctx.globalAlpha = 1;\n    };\n\n    /**\n     * draws a link between two points\n     * @method renderLink\n     * @param {vec2} a start pos\n     * @param {vec2} b end pos\n     * @param {Object} link the link object with all the link info\n     * @param {boolean} skip_border ignore the shadow of the link\n     * @param {boolean} flow show flow animation (for events)\n     * @param {string} color the color for the link\n     * @param {number} start_dir the direction enum\n     * @param {number} end_dir the direction enum\n     * @param {number} num_sublines number of sublines (useful to represent vec3 or rgb)\n     **/\n    LGraphCanvas.prototype.renderLink = function(\n        ctx,\n        a,\n        b,\n        link,\n        skip_border,\n        flow,\n        color,\n        start_dir,\n        end_dir,\n        num_sublines\n    ) {\n        if (link) {\n            this.visible_links.push(link);\n        }\n\n        //choose color\n        if (!color && link) {\n            color = link.color || LGraphCanvas.link_type_colors[link.type];\n        }\n        if (!color) {\n            color = this.default_link_color;\n        }\n        if (link != null && this.highlighted_links[link.id]) {\n            color = \"#FFF\";\n        }\n\n        start_dir = start_dir || LiteGraph.RIGHT;\n        end_dir = end_dir || LiteGraph.LEFT;\n\n        var dist = distance(a, b);\n\n        if (this.render_connections_border && this.ds.scale > 0.6) {\n            ctx.lineWidth = this.connections_width + 4;\n        }\n        ctx.lineJoin = \"round\";\n        num_sublines = num_sublines || 1;\n        if (num_sublines > 1) {\n            ctx.lineWidth = 0.5;\n        }\n\n        //begin line shape\n        ctx.beginPath();\n        for (var i = 0; i < num_sublines; i += 1) {\n            var offsety = (i - (num_sublines - 1) * 0.5) * 5;\n\n            if (this.links_render_mode == LiteGraph.SPLINE_LINK) {\n                ctx.moveTo(a[0], a[1] + offsety);\n                var start_offset_x = 0;\n                var start_offset_y = 0;\n                var end_offset_x = 0;\n                var end_offset_y = 0;\n                switch (start_dir) {\n                    case LiteGraph.LEFT:\n                        start_offset_x = dist * -0.25;\n                        break;\n                    case LiteGraph.RIGHT:\n                        start_offset_x = dist * 0.25;\n                        break;\n                    case LiteGraph.UP:\n                        start_offset_y = dist * -0.25;\n                        break;\n                    case LiteGraph.DOWN:\n                        start_offset_y = dist * 0.25;\n                        break;\n                }\n                switch (end_dir) {\n                    case LiteGraph.LEFT:\n                        end_offset_x = dist * -0.25;\n                        break;\n                    case LiteGraph.RIGHT:\n                        end_offset_x = dist * 0.25;\n                        break;\n                    case LiteGraph.UP:\n                        end_offset_y = dist * -0.25;\n                        break;\n                    case LiteGraph.DOWN:\n                        end_offset_y = dist * 0.25;\n                        break;\n                }\n                ctx.bezierCurveTo(\n                    a[0] + start_offset_x,\n                    a[1] + start_offset_y + offsety,\n                    b[0] + end_offset_x,\n                    b[1] + end_offset_y + offsety,\n                    b[0],\n                    b[1] + offsety\n                );\n            } else if (this.links_render_mode == LiteGraph.LINEAR_LINK) {\n                ctx.moveTo(a[0], a[1] + offsety);\n                var start_offset_x = 0;\n                var start_offset_y = 0;\n                var end_offset_x = 0;\n                var end_offset_y = 0;\n                switch (start_dir) {\n                    case LiteGraph.LEFT:\n                        start_offset_x = -1;\n                        break;\n                    case LiteGraph.RIGHT:\n                        start_offset_x = 1;\n                        break;\n                    case LiteGraph.UP:\n                        start_offset_y = -1;\n                        break;\n                    case LiteGraph.DOWN:\n                        start_offset_y = 1;\n                        break;\n                }\n                switch (end_dir) {\n                    case LiteGraph.LEFT:\n                        end_offset_x = -1;\n                        break;\n                    case LiteGraph.RIGHT:\n                        end_offset_x = 1;\n                        break;\n                    case LiteGraph.UP:\n                        end_offset_y = -1;\n                        break;\n                    case LiteGraph.DOWN:\n                        end_offset_y = 1;\n                        break;\n                }\n                var l = 15;\n                ctx.lineTo(\n                    a[0] + start_offset_x * l,\n                    a[1] + start_offset_y * l + offsety\n                );\n                ctx.lineTo(\n                    b[0] + end_offset_x * l,\n                    b[1] + end_offset_y * l + offsety\n                );\n                ctx.lineTo(b[0], b[1] + offsety);\n            } else if (this.links_render_mode == LiteGraph.STRAIGHT_LINK) {\n                ctx.moveTo(a[0], a[1]);\n                var start_x = a[0];\n                var start_y = a[1];\n                var end_x = b[0];\n                var end_y = b[1];\n                if (start_dir == LiteGraph.RIGHT) {\n                    start_x += 10;\n                } else {\n                    start_y += 10;\n                }\n                if (end_dir == LiteGraph.LEFT) {\n                    end_x -= 10;\n                } else {\n                    end_y -= 10;\n                }\n                ctx.lineTo(start_x, start_y);\n                ctx.lineTo((start_x + end_x) * 0.5, start_y);\n                ctx.lineTo((start_x + end_x) * 0.5, end_y);\n                ctx.lineTo(end_x, end_y);\n                ctx.lineTo(b[0], b[1]);\n            } else {\n                return;\n            } //unknown\n        }\n\n        //rendering the outline of the connection can be a little bit slow\n        if (\n            this.render_connections_border &&\n            this.ds.scale > 0.6 &&\n            !skip_border\n        ) {\n            ctx.strokeStyle = \"rgba(0,0,0,0.5)\";\n            ctx.stroke();\n        }\n\n        ctx.lineWidth = this.connections_width;\n        ctx.fillStyle = ctx.strokeStyle = color;\n        ctx.stroke();\n        //end line shape\n\n        var pos = this.computeConnectionPoint(a, b, 0.5, start_dir, end_dir);\n        if (link && link._pos) {\n            link._pos[0] = pos[0];\n            link._pos[1] = pos[1];\n        }\n\n        //render arrow in the middle\n        if (\n            this.ds.scale >= 0.6 &&\n            this.highquality_render &&\n            end_dir != LiteGraph.CENTER\n        ) {\n            //render arrow\n            if (this.render_connection_arrows) {\n                //compute two points in the connection\n                var posA = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.25,\n                    start_dir,\n                    end_dir\n                );\n                var posB = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.26,\n                    start_dir,\n                    end_dir\n                );\n                var posC = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.75,\n                    start_dir,\n                    end_dir\n                );\n                var posD = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.76,\n                    start_dir,\n                    end_dir\n                );\n\n                //compute the angle between them so the arrow points in the right direction\n                var angleA = 0;\n                var angleB = 0;\n                if (this.render_curved_connections) {\n                    angleA = -Math.atan2(posB[0] - posA[0], posB[1] - posA[1]);\n                    angleB = -Math.atan2(posD[0] - posC[0], posD[1] - posC[1]);\n                } else {\n                    angleB = angleA = b[1] > a[1] ? 0 : Math.PI;\n                }\n\n                //render arrow\n                ctx.save();\n                ctx.translate(posA[0], posA[1]);\n                ctx.rotate(angleA);\n                ctx.beginPath();\n                ctx.moveTo(-5, -3);\n                ctx.lineTo(0, +7);\n                ctx.lineTo(+5, -3);\n                ctx.fill();\n                ctx.restore();\n                ctx.save();\n                ctx.translate(posC[0], posC[1]);\n                ctx.rotate(angleB);\n                ctx.beginPath();\n                ctx.moveTo(-5, -3);\n                ctx.lineTo(0, +7);\n                ctx.lineTo(+5, -3);\n                ctx.fill();\n                ctx.restore();\n            }\n\n            //circle\n            ctx.beginPath();\n            ctx.arc(pos[0], pos[1], 5, 0, Math.PI * 2);\n            ctx.fill();\n        }\n\n        //render flowing points\n        if (flow) {\n            ctx.fillStyle = color;\n            for (var i = 0; i < 5; ++i) {\n                var f = (LiteGraph.getTime() * 0.001 + i * 0.2) % 1;\n                var pos = this.computeConnectionPoint(\n                    a,\n                    b,\n                    f,\n                    start_dir,\n                    end_dir\n                );\n                ctx.beginPath();\n                ctx.arc(pos[0], pos[1], 5, 0, 2 * Math.PI);\n                ctx.fill();\n            }\n        }\n    };\n\n    //returns the link center point based on curvature\n    LGraphCanvas.prototype.computeConnectionPoint = function(\n        a,\n        b,\n        t,\n        start_dir,\n        end_dir\n    ) {\n        start_dir = start_dir || LiteGraph.RIGHT;\n        end_dir = end_dir || LiteGraph.LEFT;\n\n        var dist = distance(a, b);\n        var p0 = a;\n        var p1 = [a[0], a[1]];\n        var p2 = [b[0], b[1]];\n        var p3 = b;\n\n        switch (start_dir) {\n            case LiteGraph.LEFT:\n                p1[0] += dist * -0.25;\n                break;\n            case LiteGraph.RIGHT:\n                p1[0] += dist * 0.25;\n                break;\n            case LiteGraph.UP:\n                p1[1] += dist * -0.25;\n                break;\n            case LiteGraph.DOWN:\n                p1[1] += dist * 0.25;\n                break;\n        }\n        switch (end_dir) {\n            case LiteGraph.LEFT:\n                p2[0] += dist * -0.25;\n                break;\n            case LiteGraph.RIGHT:\n                p2[0] += dist * 0.25;\n                break;\n            case LiteGraph.UP:\n                p2[1] += dist * -0.25;\n                break;\n            case LiteGraph.DOWN:\n                p2[1] += dist * 0.25;\n                break;\n        }\n\n        var c1 = (1 - t) * (1 - t) * (1 - t);\n        var c2 = 3 * ((1 - t) * (1 - t)) * t;\n        var c3 = 3 * (1 - t) * (t * t);\n        var c4 = t * t * t;\n\n        var x = c1 * p0[0] + c2 * p1[0] + c3 * p2[0] + c4 * p3[0];\n        var y = c1 * p0[1] + c2 * p1[1] + c3 * p2[1] + c4 * p3[1];\n        return [x, y];\n    };\n\n    LGraphCanvas.prototype.drawExecutionOrder = function(ctx) {\n        ctx.shadowColor = \"transparent\";\n        ctx.globalAlpha = 0.25;\n\n        ctx.textAlign = \"center\";\n        ctx.strokeStyle = \"white\";\n        ctx.globalAlpha = 0.75;\n\n        var visible_nodes = this.visible_nodes;\n        for (var i = 0; i < visible_nodes.length; ++i) {\n            var node = visible_nodes[i];\n            ctx.fillStyle = \"black\";\n            ctx.fillRect(\n                node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT,\n                node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT,\n                LiteGraph.NODE_TITLE_HEIGHT,\n                LiteGraph.NODE_TITLE_HEIGHT\n            );\n            if (node.order == 0) {\n                ctx.strokeRect(\n                    node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                    node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                    LiteGraph.NODE_TITLE_HEIGHT,\n                    LiteGraph.NODE_TITLE_HEIGHT\n                );\n            }\n            ctx.fillStyle = \"#FFF\";\n            ctx.fillText(\n                node.order,\n                node.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * -0.5,\n                node.pos[1] - 6\n            );\n        }\n        ctx.globalAlpha = 1;\n    };\n\n    /**\n     * draws the widgets stored inside a node\n     * @method drawNodeWidgets\n     **/\n    LGraphCanvas.prototype.drawNodeWidgets = function(\n        node,\n        posY,\n        ctx,\n        active_widget\n    ) {\n        if (!node.widgets || !node.widgets.length) {\n            return 0;\n        }\n        var width = node.size[0];\n        var widgets = node.widgets;\n        posY += 2;\n        var H = LiteGraph.NODE_WIDGET_HEIGHT;\n        var show_text = this.ds.scale > 0.5;\n        ctx.save();\n        ctx.globalAlpha = this.editor_alpha;\n        var outline_color = LiteGraph.WIDGET_OUTLINE_COLOR;\n        var background_color = LiteGraph.WIDGET_BGCOLOR;\n        var text_color = LiteGraph.WIDGET_TEXT_COLOR;\n\t\tvar secondary_text_color = LiteGraph.WIDGET_SECONDARY_TEXT_COLOR;\n        var margin = 15;\n\n        for (var i = 0; i < widgets.length; ++i) {\n            var w = widgets[i];\n            var y = posY;\n            if (w.y) {\n                y = w.y;\n            }\n            w.last_y = y;\n            ctx.strokeStyle = outline_color;\n            ctx.fillStyle = \"#222\";\n            ctx.textAlign = \"left\";\n\t\t\t//ctx.lineWidth = 2;\n\t\t\tif(w.disabled)\n\t\t\t\tctx.globalAlpha *= 0.5;\n\t\t\tvar widget_width = w.width || width;\n\n            switch (w.type) {\n                case \"button\":\n                    if (w.clicked) {\n                        ctx.fillStyle = \"#AAA\";\n                        w.clicked = false;\n                        this.dirty_canvas = true;\n                    }\n                    ctx.fillRect(margin, y, widget_width - margin * 2, H);\n\t\t\t\t\tif(show_text && !w.disabled)\n\t                    ctx.strokeRect( margin, y, widget_width - margin * 2, H );\n                    if (show_text) {\n                        ctx.textAlign = \"center\";\n                        ctx.fillStyle = text_color;\n                        ctx.fillText(w.label || w.name, widget_width * 0.5, y + H * 0.7);\n                    }\n                    break;\n                case \"toggle\":\n                    ctx.textAlign = \"left\";\n                    ctx.strokeStyle = outline_color;\n                    ctx.fillStyle = background_color;\n                    ctx.beginPath();\n                    if (show_text)\n\t                    ctx.roundRect(margin, y, widget_width - margin * 2, H, [H * 0.5]);\n\t\t\t\t\telse\n\t                    ctx.rect(margin, y, widget_width - margin * 2, H );\n                    ctx.fill();\n\t\t\t\t\tif(show_text && !w.disabled)\n\t                    ctx.stroke();\n                    ctx.fillStyle = w.value ? \"#89A\" : \"#333\";\n                    ctx.beginPath();\n                    ctx.arc( widget_width - margin * 2, y + H * 0.5, H * 0.36, 0, Math.PI * 2 );\n                    ctx.fill();\n                    if (show_text) {\n                        ctx.fillStyle = secondary_text_color;\n                        const label = w.label || w.name;    \n                        if (label != null) {\n                            ctx.fillText(label, margin * 2, y + H * 0.7);\n                        }\n                        ctx.fillStyle = w.value ? text_color : secondary_text_color;\n                        ctx.textAlign = \"right\";\n                        ctx.fillText(\n                            w.value\n                                ? w.options.on || \"true\"\n                                : w.options.off || \"false\",\n                            widget_width - 40,\n                            y + H * 0.7\n                        );\n                    }\n                    break;\n                case \"slider\":\n                    ctx.fillStyle = background_color;\n                    ctx.fillRect(margin, y, widget_width - margin * 2, H);\n                    var range = w.options.max - w.options.min;\n                    var nvalue = (w.value - w.options.min) / range;\n\t\t\t\t\tif(nvalue < 0.0) nvalue = 0.0;\n\t\t\t\t\tif(nvalue > 1.0) nvalue = 1.0;\n                    ctx.fillStyle = w.options.hasOwnProperty(\"slider_color\") ? w.options.slider_color : (active_widget == w ? \"#89A\" : \"#678\");\n                    ctx.fillRect(margin, y, nvalue * (widget_width - margin * 2), H);\n\t\t\t\t\tif(show_text && !w.disabled)\n\t                    ctx.strokeRect(margin, y, widget_width - margin * 2, H);\n                    if (w.marker) {\n                        var marker_nvalue = (w.marker - w.options.min) / range;\n\t\t\t\t\t\tif(marker_nvalue < 0.0) marker_nvalue = 0.0;\n\t\t\t\t\t\tif(marker_nvalue > 1.0) marker_nvalue = 1.0;\n                        ctx.fillStyle = w.options.hasOwnProperty(\"marker_color\") ? w.options.marker_color : \"#AA9\";\n                        ctx.fillRect( margin + marker_nvalue * (widget_width - margin * 2), y, 2, H );\n                    }\n                    if (show_text) {\n                        ctx.textAlign = \"center\";\n                        ctx.fillStyle = text_color;\n                        ctx.fillText(\n                            w.label || w.name + \"  \" + Number(w.value).toFixed(\n                                                            w.options.precision != null\n                                                                ? w.options.precision\n                                                                : 3\n                                                        ),\n                            widget_width * 0.5,\n                            y + H * 0.7\n                        );\n                    }\n                    break;\n                case \"number\":\n                case \"combo\":\n                    ctx.textAlign = \"left\";\n                    ctx.strokeStyle = outline_color;\n                    ctx.fillStyle = background_color;\n                    ctx.beginPath();\n\t\t\t\t\tif(show_text)\n\t                    ctx.roundRect(margin, y, widget_width - margin * 2, H, [H * 0.5] );\n\t\t\t\t\telse\n\t                    ctx.rect(margin, y, widget_width - margin * 2, H );\n                    ctx.fill();\n                    if (show_text) {\n\t\t\t\t\t\tif(!w.disabled)\n\t\t                    ctx.stroke();\n                        ctx.fillStyle = text_color;\n\t\t\t\t\t\tif(!w.disabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tctx.beginPath();\n\t\t\t\t\t\t\tctx.moveTo(margin + 16, y + 5);\n\t\t\t\t\t\t\tctx.lineTo(margin + 6, y + H * 0.5);\n\t\t\t\t\t\t\tctx.lineTo(margin + 16, y + H - 5);\n\t\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\t\tctx.beginPath();\n\t\t\t\t\t\t\tctx.moveTo(widget_width - margin - 16, y + 5);\n\t\t\t\t\t\t\tctx.lineTo(widget_width - margin - 6, y + H * 0.5);\n\t\t\t\t\t\t\tctx.lineTo(widget_width - margin - 16, y + H - 5);\n\t\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\t}\n                        ctx.fillStyle = secondary_text_color;\n                        ctx.fillText(w.label || w.name, margin * 2 + 5, y + H * 0.7);\n                        ctx.fillStyle = text_color;\n                        ctx.textAlign = \"right\";\n                        if (w.type == \"number\") {\n                            ctx.fillText(\n                                Number(w.value).toFixed(\n                                    w.options.precision !== undefined\n                                        ? w.options.precision\n                                        : 3\n                                ),\n                                widget_width - margin * 2 - 20,\n                                y + H * 0.7\n                            );\n                        } else {\n\t\t\t\t\t\t\tvar v = w.value;\n\t\t\t\t\t\t\tif( w.options.values )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar values = w.options.values;\n\t\t\t\t\t\t\t\tif( values.constructor === Function )\n\t\t\t\t\t\t\t\t\tvalues = values();\n\t\t\t\t\t\t\t\tif(values && values.constructor !== Array)\n\t\t\t\t\t\t\t\t\tv = values[ w.value ];\n\t\t\t\t\t\t\t}\n                            ctx.fillText(\n                                v,\n                                widget_width - margin * 2 - 20,\n                                y + H * 0.7\n                            );\n                        }\n                    }\n                    break;\n                case \"string\":\n                case \"text\":\n                    ctx.textAlign = \"left\";\n                    ctx.strokeStyle = outline_color;\n                    ctx.fillStyle = background_color;\n                    ctx.beginPath();\n                    if (show_text)\n\t                    ctx.roundRect(margin, y, widget_width - margin * 2, H, [H * 0.5]);\n\t\t\t\t\telse\n\t                    ctx.rect( margin, y, widget_width - margin * 2, H );\n                    ctx.fill();\n\t                if (show_text) {\n\t\t\t\t\t\tif(!w.disabled)\n\t\t\t\t\t\t\tctx.stroke();\n    \t\t\t\t\tctx.save();\n\t\t\t\t\t\tctx.beginPath();\n\t\t\t\t\t\tctx.rect(margin, y, widget_width - margin * 2, H);\n\t\t\t\t\t\tctx.clip();\n\n\t                    //ctx.stroke();\n                        ctx.fillStyle = secondary_text_color;\n                        const label = w.label || w.name;\t\n                        if (label != null) {\n                            ctx.fillText(label, margin * 2, y + H * 0.7);\n                        }\n                        ctx.fillStyle = text_color;\n                        ctx.textAlign = \"right\";\n                        ctx.fillText(String(w.value).substr(0,30), widget_width - margin * 2, y + H * 0.7); //30 chars max\n\t\t\t\t\t\tctx.restore();\n                    }\n                    break;\n                default:\n                    if (w.draw) {\n                        w.draw(ctx, node, widget_width, y, H);\n                    }\n                    break;\n            }\n            posY += (w.computeSize ? w.computeSize(widget_width)[1] : H) + 4;\n\t\t\tctx.globalAlpha = this.editor_alpha;\n\n        }\n        ctx.restore();\n\t\tctx.textAlign = \"left\";\n    };\n\n    /**\n     * process an event on widgets\n     * @method processNodeWidgets\n     **/\n    LGraphCanvas.prototype.processNodeWidgets = function(\n        node,\n        pos,\n        event,\n        active_widget\n    ) {\n        if (!node.widgets || !node.widgets.length || (!this.allow_interaction && !node.flags.allow_interaction)) {\n            return null;\n        }\n\n        var x = pos[0] - node.pos[0];\n        var y = pos[1] - node.pos[1];\n        var width = node.size[0];\n        var deltaX = event.deltaX || event.deltax || 0;\n        var that = this;\n        var ref_window = this.getCanvasWindow();\n\n        for (var i = 0; i < node.widgets.length; ++i) {\n            var w = node.widgets[i];\n\t\t\tif(!w || w.disabled)\n\t\t\t\tcontinue;\n\t\t\tvar widget_height = w.computeSize ? w.computeSize(width)[1] : LiteGraph.NODE_WIDGET_HEIGHT;\n\t\t\tvar widget_width = w.width || width;\n\t\t\t//outside\n\t\t\tif ( w != active_widget && \n\t\t\t\t(x < 6 || x > widget_width - 12 || y < w.last_y || y > w.last_y + widget_height || w.last_y === undefined) ) \n\t\t\t\tcontinue;\n\n\t\t\tvar old_value = w.value;\n\n            //if ( w == active_widget || (x > 6 && x < widget_width - 12 && y > w.last_y && y < w.last_y + widget_height) ) {\n\t\t\t//inside widget\n\t\t\tswitch (w.type) {\n\t\t\t\tcase \"button\":\n\t\t\t\t\tif (event.type === LiteGraph.pointerevents_method+\"down\") {\n                        if (w.callback) {\n                            setTimeout(function() {\n                                w.callback(w, that, node, pos, event);\n                            }, 20);\n                        }\n                        w.clicked = true;\n                        this.dirty_canvas = true;\n                    }\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"slider\":\n\t\t\t\t\tvar old_value = w.value;\n\t\t\t\t\tvar nvalue = clamp((x - 15) / (widget_width - 30), 0, 1);\n\t\t\t\t\tif(w.options.read_only) break;\n\t\t\t\t\tw.value = w.options.min + (w.options.max - w.options.min) * nvalue;\n\t\t\t\t\tif (old_value != w.value) {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tinner_value_change(w, w.value);\n\t\t\t\t\t\t}, 20);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dirty_canvas = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"number\":\n\t\t\t\tcase \"combo\":\n\t\t\t\t\tvar old_value = w.value;\n\t\t\t\t\tif (event.type == LiteGraph.pointerevents_method+\"move\" && w.type == \"number\") {\n                        if(deltaX)\n\t\t\t\t\t\t    w.value += deltaX * 0.1 * (w.options.step || 1);\n\t\t\t\t\t\tif ( w.options.min != null && w.value < w.options.min ) {\n\t\t\t\t\t\t\tw.value = w.options.min;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( w.options.max != null && w.value > w.options.max ) {\n\t\t\t\t\t\t\tw.value = w.options.max;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (event.type == LiteGraph.pointerevents_method+\"down\") {\n\t\t\t\t\t\tvar values = w.options.values;\n\t\t\t\t\t\tif (values && values.constructor === Function) {\n\t\t\t\t\t\t\tvalues = w.options.values(w, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar values_list = null;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif( w.type != \"number\")\n\t\t\t\t\t\t\tvalues_list = values.constructor === Array ? values : Object.keys(values);\n\n\t\t\t\t\t\tvar delta = x < 40 ? -1 : x > widget_width - 40 ? 1 : 0;\n\t\t\t\t\t\tif (w.type == \"number\") {\n\t\t\t\t\t\t\tw.value += delta * 0.1 * (w.options.step || 1);\n\t\t\t\t\t\t\tif ( w.options.min != null && w.value < w.options.min ) {\n\t\t\t\t\t\t\t\tw.value = w.options.min;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ( w.options.max != null && w.value > w.options.max ) {\n\t\t\t\t\t\t\t\tw.value = w.options.max;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (delta) { //clicked in arrow, used for combos \n\t\t\t\t\t\t\tvar index = -1;\n\t\t\t\t\t\t\tthis.last_mouseclick = 0; //avoids dobl click event\n\t\t\t\t\t\t\tif(values.constructor === Object)\n\t\t\t\t\t\t\t\tindex = values_list.indexOf( String( w.value ) ) + delta;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tindex = values_list.indexOf( w.value ) + delta;\n\t\t\t\t\t\t\tif (index >= values_list.length) {\n\t\t\t\t\t\t\t\tindex = values_list.length - 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (index < 0) {\n\t\t\t\t\t\t\t\tindex = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif( values.constructor === Array )\n\t\t\t\t\t\t\t\tw.value = values[index];\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tw.value = index;\n\t\t\t\t\t\t} else { //combo clicked \n\t\t\t\t\t\t\tvar text_values = values != values_list ? Object.values(values) : values;\n\t\t\t\t\t\t\tvar menu = new LiteGraph.ContextMenu(text_values, {\n\t\t\t\t\t\t\t\t\tscale: Math.max(1, this.ds.scale),\n\t\t\t\t\t\t\t\t\tevent: event,\n\t\t\t\t\t\t\t\t\tclassName: \"dark\",\n\t\t\t\t\t\t\t\t\tcallback: inner_clicked.bind(w)\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tref_window);\n\t\t\t\t\t\t\tfunction inner_clicked(v, option, event) {\n\t\t\t\t\t\t\t\tif(values != values_list)\n\t\t\t\t\t\t\t\t\tv = text_values.indexOf(v);\n\t\t\t\t\t\t\t\tthis.value = v;\n\t\t\t\t\t\t\t\tinner_value_change(this, v);\n\t\t\t\t\t\t\t\tthat.dirty_canvas = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} //end mousedown\n\t\t\t\t\telse if(event.type == LiteGraph.pointerevents_method+\"up\" && w.type == \"number\")\n\t\t\t\t\t{\n\t\t\t\t\t\tvar delta = x < 40 ? -1 : x > widget_width - 40 ? 1 : 0;\n\t\t\t\t\t\tif (event.click_time < 200 && delta == 0) {\n\t\t\t\t\t\t\tthis.prompt(\"Value\",w.value,function(v) {\n\t\t\t\t\t\t\t\t\t// check if v is a valid equation or a number\n\t\t\t\t\t\t\t\t\t  if (/^[0-9+\\-*/()\\s]+|\\d+\\.\\d+$/.test(v)) {\n\t\t\t\t\t\t\t\t\t\ttry {//solve the equation if possible\n\t\t\t\t\t\t\t\t\t    \t\tv = eval(v);\n\t\t\t\t\t\t\t\t\t\t} catch (e) { }\n\t\t\t\t\t\t\t\t\t}\t\n\t\t\t\t\t\t\t\t\tthis.value = Number(v);\n\t\t\t\t\t\t\t\t\tinner_value_change(this, this.value);\n\t\t\t\t\t\t\t\t}.bind(w),\n\t\t\t\t\t\t\t\tevent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( old_value != w.value )\n\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tinner_value_change(this, this.value);\n\t\t\t\t\t\t\t}.bind(w),\n\t\t\t\t\t\t\t20\n\t\t\t\t\t\t);\n\t\t\t\t\tthis.dirty_canvas = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"toggle\":\n\t\t\t\t\tif (event.type == LiteGraph.pointerevents_method+\"down\") {\n\t\t\t\t\t\tw.value = !w.value;\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tinner_value_change(w, w.value);\n\t\t\t\t\t\t}, 20);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"string\":\n\t\t\t\tcase \"text\":\n\t\t\t\t\tif (event.type == LiteGraph.pointerevents_method+\"down\") {\n\t\t\t\t\t\tthis.prompt(\"Value\",w.value,function(v) {\n\t\t\t\t\t\t\t\tinner_value_change(this, v);\n\t\t\t\t\t\t\t}.bind(w),\n\t\t\t\t\t\t\tevent,w.options ? w.options.multiline : false );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (w.mouse) {\n\t\t\t\t\t\tthis.dirty_canvas = w.mouse(event, [x, y], node);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t} //end switch\n\n\t\t\t//value changed\n\t\t\tif( old_value != w.value )\n\t\t\t{\n\t\t\t\tif(node.onWidgetChanged)\n\t\t\t\t\tnode.onWidgetChanged( w.name,w.value,old_value,w );\n                node.graph._version++;\n\t\t\t}\n\n\t\t\treturn w;\n        }//end for\n\n        function inner_value_change(widget, value) {\n            if(widget.type == \"number\"){\n                value = Number(value);\n            }\n            widget.value = value;\n            if ( widget.options && widget.options.property && node.properties[widget.options.property] !== undefined ) {\n                node.setProperty( widget.options.property, value );\n            }\n            if (widget.callback) {\n                widget.callback(widget.value, that, node, pos, event);\n            }\n        }\n\n        return null;\n    };\n\n    /**\n     * draws every group area in the background\n     * @method drawGroups\n     **/\n    LGraphCanvas.prototype.drawGroups = function(canvas, ctx) {\n        if (!this.graph) {\n            return;\n        }\n\n        var groups = this.graph._groups;\n\n        ctx.save();\n        ctx.globalAlpha = 0.5 * this.editor_alpha;\n\n        for (var i = 0; i < groups.length; ++i) {\n            var group = groups[i];\n\n            if (!overlapBounding(this.visible_area, group._bounding)) {\n                continue;\n            } //out of the visible area\n\n            ctx.fillStyle = group.color || \"#335\";\n            ctx.strokeStyle = group.color || \"#335\";\n            var pos = group._pos;\n            var size = group._size;\n            ctx.globalAlpha = 0.25 * this.editor_alpha;\n            ctx.beginPath();\n            ctx.rect(pos[0] + 0.5, pos[1] + 0.5, size[0], size[1]);\n            ctx.fill();\n            ctx.globalAlpha = this.editor_alpha;\n            ctx.stroke();\n\n            ctx.beginPath();\n            ctx.moveTo(pos[0] + size[0], pos[1] + size[1]);\n            ctx.lineTo(pos[0] + size[0] - 10, pos[1] + size[1]);\n            ctx.lineTo(pos[0] + size[0], pos[1] + size[1] - 10);\n            ctx.fill();\n\n            var font_size =\n                group.font_size || LiteGraph.DEFAULT_GROUP_FONT_SIZE;\n            ctx.font = font_size + \"px Arial\";\n\t\t\tctx.textAlign = \"left\";\n            ctx.fillText(group.title, pos[0] + 4, pos[1] + font_size);\n        }\n\n        ctx.restore();\n    };\n\n    LGraphCanvas.prototype.adjustNodesSize = function() {\n        var nodes = this.graph._nodes;\n        for (var i = 0; i < nodes.length; ++i) {\n            nodes[i].size = nodes[i].computeSize();\n        }\n        this.setDirty(true, true);\n    };\n\n    /**\n     * resizes the canvas to a given size, if no size is passed, then it tries to fill the parentNode\n     * @method resize\n     **/\n    LGraphCanvas.prototype.resize = function(width, height) {\n        if (!width && !height) {\n            var parent = this.canvas.parentNode;\n            width = parent.offsetWidth;\n            height = parent.offsetHeight;\n        }\n\n        if (this.canvas.width == width && this.canvas.height == height) {\n            return;\n        }\n\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.bgcanvas.width = this.canvas.width;\n        this.bgcanvas.height = this.canvas.height;\n        this.setDirty(true, true);\n    };\n\n    /**\n     * switches to live mode (node shapes are not rendered, only the content)\n     * this feature was designed when graphs where meant to create user interfaces\n     * @method switchLiveMode\n     **/\n    LGraphCanvas.prototype.switchLiveMode = function(transition) {\n        if (!transition) {\n            this.live_mode = !this.live_mode;\n            this.dirty_canvas = true;\n            this.dirty_bgcanvas = true;\n            return;\n        }\n\n        var self = this;\n        var delta = this.live_mode ? 1.1 : 0.9;\n        if (this.live_mode) {\n            this.live_mode = false;\n            this.editor_alpha = 0.1;\n        }\n\n        var t = setInterval(function() {\n            self.editor_alpha *= delta;\n            self.dirty_canvas = true;\n            self.dirty_bgcanvas = true;\n\n            if (delta < 1 && self.editor_alpha < 0.01) {\n                clearInterval(t);\n                if (delta < 1) {\n                    self.live_mode = true;\n                }\n            }\n            if (delta > 1 && self.editor_alpha > 0.99) {\n                clearInterval(t);\n                self.editor_alpha = 1;\n            }\n        }, 1);\n    };\n\n    LGraphCanvas.prototype.onNodeSelectionChange = function(node) {\n        return; //disabled\n    };\n\n    /* this is an implementation for touch not in production and not ready\n     */\n    /*LGraphCanvas.prototype.touchHandler = function(event) {\n        //alert(\"foo\");\n        var touches = event.changedTouches,\n            first = touches[0],\n            type = \"\";\n\n        switch (event.type) {\n            case \"touchstart\":\n                type = \"mousedown\";\n                break;\n            case \"touchmove\":\n                type = \"mousemove\";\n                break;\n            case \"touchend\":\n                type = \"mouseup\";\n                break;\n            default:\n                return;\n        }\n\n        //initMouseEvent(type, canBubble, cancelable, view, clickCount,\n        //           screenX, screenY, clientX, clientY, ctrlKey,\n        //           altKey, shiftKey, metaKey, button, relatedTarget);\n\n        // this is eventually a Dom object, get the LGraphCanvas back\n        if(typeof this.getCanvasWindow == \"undefined\"){\n            var window = this.lgraphcanvas.getCanvasWindow();\n        }else{\n            var window = this.getCanvasWindow();\n        }\n        \n        var document = window.document;\n\n        var simulatedEvent = document.createEvent(\"MouseEvent\");\n        simulatedEvent.initMouseEvent(\n            type,\n            true,\n            true,\n            window,\n            1,\n            first.screenX,\n            first.screenY,\n            first.clientX,\n            first.clientY,\n            false,\n            false,\n            false,\n            false,\n            0, //left\n            null\n        );\n        first.target.dispatchEvent(simulatedEvent);\n        event.preventDefault();\n    };*/\n\n    /* CONTEXT MENU ********************/\n\n    LGraphCanvas.onGroupAdd = function(info, entry, mouse_event) {\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var group = new LiteGraph.LGraphGroup();\n        group.pos = canvas.convertEventToCanvasOffset(mouse_event);\n        canvas.graph.add(group);\n    };\n\n    /**\n     * Determines the furthest nodes in each direction\n     * @param nodes {LGraphNode[]} the nodes to from which boundary nodes will be extracted\n     * @return {{left: LGraphNode, top: LGraphNode, right: LGraphNode, bottom: LGraphNode}}\n     */\n    LGraphCanvas.getBoundaryNodes = function(nodes) {\n        let top = null;\n        let right = null;\n        let bottom = null;\n        let left = null;\n        for (const nID in nodes) {\n            const node = nodes[nID];\n            const [x, y] = node.pos;\n            const [width, height] = node.size;\n\n            if (top === null || y < top.pos[1]) {\n                top = node;\n            }\n            if (right === null || x + width > right.pos[0] + right.size[0]) {\n                right = node;\n            }\n            if (bottom === null || y + height > bottom.pos[1] + bottom.size[1]) {\n                bottom = node;\n            }\n            if (left === null || x < left.pos[0]) {\n                left = node;\n            }\n        }\n\n        return {\n            \"top\": top,\n            \"right\": right,\n            \"bottom\": bottom,\n            \"left\": left\n        };\n    }\n    /**\n     * Determines the furthest nodes in each direction for the currently selected nodes\n     * @return {{left: LGraphNode, top: LGraphNode, right: LGraphNode, bottom: LGraphNode}}\n     */\n    LGraphCanvas.prototype.boundaryNodesForSelection = function() {\n        return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes));\n    }\n\n    /**\n     *\n     * @param {LGraphNode[]} nodes a list of nodes\n     * @param {\"top\"|\"bottom\"|\"left\"|\"right\"} direction Direction to align the nodes\n     * @param {LGraphNode?} align_to Node to align to (if null, align to the furthest node in the given direction)\n     */\n    LGraphCanvas.alignNodes = function (nodes, direction, align_to) {\n        if (!nodes) {\n            return;\n        }\n\n        const canvas = LGraphCanvas.active_canvas;\n        let boundaryNodes = []\n        if (align_to === undefined) {\n            boundaryNodes = LGraphCanvas.getBoundaryNodes(nodes)\n        } else {\n            boundaryNodes = {\n                \"top\": align_to,\n                \"right\": align_to,\n                \"bottom\": align_to,\n                \"left\": align_to\n            }\n        }\n\n        for (const [_, node] of Object.entries(canvas.selected_nodes)) {\n            switch (direction) {\n                case \"right\":\n                    node.pos[0] = boundaryNodes[\"right\"].pos[0] + boundaryNodes[\"right\"].size[0] - node.size[0];\n                    break;\n                case \"left\":\n                    node.pos[0] = boundaryNodes[\"left\"].pos[0];\n                    break;\n                case \"top\":\n                    node.pos[1] = boundaryNodes[\"top\"].pos[1];\n                    break;\n                case \"bottom\":\n                    node.pos[1] = boundaryNodes[\"bottom\"].pos[1] + boundaryNodes[\"bottom\"].size[1] - node.size[1];\n                    break;\n            }\n        }\n\n        canvas.dirty_canvas = true;\n        canvas.dirty_bgcanvas = true;\n    };\n\n    LGraphCanvas.onNodeAlign = function(value, options, event, prev_menu, node) {\n        new LiteGraph.ContextMenu([\"Top\", \"Bottom\", \"Left\", \"Right\"], {\n            event: event,\n            callback: inner_clicked,\n            parentMenu: prev_menu,\n        });\n\n        function inner_clicked(value) {\n            LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes, value.toLowerCase(), node);\n        }\n    }\n\n    LGraphCanvas.onGroupAlign = function(value, options, event, prev_menu) {\n        new LiteGraph.ContextMenu([\"Top\", \"Bottom\", \"Left\", \"Right\"], {\n            event: event,\n            callback: inner_clicked,\n            parentMenu: prev_menu,\n        });\n\n        function inner_clicked(value) {\n            LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes, value.toLowerCase());\n        }\n    }\n\n    LGraphCanvas.onMenuAdd = function (node, options, e, prev_menu, callback) {\n\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n        var graph = canvas.graph;\n        if (!graph)\n            return;\n\n        function inner_onMenuAdded(base_category ,prev_menu){\n    \n            var categories  = LiteGraph.getNodeTypesCategories(canvas.filter || graph.filter).filter(function(category){return category.startsWith(base_category)});\n            var entries = [];\n    \n            categories.map(function(category){\n    \n                if (!category) \n                    return;\n    \n                var base_category_regex = new RegExp('^(' + base_category + ')');\n                var category_name = category.replace(base_category_regex,\"\").split('/')[0];\n                var category_path = base_category  === '' ? category_name + '/' : base_category + category_name + '/';\n    \n                var name = category_name;\n                if(name.indexOf(\"::\") != -1) //in case it has a namespace like \"shader::math/rand\" it hides the namespace\n                    name = name.split(\"::\")[1];\n                        \n                var index = entries.findIndex(function(entry){return entry.value === category_path});\n                if (index === -1) {\n                    entries.push({ value: category_path, content: name, has_submenu: true, callback : function(value, event, mouseEvent, contextMenu){\n                        inner_onMenuAdded(value.value, contextMenu)\n                    }});\n                }\n                \n            });\n    \n            var nodes = LiteGraph.getNodeTypesInCategory(base_category.slice(0, -1), canvas.filter || graph.filter );\n            nodes.map(function(node){\n    \n                if (node.skip_list)\n                    return;\n    \n                var entry = { value: node.type, content: node.title, has_submenu: false , callback : function(value, event, mouseEvent, contextMenu){\n                    \n                        var first_event = contextMenu.getFirstEvent();\n                        canvas.graph.beforeChange();\n                        var node = LiteGraph.createNode(value.value);\n                        if (node) {\n                            node.pos = canvas.convertEventToCanvasOffset(first_event);\n                            canvas.graph.add(node);\n                        }\n                        if(callback)\n                            callback(node);\n                        canvas.graph.afterChange();\n                    \n                    }\n                }\n    \n                entries.push(entry);\n    \n            });\n    \n            new LiteGraph.ContextMenu( entries, { event: e, parentMenu: prev_menu }, ref_window );\n    \n        }\n    \n        inner_onMenuAdded('',prev_menu);\n        return false;\n    \n    };\n\n    LGraphCanvas.onMenuCollapseAll = function() {};\n\n    LGraphCanvas.onMenuNodeEdit = function() {};\n\n    LGraphCanvas.showMenuNodeOptionalInputs = function(\n        v,\n        options,\n        e,\n        prev_menu,\n        node\n    ) {\n        if (!node) {\n            return;\n        }\n\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var options = node.optional_inputs;\n        if (node.onGetInputs) {\n            options = node.onGetInputs();\n        }\n\n        var entries = [];\n        if (options) {\n            for (var i=0; i < options.length; i++) {\n                var entry = options[i];\n                if (!entry) {\n                    entries.push(null);\n                    continue;\n                }\n                var label = entry[0];\n\t\t\t\tif(!entry[2])\n\t\t\t\t\tentry[2] = {};\n\n                if (entry[2].label) {\n                    label = entry[2].label;\n                }\n\n\t\t\t\tentry[2].removable = true;\n                var data = { content: label, value: entry };\n                if (entry[1] == LiteGraph.ACTION) {\n                    data.className = \"event\";\n                }\n                entries.push(data);\n            }\n        }\n\n        if (node.onMenuNodeInputs) {\n            var retEntries = node.onMenuNodeInputs(entries);\n            if(retEntries) entries = retEntries;\n        }\n\n        if (!entries.length) {\n\t\t\tconsole.log(\"no input entries\");\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(\n            entries,\n            {\n                event: e,\n                callback: inner_clicked,\n                parentMenu: prev_menu,\n                node: node\n            },\n            ref_window\n        );\n\n        function inner_clicked(v, e, prev) {\n            if (!node) {\n                return;\n            }\n\n            if (v.callback) {\n                v.callback.call(that, node, v, e, prev);\n            }\n\n            if (v.value) {\n\t\t\t\tnode.graph.beforeChange();\n                node.addInput(v.value[0], v.value[1], v.value[2]);\n\n                if (node.onNodeInputAdd) { // callback to the node when adding a slot\n                    node.onNodeInputAdd(v.value);\n                }\n                node.setDirtyCanvas(true, true);\n\t\t\t\tnode.graph.afterChange();\n            }\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.showMenuNodeOptionalOutputs = function(\n        v,\n        options,\n        e,\n        prev_menu,\n        node\n    ) {\n        if (!node) {\n            return;\n        }\n\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var options = node.optional_outputs;\n        if (node.onGetOutputs) {\n            options = node.onGetOutputs();\n        }\n\n        var entries = [];\n        if (options) {\n            for (var i=0; i < options.length; i++) {\n                var entry = options[i];\n                if (!entry) {\n                    //separator?\n                    entries.push(null);\n                    continue;\n                }\n\n                if (\n                    node.flags &&\n                    node.flags.skip_repeated_outputs &&\n                    node.findOutputSlot(entry[0]) != -1\n                ) {\n                    continue;\n                } //skip the ones already on\n                var label = entry[0];\n\t\t\t\tif(!entry[2])\n\t\t\t\t\tentry[2] = {};\n                if (entry[2].label) {\n                    label = entry[2].label;\n                }\n\t\t\t\tentry[2].removable = true;\n                var data = { content: label, value: entry };\n                if (entry[1] == LiteGraph.EVENT) {\n                    data.className = \"event\";\n                }\n                entries.push(data);\n            }\n        }\n\n        if (this.onMenuNodeOutputs) {\n            entries = this.onMenuNodeOutputs(entries);\n        }\n        if (LiteGraph.do_add_triggers_slots){ //canvas.allow_addOutSlot_onExecuted\n            if (node.findOutputSlot(\"onExecuted\") == -1){\n                entries.push({content: \"On Executed\", value: [\"onExecuted\", LiteGraph.EVENT, {nameLocked: true}], className: \"event\"}); //, opts: {}\n            }\n        }\n        // add callback for modifing the menu elements onMenuNodeOutputs\n        if (node.onMenuNodeOutputs) {\n            var retEntries = node.onMenuNodeOutputs(entries);\n            if(retEntries) entries = retEntries;\n        }\n\n        if (!entries.length) {\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(\n            entries,\n            {\n                event: e,\n                callback: inner_clicked,\n                parentMenu: prev_menu,\n                node: node\n            },\n            ref_window\n        );\n\n        function inner_clicked(v, e, prev) {\n            if (!node) {\n                return;\n            }\n\n            if (v.callback) {\n                v.callback.call(that, node, v, e, prev);\n            }\n\n            if (!v.value) {\n                return;\n            }\n\n            var value = v.value[1];\n\n            if (\n                value &&\n                (value.constructor === Object || value.constructor === Array)\n            ) {\n                //submenu why?\n                var entries = [];\n                for (var i in value) {\n                    entries.push({ content: i, value: value[i] });\n                }\n                new LiteGraph.ContextMenu(entries, {\n                    event: e,\n                    callback: inner_clicked,\n                    parentMenu: prev_menu,\n                    node: node\n                });\n                return false;\n            } else {\n\t\t\t\tnode.graph.beforeChange();\n                node.addOutput(v.value[0], v.value[1], v.value[2]);\n\n                if (node.onNodeOutputAdd) { // a callback to the node when adding a slot\n                    node.onNodeOutputAdd(v.value);\n                }\n                node.setDirtyCanvas(true, true);\n\t\t\t\tnode.graph.afterChange();\n            }\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onShowMenuNodeProperties = function(\n        value,\n        options,\n        e,\n        prev_menu,\n        node\n    ) {\n        if (!node || !node.properties) {\n            return;\n        }\n\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var entries = [];\n        for (var i in node.properties) {\n            var value = node.properties[i] !== undefined ? node.properties[i] : \" \";\n\t\t\tif( typeof value == \"object\" )\n\t\t\t\tvalue = JSON.stringify(value);\n\t\t\tvar info = node.getPropertyInfo(i);\n\t\t\tif(info.type == \"enum\" || info.type == \"combo\")\n\t\t\t\tvalue = LGraphCanvas.getPropertyPrintableValue( value, info.values );\n\n            //value could contain invalid html characters, clean that\n            value = LGraphCanvas.decodeHTML(value);\n            entries.push({\n                content:\n                    \"<span class='property_name'>\" +\n                    (info.label ? info.label : i) +\n                    \"</span>\" +\n                    \"<span class='property_value'>\" +\n                    value +\n                    \"</span>\",\n                value: i\n            });\n        }\n        if (!entries.length) {\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(\n            entries,\n            {\n                event: e,\n                callback: inner_clicked,\n                parentMenu: prev_menu,\n                allow_html: true,\n                node: node\n            },\n            ref_window\n        );\n\n        function inner_clicked(v, options, e, prev) {\n            if (!node) {\n                return;\n            }\n            var rect = this.getBoundingClientRect();\n            canvas.showEditPropertyValue(node, v.value, {\n                position: [rect.left, rect.top]\n            });\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.decodeHTML = function(str) {\n        var e = document.createElement(\"div\");\n        e.innerText = str;\n        return e.innerHTML;\n    };\n\n    LGraphCanvas.onMenuResizeNode = function(value, options, e, menu, node) {\n        if (!node) {\n            return;\n        }\n        \n\t\tvar fApplyMultiNode = function(node){\n\t\t\tnode.size = node.computeSize();\n\t\t\tif (node.onResize)\n\t\t\t\tnode.onResize(node.size);\n\t\t}\n\t\t\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.prototype.showLinkMenu = function(link, e) {\n        var that = this;\n\t\t// console.log(link);\n\t\tvar node_left = that.graph.getNodeById( link.origin_id );\n\t\tvar node_right = that.graph.getNodeById( link.target_id );\n\t\tvar fromType = false;\n\t\tif (node_left && node_left.outputs && node_left.outputs[link.origin_slot]) fromType = node_left.outputs[link.origin_slot].type;\n        var destType = false;\n\t\tif (node_right && node_right.outputs && node_right.outputs[link.target_slot]) destType = node_right.inputs[link.target_slot].type;\n\t\t\n\t\tvar options = [\"Add Node\",null,\"Delete\",null];\n\t\t\n\t\t\n        var menu = new LiteGraph.ContextMenu(options, {\n            event: e,\n\t\t\ttitle: link.data != null ? link.data.constructor.name : null,\n            callback: inner_clicked\n        });\n\n        function inner_clicked(v,options,e) {\n            switch (v) {\n                case \"Add Node\":\n\t\t\t\t\tLGraphCanvas.onMenuAdd(null, null, e, menu, function(node){\n\t\t\t\t\t\t// console.debug(\"node autoconnect\");\n\t\t\t\t\t\tif(!node.inputs || !node.inputs.length || !node.outputs || !node.outputs.length){\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// leave the connection type checking inside connectByType\n\t\t\t\t\t\tif (node_left.connectByType( link.origin_slot, node, fromType )){\n                        \tnode.connectByType( link.target_slot, node_right, destType );\n                            node.pos[0] -= node.size[0] * 0.5;\n                        }\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n                case \"Delete\":\n                    that.graph.removeLink(link.id);\n                    break;\n                default:\n\t\t\t\t\t/*var nodeCreated = createDefaultNodeForSlot({   nodeFrom: node_left\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotFrom: link.origin_slot\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeTo: node\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotTo: link.target_slot\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,e: e\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeType: \"AUTO\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\tif(nodeCreated) console.log(\"new node in beetween \"+v+\" created\");*/\n            }\n        }\n\n        return false;\n    };\n    \n \tLGraphCanvas.prototype.createDefaultNodeForSlot = function(optPass) { // addNodeMenu for connection\n        var optPass = optPass || {};\n        var opts = Object.assign({   nodeFrom: null // input\n                                    ,slotFrom: null // input\n                                    ,nodeTo: null   // output\n                                    ,slotTo: null   // output\n                                    ,position: []\t// pass the event coords\n\t\t\t\t\t\t\t\t  \t,nodeType: null\t// choose a nodetype to add, AUTO to set at first good\n\t\t\t\t\t\t\t\t  \t,posAdd:[0,0]\t// adjust x,y\n\t\t\t\t\t\t\t\t  \t,posSizeFix:[0,0] // alpha, adjust the position x,y based on the new node size w,h\n                                }\n                                ,optPass\n                            );\n        var that = this;\n        \n        var isFrom = opts.nodeFrom && opts.slotFrom!==null;\n        var isTo = !isFrom && opts.nodeTo && opts.slotTo!==null;\n\t\n        if (!isFrom && !isTo){\n            console.warn(\"No data passed to createDefaultNodeForSlot \"+opts.nodeFrom+\" \"+opts.slotFrom+\" \"+opts.nodeTo+\" \"+opts.slotTo);\n            return false;\n        }\n\t\tif (!opts.nodeType){\n            console.warn(\"No type to createDefaultNodeForSlot\");\n            return false;\n        }\n        \n        var nodeX = isFrom ? opts.nodeFrom : opts.nodeTo;\n        var slotX = isFrom ? opts.slotFrom : opts.slotTo;\n        \n        var iSlotConn = false;\n        switch (typeof slotX){\n            case \"string\":\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX,false) : nodeX.findInputSlot(slotX,false);\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n            case \"object\":\n                // ok slotX\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX.name) : nodeX.findInputSlot(slotX.name);\n            break;\n            case \"number\":\n                iSlotConn = slotX;\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n\t\t\tcase \"undefined\":\n            default:\n                // bad ?\n                //iSlotConn = 0;\n                console.warn(\"Cant get slot information \"+slotX);\n                return false;\n        }\n\t\n\t\tif (slotX===false || iSlotConn===false){\n\t\t\tconsole.warn(\"createDefaultNodeForSlot bad slotX \"+slotX+\" \"+iSlotConn);\n\t\t}\n\t\t\n\t\t// check for defaults nodes for this slottype\n\t\tvar fromSlotType = slotX.type==LiteGraph.EVENT?\"_event_\":slotX.type;\n\t\tvar slotTypesDefault = isFrom ? LiteGraph.slot_types_default_out : LiteGraph.slot_types_default_in;\n\t\tif(slotTypesDefault && slotTypesDefault[fromSlotType]){\n\t\t\tif (slotX.link !== null) {\n\t\t\t\t// is connected\n\t\t\t}else{\n\t\t\t\t// is not not connected\n\t\t\t}\n\t\t\tnodeNewType = false;\n\t\t\tif(typeof slotTypesDefault[fromSlotType] == \"object\" || typeof slotTypesDefault[fromSlotType] == \"array\"){\n\t\t\t\tfor(var typeX in slotTypesDefault[fromSlotType]){\n\t\t\t\t\tif (opts.nodeType == slotTypesDefault[fromSlotType][typeX] || opts.nodeType == \"AUTO\"){\n\t\t\t\t\t\tnodeNewType = slotTypesDefault[fromSlotType][typeX];\n\t\t\t\t\t\t// console.log(\"opts.nodeType == slotTypesDefault[fromSlotType][typeX] :: \"+opts.nodeType);\n\t\t\t\t\t\tbreak; // --------\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif (opts.nodeType == slotTypesDefault[fromSlotType] || opts.nodeType == \"AUTO\") nodeNewType = slotTypesDefault[fromSlotType];\n\t\t\t}\n\t\t\tif (nodeNewType) {\n\t\t\t\tvar nodeNewOpts = false;\n\t\t\t\tif (typeof nodeNewType == \"object\" && nodeNewType.node){\n\t\t\t\t\tnodeNewOpts = nodeNewType;\n\t\t\t\t\tnodeNewType = nodeNewType.node;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//that.graph.beforeChange();\n\t\t\t\t\n\t\t\t\tvar newNode = LiteGraph.createNode(nodeNewType);\n\t\t\t\tif(newNode){\n\t\t\t\t\t// if is object pass options\n\t\t\t\t\tif (nodeNewOpts){\n\t\t\t\t\t\tif (nodeNewOpts.properties) {\n\t\t\t\t\t\t\tfor (var i in nodeNewOpts.properties) {\n\t\t\t\t\t\t\t\tnewNode.addProperty( i, nodeNewOpts.properties[i] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.inputs) {\n\t\t\t\t\t\t\tnewNode.inputs = [];\n\t\t\t\t\t\t\tfor (var i in nodeNewOpts.inputs) {\n\t\t\t\t\t\t\t\tnewNode.addOutput(\n\t\t\t\t\t\t\t\t\tnodeNewOpts.inputs[i][0],\n\t\t\t\t\t\t\t\t\tnodeNewOpts.inputs[i][1]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.outputs) {\n\t\t\t\t\t\t\tnewNode.outputs = [];\n\t\t\t\t\t\t\tfor (var i in nodeNewOpts.outputs) {\n\t\t\t\t\t\t\t\tnewNode.addOutput(\n\t\t\t\t\t\t\t\t\tnodeNewOpts.outputs[i][0],\n\t\t\t\t\t\t\t\t\tnodeNewOpts.outputs[i][1]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.title) {\n\t\t\t\t\t\t\tnewNode.title = nodeNewOpts.title;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.json) {\n\t\t\t\t\t\t\tnewNode.configure(nodeNewOpts.json);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// add the node\n\t\t\t\t\tthat.graph.add(newNode);\n\t\t\t\t\tnewNode.pos = [\topts.position[0]+opts.posAdd[0]+(opts.posSizeFix[0]?opts.posSizeFix[0]*newNode.size[0]:0)\n\t\t\t\t\t\t\t\t   \t,opts.position[1]+opts.posAdd[1]+(opts.posSizeFix[1]?opts.posSizeFix[1]*newNode.size[1]:0)]; //that.last_click_position; //[e.canvasX+30, e.canvasX+5];*/\n\t\t\t\t\t\n\t\t\t\t\t//that.graph.afterChange();\n\t\t\t\t\t\n\t\t\t\t\t// connect the two!\n\t\t\t\t\tif (isFrom){\n\t\t\t\t\t\topts.nodeFrom.connectByType( iSlotConn, newNode, fromSlotType );\n\t\t\t\t\t}else{\n\t\t\t\t\t\topts.nodeTo.connectByTypeOutput( iSlotConn, newNode, fromSlotType );\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// if connecting in between\n\t\t\t\t\tif (isFrom && isTo){\n\t\t\t\t\t\t// TODO\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn true;\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log(\"failed creating \"+nodeNewType);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n \n    LGraphCanvas.prototype.showConnectionMenu = function(optPass) { // addNodeMenu for connection\n        var optPass = optPass || {};\n        var opts = Object.assign({   nodeFrom: null  // input\n                                    ,slotFrom: null // input\n                                    ,nodeTo: null   // output\n                                    ,slotTo: null   // output\n                                    ,e: null\n                                }\n                                ,optPass\n                            );\n        var that = this;\n        \n        var isFrom = opts.nodeFrom && opts.slotFrom;\n        var isTo = !isFrom && opts.nodeTo && opts.slotTo;\n        \n        if (!isFrom && !isTo){\n            console.warn(\"No data passed to showConnectionMenu\");\n            return false;\n        }\n        \n        var nodeX = isFrom ? opts.nodeFrom : opts.nodeTo;\n        var slotX = isFrom ? opts.slotFrom : opts.slotTo;\n        \n        var iSlotConn = false;\n        switch (typeof slotX){\n            case \"string\":\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX,false) : nodeX.findInputSlot(slotX,false);\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n            case \"object\":\n                // ok slotX\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX.name) : nodeX.findInputSlot(slotX.name);\n            break;\n            case \"number\":\n                iSlotConn = slotX;\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n            default:\n                // bad ?\n                //iSlotConn = 0;\n                console.warn(\"Cant get slot information \"+slotX);\n                return false;\n        }\n            \n\t\tvar options = [\"Add Node\",null];\n\t\t\n\t\tif (that.allow_searchbox){\n\t\t\toptions.push(\"Search\");\n\t\t\toptions.push(null);\n\t\t}\n\t\t\n\t\t// get defaults nodes for this slottype\n\t\tvar fromSlotType = slotX.type==LiteGraph.EVENT?\"_event_\":slotX.type;\n\t\tvar slotTypesDefault = isFrom ? LiteGraph.slot_types_default_out : LiteGraph.slot_types_default_in;\n\t\tif(slotTypesDefault && slotTypesDefault[fromSlotType]){\n\t\t\tif(typeof slotTypesDefault[fromSlotType] == \"object\" || typeof slotTypesDefault[fromSlotType] == \"array\"){\n\t\t\t\tfor(var typeX in slotTypesDefault[fromSlotType]){\n\t\t\t\t\toptions.push(slotTypesDefault[fromSlotType][typeX]);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\toptions.push(slotTypesDefault[fromSlotType]);\n\t\t\t}\n\t\t}\n\t\t\n\t\t// build menu\n        var menu = new LiteGraph.ContextMenu(options, {\n            event: opts.e,\n\t\t\ttitle: (slotX && slotX.name!=\"\" ? (slotX.name + (fromSlotType?\" | \":\"\")) : \"\")+(slotX && fromSlotType ? fromSlotType : \"\"),\n            callback: inner_clicked\n        });\n        \n\t\t// callback\n        function inner_clicked(v,options,e) {\n            //console.log(\"Process showConnectionMenu selection\");\n            switch (v) {\n                case \"Add Node\":\n                    LGraphCanvas.onMenuAdd(null, null, e, menu, function(node){\n                        if (isFrom){\n                            opts.nodeFrom.connectByType( iSlotConn, node, fromSlotType );\n                        }else{\n                            opts.nodeTo.connectByTypeOutput( iSlotConn, node, fromSlotType );\n                        }\n                    });\n                    break;\n\t\t\t\tcase \"Search\":\n\t\t\t\t\tif(isFrom){\n\t\t\t\t\t\tthat.showSearchBox(e,{node_from: opts.nodeFrom, slot_from: slotX, type_filter_in: fromSlotType});\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthat.showSearchBox(e,{node_to: opts.nodeTo, slot_from: slotX, type_filter_out: fromSlotType});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n                default:\n\t\t\t\t\t// check for defaults nodes for this slottype\n\t\t\t\t\tvar nodeCreated = that.createDefaultNodeForSlot(Object.assign(opts,{ position: [opts.e.canvasX, opts.e.canvasY]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeType: v\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\tif (nodeCreated){\n\t\t\t\t\t\t// new node created\n\t\t\t\t\t\t//console.log(\"node \"+v+\" created\")\n\t\t\t\t\t}else{\n\t\t\t\t\t\t// failed or v is not in defaults\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n            }\n        }   \n        \n        return false;\n    };\n\n    // TODO refactor :: this is used fot title but not for properties!\n    LGraphCanvas.onShowPropertyEditor = function(item, options, e, menu, node) {\n        var input_html = \"\";\n        var property = item.property || \"title\";\n        var value = node[property];\n\n        // TODO refactor :: use createDialog ?\n        \n        var dialog = document.createElement(\"div\");\n        dialog.is_modified = false;\n        dialog.className = \"graphdialog\";\n        dialog.innerHTML =\n            \"<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>\";\n        dialog.close = function() {\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n        var title = dialog.querySelector(\".name\");\n        title.innerText = property;\n        var input = dialog.querySelector(\".value\");\n        if (input) {\n            input.value = value;\n            input.addEventListener(\"blur\", function(e) {\n                this.focus();\n            });\n            input.addEventListener(\"keydown\", function(e) {\n                dialog.is_modified = true;\n                if (e.keyCode == 27) {\n                    //ESC\n                    dialog.close();\n                } else if (e.keyCode == 13) {\n                    inner(); // save\n                } else if (e.keyCode != 13 && e.target.localName != \"textarea\") {\n                    return;\n                }\n                e.preventDefault();\n                e.stopPropagation();\n            });\n        }\n\n        var graphcanvas = LGraphCanvas.active_canvas;\n        var canvas = graphcanvas.canvas;\n\n        var rect = canvas.getBoundingClientRect();\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (event) {\n            dialog.style.left = event.clientX + offsetx + \"px\";\n            dialog.style.top = event.clientY + offsety + \"px\";\n        } else {\n            dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n            dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n        }\n\n        var button = dialog.querySelector(\"button\");\n        button.addEventListener(\"click\", inner);\n        canvas.parentNode.appendChild(dialog);\n\n        if(input) input.focus();\n        \n        var dialogCloseTimer = null;\n        dialog.addEventListener(\"mouseleave\", function(e) {\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if (!dialog.is_modified && LiteGraph.dialog_close_on_mouse_leave)\n                    dialogCloseTimer = setTimeout(dialog.close, LiteGraph.dialog_close_on_mouse_leave_delay); //dialog.close();\n        });\n        dialog.addEventListener(\"mouseenter\", function(e) {\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if(dialogCloseTimer) clearTimeout(dialogCloseTimer);\n        });\n        \n        function inner() {\n            if(input) setValue(input.value);\n        }\n\n        function setValue(value) {\n            if (item.type == \"Number\") {\n                value = Number(value);\n            } else if (item.type == \"Boolean\") {\n                value = Boolean(value);\n            }\n            node[property] = value;\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n            node.setDirtyCanvas(true, true);\n        }\n    };\n\n    // refactor: there are different dialogs, some uses createDialog some dont\n    LGraphCanvas.prototype.prompt = function(title, value, callback, event, multiline) {\n        var that = this;\n        var input_html = \"\";\n        title = title || \"\";\n\n        var dialog = document.createElement(\"div\");\n        dialog.is_modified = false;\n        dialog.className = \"graphdialog rounded\";\n        if(multiline)\n\t        dialog.innerHTML = \"<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>\";\n\t\telse\n        \tdialog.innerHTML = \"<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>\";\n        dialog.close = function() {\n            that.prompt_box = null;\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n\n        var graphcanvas = LGraphCanvas.active_canvas;\n        var canvas = graphcanvas.canvas;\n        canvas.parentNode.appendChild(dialog);\n        \n        if (this.ds.scale > 1) {\n            dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n        }\n\n        var dialogCloseTimer = null;\n        var prevent_timeout = false;\n        LiteGraph.pointerListenerAdd(dialog,\"leave\", function(e) {\n            if (prevent_timeout)\n                return;\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if (!dialog.is_modified && LiteGraph.dialog_close_on_mouse_leave)\n                    dialogCloseTimer = setTimeout(dialog.close, LiteGraph.dialog_close_on_mouse_leave_delay); //dialog.close();\n        });\n        LiteGraph.pointerListenerAdd(dialog,\"enter\", function(e) {\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if(dialogCloseTimer) clearTimeout(dialogCloseTimer);\n        });\n        var selInDia = dialog.querySelectorAll(\"select\");\n        if (selInDia){\n            // if filtering, check focus changed to comboboxes and prevent closing\n            selInDia.forEach(function(selIn) {\n                selIn.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selIn.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selIn.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n            });\n        }\n\n        if (that.prompt_box) {\n            that.prompt_box.close();\n        }\n        that.prompt_box = dialog;\n\n        var first = null;\n        var timeout = null;\n        var selected = null;\n\n        var name_element = dialog.querySelector(\".name\");\n        name_element.innerText = title;\n        var value_element = dialog.querySelector(\".value\");\n        value_element.value = value;\n\n        var input = value_element;\n        input.addEventListener(\"keydown\", function(e) {\n            dialog.is_modified = true;\n            if (e.keyCode == 27) {\n                //ESC\n                dialog.close();\n            } else if (e.keyCode == 13 && e.target.localName != \"textarea\") {\n                if (callback) {\n                    callback(this.value);\n                }\n                dialog.close();\n            } else {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n        });\n\n        var button = dialog.querySelector(\"button\");\n        button.addEventListener(\"click\", function(e) {\n            if (callback) {\n                callback(input.value);\n            }\n            that.setDirty(true);\n            dialog.close();\n        });\n\n        var rect = canvas.getBoundingClientRect();\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (event) {\n            dialog.style.left = event.clientX + offsetx + \"px\";\n            dialog.style.top = event.clientY + offsety + \"px\";\n        } else {\n            dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n            dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n        }\n\n        setTimeout(function() {\n            input.focus();\n        }, 10);\n\n        return dialog;\n    };\n\n    LGraphCanvas.search_limit = -1;\n    LGraphCanvas.prototype.showSearchBox = function(event, options) {\n        // proposed defaults\n        var def_options = { slot_from: null\n                        ,node_from: null\n                        ,node_to: null\n                        ,do_type_filter: LiteGraph.search_filter_enabled // TODO check for registered_slot_[in/out]_types not empty // this will be checked for functionality enabled : filter on slot type, in and out\n                        ,type_filter_in: false                          // these are default: pass to set initially set values\n                        ,type_filter_out: false\n                        ,show_general_if_none_on_typefilter: true\n                        ,show_general_after_typefiltered: true\n                        ,hide_on_mouse_leave: LiteGraph.search_hide_on_mouse_leave\n                        ,show_all_if_empty: true\n                        ,show_all_on_open: LiteGraph.search_show_all_on_open\n                    };\n        options = Object.assign(def_options, options || {});\n        \n\t\t//console.log(options);\n\t\t\n        var that = this;\n        var input_html = \"\";\n        var graphcanvas = LGraphCanvas.active_canvas;\n        var canvas = graphcanvas.canvas;\n        var root_document = canvas.ownerDocument || document;\n\n        var dialog = document.createElement(\"div\");\n        dialog.className = \"litegraph litesearchbox graphdialog rounded\";\n        dialog.innerHTML = \"<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>\";\n        if (options.do_type_filter){\n            dialog.innerHTML += \"<select class='slot_in_type_filter'><option value=''></option></select>\";\n            dialog.innerHTML += \"<select class='slot_out_type_filter'><option value=''></option></select>\";\n        }\n        dialog.innerHTML += \"<div class='helper'></div>\";\n        \n        if( root_document.fullscreenElement )\n\t        root_document.fullscreenElement.appendChild(dialog);\n\t\telse\n\t\t{\n\t\t    root_document.body.appendChild(dialog);\n\t\t\troot_document.body.style.overflow = \"hidden\";\n\t\t}\n        // dialog element has been appended\n        \n        if (options.do_type_filter){\n            var selIn = dialog.querySelector(\".slot_in_type_filter\");\n            var selOut = dialog.querySelector(\".slot_out_type_filter\");\n        }\n        \n        dialog.close = function() {\n            that.search_box = null;\n\t\t\tthis.blur();\n            canvas.focus();\n\t\t\troot_document.body.style.overflow = \"\";\n\n            setTimeout(function() {\n                that.canvas.focus();\n            }, 20); //important, if canvas loses focus keys wont be captured\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n\n        if (this.ds.scale > 1) {\n            dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n        }\n\n        // hide on mouse leave\n        if(options.hide_on_mouse_leave){\n            var prevent_timeout = false;\n            var timeout_close = null;\n            LiteGraph.pointerListenerAdd(dialog,\"enter\", function(e) {\n                if (timeout_close) {\n                    clearTimeout(timeout_close);\n                    timeout_close = null;\n                }\n            });\n            LiteGraph.pointerListenerAdd(dialog,\"leave\", function(e) {\n                if (prevent_timeout){\n                    return;\n                }\n                timeout_close = setTimeout(function() {\n                    dialog.close();\n                }, 500);\n            });\n            // if filtering, check focus changed to comboboxes and prevent closing\n            if (options.do_type_filter){\n                selIn.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selIn.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selIn.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n                selOut.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selOut.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selOut.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n            }\n        }\n\n        if (that.search_box) {\n            that.search_box.close();\n        }\n        that.search_box = dialog;\n\n        var helper = dialog.querySelector(\".helper\");\n\n        var first = null;\n        var timeout = null;\n        var selected = null;\n\n        var input = dialog.querySelector(\"input\");\n        if (input) {\n            input.addEventListener(\"blur\", function(e) {\n                if(that.search_box)\n                    this.focus();\n            });\n            input.addEventListener(\"keydown\", function(e) {\n                if (e.keyCode == 38) {\n                    //UP\n                    changeSelection(false);\n                } else if (e.keyCode == 40) {\n                    //DOWN\n                    changeSelection(true);\n                } else if (e.keyCode == 27) {\n                    //ESC\n                    dialog.close();\n                } else if (e.keyCode == 13) {\n                    refreshHelper();\n                    if (selected) {\n                        select(selected.innerHTML);\n                    } else if (first) {\n                        select(first);\n                    } else {\n                        dialog.close();\n                    }\n                } else {\n                    if (timeout) {\n                        clearInterval(timeout);\n                    }\n                    timeout = setTimeout(refreshHelper, 250);\n                    return;\n                }\n                e.preventDefault();\n                e.stopPropagation();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\treturn true;\n            });\n        }\n        \n        // if should filter on type, load and fill selected and choose elements if passed\n        if (options.do_type_filter){\n            if (selIn){\n                var aSlots = LiteGraph.slot_types_in;\n                var nSlots = aSlots.length; // this for object :: Object.keys(aSlots).length;\n                \n                if (options.type_filter_in == LiteGraph.EVENT || options.type_filter_in == LiteGraph.ACTION)\n                    options.type_filter_in = \"_event_\";\n                /* this will filter on * .. but better do it manually in case\n                else if(options.type_filter_in === \"\" || options.type_filter_in === 0)\n                    options.type_filter_in = \"*\";*/\n                \n                for (var iK=0; iK<nSlots; iK++){\n                    var opt = document.createElement('option');\n                    opt.value = aSlots[iK];\n                    opt.innerHTML = aSlots[iK];\n                    selIn.appendChild(opt);\n                    if(options.type_filter_in !==false && (options.type_filter_in+\"\").toLowerCase() == (aSlots[iK]+\"\").toLowerCase()){\n                        //selIn.selectedIndex ..\n                        opt.selected = true;\n\t\t\t\t\t\t//console.log(\"comparing IN \"+options.type_filter_in+\" :: \"+aSlots[iK]);\n\t                }else{\n\t\t\t\t\t\t//console.log(\"comparing OUT \"+options.type_filter_in+\" :: \"+aSlots[iK]);\n\t\t\t\t\t}\n\t\t\t\t}\n                selIn.addEventListener(\"change\",function(){\n                    refreshHelper();\n                });\n            }\n            if (selOut){\n                var aSlots = LiteGraph.slot_types_out;\n                var nSlots = aSlots.length; // this for object :: Object.keys(aSlots).length; \n                \n                if (options.type_filter_out == LiteGraph.EVENT || options.type_filter_out == LiteGraph.ACTION)\n                    options.type_filter_out = \"_event_\";\n                /* this will filter on * .. but better do it manually in case\n                else if(options.type_filter_out === \"\" || options.type_filter_out === 0)\n                    options.type_filter_out = \"*\";*/\n                \n                for (var iK=0; iK<nSlots; iK++){\n                    var opt = document.createElement('option');\n                    opt.value = aSlots[iK];\n                    opt.innerHTML = aSlots[iK];\n                    selOut.appendChild(opt);\n                    if(options.type_filter_out !==false && (options.type_filter_out+\"\").toLowerCase() == (aSlots[iK]+\"\").toLowerCase()){\n                        //selOut.selectedIndex ..\n                        opt.selected = true;\n                    }\n                }\n                selOut.addEventListener(\"change\",function(){\n                    refreshHelper();\n                });\n            }\n        }\n        \n        //compute best position\n        var rect = canvas.getBoundingClientRect();\n\n        var left = ( event ? event.clientX : (rect.left + rect.width * 0.5) ) - 80;\n        var top = ( event ? event.clientY : (rect.top + rect.height * 0.5) ) - 20;\n        dialog.style.left = left + \"px\";\n        dialog.style.top = top + \"px\";\n\n\t\t//To avoid out of screen problems\n\t\tif(event.layerY > (rect.height - 200)) \n            helper.style.maxHeight = (rect.height - event.layerY - 20) + \"px\";\n\n\t\t/*\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (event) {\n            dialog.style.left = event.clientX + offsetx + \"px\";\n            dialog.style.top = event.clientY + offsety + \"px\";\n        } else {\n            dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n            dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n        }\n        canvas.parentNode.appendChild(dialog);\n\t\t*/\n\n        input.focus();\n        if (options.show_all_on_open) refreshHelper();\n\n        function select(name) {\n            if (name) {\n                if (that.onSearchBoxSelection) {\n                    that.onSearchBoxSelection(name, event, graphcanvas);\n                } else {\n                    var extra = LiteGraph.searchbox_extras[name.toLowerCase()];\n                    if (extra) {\n                        name = extra.type;\n                    }\n\n\t\t\t\t\tgraphcanvas.graph.beforeChange();\n                    var node = LiteGraph.createNode(name);\n                    if (node) {\n                        node.pos = graphcanvas.convertEventToCanvasOffset(\n                            event\n                        );\n                        graphcanvas.graph.add(node, false);\n                    }\n\n                    if (extra && extra.data) {\n                        if (extra.data.properties) {\n                            for (var i in extra.data.properties) {\n                                node.addProperty( i, extra.data.properties[i] );\n                            }\n                        }\n                        if (extra.data.inputs) {\n                            node.inputs = [];\n                            for (var i in extra.data.inputs) {\n                                node.addOutput(\n                                    extra.data.inputs[i][0],\n                                    extra.data.inputs[i][1]\n                                );\n                            }\n                        }\n                        if (extra.data.outputs) {\n                            node.outputs = [];\n                            for (var i in extra.data.outputs) {\n                                node.addOutput(\n                                    extra.data.outputs[i][0],\n                                    extra.data.outputs[i][1]\n                                );\n                            }\n                        }\n                        if (extra.data.title) {\n                            node.title = extra.data.title;\n                        }\n                        if (extra.data.json) {\n                            node.configure(extra.data.json);\n                        }\n\n                    }\n\n                    // join node after inserting\n                    if (options.node_from){\n                        var iS = false;\n                        switch (typeof options.slot_from){\n                            case \"string\":\n                                iS = options.node_from.findOutputSlot(options.slot_from);    \n                            break;\n                            case \"object\":\n                                if (options.slot_from.name){\n                                    iS = options.node_from.findOutputSlot(options.slot_from.name);\n                                }else{\n                                    iS = -1;\n                                }\n                                if (iS==-1 && typeof options.slot_from.slot_index !== \"undefined\") iS = options.slot_from.slot_index;\n                            break;\n                            case \"number\":\n                                iS = options.slot_from;\n                            break;\n                            default:\n                                iS = 0; // try with first if no name set\n                        }\n                        if (typeof options.node_from.outputs[iS] !== \"undefined\"){\n                            if (iS!==false && iS>-1){\n                                options.node_from.connectByType( iS, node, options.node_from.outputs[iS].type );\n                            }\n                        }else{\n                            // console.warn(\"cant find slot \" + options.slot_from);\n                        }\n                    }\n                    if (options.node_to){\n                        var iS = false;\n                        switch (typeof options.slot_from){\n                            case \"string\":\n                                iS = options.node_to.findInputSlot(options.slot_from);    \n                            break;\n                            case \"object\":\n                                if (options.slot_from.name){\n                                    iS = options.node_to.findInputSlot(options.slot_from.name);\n                                }else{\n                                    iS = -1;\n                                }\n                                if (iS==-1 && typeof options.slot_from.slot_index !== \"undefined\") iS = options.slot_from.slot_index;\n                            break;\n                            case \"number\":\n                                iS = options.slot_from;\n                            break;\n                            default:\n                                iS = 0; // try with first if no name set\n                        }\n                        if (typeof options.node_to.inputs[iS] !== \"undefined\"){\n                            if (iS!==false && iS>-1){\n                                // try connection\n                                options.node_to.connectByTypeOutput(iS,node,options.node_to.inputs[iS].type);\n                            }\n                        }else{\n                            // console.warn(\"cant find slot_nodeTO \" + options.slot_from);\n                        }\n                    }\n                    \n                    graphcanvas.graph.afterChange();\n                }\n            }\n\n            dialog.close();\n        }\n\n        function changeSelection(forward) {\n            var prev = selected;\n            if (selected) {\n                selected.classList.remove(\"selected\");\n            }\n            if (!selected) {\n                selected = forward\n                    ? helper.childNodes[0]\n                    : helper.childNodes[helper.childNodes.length];\n            } else {\n                selected = forward\n                    ? selected.nextSibling\n                    : selected.previousSibling;\n                if (!selected) {\n                    selected = prev;\n                }\n            }\n            if (!selected) {\n                return;\n            }\n            selected.classList.add(\"selected\");\n            selected.scrollIntoView({block: \"end\", behavior: \"smooth\"});\n        }\n\n        function refreshHelper() {\n            timeout = null;\n            var str = input.value;\n            first = null;\n            helper.innerHTML = \"\";\n            if (!str && !options.show_all_if_empty) {\n                return;\n            }\n\n            if (that.onSearchBox) {\n                var list = that.onSearchBox(helper, str, graphcanvas);\n                if (list) {\n                    for (var i = 0; i < list.length; ++i) {\n                        addResult(list[i]);\n                    }\n                }\n            } else {\n                var c = 0;\n                str = str.toLowerCase();\n\t\t\t\tvar filter = graphcanvas.filter || graphcanvas.graph.filter;\n\n                // filter by type preprocess\n                if(options.do_type_filter && that.search_box){\n                    var sIn = that.search_box.querySelector(\".slot_in_type_filter\");\n                    var sOut = that.search_box.querySelector(\".slot_out_type_filter\");\n                }else{\n                    var sIn = false;\n                    var sOut = false;\n                }\n                \n                //extras\n                for (var i in LiteGraph.searchbox_extras) {\n                    var extra = LiteGraph.searchbox_extras[i];\n                    if ((!options.show_all_if_empty || str) && extra.desc.toLowerCase().indexOf(str) === -1) {\n                        continue;\n                    }\n\t\t\t\t\tvar ctor = LiteGraph.registered_node_types[ extra.type ];\n\t\t\t\t\tif( ctor && ctor.filter != filter )\n\t\t\t\t\t\tcontinue;\n                    if( ! inner_test_filter(extra.type) )\n                        continue;\n                    addResult( extra.desc, \"searchbox_extra\" );\n                    if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                        break;\n                    }\n                }\n\n\t\t\t\tvar filtered = null;\n                if (Array.prototype.filter) { //filter supported\n                    var keys = Object.keys( LiteGraph.registered_node_types ); //types\n                    var filtered = keys.filter( inner_test_filter );\n                } else {\n\t\t\t\t\tfiltered = [];\n                    for (var i in LiteGraph.registered_node_types) {\n\t\t\t\t\t\tif( inner_test_filter(i) )\n\t\t\t\t\t\t\tfiltered.push(i);\n                    }\n                }\n\n\t\t\t\tfor (var i = 0; i < filtered.length; i++) {\n\t\t\t\t\taddResult(filtered[i]);\n\t\t\t\t\tif ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n                \n                // add general type if filtering\n                if (options.show_general_after_typefiltered\n                    && (sIn.value || sOut.value) \n                ){\n                    filtered_extra = [];\n                    for (var i in LiteGraph.registered_node_types) {\n\t\t\t\t\t\tif( inner_test_filter(i, {inTypeOverride: sIn&&sIn.value?\"*\":false, outTypeOverride: sOut&&sOut.value?\"*\":false}) )\n\t\t\t\t\t\t\tfiltered_extra.push(i);\n                    }\n                    for (var i = 0; i < filtered_extra.length; i++) {\n                        addResult(filtered_extra[i], \"generic_type\");\n                        if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                            break;\n                        }\n                    }\n                }\n                \n                // check il filtering gave no results\n                if ((sIn.value || sOut.value) && \n                    ( (helper.childNodes.length == 0 && options.show_general_if_none_on_typefilter) )\n                ){\n                    filtered_extra = [];\n                    for (var i in LiteGraph.registered_node_types) {\n\t\t\t\t\t\tif( inner_test_filter(i, {skipFilter: true}) )\n\t\t\t\t\t\t\tfiltered_extra.push(i);\n                    }\n                    for (var i = 0; i < filtered_extra.length; i++) {\n                        addResult(filtered_extra[i], \"not_in_filter\");\n                        if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                            break;\n                        }\n                    }\n                }\n                \n\t\t\t\tfunction inner_test_filter( type, optsIn )\n\t\t\t\t{\n                    var optsIn = optsIn || {};\n                    var optsDef = { skipFilter: false\n                                    ,inTypeOverride: false\n                                    ,outTypeOverride: false\n                                  };\n                    var opts = Object.assign(optsDef,optsIn);\n\t\t\t\t\tvar ctor = LiteGraph.registered_node_types[ type ];\n\t\t\t\t\tif(filter && ctor.filter != filter )\n\t\t\t\t\t\treturn false;\n                    if ((!options.show_all_if_empty || str) && type.toLowerCase().indexOf(str) === -1)\n                        return false;\n                    \n                    // filter by slot IN, OUT types\n                    if(options.do_type_filter && !opts.skipFilter){\n                        var sType = type;\n                        \n                        var sV = sIn.value;\n                        if (opts.inTypeOverride!==false) sV = opts.inTypeOverride;\n\t\t\t\t\t\t//if (sV.toLowerCase() == \"_event_\") sV = LiteGraph.EVENT; // -1\n                        \n                        if(sIn && sV){\n                            //console.log(\"will check filter against \"+sV);\n                            if (LiteGraph.registered_slot_in_types[sV] && LiteGraph.registered_slot_in_types[sV].nodes){ // type is stored\n                                //console.debug(\"check \"+sType+\" in \"+LiteGraph.registered_slot_in_types[sV].nodes);\n                                var doesInc = LiteGraph.registered_slot_in_types[sV].nodes.includes(sType);\n                                if (doesInc!==false){\n                                    //console.log(sType+\" HAS \"+sV);\n                                }else{\n                                    /*console.debug(LiteGraph.registered_slot_in_types[sV]);\n                                    console.log(+\" DONT includes \"+type);*/\n                                    return false;\n                                }\n                            }\n                        }\n                        \n                        var sV = sOut.value;\n                        if (opts.outTypeOverride!==false) sV = opts.outTypeOverride;\n                        //if (sV.toLowerCase() == \"_event_\") sV = LiteGraph.EVENT; // -1\n                        \n                        if(sOut && sV){\n                            //console.log(\"search will check filter against \"+sV);\n                            if (LiteGraph.registered_slot_out_types[sV] && LiteGraph.registered_slot_out_types[sV].nodes){ // type is stored\n                                //console.debug(\"check \"+sType+\" in \"+LiteGraph.registered_slot_out_types[sV].nodes);\n                                var doesInc = LiteGraph.registered_slot_out_types[sV].nodes.includes(sType);\n                                if (doesInc!==false){\n                                    //console.log(sType+\" HAS \"+sV);\n                                }else{\n                                    /*console.debug(LiteGraph.registered_slot_out_types[sV]);\n                                    console.log(+\" DONT includes \"+type);*/\n                                    return false;\n                                }\n                            }\n                        }\n                    }\n                    return true;\n\t\t\t\t}\n            }\n\n            function addResult(type, className) {\n                var help = document.createElement(\"div\");\n                if (!first) {\n                    first = type;\n                }\n                help.innerText = type;\n                help.dataset[\"type\"] = escape(type);\n                help.className = \"litegraph lite-search-item\";\n                if (className) {\n                    help.className += \" \" + className;\n                }\n                help.addEventListener(\"click\", function(e) {\n                    select(unescape(this.dataset[\"type\"]));\n                });\n                helper.appendChild(help);\n            }\n        }\n\n        return dialog;\n    };\n\n    LGraphCanvas.prototype.showEditPropertyValue = function( node, property, options ) {\n        if (!node || node.properties[property] === undefined) {\n            return;\n        }\n\n        options = options || {};\n        var that = this;\n\n        var info = node.getPropertyInfo(property);\n\t\tvar type = info.type;\n\n        var input_html = \"\";\n\n        if (type == \"string\" || type == \"number\" || type == \"array\" || type == \"object\") {\n            input_html = \"<input autofocus type='text' class='value'/>\";\n        } else if ( (type == \"enum\" || type == \"combo\") && info.values) {\n            input_html = \"<select autofocus type='text' class='value'>\";\n            for (var i in info.values) {\n                var v = i;\n\t\t\t\tif( info.values.constructor === Array )\n\t\t\t\t\tv = info.values[i];\n\n                input_html +=\n                    \"<option value='\" +\n                    v +\n                    \"' \" +\n                    (v == node.properties[property] ? \"selected\" : \"\") +\n                    \">\" +\n                    info.values[i] +\n                    \"</option>\";\n            }\n            input_html += \"</select>\";\n        } else if (type == \"boolean\" || type == \"toggle\") {\n            input_html =\n                \"<input autofocus type='checkbox' class='value' \" +\n                (node.properties[property] ? \"checked\" : \"\") +\n                \"/>\";\n        } else {\n            console.warn(\"unknown type: \" + type);\n            return;\n        }\n\n        var dialog = this.createDialog(\n            \"<span class='name'>\" +\n                (info.label ? info.label : property) +\n                \"</span>\" +\n                input_html +\n                \"<button>OK</button>\",\n            options\n        );\n\n        var input = false;\n        if ((type == \"enum\" || type == \"combo\") && info.values) {\n            input = dialog.querySelector(\"select\");\n            input.addEventListener(\"change\", function(e) {\n                dialog.modified();\n                setValue(e.target.value);\n                //var index = e.target.value;\n                //setValue( e.options[e.selectedIndex].value );\n            });\n        } else if (type == \"boolean\" || type == \"toggle\") {\n            input = dialog.querySelector(\"input\");\n            if (input) {\n                input.addEventListener(\"click\", function(e) {\n                    dialog.modified();\n                    setValue(!!input.checked);\n                });\n            }\n        } else {\n            input = dialog.querySelector(\"input\");\n            if (input) {\n                input.addEventListener(\"blur\", function(e) {\n                    this.focus();\n                });\n\n\t\t\t\tvar v = node.properties[property] !== undefined ? node.properties[property] : \"\";\n\t\t\t\tif (type !== 'string') {\n                    v = JSON.stringify(v);\n                }\n\n                input.value = v;\n                input.addEventListener(\"keydown\", function(e) {\n                    if (e.keyCode == 27) {\n                        //ESC\n                        dialog.close();\n                    } else if (e.keyCode == 13) {\n                        // ENTER\n                        inner(); // save\n                    } else if (e.keyCode != 13) {\n                        dialog.modified();\n                        return;\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n            }\n        }\n        if (input) input.focus();\n\n        var button = dialog.querySelector(\"button\");\n        button.addEventListener(\"click\", inner);\n\n        function inner() {\n            setValue(input.value);\n        }\n\n        function setValue(value) {\n\n\t\t\tif(info && info.values && info.values.constructor === Object && info.values[value] != undefined )\n\t\t\t\tvalue = info.values[value];\n\n            if (typeof node.properties[property] == \"number\") {\n                value = Number(value);\n            }\n            if (type == \"array\" || type == \"object\") {\n                value = JSON.parse(value);\n            }\n            node.properties[property] = value;\n            if (node.graph) {\n                node.graph._version++;\n            }\n            if (node.onPropertyChanged) {\n                node.onPropertyChanged(property, value);\n            }\n\t\t\tif(options.onclose)\n\t\t\t\toptions.onclose();\n            dialog.close();\n            node.setDirtyCanvas(true, true);\n        }\n\n\t\treturn dialog;\n    };\n\n    // TODO refactor, theer are different dialog, some uses createDialog, some dont\n    LGraphCanvas.prototype.createDialog = function(html, options) {\n        var def_options = { checkForInput: false, closeOnLeave: true, closeOnLeave_checkModified: true };\n        options = Object.assign(def_options, options || {});\n\n        var dialog = document.createElement(\"div\");\n        dialog.className = \"graphdialog\";\n        dialog.innerHTML = html;\n        dialog.is_modified = false;\n\n        var rect = this.canvas.getBoundingClientRect();\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (options.position) {\n            offsetx += options.position[0];\n            offsety += options.position[1];\n        } else if (options.event) {\n            offsetx += options.event.clientX;\n            offsety += options.event.clientY;\n        } //centered\n        else {\n            offsetx += this.canvas.width * 0.5;\n            offsety += this.canvas.height * 0.5;\n        }\n\n        dialog.style.left = offsetx + \"px\";\n        dialog.style.top = offsety + \"px\";\n\n        this.canvas.parentNode.appendChild(dialog);\n        \n        // acheck for input and use default behaviour: save on enter, close on esc\n        if (options.checkForInput){\n            var aI = [];\n            var focused = false;\n            if (aI = dialog.querySelectorAll(\"input\")){\n                aI.forEach(function(iX) {\n                    iX.addEventListener(\"keydown\",function(e){\n                        dialog.modified();\n                        if (e.keyCode == 27) {\n                            dialog.close();\n                        } else if (e.keyCode != 13) {\n                            return;\n                        }\n                        // set value ?\n                        e.preventDefault();\n                        e.stopPropagation();\n                    });\n                    if (!focused) iX.focus();\n                });\n            }\n        }\n        \n        dialog.modified = function(){\n            dialog.is_modified = true;\n        }\n        dialog.close = function() {\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n        \n        var dialogCloseTimer = null;\n        var prevent_timeout = false;\n        dialog.addEventListener(\"mouseleave\", function(e) {\n            if (prevent_timeout)\n                return;\n            if(options.closeOnLeave || LiteGraph.dialog_close_on_mouse_leave)\n                if (!dialog.is_modified && LiteGraph.dialog_close_on_mouse_leave)\n                    dialogCloseTimer = setTimeout(dialog.close, LiteGraph.dialog_close_on_mouse_leave_delay); //dialog.close();\n        });\n        dialog.addEventListener(\"mouseenter\", function(e) {\n            if(options.closeOnLeave || LiteGraph.dialog_close_on_mouse_leave)\n                if(dialogCloseTimer) clearTimeout(dialogCloseTimer);\n        });\n        var selInDia = dialog.querySelectorAll(\"select\");\n        if (selInDia){\n            // if filtering, check focus changed to comboboxes and prevent closing\n            selInDia.forEach(function(selIn) {\n                selIn.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selIn.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selIn.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n            });\n        }\n\n        return dialog;\n    };\n\n\tLGraphCanvas.prototype.createPanel = function(title, options) {\n\t\toptions = options || {};\n\n\t\tvar ref_window = options.window || window;\n\t\tvar root = document.createElement(\"div\");\n\t\troot.className = \"litegraph dialog\";\n\t\troot.innerHTML = \"<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>\";\n\t\troot.header = root.querySelector(\".dialog-header\");\n\n\t\tif(options.width)\n\t\t\troot.style.width = options.width + (options.width.constructor === Number ? \"px\" : \"\");\n\t\tif(options.height)\n\t\t\troot.style.height = options.height + (options.height.constructor === Number ? \"px\" : \"\");\n\t\tif(options.closable)\n\t\t{\n\t\t\tvar close = document.createElement(\"span\");\n\t\t\tclose.innerHTML = \"&#10005;\";\n\t\t\tclose.classList.add(\"close\");\n\t\t\tclose.addEventListener(\"click\",function(){\n\t\t\t\troot.close();\n\t\t\t});\n\t\t\troot.header.appendChild(close);\n\t\t}\n\t\troot.title_element = root.querySelector(\".dialog-title\");\n\t\troot.title_element.innerText = title;\n\t\troot.content = root.querySelector(\".dialog-content\");\n        root.alt_content = root.querySelector(\".dialog-alt-content\");\n\t\troot.footer = root.querySelector(\".dialog-footer\");\n\n\t\troot.close = function()\n\t\t{\n\t\t    if (root.onClose && typeof root.onClose == \"function\"){\n\t\t        root.onClose();\n\t\t    }\n            if(root.parentNode)\n\t\t        root.parentNode.removeChild(root);\n\t\t    /* XXX CHECK THIS */\n\t\t    if(this.parentNode){\n\t\t    \tthis.parentNode.removeChild(this);\n\t\t    }\n\t\t    /* XXX this was not working, was fixed with an IF, check this */\n\t\t}\n\n        // function to swap panel content\n        root.toggleAltContent = function(force){\n            if (typeof force != \"undefined\"){\n                var vTo = force ? \"block\" : \"none\";\n                var vAlt = force ? \"none\" : \"block\";\n            }else{\n                var vTo = root.alt_content.style.display != \"block\" ? \"block\" : \"none\";\n                var vAlt = root.alt_content.style.display != \"block\" ? \"none\" : \"block\";\n            }\n            root.alt_content.style.display = vTo;\n            root.content.style.display = vAlt;\n        }\n        \n        root.toggleFooterVisibility = function(force){\n            if (typeof force != \"undefined\"){\n                var vTo = force ? \"block\" : \"none\";\n            }else{\n                var vTo = root.footer.style.display != \"block\" ? \"block\" : \"none\";\n            }\n            root.footer.style.display = vTo;\n        }\n        \n\t\troot.clear = function()\n\t\t{\n\t\t\tthis.content.innerHTML = \"\";\n\t\t}\n\n\t\troot.addHTML = function(code, classname, on_footer)\n\t\t{\n\t\t\tvar elem = document.createElement(\"div\");\n\t\t\tif(classname)\n\t\t\t\telem.className = classname;\n\t\t\telem.innerHTML = code;\n\t\t\tif(on_footer)\n\t\t\t\troot.footer.appendChild(elem);\n\t\t\telse\n\t\t\t\troot.content.appendChild(elem);\n\t\t\treturn elem;\n\t\t}\n\n\t\troot.addButton = function( name, callback, options )\n\t\t{\n\t\t\tvar elem = document.createElement(\"button\");\n\t\t\telem.innerText = name;\n\t\t\telem.options = options;\n\t\t\telem.classList.add(\"btn\");\n\t\t\telem.addEventListener(\"click\",callback);\n\t\t\troot.footer.appendChild(elem);\n\t\t\treturn elem;\n\t\t}\n\n\t\troot.addSeparator = function()\n\t\t{\n\t\t\tvar elem = document.createElement(\"div\");\n\t\t\telem.className = \"separator\";\n\t\t\troot.content.appendChild(elem);\n\t\t}\n\n\t\troot.addWidget = function( type, name, value, options, callback )\n\t\t{\n\t\t\toptions = options || {};\n\t\t\tvar str_value = String(value);\n\t\t\ttype = type.toLowerCase();\n\t\t\tif(type == \"number\")\n\t\t\t\tstr_value = value.toFixed(3);\n\n\t\t\tvar elem = document.createElement(\"div\");\n\t\t\telem.className = \"property\";\n\t\t\telem.innerHTML = \"<span class='property_name'></span><span class='property_value'></span>\";\n\t\t\telem.querySelector(\".property_name\").innerText = options.label || name;\n\t\t\tvar value_element = elem.querySelector(\".property_value\");\n\t\t\tvalue_element.innerText = str_value;\n\t\t\telem.dataset[\"property\"] = name;\n\t\t\telem.dataset[\"type\"] = options.type || type;\n\t\t\telem.options = options;\n\t\t\telem.value = value;\n\n\t\t\tif( type == \"code\" )\n\t\t\t\telem.addEventListener(\"click\", function(e){ root.inner_showCodePad( this.dataset[\"property\"] ); });\n\t\t\telse if (type == \"boolean\")\n\t\t\t{\n\t\t\t\telem.classList.add(\"boolean\");\n\t\t\t\tif(value)\n\t\t\t\t\telem.classList.add(\"bool-on\");\n\t\t\t\telem.addEventListener(\"click\", function(){ \n\t\t\t\t\t//var v = node.properties[this.dataset[\"property\"]]; \n\t\t\t\t\t//node.setProperty(this.dataset[\"property\"],!v); this.innerText = v ? \"true\" : \"false\"; \n\t\t\t\t\tvar propname = this.dataset[\"property\"];\n\t\t\t\t\tthis.value = !this.value;\n\t\t\t\t\tthis.classList.toggle(\"bool-on\");\n\t\t\t\t\tthis.querySelector(\".property_value\").innerText = this.value ? \"true\" : \"false\";\n\t\t\t\t\tinnerChange(propname, this.value );\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (type == \"string\" || type == \"number\")\n\t\t\t{\n\t\t\t\tvalue_element.setAttribute(\"contenteditable\",true);\n\t\t\t\tvalue_element.addEventListener(\"keydown\", function(e){ \n\t\t\t\t\tif(e.code == \"Enter\" && (type != \"string\" || !e.shiftKey)) // allow for multiline\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.blur();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvalue_element.addEventListener(\"blur\", function(){ \n\t\t\t\t\tvar v = this.innerText;\n\t\t\t\t\tvar propname = this.parentNode.dataset[\"property\"];\n\t\t\t\t\tvar proptype = this.parentNode.dataset[\"type\"];\n\t\t\t\t\tif( proptype == \"number\")\n\t\t\t\t\t\tv = Number(v);\n\t\t\t\t\tinnerChange(propname, v);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (type == \"enum\" || type == \"combo\") {\n\t\t\t\tvar str_value = LGraphCanvas.getPropertyPrintableValue( value, options.values );\n\t\t\t\tvalue_element.innerText = str_value;\n\n\t\t\t\tvalue_element.addEventListener(\"click\", function(event){ \n\t\t\t\t\tvar values = options.values || [];\n\t\t\t\t\tvar propname = this.parentNode.dataset[\"property\"];\n\t\t\t\t\tvar elem_that = this;\n\t\t\t\t\tvar menu = new LiteGraph.ContextMenu(values,{\n\t\t\t\t\t\t\tevent: event,\n\t\t\t\t\t\t\tclassName: \"dark\",\n\t\t\t\t\t\t\tcallback: inner_clicked\n\t\t\t\t\t\t},\n\t\t\t\t\t\tref_window);\n\t\t\t\t\tfunction inner_clicked(v, option, event) {\n\t\t\t\t\t\t//node.setProperty(propname,v); \n\t\t\t\t\t\t//graphcanvas.dirty_canvas = true;\n\t\t\t\t\t\telem_that.innerText = v;\n\t\t\t\t\t\tinnerChange(propname,v);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n            }\n\n\t\t\troot.content.appendChild(elem);\n\n\t\t\tfunction innerChange(name, value)\n\t\t\t{\n\t\t\t\t//console.log(\"change\",name,value);\n\t\t\t\t//that.dirty_canvas = true;\n\t\t\t\tif(options.callback)\n\t\t\t\t\toptions.callback(name,value,options);\n\t\t\t\tif(callback)\n\t\t\t\t\tcallback(name,value,options);\n\t\t\t}\n\n\t\t\treturn elem;\n\t\t}\n\n        if (root.onOpen && typeof root.onOpen == \"function\") root.onOpen();\n        \n\t\treturn root;\n\t};\n\n\tLGraphCanvas.getPropertyPrintableValue = function(value, values)\n\t{\n\t\tif(!values)\n\t\t\treturn String(value);\n\n\t\tif(values.constructor === Array)\n\t\t{\n\t\t\treturn String(value);\t\t\t\n\t\t}\n\n\t\tif(values.constructor === Object)\n\t\t{\n\t\t\tvar desc_value = \"\";\n\t\t\tfor(var k in values)\n\t\t\t{\n\t\t\t\tif(values[k] != value)\n\t\t\t\t\tcontinue;\n\t\t\t\tdesc_value = k;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn String(value) + \" (\"+desc_value+\")\";\n\t\t}\n\t}\n\n    LGraphCanvas.prototype.closePanels = function(){\n        var panel = document.querySelector(\"#node-panel\");\n\t\tif(panel)\n\t\t\tpanel.close();\n        var panel = document.querySelector(\"#option-panel\");\n\t\tif(panel)\n\t\t\tpanel.close();\n    }\n    \n    LGraphCanvas.prototype.showShowGraphOptionsPanel = function(refOpts, obEv, refMenu, refMenu2){\n        if(this.constructor && this.constructor.name == \"HTMLDivElement\"){\n            // assume coming from the menu event click\n            if (!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas){\n                console.warn(\"Canvas not found\"); // need a ref to canvas obj\n                /*console.debug(event);\n                console.debug(event.target);*/\n                return;\n            }\n            var graphcanvas = obEv.event.target.lgraphcanvas;\n        }else{\n            // assume called internally\n            var graphcanvas = this;\n        }\n        graphcanvas.closePanels();\n        var ref_window = graphcanvas.getCanvasWindow();\n        panel = graphcanvas.createPanel(\"Options\",{\n                                            closable: true\n                                            ,window: ref_window\n                                            ,onOpen: function(){\n                                                graphcanvas.OPTIONPANEL_IS_OPEN = true;\n                                            }\n                                            ,onClose: function(){\n                                                graphcanvas.OPTIONPANEL_IS_OPEN = false;\n                                                graphcanvas.options_panel = null;\n                                            }\n                                        });\n        graphcanvas.options_panel = panel;\n        panel.id = \"option-panel\";\n\t\tpanel.classList.add(\"settings\");\n        \n        function inner_refresh(){\n            \n            panel.content.innerHTML = \"\"; //clear\n\n            var fUpdate = function(name, value, options){\n                switch(name){\n                    /*case \"Render mode\":\n                        // Case \"\".. \n                        if (options.values && options.key){\n                            var kV = Object.values(options.values).indexOf(value);\n                            if (kV>=0 && options.values[kV]){\n                                console.debug(\"update graph options: \"+options.key+\": \"+kV);\n                                graphcanvas[options.key] = kV;\n                                //console.debug(graphcanvas);\n                                break;\n                            }\n                        }\n                        console.warn(\"unexpected options\");\n                        console.debug(options);\n                        break;*/\n                    default:\n                        //console.debug(\"want to update graph options: \"+name+\": \"+value);\n                        if (options && options.key){\n                            name = options.key;\n                        }\n                        if (options.values){\n                            value = Object.values(options.values).indexOf(value);\n                        }\n                        //console.debug(\"update graph option: \"+name+\": \"+value);\n                        graphcanvas[name] = value;\n                        break;\n                }\n            };\n            \n            // panel.addWidget( \"string\", \"Graph name\", \"\", {}, fUpdate); // implement\n            \n            var aProps = LiteGraph.availableCanvasOptions;\n            aProps.sort();\n            for(var pI in aProps){\n                var pX = aProps[pI];\n                panel.addWidget( \"boolean\", pX, graphcanvas[pX], {key: pX, on: \"True\", off: \"False\"}, fUpdate);\n            }\n            \n            var aLinks = [ graphcanvas.links_render_mode ];\n            panel.addWidget( \"combo\", \"Render mode\", LiteGraph.LINK_RENDER_MODES[graphcanvas.links_render_mode], {key: \"links_render_mode\", values: LiteGraph.LINK_RENDER_MODES}, fUpdate);\n            \n            panel.addSeparator();\n            \n            panel.footer.innerHTML = \"\"; // clear\n\n\t\t}\n        inner_refresh();\n\n\t\tgraphcanvas.canvas.parentNode.appendChild( panel );\n    }\n    \n    LGraphCanvas.prototype.showShowNodePanel = function( node )\n\t{\n\t\tthis.SELECTED_NODE = node;\n\t\tthis.closePanels();\n\t\tvar ref_window = this.getCanvasWindow();\n        var that = this;\n\t\tvar graphcanvas = this;\n\t\tvar panel = this.createPanel(node.title || \"\",{\n                                                    closable: true\n                                                    ,window: ref_window\n                                                    ,onOpen: function(){\n                                                        graphcanvas.NODEPANEL_IS_OPEN = true;\n                                                    }\n                                                    ,onClose: function(){\n                                                        graphcanvas.NODEPANEL_IS_OPEN = false;\n                                                        graphcanvas.node_panel = null;\n                                                    }\n                                                });\n        graphcanvas.node_panel = panel;\n\t\tpanel.id = \"node-panel\";\n\t\tpanel.node = node;\n\t\tpanel.classList.add(\"settings\");\n\n\t\tfunction inner_refresh()\n\t\t{\n\t\t\tpanel.content.innerHTML = \"\"; //clear\n\t\t\tpanel.addHTML(\"<span class='node_type'>\"+node.type+\"</span><span class='node_desc'>\"+(node.constructor.desc || \"\")+\"</span><span class='separator'></span>\");\n\n\t\t\tpanel.addHTML(\"<h3>Properties</h3>\");\n\n            var fUpdate = function(name,value){\n                            graphcanvas.graph.beforeChange(node);\n                            switch(name){\n                                case \"Title\":\n                                    node.title = value;\n                                    break;\n                                case \"Mode\":\n                                    var kV = Object.values(LiteGraph.NODE_MODES).indexOf(value);\n                                    if (kV>=0 && LiteGraph.NODE_MODES[kV]){\n                                        node.changeMode(kV);\n                                    }else{\n                                        console.warn(\"unexpected mode: \"+value);\n                                    }\n                                    break;\n                                case \"Color\":\n                                    if (LGraphCanvas.node_colors[value]){\n                                        node.color = LGraphCanvas.node_colors[value].color;\n                                        node.bgcolor = LGraphCanvas.node_colors[value].bgcolor;\n                                    }else{\n                                        console.warn(\"unexpected color: \"+value);\n                                    }\n                                    break;\n                                default:\n                                    node.setProperty(name,value);\n                                    break;\n                            }\n                            graphcanvas.graph.afterChange();\n                            graphcanvas.dirty_canvas = true;\n                        };\n            \n            panel.addWidget( \"string\", \"Title\", node.title, {}, fUpdate);\n            \n            panel.addWidget( \"combo\", \"Mode\", LiteGraph.NODE_MODES[node.mode], {values: LiteGraph.NODE_MODES}, fUpdate);\n            \n            var nodeCol = \"\";\n            if (node.color !== undefined){\n                nodeCol = Object.keys(LGraphCanvas.node_colors).filter(function(nK){ return LGraphCanvas.node_colors[nK].color == node.color; });\n            }\n            \n            panel.addWidget( \"combo\", \"Color\", nodeCol, {values: Object.keys(LGraphCanvas.node_colors)}, fUpdate);\n            \n            for(var pName in node.properties)\n\t\t\t{\n\t\t\t\tvar value = node.properties[pName];\n\t\t\t\tvar info = node.getPropertyInfo(pName);\n\t\t\t\tvar type = info.type || \"string\";\n\n\t\t\t\t//in case the user wants control over the side panel widget\n\t\t\t\tif( node.onAddPropertyToPanel && node.onAddPropertyToPanel(pName,panel) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tpanel.addWidget( info.widget || info.type, pName, value, info, fUpdate);\n\t\t\t}\n\n\t\t\tpanel.addSeparator();\n\n\t\t\tif(node.onShowCustomPanelInfo)\n\t\t\t\tnode.onShowCustomPanelInfo(panel);\n\n            panel.footer.innerHTML = \"\"; // clear\n\t\t\tpanel.addButton(\"Delete\",function(){\n\t\t\t\tif(node.block_delete)\n\t\t\t\t\treturn;\n\t\t\t\tnode.graph.remove(node);\n\t\t\t\tpanel.close();\n\t\t\t}).classList.add(\"delete\");\n\t\t}\n\n\t\tpanel.inner_showCodePad = function( propname )\n\t\t{\n            panel.classList.remove(\"settings\");\n            panel.classList.add(\"centered\");\n\n            \n\t\t\t/*if(window.CodeFlask) //disabled for now\n\t\t\t{\n\t\t\t\tpanel.content.innerHTML = \"<div class='code'></div>\";\n\t\t\t\tvar flask = new CodeFlask( \"div.code\", { language: 'js' });\n\t\t\t\tflask.updateCode(node.properties[propname]);\n\t\t\t\tflask.onUpdate( function(code) {\n\t\t\t\t\tnode.setProperty(propname, code);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{*/\n\t\t\t\tpanel.alt_content.innerHTML = \"<textarea class='code'></textarea>\";\n\t\t\t\tvar textarea = panel.alt_content.querySelector(\"textarea\");\n                var fDoneWith = function(){\n                    panel.toggleAltContent(false); //if(node_prop_div) node_prop_div.style.display = \"block\"; // panel.close();\n                    panel.toggleFooterVisibility(true);\n                    textarea.parentNode.removeChild(textarea);\n                    panel.classList.add(\"settings\");\n                    panel.classList.remove(\"centered\");\n                    inner_refresh();\n                }\n\t\t\t\ttextarea.value = node.properties[propname];\n\t\t\t\ttextarea.addEventListener(\"keydown\", function(e){\n\t\t\t\t\tif(e.code == \"Enter\" && e.ctrlKey )\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.setProperty(propname, textarea.value);\n                        fDoneWith();\n\t\t\t\t\t}\n\t\t\t\t});\n                panel.toggleAltContent(true);\n                panel.toggleFooterVisibility(false);\n\t\t\t\ttextarea.style.height = \"calc(100% - 40px)\";\n\t\t\t/*}*/\n\t\t\tvar assign = panel.addButton( \"Assign\", function(){\n\t\t\t\tnode.setProperty(propname, textarea.value);\n                fDoneWith();\n\t\t\t});\n\t\t\tpanel.alt_content.appendChild(assign); //panel.content.appendChild(assign);\n\t\t\tvar button = panel.addButton( \"Close\", fDoneWith);\n\t\t\tbutton.style.float = \"right\";\n\t\t\tpanel.alt_content.appendChild(button); // panel.content.appendChild(button);\n\t\t}\n\n\t\tinner_refresh();\n\n\t\tthis.canvas.parentNode.appendChild( panel );\n\t}\n\t\n\tLGraphCanvas.prototype.showSubgraphPropertiesDialog = function(node)\n\t{\n\t\tconsole.log(\"showing subgraph properties dialog\");\n\n\t\tvar old_panel = this.canvas.parentNode.querySelector(\".subgraph_dialog\");\n\t\tif(old_panel)\n\t\t\told_panel.close();\n\n\t\tvar panel = this.createPanel(\"Subgraph Inputs\",{closable:true, width: 500});\n\t\tpanel.node = node;\n\t\tpanel.classList.add(\"subgraph_dialog\");\n\n\t\tfunction inner_refresh()\n\t\t{\n\t\t\tpanel.clear();\n\n\t\t\t//show currents\n\t\t\tif(node.inputs)\n\t\t\t\tfor(var i = 0; i < node.inputs.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tvar input = node.inputs[i];\n\t\t\t\t\tif(input.not_subgraph_input)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tvar html = \"<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>\";\n\t\t\t\t\tvar elem = panel.addHTML(html,\"subgraph_property\");\n\t\t\t\t\telem.dataset[\"name\"] = input.name;\n\t\t\t\t\telem.dataset[\"slot\"] = i;\n\t\t\t\t\telem.querySelector(\".name\").innerText = input.name;\n\t\t\t\t\telem.querySelector(\".type\").innerText = input.type;\n\t\t\t\t\telem.querySelector(\"button\").addEventListener(\"click\",function(e){\n\t\t\t\t\t\tnode.removeInput( Number( this.parentNode.dataset[\"slot\"] ) );\n\t\t\t\t\t\tinner_refresh();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t}\n\n\t\t//add extra\n\t\tvar html = \" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>\";\n\t\tvar elem = panel.addHTML(html,\"subgraph_property extra\", true);\n\t\telem.querySelector(\"button\").addEventListener(\"click\", function(e){\n\t\t\tvar elem = this.parentNode;\n\t\t\tvar name = elem.querySelector(\".name\").value;\n\t\t\tvar type = elem.querySelector(\".type\").value;\n\t\t\tif(!name || node.findInputSlot(name) != -1)\n\t\t\t\treturn;\n\t\t\tnode.addInput(name,type);\n\t\t\telem.querySelector(\".name\").value = \"\";\n\t\t\telem.querySelector(\".type\").value = \"\";\n\t\t\tinner_refresh();\n\t\t});\n\n\t\tinner_refresh();\n\t    this.canvas.parentNode.appendChild(panel);\n\t\treturn panel;\n\t}\n    LGraphCanvas.prototype.showSubgraphPropertiesDialogRight = function (node) {\n\n        // console.log(\"showing subgraph properties dialog\");\n        var that = this;\n        // old_panel if old_panel is exist close it\n        var old_panel = this.canvas.parentNode.querySelector(\".subgraph_dialog\");\n        if (old_panel)\n            old_panel.close();\n        // new panel\n        var panel = this.createPanel(\"Subgraph Outputs\", { closable: true, width: 500 });\n        panel.node = node;\n        panel.classList.add(\"subgraph_dialog\");\n\n        function inner_refresh() {\n            panel.clear();\n            //show currents\n            if (node.outputs)\n                for (var i = 0; i < node.outputs.length; ++i) {\n                    var input = node.outputs[i];\n                    if (input.not_subgraph_output)\n                        continue;\n                    var html = \"<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>\";\n                    var elem = panel.addHTML(html, \"subgraph_property\");\n                    elem.dataset[\"name\"] = input.name;\n                    elem.dataset[\"slot\"] = i;\n                    elem.querySelector(\".name\").innerText = input.name;\n                    elem.querySelector(\".type\").innerText = input.type;\n                    elem.querySelector(\"button\").addEventListener(\"click\", function (e) {\n                        node.removeOutput(Number(this.parentNode.dataset[\"slot\"]));\n                        inner_refresh();\n                    });\n                }\n        }\n\n        //add extra\n        var html = \" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>\";\n        var elem = panel.addHTML(html, \"subgraph_property extra\", true);\n        elem.querySelector(\".name\").addEventListener(\"keydown\", function (e) {\n            if (e.keyCode == 13) {\n                addOutput.apply(this)\n            }\n        })\n        elem.querySelector(\"button\").addEventListener(\"click\", function (e) {\n            addOutput.apply(this)\n        });\n        function addOutput() {\n            var elem = this.parentNode;\n            var name = elem.querySelector(\".name\").value;\n            var type = elem.querySelector(\".type\").value;\n            if (!name || node.findOutputSlot(name) != -1)\n                return;\n            node.addOutput(name, type);\n            elem.querySelector(\".name\").value = \"\";\n            elem.querySelector(\".type\").value = \"\";\n            inner_refresh();\n        }\n\n        inner_refresh();\n        this.canvas.parentNode.appendChild(panel);\n        return panel;\n    }\n\tLGraphCanvas.prototype.checkPanels = function()\n\t{\n\t\tif(!this.canvas)\n\t\t\treturn;\n\t\tvar panels = this.canvas.parentNode.querySelectorAll(\".litegraph.dialog\");\n\t\tfor(var i = 0; i < panels.length; ++i)\n\t\t{\n\t\t\tvar panel = panels[i];\n\t\t\tif( !panel.node )\n\t\t\t\tcontinue;\n\t\t\tif( !panel.node.graph || panel.graph != this.graph )\n\t\t\t\tpanel.close();\n\t\t}\n\t}\n\n    LGraphCanvas.onMenuNodeCollapse = function(value, options, e, menu, node) {\n\t\tnode.graph.beforeChange(/*?*/);\n\t\t\n\t\tvar fApplyMultiNode = function(node){\n\t\t\tnode.collapse();\n\t\t}\n\t\t\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tnode.graph.afterChange(/*?*/);\n    };\n\n    LGraphCanvas.onMenuNodePin = function(value, options, e, menu, node) {\n        node.pin();\n    };\n\n    LGraphCanvas.onMenuNodeMode = function(value, options, e, menu, node) {\n        new LiteGraph.ContextMenu(\n            LiteGraph.NODE_MODES,\n            { event: e, callback: inner_clicked, parentMenu: menu, node: node }\n        );\n\n        function inner_clicked(v) {\n            if (!node) {\n                return;\n            }\n            var kV = Object.values(LiteGraph.NODE_MODES).indexOf(v);\n            var fApplyMultiNode = function(node){\n\t\t\t\tif (kV>=0 && LiteGraph.NODE_MODES[kV])\n\t\t\t\t\tnode.changeMode(kV);\n\t\t\t\telse{\n\t\t\t\t\tconsole.warn(\"unexpected mode: \"+v);\n\t\t\t\t\tnode.changeMode(LiteGraph.ALWAYS);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\t\tfApplyMultiNode(node);\n\t\t\t}else{\n\t\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t\t}\n\t\t\t}\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onMenuNodeColors = function(value, options, e, menu, node) {\n        if (!node) {\n            throw \"no node for color\";\n        }\n\n        var values = [];\n        values.push({\n            value: null,\n            content:\n                \"<span style='display: block; padding-left: 4px;'>No color</span>\"\n        });\n\n        for (var i in LGraphCanvas.node_colors) {\n            var color = LGraphCanvas.node_colors[i];\n            var value = {\n                value: i,\n                content:\n                    \"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid \" +\n                    color.color +\n                    \"; background-color:\" +\n                    color.bgcolor +\n                    \"'>\" +\n                    i +\n                    \"</span>\"\n            };\n            values.push(value);\n        }\n        new LiteGraph.ContextMenu(values, {\n            event: e,\n            callback: inner_clicked,\n            parentMenu: menu,\n            node: node\n        });\n\n        function inner_clicked(v) {\n            if (!node) {\n                return;\n            }\n\n            var color = v.value ? LGraphCanvas.node_colors[v.value] : null;\n\t\t\t\n\t\t\tvar fApplyColor = function(node){\n\t\t\t\tif (color) {\n\t\t\t\t\tif (node.constructor === LiteGraph.LGraphGroup) {\n\t\t\t\t\t\tnode.color = color.groupcolor;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode.color = color.color;\n\t\t\t\t\t\tnode.bgcolor = color.bgcolor;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdelete node.color;\n\t\t\t\t\tdelete node.bgcolor;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\t\tfApplyColor(node);\n\t\t\t}else{\n\t\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\t\tfApplyColor(graphcanvas.selected_nodes[i]);\n\t\t\t\t}\n\t\t\t}\n            node.setDirtyCanvas(true, true);\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onMenuNodeShapes = function(value, options, e, menu, node) {\n        if (!node) {\n            throw \"no node passed\";\n        }\n\n        new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES, {\n            event: e,\n            callback: inner_clicked,\n            parentMenu: menu,\n            node: node\n        });\n\n        function inner_clicked(v) {\n            if (!node) {\n                return;\n            }\n\t\t\tnode.graph.beforeChange(/*?*/); //node\n            \n\t\t\tvar fApplyMultiNode = function(node){\n\t\t\t\tnode.shape = v;\n\t\t\t}\n\n\t\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\t\tfApplyMultiNode(node);\n\t\t\t}else{\n\t\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnode.graph.afterChange(/*?*/); //node\n            node.setDirtyCanvas(true);\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onMenuNodeRemove = function(value, options, e, menu, node) {\n        if (!node) {\n            throw \"no node passed\";\n        }\n\n\t\tvar graph = node.graph;\n\t\tgraph.beforeChange();\n        \n\t\t\n\t\tvar fApplyMultiNode = function(node){\n\t\t\tif (node.removable === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tgraph.remove(node);\n\t\t}\n\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tgraph.afterChange();\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.onMenuNodeToSubgraph = function(value, options, e, menu, node) {\n\t\tvar graph = node.graph;\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif(!graphcanvas) //??\n\t\t\treturn;\n\n\t\tvar nodes_list = Object.values( graphcanvas.selected_nodes || {} );\n\t\tif( !nodes_list.length )\n\t\t\tnodes_list = [ node ];\n\n\t\tvar subgraph_node = LiteGraph.createNode(\"graph/subgraph\");\n\t\tsubgraph_node.pos = node.pos.concat();\n\t\tgraph.add(subgraph_node);\n\n\t\tsubgraph_node.buildFromNodes( nodes_list );\n\n\t\tgraphcanvas.deselectAllNodes();\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.onMenuNodeClone = function(value, options, e, menu, node) {\n        \n\t\tnode.graph.beforeChange();\n        \n\t\tvar newSelected = {};\n\t\t\n\t\tvar fApplyMultiNode = function(node){\n\t\t\tif (node.clonable === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar newnode = node.clone();\n\t\t\tif (!newnode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnewnode.pos = [node.pos[0] + 5, node.pos[1] + 5];\n\t\t\tnode.graph.add(newnode);\n\t\t\tnewSelected[newnode.id] = newnode;\n\t\t}\n\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(Object.keys(newSelected).length){\n\t\t\tgraphcanvas.selectNodes(newSelected);\n\t\t}\n\t\t\n\t\tnode.graph.afterChange();\n\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.node_colors = {\n        red: { color: \"#322\", bgcolor: \"#533\", groupcolor: \"#A88\" },\n        brown: { color: \"#332922\", bgcolor: \"#593930\", groupcolor: \"#b06634\" },\n        green: { color: \"#232\", bgcolor: \"#353\", groupcolor: \"#8A8\" },\n        blue: { color: \"#223\", bgcolor: \"#335\", groupcolor: \"#88A\" },\n        pale_blue: {\n            color: \"#2a363b\",\n            bgcolor: \"#3f5159\",\n            groupcolor: \"#3f789e\"\n        },\n        cyan: { color: \"#233\", bgcolor: \"#355\", groupcolor: \"#8AA\" },\n        purple: { color: \"#323\", bgcolor: \"#535\", groupcolor: \"#a1309b\" },\n        yellow: { color: \"#432\", bgcolor: \"#653\", groupcolor: \"#b58b2a\" },\n        black: { color: \"#222\", bgcolor: \"#000\", groupcolor: \"#444\" }\n    };\n\n    LGraphCanvas.prototype.getCanvasMenuOptions = function() {\n        var options = null;\n\t\tvar that = this;\n        if (this.getMenuOptions) {\n            options = this.getMenuOptions();\n        } else {\n            options = [\n                {\n                    content: \"Add Node\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuAdd\n                },\n                { content: \"Add Group\", callback: LGraphCanvas.onGroupAdd },\n\t\t\t\t//{ content: \"Arrange\", callback: that.graph.arrange },\n                //{content:\"Collapse All\", callback: LGraphCanvas.onMenuCollapseAll }\n            ];\n            /*if (LiteGraph.showCanvasOptions){\n                options.push({ content: \"Options\", callback: that.showShowGraphOptionsPanel });\n            }*/\n\n            if (Object.keys(this.selected_nodes).length > 1) {\n                options.push({\n                    content: \"Align\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onGroupAlign,\n                })\n            }\n\n            if (this._graph_stack && this._graph_stack.length > 0) {\n                options.push(null, {\n                    content: \"Close subgraph\",\n                    callback: this.closeSubgraph.bind(this)\n                });\n            }\n        }\n\n        if (this.getExtraMenuOptions) {\n            var extra = this.getExtraMenuOptions(this, options);\n            if (extra) {\n                options = options.concat(extra);\n            }\n        }\n\n        return options;\n    };\n\n    //called by processContextMenu to extract the menu list\n    LGraphCanvas.prototype.getNodeMenuOptions = function(node) {\n        var options = null;\n\n        if (node.getMenuOptions) {\n            options = node.getMenuOptions(this);\n        } else {\n            options = [\n                {\n                    content: \"Inputs\",\n                    has_submenu: true,\n                    disabled: true,\n                    callback: LGraphCanvas.showMenuNodeOptionalInputs\n                },\n                {\n                    content: \"Outputs\",\n                    has_submenu: true,\n                    disabled: true,\n                    callback: LGraphCanvas.showMenuNodeOptionalOutputs\n                },\n                null,\n                {\n                    content: \"Properties\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onShowMenuNodeProperties\n                },\n                null,\n                {\n                    content: \"Title\",\n                    callback: LGraphCanvas.onShowPropertyEditor\n                },\n                {\n                    content: \"Mode\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuNodeMode\n                }];\n            if(node.resizable !== false){\n                options.push({\n                    content: \"Resize\", callback: LGraphCanvas.onMenuResizeNode\n                });\n            }\n            options.push(\n                {\n                    content: \"Collapse\",\n                    callback: LGraphCanvas.onMenuNodeCollapse\n                },\n                { content: \"Pin\", callback: LGraphCanvas.onMenuNodePin },\n                {\n                    content: \"Colors\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuNodeColors\n                },\n                {\n                    content: \"Shapes\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuNodeShapes\n                },\n                null\n            );\n        }\n\n        if (node.onGetInputs) {\n            var inputs = node.onGetInputs();\n            if (inputs && inputs.length) {\n                options[0].disabled = false;\n            }\n        }\n\n        if (node.onGetOutputs) {\n            var outputs = node.onGetOutputs();\n            if (outputs && outputs.length) {\n                options[1].disabled = false;\n            }\n        }\n\n        if (node.getExtraMenuOptions) {\n            var extra = node.getExtraMenuOptions(this, options);\n            if (extra) {\n                extra.push(null);\n                options = extra.concat(options);\n            }\n        }\n\n        if (node.clonable !== false) {\n            options.push({\n                content: \"Clone\",\n                callback: LGraphCanvas.onMenuNodeClone\n            });\n        }\n\n\t\tif(0) //TODO\n\t\toptions.push({\n\t\t\tcontent: \"To Subgraph\",\n\t\t\tcallback: LGraphCanvas.onMenuNodeToSubgraph\n\t\t});\n\n        if (Object.keys(this.selected_nodes).length > 1) {\n            options.push({\n                content: \"Align Selected To\",\n                has_submenu: true,\n                callback: LGraphCanvas.onNodeAlign,\n            })\n        }\n\n\t\toptions.push(null, {\n\t\t\tcontent: \"Remove\",\n\t\t\tdisabled: !(node.removable !== false && !node.block_delete ),\n\t\t\tcallback: LGraphCanvas.onMenuNodeRemove\n\t\t});\n\n        if (node.graph && node.graph.onGetNodeMenuOptions) {\n            node.graph.onGetNodeMenuOptions(options, node);\n        }\n\n        return options;\n    };\n\n    LGraphCanvas.prototype.getGroupMenuOptions = function(node) {\n        var o = [\n            { content: \"Title\", callback: LGraphCanvas.onShowPropertyEditor },\n            {\n                content: \"Color\",\n                has_submenu: true,\n                callback: LGraphCanvas.onMenuNodeColors\n            },\n            {\n                content: \"Font size\",\n                property: \"font_size\",\n                type: \"Number\",\n                callback: LGraphCanvas.onShowPropertyEditor\n            },\n            null,\n            { content: \"Remove\", callback: LGraphCanvas.onMenuNodeRemove }\n        ];\n\n        return o;\n    };\n\n    LGraphCanvas.prototype.processContextMenu = function(node, event) {\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var menu_info = null;\n        var options = {\n            event: event,\n            callback: inner_option_clicked,\n            extra: node\n        };\n\n\t\tif(node)\n\t\t\toptions.title = node.type;\n\n        //check if mouse is in input\n        var slot = null;\n        if (node) {\n            slot = node.getSlotInPosition(event.canvasX, event.canvasY);\n            LGraphCanvas.active_node = node;\n        }\n\n        if (slot) {\n            //on slot\n            menu_info = [];\n            if (node.getSlotMenuOptions) {\n                menu_info = node.getSlotMenuOptions(slot);\n            } else {\n                if (\n                    slot &&\n                    slot.output &&\n                    slot.output.links &&\n                    slot.output.links.length\n                ) {\n                    menu_info.push({ content: \"Disconnect Links\", slot: slot });\n                }\n                var _slot = slot.input || slot.output;\n                if (_slot.removable){\n                \tmenu_info.push(\n\t                    _slot.locked\n\t                        ? \"Cannot remove\"\n\t                        : { content: \"Remove Slot\", slot: slot }\n\t                );\n            \t}\n                if (!_slot.nameLocked){\n\t                menu_info.push({ content: \"Rename Slot\", slot: slot });\n                }\n    \n            }\n            options.title =\n                (slot.input ? slot.input.type : slot.output.type) || \"*\";\n            if (slot.input && slot.input.type == LiteGraph.ACTION) {\n                options.title = \"Action\";\n            }\n            if (slot.output && slot.output.type == LiteGraph.EVENT) {\n                options.title = \"Event\";\n            }\n        } else {\n            if (node) {\n                //on node\n                menu_info = this.getNodeMenuOptions(node);\n            } else {\n                menu_info = this.getCanvasMenuOptions();\n                var group = this.graph.getGroupOnPos(\n                    event.canvasX,\n                    event.canvasY\n                );\n                if (group) {\n                    //on group\n                    menu_info.push(null, {\n                        content: \"Edit Group\",\n                        has_submenu: true,\n                        submenu: {\n                            title: \"Group\",\n                            extra: group,\n                            options: this.getGroupMenuOptions(group)\n                        }\n                    });\n                }\n            }\n        }\n\n        //show menu\n        if (!menu_info) {\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(menu_info, options, ref_window);\n\n        function inner_option_clicked(v, options, e) {\n            if (!v) {\n                return;\n            }\n\n            if (v.content == \"Remove Slot\") {\n                var info = v.slot;\n                node.graph.beforeChange();\n                if (info.input) {\n                    node.removeInput(info.slot);\n                } else if (info.output) {\n                    node.removeOutput(info.slot);\n                }\n                node.graph.afterChange();\n                return;\n            } else if (v.content == \"Disconnect Links\") {\n                var info = v.slot;\n                node.graph.beforeChange();\n                if (info.output) {\n                    node.disconnectOutput(info.slot);\n                } else if (info.input) {\n                    node.disconnectInput(info.slot);\n                }\n                node.graph.afterChange();\n                return;\n            } else if (v.content == \"Rename Slot\") {\n                var info = v.slot;\n                var slot_info = info.input\n                    ? node.getInputInfo(info.slot)\n                    : node.getOutputInfo(info.slot);\n                var dialog = that.createDialog(\n                    \"<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>\",\n                    options\n                );\n                var input = dialog.querySelector(\"input\");\n                if (input && slot_info) {\n                    input.value = slot_info.label || \"\";\n                }\n                var inner = function(){\n                \tnode.graph.beforeChange();\n                    if (input.value) {\n                        if (slot_info) {\n                            slot_info.label = input.value;\n                        }\n                        that.setDirty(true);\n                    }\n                    dialog.close();\n                    node.graph.afterChange();\n                }\n                dialog.querySelector(\"button\").addEventListener(\"click\", inner);\n                input.addEventListener(\"keydown\", function(e) {\n                    dialog.is_modified = true;\n                    if (e.keyCode == 27) {\n                        //ESC\n                        dialog.close();\n                    } else if (e.keyCode == 13) {\n                        inner(); // save\n                    } else if (e.keyCode != 13 && e.target.localName != \"textarea\") {\n                        return;\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n                input.focus();\n            }\n\n            //if(v.callback)\n            //\treturn v.callback.call(that, node, options, e, menu, that, event );\n        }\n    };\n\n    //API *************************************************\n    function compareObjects(a, b) {\n        for (var i in a) {\n            if (a[i] != b[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    LiteGraph.compareObjects = compareObjects;\n\n    function distance(a, b) {\n        return Math.sqrt(\n            (b[0] - a[0]) * (b[0] - a[0]) + (b[1] - a[1]) * (b[1] - a[1])\n        );\n    }\n    LiteGraph.distance = distance;\n\n    function colorToString(c) {\n        return (\n            \"rgba(\" +\n            Math.round(c[0] * 255).toFixed() +\n            \",\" +\n            Math.round(c[1] * 255).toFixed() +\n            \",\" +\n            Math.round(c[2] * 255).toFixed() +\n            \",\" +\n            (c.length == 4 ? c[3].toFixed(2) : \"1.0\") +\n            \")\"\n        );\n    }\n    LiteGraph.colorToString = colorToString;\n\n    function isInsideRectangle(x, y, left, top, width, height) {\n        if (left < x && left + width > x && top < y && top + height > y) {\n            return true;\n        }\n        return false;\n    }\n    LiteGraph.isInsideRectangle = isInsideRectangle;\n\n    //[minx,miny,maxx,maxy]\n    function growBounding(bounding, x, y) {\n        if (x < bounding[0]) {\n            bounding[0] = x;\n        } else if (x > bounding[2]) {\n            bounding[2] = x;\n        }\n\n        if (y < bounding[1]) {\n            bounding[1] = y;\n        } else if (y > bounding[3]) {\n            bounding[3] = y;\n        }\n    }\n    LiteGraph.growBounding = growBounding;\n\n    //point inside bounding box\n    function isInsideBounding(p, bb) {\n        if (\n            p[0] < bb[0][0] ||\n            p[1] < bb[0][1] ||\n            p[0] > bb[1][0] ||\n            p[1] > bb[1][1]\n        ) {\n            return false;\n        }\n        return true;\n    }\n    LiteGraph.isInsideBounding = isInsideBounding;\n\n    //bounding overlap, format: [ startx, starty, width, height ]\n    function overlapBounding(a, b) {\n        var A_end_x = a[0] + a[2];\n        var A_end_y = a[1] + a[3];\n        var B_end_x = b[0] + b[2];\n        var B_end_y = b[1] + b[3];\n\n        if (\n            a[0] > B_end_x ||\n            a[1] > B_end_y ||\n            A_end_x < b[0] ||\n            A_end_y < b[1]\n        ) {\n            return false;\n        }\n        return true;\n    }\n    LiteGraph.overlapBounding = overlapBounding;\n\n    //Convert a hex value to its decimal value - the inputted hex must be in the\n    //\tformat of a hex triplet - the kind we use for HTML colours. The function\n    //\twill return an array with three values.\n    function hex2num(hex) {\n        if (hex.charAt(0) == \"#\") {\n            hex = hex.slice(1);\n        } //Remove the '#' char - if there is one.\n        hex = hex.toUpperCase();\n        var hex_alphabets = \"0123456789ABCDEF\";\n        var value = new Array(3);\n        var k = 0;\n        var int1, int2;\n        for (var i = 0; i < 6; i += 2) {\n            int1 = hex_alphabets.indexOf(hex.charAt(i));\n            int2 = hex_alphabets.indexOf(hex.charAt(i + 1));\n            value[k] = int1 * 16 + int2;\n            k++;\n        }\n        return value;\n    }\n\n    LiteGraph.hex2num = hex2num;\n\n    //Give a array with three values as the argument and the function will return\n    //\tthe corresponding hex triplet.\n    function num2hex(triplet) {\n        var hex_alphabets = \"0123456789ABCDEF\";\n        var hex = \"#\";\n        var int1, int2;\n        for (var i = 0; i < 3; i++) {\n            int1 = triplet[i] / 16;\n            int2 = triplet[i] % 16;\n\n            hex += hex_alphabets.charAt(int1) + hex_alphabets.charAt(int2);\n        }\n        return hex;\n    }\n\n    LiteGraph.num2hex = num2hex;\n\n    /* LiteGraph GUI elements used for canvas editing *************************************/\n\n    /**\n     * ContextMenu from LiteGUI\n     *\n     * @class ContextMenu\n     * @constructor\n     * @param {Array} values (allows object { title: \"Nice text\", callback: function ... })\n     * @param {Object} options [optional] Some options:\\\n     * - title: title to show on top of the menu\n     * - callback: function to call when an option is clicked, it receives the item information\n     * - ignore_item_callbacks: ignores the callback inside the item, it just calls the options.callback\n     * - event: you can pass a MouseEvent, this way the ContextMenu appears in that position\n     */\n    function ContextMenu(values, options) {\n        options = options || {};\n        this.options = options;\n        var that = this;\n\n        //to link a menu with its parent\n        if (options.parentMenu) {\n            if (options.parentMenu.constructor !== this.constructor) {\n                console.error(\n                    \"parentMenu must be of class ContextMenu, ignoring it\"\n                );\n                options.parentMenu = null;\n            } else {\n                this.parentMenu = options.parentMenu;\n                this.parentMenu.lock = true;\n                this.parentMenu.current_submenu = this;\n            }\n        }\n\n\t\tvar eventClass = null;\n\t\tif(options.event) //use strings because comparing classes between windows doesnt work\n\t\t\teventClass = options.event.constructor.name;\n        if ( eventClass !== \"MouseEvent\" &&\n            eventClass !== \"CustomEvent\" &&\n\t\t\teventClass !== \"PointerEvent\"\n        ) {\n            console.error(\n                \"Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (\"+eventClass+\")\"\n            );\n            options.event = null;\n        }\n\n        var root = document.createElement(\"div\");\n        root.className = \"litegraph litecontextmenu litemenubar-panel\";\n        if (options.className) {\n            root.className += \" \" + options.className;\n        }\n        root.style.minWidth = 100;\n        root.style.minHeight = 100;\n        root.style.pointerEvents = \"none\";\n        setTimeout(function() {\n            root.style.pointerEvents = \"auto\";\n        }, 100); //delay so the mouse up event is not caught by this element\n\n        //this prevents the default context browser menu to open in case this menu was created when pressing right button\n\t\tLiteGraph.pointerListenerAdd(root,\"up\",\n            function(e) {\n\t\t\t  \t//console.log(\"pointerevents: ContextMenu up root prevent\");\n                e.preventDefault();\n                return true;\n            },\n            true\n        );\n        root.addEventListener(\n            \"contextmenu\",\n            function(e) {\n                if (e.button != 2) {\n                    //right button\n                    return false;\n                }\n                e.preventDefault();\n                return false;\n            },\n            true\n        );\n\n        LiteGraph.pointerListenerAdd(root,\"down\",\n            function(e) {\n\t\t\t  \t//console.log(\"pointerevents: ContextMenu down\");\n                if (e.button == 2) {\n                    that.close();\n                    e.preventDefault();\n                    return true;\n                }\n            },\n            true\n        );\n\n        function on_mouse_wheel(e) {\n            var pos = parseInt(root.style.top);\n            root.style.top =\n                (pos + e.deltaY * options.scroll_speed).toFixed() + \"px\";\n            e.preventDefault();\n            return true;\n        }\n\n        if (!options.scroll_speed) {\n            options.scroll_speed = 0.1;\n        }\n\n        root.addEventListener(\"wheel\", on_mouse_wheel, true);\n        root.addEventListener(\"mousewheel\", on_mouse_wheel, true);\n\n        this.root = root;\n\n        //title\n        if (options.title) {\n            var element = document.createElement(\"div\");\n            element.className = \"litemenu-title\";\n            element.innerHTML = options.title;\n            root.appendChild(element);\n        }\n\n        //entries\n        var num = 0;\n        for (var i=0; i < values.length; i++) {\n            var name = values.constructor == Array ? values[i] : i;\n            if (name != null && name.constructor !== String) {\n                name = name.content === undefined ? String(name) : name.content;\n            }\n            var value = values[i];\n            this.addItem(name, value, options);\n            num++;\n        }\n\n        //close on leave? touch enabled devices won't work TODO use a global device detector and condition on that\n        /*LiteGraph.pointerListenerAdd(root,\"leave\", function(e) {\n\t\t  \tconsole.log(\"pointerevents: ContextMenu leave\");\n            if (that.lock) {\n                return;\n            }\n            if (root.closing_timer) {\n                clearTimeout(root.closing_timer);\n            }\n            root.closing_timer = setTimeout(that.close.bind(that, e), 500);\n            //that.close(e);\n        });*/\n\n\t\tLiteGraph.pointerListenerAdd(root,\"enter\", function(e) {\n\t\t  \t//console.log(\"pointerevents: ContextMenu enter\");\n            if (root.closing_timer) {\n                clearTimeout(root.closing_timer);\n            }\n        });\n\n        //insert before checking position\n        var root_document = document;\n        if (options.event) {\n            root_document = options.event.target.ownerDocument;\n        }\n\n        if (!root_document) {\n            root_document = document;\n        }\n\n\t\tif( root_document.fullscreenElement )\n\t        root_document.fullscreenElement.appendChild(root);\n\t\telse\n\t\t    root_document.body.appendChild(root);\n\n        //compute best position\n        var left = options.left || 0;\n        var top = options.top || 0;\n        if (options.event) {\n            left = options.event.clientX - 10;\n            top = options.event.clientY - 10;\n            if (options.title) {\n                top -= 20;\n            }\n\n            if (options.parentMenu) {\n                var rect = options.parentMenu.root.getBoundingClientRect();\n                left = rect.left + rect.width;\n            }\n\n            var body_rect = document.body.getBoundingClientRect();\n            var root_rect = root.getBoundingClientRect();\n\t\t\tif(body_rect.height == 0)\n\t\t\t\tconsole.error(\"document.body height is 0. That is dangerous, set html,body { height: 100%; }\");\n\n            if (body_rect.width && left > body_rect.width - root_rect.width - 10) {\n                left = body_rect.width - root_rect.width - 10;\n            }\n            if (body_rect.height && top > body_rect.height - root_rect.height - 10) {\n                top = body_rect.height - root_rect.height - 10;\n            }\n        }\n\n        root.style.left = left + \"px\";\n        root.style.top = top + \"px\";\n\n        if (options.scale) {\n            root.style.transform = \"scale(\" + options.scale + \")\";\n        }\n    }\n\n    ContextMenu.prototype.addItem = function(name, value, options) {\n        var that = this;\n        options = options || {};\n\n        var element = document.createElement(\"div\");\n        element.className = \"litemenu-entry submenu\";\n\n        var disabled = false;\n\n        if (value === null) {\n            element.classList.add(\"separator\");\n            //element.innerHTML = \"<hr/>\"\n            //continue;\n        } else {\n            element.innerHTML = value && value.title ? value.title : name;\n            element.value = value;\n\n            if (value) {\n                if (value.disabled) {\n                    disabled = true;\n                    element.classList.add(\"disabled\");\n                }\n                if (value.submenu || value.has_submenu) {\n                    element.classList.add(\"has_submenu\");\n                }\n            }\n\n            if (typeof value == \"function\") {\n                element.dataset[\"value\"] = name;\n                element.onclick_callback = value;\n            } else {\n                element.dataset[\"value\"] = value;\n            }\n\n            if (value.className) {\n                element.className += \" \" + value.className;\n            }\n        }\n\n        this.root.appendChild(element);\n        if (!disabled) {\n            element.addEventListener(\"click\", inner_onclick);\n        }\n        if (!disabled && options.autoopen) {\n\t\t\tLiteGraph.pointerListenerAdd(element,\"enter\",inner_over);\n        }\n\n        function inner_over(e) {\n            var value = this.value;\n            if (!value || !value.has_submenu) {\n                return;\n            }\n            //if it is a submenu, autoopen like the item was clicked\n            inner_onclick.call(this, e);\n        }\n\n        //menu option clicked\n        function inner_onclick(e) {\n            var value = this.value;\n            var close_parent = true;\n\n            if (that.current_submenu) {\n                that.current_submenu.close(e);\n            }\n\n            //global callback\n            if (options.callback) {\n                var r = options.callback.call(\n                    this,\n                    value,\n                    options,\n                    e,\n                    that,\n                    options.node\n                );\n                if (r === true) {\n                    close_parent = false;\n                }\n            }\n\n            //special cases\n            if (value) {\n                if (\n                    value.callback &&\n                    !options.ignore_item_callbacks &&\n                    value.disabled !== true\n                ) {\n                    //item callback\n                    var r = value.callback.call(\n                        this,\n                        value,\n                        options,\n                        e,\n                        that,\n                        options.extra\n                    );\n                    if (r === true) {\n                        close_parent = false;\n                    }\n                }\n                if (value.submenu) {\n                    if (!value.submenu.options) {\n                        throw \"ContextMenu submenu needs options\";\n                    }\n                    var submenu = new that.constructor(value.submenu.options, {\n                        callback: value.submenu.callback,\n                        event: e,\n                        parentMenu: that,\n                        ignore_item_callbacks:\n                            value.submenu.ignore_item_callbacks,\n                        title: value.submenu.title,\n                        extra: value.submenu.extra,\n                        autoopen: options.autoopen\n                    });\n                    close_parent = false;\n                }\n            }\n\n            if (close_parent && !that.lock) {\n                that.close();\n            }\n        }\n\n        return element;\n    };\n\n    ContextMenu.prototype.close = function(e, ignore_parent_menu) {\n        if (this.root.parentNode) {\n            this.root.parentNode.removeChild(this.root);\n        }\n        if (this.parentMenu && !ignore_parent_menu) {\n            this.parentMenu.lock = false;\n            this.parentMenu.current_submenu = null;\n            if (e === undefined) {\n                this.parentMenu.close();\n            } else if (\n                e &&\n                !ContextMenu.isCursorOverElement(e, this.parentMenu.root)\n            ) {\n                ContextMenu.trigger(this.parentMenu.root, LiteGraph.pointerevents_method+\"leave\", e);\n            }\n        }\n        if (this.current_submenu) {\n            this.current_submenu.close(e, true);\n        }\n\n        if (this.root.closing_timer) {\n            clearTimeout(this.root.closing_timer);\n        }\n        \n        // TODO implement : LiteGraph.contextMenuClosed(); :: keep track of opened / closed / current ContextMenu\n        // on key press, allow filtering/selecting the context menu elements\n    };\n\n    //this code is used to trigger events easily (used in the context menu mouseleave\n    ContextMenu.trigger = function(element, event_name, params, origin) {\n        var evt = document.createEvent(\"CustomEvent\");\n        evt.initCustomEvent(event_name, true, true, params); //canBubble, cancelable, detail\n        evt.srcElement = origin;\n        if (element.dispatchEvent) {\n            element.dispatchEvent(evt);\n        } else if (element.__events) {\n            element.__events.dispatchEvent(evt);\n        }\n        //else nothing seems binded here so nothing to do\n        return evt;\n    };\n\n    //returns the top most menu\n    ContextMenu.prototype.getTopMenu = function() {\n        if (this.options.parentMenu) {\n            return this.options.parentMenu.getTopMenu();\n        }\n        return this;\n    };\n\n    ContextMenu.prototype.getFirstEvent = function() {\n        if (this.options.parentMenu) {\n            return this.options.parentMenu.getFirstEvent();\n        }\n        return this.options.event;\n    };\n\n    ContextMenu.isCursorOverElement = function(event, element) {\n        var left = event.clientX;\n        var top = event.clientY;\n        var rect = element.getBoundingClientRect();\n        if (!rect) {\n            return false;\n        }\n        if (\n            top > rect.top &&\n            top < rect.top + rect.height &&\n            left > rect.left &&\n            left < rect.left + rect.width\n        ) {\n            return true;\n        }\n        return false;\n    };\n\n    LiteGraph.ContextMenu = ContextMenu;\n\n    LiteGraph.closeAllContextMenus = function(ref_window) {\n        ref_window = ref_window || window;\n\n        var elements = ref_window.document.querySelectorAll(\".litecontextmenu\");\n        if (!elements.length) {\n            return;\n        }\n\n        var result = [];\n        for (var i = 0; i < elements.length; i++) {\n            result.push(elements[i]);\n        }\n\n        for (var i=0; i < result.length; i++) {\n            if (result[i].close) {\n                result[i].close();\n            } else if (result[i].parentNode) {\n                result[i].parentNode.removeChild(result[i]);\n            }\n        }\n    };\n\n    LiteGraph.extendClass = function(target, origin) {\n        for (var i in origin) {\n            //copy class properties\n            if (target.hasOwnProperty(i)) {\n                continue;\n            }\n            target[i] = origin[i];\n        }\n\n        if (origin.prototype) {\n            //copy prototype properties\n            for (var i in origin.prototype) {\n                //only enumerable\n                if (!origin.prototype.hasOwnProperty(i)) {\n                    continue;\n                }\n\n                if (target.prototype.hasOwnProperty(i)) {\n                    //avoid overwriting existing ones\n                    continue;\n                }\n\n                //copy getters\n                if (origin.prototype.__lookupGetter__(i)) {\n                    target.prototype.__defineGetter__(\n                        i,\n                        origin.prototype.__lookupGetter__(i)\n                    );\n                } else {\n                    target.prototype[i] = origin.prototype[i];\n                }\n\n                //and setters\n                if (origin.prototype.__lookupSetter__(i)) {\n                    target.prototype.__defineSetter__(\n                        i,\n                        origin.prototype.__lookupSetter__(i)\n                    );\n                }\n            }\n        }\n    };\n\n\t//used by some widgets to render a curve editor\n\tfunction CurveEditor( points )\n\t{\n\t\tthis.points = points;\n\t\tthis.selected = -1;\n\t\tthis.nearest = -1;\n\t\tthis.size = null; //stores last size used\n\t\tthis.must_update = true;\n\t\tthis.margin = 5;\n\t}\n\n\tCurveEditor.sampleCurve = function(f,points)\n\t{\n\t\tif(!points)\n\t\t\treturn;\n\t\tfor(var i = 0; i < points.length - 1; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tvar pn = points[i+1];\n\t\t\tif(pn[0] < f)\n\t\t\t\tcontinue;\n\t\t\tvar r = (pn[0] - p[0]);\n\t\t\tif( Math.abs(r) < 0.00001 )\n\t\t\t\treturn p[1];\n\t\t\tvar local_f = (f - p[0]) / r;\n\t\t\treturn p[1] * (1.0 - local_f) + pn[1] * local_f;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tCurveEditor.prototype.draw = function( ctx, size, graphcanvas, background_color, line_color, inactive )\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn;\n\t\tthis.size = size;\n\t\tvar w = size[0] - this.margin * 2;\n\t\tvar h = size[1] - this.margin * 2;\n\n\t\tline_color = line_color || \"#666\";\n\n\t\tctx.save();\n\t\tctx.translate(this.margin,this.margin);\n\n\t\tif(background_color)\n\t\t{\n\t\t\tctx.fillStyle = \"#111\";\n\t\t\tctx.fillRect(0,0,w,h);\n\t\t\tctx.fillStyle = \"#222\";\n\t\t\tctx.fillRect(w*0.5,0,1,h);\n\t\t\tctx.strokeStyle = \"#333\";\n\t\t\tctx.strokeRect(0,0,w,h);\n\t\t}\n\t\tctx.strokeStyle = line_color;\n\t\tif(inactive)\n\t\t\tctx.globalAlpha = 0.5;\n\t\tctx.beginPath();\n\t\tfor(var i = 0; i < points.length; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tctx.lineTo( p[0] * w, (1.0 - p[1]) * h );\n\t\t}\n\t\tctx.stroke();\n\t\tctx.globalAlpha = 1;\n\t\tif(!inactive)\n\t\t\tfor(var i = 0; i < points.length; ++i)\n\t\t\t{\n\t\t\t\tvar p = points[i];\n\t\t\t\tctx.fillStyle = this.selected == i ? \"#FFF\" : (this.nearest == i ? \"#DDD\" : \"#AAA\");\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.arc( p[0] * w, (1.0 - p[1]) * h, 2, 0, Math.PI * 2 );\n\t\t\t\tctx.fill();\n\t\t\t}\n\t\tctx.restore();\n\t}\n\n\t//localpos is mouse in curve editor space\n\tCurveEditor.prototype.onMouseDown = function( localpos, graphcanvas )\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn;\n\t\tif( localpos[1] < 0 )\n\t\t\treturn;\n\n\t\t//this.captureInput(true);\n\t\tvar w = this.size[0] - this.margin * 2;\n\t\tvar h = this.size[1] - this.margin * 2;\n\t\tvar x = localpos[0] - this.margin;\n\t\tvar y = localpos[1] - this.margin;\n\t\tvar pos = [x,y];\n\t\tvar max_dist = 30 / graphcanvas.ds.scale;\n\t\t//search closer one\n\t\tthis.selected = this.getCloserPoint(pos, max_dist);\n\t\t//create one\n\t\tif(this.selected == -1)\n\t\t{\n\t\t\tvar point = [x / w, 1 - y / h];\n\t\t\tpoints.push(point);\n\t\t\tpoints.sort(function(a,b){ return a[0] - b[0]; });\n\t\t\tthis.selected = points.indexOf(point);\n\t\t\tthis.must_update = true;\n\t\t}\n\t\tif(this.selected != -1)\n\t\t\treturn true;\n\t}\n\n\tCurveEditor.prototype.onMouseMove = function( localpos, graphcanvas )\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn;\n\t\tvar s = this.selected;\n\t\tif(s < 0)\n\t\t\treturn;\n\t\tvar x = (localpos[0] - this.margin) / (this.size[0] - this.margin * 2 );\n\t\tvar y = (localpos[1] - this.margin) / (this.size[1] - this.margin * 2 );\n\t\tvar curvepos = [(localpos[0] - this.margin),(localpos[1] - this.margin)];\n\t\tvar max_dist = 30 / graphcanvas.ds.scale;\n\t\tthis._nearest = this.getCloserPoint(curvepos, max_dist);\n\t\tvar point = points[s];\n\t\tif(point)\n\t\t{\n\t\t\tvar is_edge_point = s == 0 || s == points.length - 1;\n\t\t\tif( !is_edge_point && (localpos[0] < -10 || localpos[0] > this.size[0] + 10 || localpos[1] < -10 || localpos[1] > this.size[1] + 10) )\n\t\t\t{\n\t\t\t\tpoints.splice(s,1);\n\t\t\t\tthis.selected = -1;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif( !is_edge_point ) //not edges\n\t\t\t\tpoint[0] = clamp(x, 0, 1);\n\t\t\telse\n\t\t\t\tpoint[0] = s == 0 ? 0 : 1;\n\t\t\tpoint[1] = 1.0 - clamp(y, 0, 1);\n\t\t\tpoints.sort(function(a,b){ return a[0] - b[0]; });\n\t\t\tthis.selected = points.indexOf(point);\n\t\t\tthis.must_update = true;\n\t\t}\n\t}\n\n\tCurveEditor.prototype.onMouseUp = function( localpos, graphcanvas )\n\t{\n\t\tthis.selected = -1;\n\t\treturn false;\n\t}\n\n\tCurveEditor.prototype.getCloserPoint = function(pos, max_dist)\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn -1;\n\t\tmax_dist = max_dist || 30;\n\t\tvar w = (this.size[0] - this.margin * 2);\n\t\tvar h = (this.size[1] - this.margin * 2);\n\t\tvar num = points.length;\n\t\tvar p2 = [0,0];\n\t\tvar min_dist = 1000000;\n\t\tvar closest = -1;\n\t\tvar last_valid = -1;\n\t\tfor(var i = 0; i < num; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tp2[0] = p[0] * w;\n\t\t\tp2[1] = (1.0 - p[1]) * h;\n\t\t\tif(p2[0] < pos[0])\n\t\t\t\tlast_valid = i;\n\t\t\tvar dist = vec2.distance(pos,p2);\n\t\t\tif(dist > min_dist || dist > max_dist)\n\t\t\t\tcontinue;\n\t\t\tclosest = i;\n\t\t\tmin_dist = dist;\n\t\t}\n\t\treturn closest;\n\t}\n\n\tLiteGraph.CurveEditor = CurveEditor;\n\n    //used to create nodes from wrapping functions\n    LiteGraph.getParameterNames = function(func) {\n        return (func + \"\")\n            .replace(/[/][/].*$/gm, \"\") // strip single-line comments\n            .replace(/\\s+/g, \"\") // strip white space\n            .replace(/[/][*][^/*]*[*][/]/g, \"\") // strip multi-line comments  /**/\n            .split(\"){\", 1)[0]\n            .replace(/^[^(]*[(]/, \"\") // extract the parameters\n            .replace(/=[^,]+/g, \"\") // strip any ES6 defaults\n            .split(\",\")\n            .filter(Boolean); // split & filter [\"\"]\n    };\n\n\t/* helper for interaction: pointer, touch, mouse Listeners\n\tused by LGraphCanvas DragAndScale ContextMenu*/\n\tLiteGraph.pointerListenerAdd = function(oDOM, sEvIn, fCall, capture=false) {\n\t\tif (!oDOM || !oDOM.addEventListener || !sEvIn || typeof fCall!==\"function\"){\n\t\t\t//console.log(\"cant pointerListenerAdd \"+oDOM+\", \"+sEvent+\", \"+fCall);\n\t\t\treturn; // -- break --\n\t\t}\n\t\t\n\t\tvar sMethod = LiteGraph.pointerevents_method;\n\t\tvar sEvent = sEvIn;\n\t\t\n\t\t// UNDER CONSTRUCTION\n\t\t// convert pointerevents to touch event when not available\n\t\tif (sMethod==\"pointer\" && !window.PointerEvent){ \n\t\t\tconsole.warn(\"sMethod=='pointer' && !window.PointerEvent\");\n\t\t\tconsole.log(\"Converting pointer[\"+sEvent+\"] : down move up cancel enter TO touchstart touchmove touchend, etc ..\");\n\t\t\tswitch(sEvent){\n\t\t\t\tcase \"down\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\tsEvent = \"start\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"move\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\t//sEvent = \"move\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"up\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\tsEvent = \"end\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"cancel\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\t//sEvent = \"cancel\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"enter\":{\n\t\t\t\t\tconsole.log(\"debug: Should I send a move event?\"); // ???\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// case \"over\": case \"out\": not used at now\n\t\t\t\tdefault:{\n\t\t\t\t\tconsole.warn(\"PointerEvent not available in this browser ? The event \"+sEvent+\" would not be called\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tswitch(sEvent){\n\t\t\t//both pointer and move events\n\t\t\tcase \"down\": case \"up\": case \"move\": case \"over\": case \"out\": case \"enter\":\n\t\t\t{\n\t\t\t\toDOM.addEventListener(sMethod+sEvent, fCall, capture);\n\t\t\t}\n\t\t\t// only pointerevents\n\t\t\tcase \"leave\": case \"cancel\": case \"gotpointercapture\": case \"lostpointercapture\":\n\t\t\t{\n\t\t\t\tif (sMethod!=\"mouse\"){\n\t\t\t\t\treturn oDOM.addEventListener(sMethod+sEvent, fCall, capture);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// not \"pointer\" || \"mouse\"\n\t\t\tdefault:\n\t\t\t\treturn oDOM.addEventListener(sEvent, fCall, capture);\n\t\t}\n\t}\n\tLiteGraph.pointerListenerRemove = function(oDOM, sEvent, fCall, capture=false) {\n\t\tif (!oDOM || !oDOM.removeEventListener || !sEvent || typeof fCall!==\"function\"){\n\t\t\t//console.log(\"cant pointerListenerRemove \"+oDOM+\", \"+sEvent+\", \"+fCall);\n\t\t\treturn; // -- break --\n\t\t}\n\t\tswitch(sEvent){\n\t\t\t//both pointer and move events\n\t\t\tcase \"down\": case \"up\": case \"move\": case \"over\": case \"out\": case \"enter\":\n\t\t\t{\n\t\t\t\tif (LiteGraph.pointerevents_method==\"pointer\" || LiteGraph.pointerevents_method==\"mouse\"){\n\t\t\t\t\toDOM.removeEventListener(LiteGraph.pointerevents_method+sEvent, fCall, capture);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// only pointerevents\n\t\t\tcase \"leave\": case \"cancel\": case \"gotpointercapture\": case \"lostpointercapture\":\n\t\t\t{\n\t\t\t\tif (LiteGraph.pointerevents_method==\"pointer\"){\n\t\t\t\t\treturn oDOM.removeEventListener(LiteGraph.pointerevents_method+sEvent, fCall, capture);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// not \"pointer\" || \"mouse\"\n\t\t\tdefault:\n\t\t\t\treturn oDOM.removeEventListener(sEvent, fCall, capture);\n\t\t}\n\t}\n\n    function clamp(v, a, b) {\n        return a > v ? a : b < v ? b : v;\n    };\n    global.clamp = clamp;\n\n    if (typeof window != \"undefined\" && !window[\"requestAnimationFrame\"]) {\n        window.requestAnimationFrame =\n            window.webkitRequestAnimationFrame ||\n            window.mozRequestAnimationFrame ||\n            function(callback) {\n                window.setTimeout(callback, 1000 / 60);\n            };\n    }\n})(this);\n\nif (typeof exports != \"undefined\") {\n    exports.LiteGraph = this.LiteGraph;\n    exports.LGraph = this.LGraph;\n    exports.LLink = this.LLink;\n    exports.LGraphNode = this.LGraphNode;\n    exports.LGraphGroup = this.LGraphGroup;\n    exports.DragAndScale = this.DragAndScale;\n    exports.LGraphCanvas = this.LGraphCanvas;\n    exports.ContextMenu = this.ContextMenu;\n}\n\n\n//basic nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    //Constant\r\n    function Time() {\r\n        this.addOutput(\"in ms\", \"number\");\r\n        this.addOutput(\"in sec\", \"number\");\r\n    }\r\n\r\n    Time.title = \"Time\";\r\n    Time.desc = \"Time\";\r\n\r\n    Time.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.graph.globaltime * 1000);\r\n        this.setOutputData(1, this.graph.globaltime);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/time\", Time);\r\n\r\n    //Subgraph: a node that contains a graph\r\n    function Subgraph() {\r\n        var that = this;\r\n        this.size = [140, 80];\r\n        this.properties = { enabled: true };\r\n        this.enabled = true;\r\n\r\n        //create inner graph\r\n        this.subgraph = new LiteGraph.LGraph();\r\n        this.subgraph._subgraph_node = this;\r\n        this.subgraph._is_subgraph = true;\r\n\r\n        this.subgraph.onTrigger = this.onSubgraphTrigger.bind(this);\r\n\r\n\t\t//nodes input node added inside\r\n        this.subgraph.onInputAdded = this.onSubgraphNewInput.bind(this);\r\n        this.subgraph.onInputRenamed = this.onSubgraphRenamedInput.bind(this);\r\n        this.subgraph.onInputTypeChanged = this.onSubgraphTypeChangeInput.bind(this);\r\n        this.subgraph.onInputRemoved = this.onSubgraphRemovedInput.bind(this);\r\n\r\n        this.subgraph.onOutputAdded = this.onSubgraphNewOutput.bind(this);\r\n        this.subgraph.onOutputRenamed = this.onSubgraphRenamedOutput.bind(this);\r\n        this.subgraph.onOutputTypeChanged = this.onSubgraphTypeChangeOutput.bind(this);\r\n        this.subgraph.onOutputRemoved = this.onSubgraphRemovedOutput.bind(this);\r\n    }\r\n\r\n    Subgraph.title = \"Subgraph\";\r\n    Subgraph.desc = \"Graph inside a node\";\r\n    Subgraph.title_color = \"#334\";\r\n\r\n    Subgraph.prototype.onGetInputs = function() {\r\n        return [[\"enabled\", \"boolean\"]];\r\n    };\r\n\r\n\t/*\r\n    Subgraph.prototype.onDrawTitle = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        ctx.fillStyle = \"#555\";\r\n        var w = LiteGraph.NODE_TITLE_HEIGHT;\r\n        var x = this.size[0] - w;\r\n        ctx.fillRect(x, -w, w, w);\r\n        ctx.fillStyle = \"#333\";\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + w * 0.2, -w * 0.6);\r\n        ctx.lineTo(x + w * 0.8, -w * 0.6);\r\n        ctx.lineTo(x + w * 0.5, -w * 0.3);\r\n        ctx.fill();\r\n    };\r\n\t*/\r\n\r\n    Subgraph.prototype.onDblClick = function(e, pos, graphcanvas) {\r\n        var that = this;\r\n        setTimeout(function() {\r\n            graphcanvas.openSubgraph(that.subgraph);\r\n        }, 10);\r\n    };\r\n\r\n\t/*\r\n    Subgraph.prototype.onMouseDown = function(e, pos, graphcanvas) {\r\n        if (\r\n            !this.flags.collapsed &&\r\n            pos[0] > this.size[0] - LiteGraph.NODE_TITLE_HEIGHT &&\r\n            pos[1] < 0\r\n        ) {\r\n            var that = this;\r\n            setTimeout(function() {\r\n                graphcanvas.openSubgraph(that.subgraph);\r\n            }, 10);\r\n        }\r\n    };\r\n\t*/\r\n\r\n    Subgraph.prototype.onAction = function(action, param) {\r\n        this.subgraph.onAction(action, param);\r\n    };\r\n\r\n    Subgraph.prototype.onExecute = function() {\r\n        this.enabled = this.getInputOrProperty(\"enabled\");\r\n        if (!this.enabled) {\r\n            return;\r\n        }\r\n\r\n        //send inputs to subgraph global inputs\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; i++) {\r\n                var input = this.inputs[i];\r\n                var value = this.getInputData(i);\r\n                this.subgraph.setInputData(input.name, value);\r\n            }\r\n        }\r\n\r\n        //execute\r\n        this.subgraph.runStep();\r\n\r\n        //send subgraph global outputs to outputs\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; i++) {\r\n                var output = this.outputs[i];\r\n                var value = this.subgraph.getOutputData(output.name);\r\n                this.setOutputData(i, value);\r\n            }\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.sendEventToAllNodes = function(eventname, param, mode) {\r\n        if (this.enabled) {\r\n            this.subgraph.sendEventToAllNodes(eventname, param, mode);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onDrawBackground = function (ctx, graphcanvas, canvas, pos) {\r\n        if (this.flags.collapsed)\r\n            return;\r\n        var y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n        // button\r\n        var over = LiteGraph.isInsideRectangle(pos[0], pos[1], this.pos[0], this.pos[1] + y, this.size[0], LiteGraph.NODE_TITLE_HEIGHT);\r\n        let overleft = LiteGraph.isInsideRectangle(pos[0], pos[1], this.pos[0], this.pos[1] + y, this.size[0] / 2, LiteGraph.NODE_TITLE_HEIGHT)\r\n        ctx.fillStyle = over ? \"#555\" : \"#222\";\r\n        ctx.beginPath();\r\n        if (this._shape == LiteGraph.BOX_SHAPE) {\r\n            if (overleft) {\r\n                ctx.rect(0, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT);\r\n            } else {\r\n                ctx.rect(this.size[0] / 2, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT);\r\n            }\r\n        }\r\n        else {\r\n            if (overleft) {\r\n                ctx.roundRect(0, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT, [0,0, 8,8]);\r\n            } else {\r\n                ctx.roundRect(this.size[0] / 2, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT, [0,0, 8,8]);\r\n            }\r\n        }\r\n        if (over) {\r\n            ctx.fill();\r\n        } else {\r\n            ctx.fillRect(0, y, this.size[0] + 1, LiteGraph.NODE_TITLE_HEIGHT);\r\n        }\r\n        // button\r\n        ctx.textAlign = \"center\";\r\n        ctx.font = \"24px Arial\";\r\n        ctx.fillStyle = over ? \"#DDD\" : \"#999\";\r\n        ctx.fillText(\"+\", this.size[0] * 0.25, y + 24);\r\n        ctx.fillText(\"+\", this.size[0] * 0.75, y + 24);\r\n    }\r\n\r\n    // Subgraph.prototype.onMouseDown = function(e, localpos, graphcanvas)\r\n    // {\r\n    // \tvar y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n    // \tif(localpos[1] > y)\r\n    // \t{\r\n    // \t\tgraphcanvas.showSubgraphPropertiesDialog(this);\r\n    // \t}\r\n    // }\r\n    Subgraph.prototype.onMouseDown = function (e, localpos, graphcanvas) {\r\n        var y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n        console.log(0)\r\n        if (localpos[1] > y) {\r\n            if (localpos[0] < this.size[0] / 2) {\r\n                console.log(1)\r\n                graphcanvas.showSubgraphPropertiesDialog(this);\r\n            } else {\r\n                console.log(2)\r\n                graphcanvas.showSubgraphPropertiesDialogRight(this);\r\n            }\r\n        }\r\n    }\r\n\tSubgraph.prototype.computeSize = function()\r\n\t{\r\n\t\tvar num_inputs = this.inputs ? this.inputs.length : 0;\r\n\t\tvar num_outputs = this.outputs ? this.outputs.length : 0;\r\n\t\treturn [ 200, Math.max(num_inputs,num_outputs) * LiteGraph.NODE_SLOT_HEIGHT + LiteGraph.NODE_TITLE_HEIGHT ];\r\n\t}\r\n\r\n    //**** INPUTS ***********************************\r\n    Subgraph.prototype.onSubgraphTrigger = function(event, param) {\r\n        var slot = this.findOutputSlot(event);\r\n        if (slot != -1) {\r\n            this.triggerSlot(slot);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphNewInput = function(name, type) {\r\n        var slot = this.findInputSlot(name);\r\n        if (slot == -1) {\r\n            //add input to the node\r\n            this.addInput(name, type);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRenamedInput = function(oldname, name) {\r\n        var slot = this.findInputSlot(oldname);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getInputInfo(slot);\r\n        info.name = name;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphTypeChangeInput = function(name, type) {\r\n        var slot = this.findInputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getInputInfo(slot);\r\n        info.type = type;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRemovedInput = function(name) {\r\n        var slot = this.findInputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        this.removeInput(slot);\r\n    };\r\n\r\n    //**** OUTPUTS ***********************************\r\n    Subgraph.prototype.onSubgraphNewOutput = function(name, type) {\r\n        var slot = this.findOutputSlot(name);\r\n        if (slot == -1) {\r\n            this.addOutput(name, type);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRenamedOutput = function(oldname, name) {\r\n        var slot = this.findOutputSlot(oldname);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getOutputInfo(slot);\r\n        info.name = name;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphTypeChangeOutput = function(name, type) {\r\n        var slot = this.findOutputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getOutputInfo(slot);\r\n        info.type = type;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRemovedOutput = function(name) {\r\n        var slot = this.findOutputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        this.removeOutput(slot);\r\n    };\r\n    // *****************************************************\r\n\r\n    Subgraph.prototype.getExtraMenuOptions = function(graphcanvas) {\r\n        var that = this;\r\n        return [\r\n            {\r\n                content: \"Open\",\r\n                callback: function() {\r\n                    graphcanvas.openSubgraph(that.subgraph);\r\n                }\r\n            }\r\n        ];\r\n    };\r\n\r\n    Subgraph.prototype.onResize = function(size) {\r\n        size[1] += 20;\r\n    };\r\n\r\n    Subgraph.prototype.serialize = function() {\r\n        var data = LiteGraph.LGraphNode.prototype.serialize.call(this);\r\n        data.subgraph = this.subgraph.serialize();\r\n        return data;\r\n    };\r\n    //no need to define node.configure, the default method detects node.subgraph and passes the object to node.subgraph.configure()\r\n\r\n    Subgraph.prototype.reassignSubgraphUUIDs = function(graph) {\r\n        const idMap = { nodeIDs: {}, linkIDs: {} }\r\n\r\n        for (const node of graph.nodes) {\r\n            const oldID = node.id\r\n            const newID = LiteGraph.uuidv4()\r\n            node.id = newID\r\n\r\n            if (idMap.nodeIDs[oldID] || idMap.nodeIDs[newID]) {\r\n                throw new Error(`New/old node UUID wasn't unique in changed map! ${oldID} ${newID}`)\r\n            }\r\n\r\n            idMap.nodeIDs[oldID] = newID\r\n            idMap.nodeIDs[newID] = oldID\r\n        }\r\n\r\n        for (const link of graph.links) {\r\n            const oldID = link[0]\r\n            const newID = LiteGraph.uuidv4();\r\n            link[0] = newID\r\n\r\n            if (idMap.linkIDs[oldID] || idMap.linkIDs[newID]) {\r\n                throw new Error(`New/old link UUID wasn't unique in changed map! ${oldID} ${newID}`)\r\n            }\r\n\r\n            idMap.linkIDs[oldID] = newID\r\n            idMap.linkIDs[newID] = oldID\r\n\r\n            const nodeFrom = link[1]\r\n            const nodeTo = link[3]\r\n\r\n            if (!idMap.nodeIDs[nodeFrom]) {\r\n                throw new Error(`Old node UUID not found in mapping! ${nodeFrom}`)\r\n            }\r\n\r\n            link[1] = idMap.nodeIDs[nodeFrom]\r\n\r\n            if (!idMap.nodeIDs[nodeTo]) {\r\n                throw new Error(`Old node UUID not found in mapping! ${nodeTo}`)\r\n            }\r\n\r\n            link[3] = idMap.nodeIDs[nodeTo]\r\n        }\r\n\r\n        // Reconnect links\r\n        for (const node of graph.nodes) {\r\n            if (node.inputs) {\r\n                for (const input of node.inputs) {\r\n                    if (input.link) {\r\n                        input.link = idMap.linkIDs[input.link]\r\n                    }\r\n                }\r\n            }\r\n            if (node.outputs) {\r\n                for (const output of node.outputs) {\r\n                    if (output.links) {\r\n                        output.links = output.links.map(l => idMap.linkIDs[l]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Recurse!\r\n        for (const node of graph.nodes) {\r\n            if (node.type === \"graph/subgraph\") {\r\n                const merge = reassignGraphUUIDs(node.subgraph);\r\n                idMap.nodeIDs.assign(merge.nodeIDs)\r\n                idMap.linkIDs.assign(merge.linkIDs)\r\n            }\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.clone = function() {\r\n        var node = LiteGraph.createNode(this.type);\r\n        var data = this.serialize();\r\n\r\n        if (LiteGraph.use_uuids) {\r\n            // LGraph.serialize() seems to reuse objects in the original graph. But we\r\n            // need to change node IDs here, so clone it first.\r\n            const subgraph = LiteGraph.cloneObject(data.subgraph)\r\n\r\n            this.reassignSubgraphUUIDs(subgraph);\r\n\r\n            data.subgraph = subgraph;\r\n        }\r\n\r\n        delete data[\"id\"];\r\n        delete data[\"inputs\"];\r\n        delete data[\"outputs\"];\r\n        node.configure(data);\r\n        return node;\r\n    };\r\n\r\n\tSubgraph.prototype.buildFromNodes = function(nodes)\r\n\t{\r\n\t\t//clear all?\r\n\t\t//TODO\r\n\r\n\t\t//nodes that connect data between parent graph and subgraph\r\n\t\tvar subgraph_inputs = [];\r\n\t\tvar subgraph_outputs = [];\r\n\r\n\t\t//mark inner nodes\r\n\t\tvar ids = {};\r\n\t\tvar min_x = 0;\r\n\t\tvar max_x = 0;\r\n\t\tfor(var i = 0; i < nodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar node = nodes[i];\r\n\t\t\tids[ node.id ] = node;\r\n\t\t\tmin_x = Math.min( node.pos[0], min_x );\r\n\t\t\tmax_x = Math.max( node.pos[0], min_x );\r\n\t\t}\r\n\t\t\r\n\t\tvar last_input_y = 0;\r\n\t\tvar last_output_y = 0;\r\n\r\n\t\tfor(var i = 0; i < nodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar node = nodes[i];\r\n\t\t\t//check inputs\r\n\t\t\tif( node.inputs )\r\n\t\t\t\tfor(var j = 0; j < node.inputs.length; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar input = node.inputs[j];\r\n\t\t\t\t\tif( !input || !input.link )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tvar link = node.graph.links[ input.link ];\r\n\t\t\t\t\tif(!link)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tif( ids[ link.origin_id ] )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t//this.addInput(input.name,link.type);\r\n\t\t\t\t\tthis.subgraph.addInput(input.name,link.type);\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tvar input_node = LiteGraph.createNode(\"graph/input\");\r\n\t\t\t\t\tthis.subgraph.add( input_node );\r\n\t\t\t\t\tinput_node.pos = [min_x - 200, last_input_y ];\r\n\t\t\t\t\tlast_input_y += 100;\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\r\n\t\t\t//check outputs\r\n\t\t\tif( node.outputs )\r\n\t\t\t\tfor(var j = 0; j < node.outputs.length; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar output = node.outputs[j];\r\n\t\t\t\t\tif( !output || !output.links || !output.links.length )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tvar is_external = false;\r\n\t\t\t\t\tfor(var k = 0; k < output.links.length; ++k)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar link = node.graph.links[ output.links[k] ];\r\n\t\t\t\t\t\tif(!link)\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tif( ids[ link.target_id ] )\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tis_external = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!is_external)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t//this.addOutput(output.name,output.type);\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tvar output_node = LiteGraph.createNode(\"graph/output\");\r\n\t\t\t\t\tthis.subgraph.add( output_node );\r\n\t\t\t\t\toutput_node.pos = [max_x + 50, last_output_y ];\r\n\t\t\t\t\tlast_output_y += 100;\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\t\t}\r\n\r\n\t\t//detect inputs and outputs\r\n\t\t\t//split every connection in two data_connection nodes\r\n\t\t\t//keep track of internal connections\r\n\t\t\t//connect external connections\r\n\r\n\t\t//clone nodes inside subgraph and try to reconnect them\r\n\r\n\t\t//connect edge subgraph nodes to extarnal connections nodes\r\n\t}\r\n\r\n    LiteGraph.Subgraph = Subgraph;\r\n    LiteGraph.registerNodeType(\"graph/subgraph\", Subgraph);\r\n\r\n    //Input for a subgraph\r\n    function GraphInput() {\r\n        this.addOutput(\"\", \"number\");\r\n\r\n        this.name_in_graph = \"\";\r\n        this.properties = {\r\n\t\t\tname: \"\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: 0\r\n\t\t}; \r\n\r\n        var that = this;\r\n\r\n        this.name_widget = this.addWidget(\r\n            \"text\",\r\n            \"Name\",\r\n            this.properties.name,\r\n            function(v) {\r\n                if (!v) {\r\n                    return;\r\n                }\r\n                that.setProperty(\"name\",v);\r\n            }\r\n        );\r\n        this.type_widget = this.addWidget(\r\n            \"text\",\r\n            \"Type\",\r\n            this.properties.type,\r\n            function(v) {\r\n\t\t\t\tthat.setProperty(\"type\",v);\r\n            }\r\n        );\r\n\r\n        this.value_widget = this.addWidget(\r\n            \"number\",\r\n            \"Value\",\r\n            this.properties.value,\r\n            function(v) {\r\n                that.setProperty(\"value\",v);\r\n            }\r\n        );\r\n\r\n        this.widgets_up = true;\r\n        this.size = [180, 90];\r\n    }\r\n\r\n    GraphInput.title = \"Input\";\r\n    GraphInput.desc = \"Input of the graph\";\r\n\r\n\tGraphInput.prototype.onConfigure = function()\r\n\r\n\t{\r\n\t\tthis.updateType();\r\n\t}\r\n\r\n\t//ensures the type in the node output and the type in the associated graph input are the same\r\n\tGraphInput.prototype.updateType = function()\r\n\t{\r\n\t\tvar type = this.properties.type;\r\n\t\tthis.type_widget.value = type;\r\n\r\n\t\t//update output\r\n\t\tif(this.outputs[0].type != type)\r\n\t\t{\r\n\t        if (!LiteGraph.isValidConnection(this.outputs[0].type,type))\r\n\t\t\t\tthis.disconnectOutput(0);\r\n\t\t\tthis.outputs[0].type = type;\r\n\t\t}\r\n\r\n\t\t//update widget\r\n\t\tif(type == \"number\")\r\n\t\t{\r\n\t\t\tthis.value_widget.type = \"number\";\r\n\t\t\tthis.value_widget.value = 0;\r\n\t\t}\r\n\t\telse if(type == \"boolean\")\r\n\t\t{\r\n\t\t\tthis.value_widget.type = \"toggle\";\r\n\t\t\tthis.value_widget.value = true;\r\n\t\t}\r\n\t\telse if(type == \"string\")\r\n\t\t{\r\n\t\t\tthis.value_widget.type = \"text\";\r\n\t\t\tthis.value_widget.value = \"\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.value_widget.type = null;\r\n\t\t\tthis.value_widget.value = null;\r\n\t\t}\r\n\t\tthis.properties.value = this.value_widget.value;\r\n\r\n\t\t//update graph\r\n\t\tif (this.graph && this.name_in_graph) {\r\n\t\t\tthis.graph.changeInputType(this.name_in_graph, type);\r\n\t\t}\r\n\t}\r\n\r\n\t//this is executed AFTER the property has changed\r\n\tGraphInput.prototype.onPropertyChanged = function(name,v)\r\n\t{\r\n\t\tif( name == \"name\" )\r\n\t\t{\r\n\t\t\tif (v == \"\" || v == this.name_in_graph || v == \"enabled\") {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(this.graph)\r\n\t\t\t{\r\n\t\t\t\tif (this.name_in_graph) {\r\n\t\t\t\t\t//already added\r\n\t\t\t\t\tthis.graph.renameInput( this.name_in_graph, v );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.graph.addInput( v, this.properties.type );\r\n\t\t\t\t}\r\n\t\t\t} //what if not?!\r\n\t\t\tthis.name_widget.value = v;\r\n\t\t\tthis.name_in_graph = v;\r\n\t\t}\r\n\t\telse if( name == \"type\" )\r\n\t\t{\r\n\t\t\tthis.updateType();\r\n\t\t}\r\n\t\telse if( name == \"value\" )\r\n\t\t{\r\n\t\t}\r\n\t}\r\n\r\n    GraphInput.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.name;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    GraphInput.prototype.onAction = function(action, param) {\r\n        if (this.properties.type == LiteGraph.EVENT) {\r\n            this.triggerSlot(0, param);\r\n        }\r\n    };\r\n\r\n    GraphInput.prototype.onExecute = function() {\r\n        var name = this.properties.name;\r\n        //read from global input\r\n        var data = this.graph.inputs[name];\r\n        if (!data) {\r\n            this.setOutputData(0, this.properties.value );\r\n\t\t\treturn;\r\n        }\r\n\r\n        this.setOutputData(0, data.value !== undefined ? data.value : this.properties.value );\r\n    };\r\n\r\n    GraphInput.prototype.onRemoved = function() {\r\n        if (this.name_in_graph) {\r\n            this.graph.removeInput(this.name_in_graph);\r\n        }\r\n    };\r\n\r\n    LiteGraph.GraphInput = GraphInput;\r\n    LiteGraph.registerNodeType(\"graph/input\", GraphInput);\r\n\r\n    //Output for a subgraph\r\n    function GraphOutput() {\r\n        this.addInput(\"\", \"\");\r\n\r\n        this.name_in_graph = \"\";\r\n        this.properties = { name: \"\", type: \"\" };\r\n        var that = this;\r\n\r\n        // Object.defineProperty(this.properties, \"name\", {\r\n        //     get: function() {\r\n        //         return that.name_in_graph;\r\n        //     },\r\n        //     set: function(v) {\r\n        //         if (v == \"\" || v == that.name_in_graph) {\r\n        //             return;\r\n        //         }\r\n        //         if (that.name_in_graph) {\r\n        //             //already added\r\n        //             that.graph.renameOutput(that.name_in_graph, v);\r\n        //         } else {\r\n        //             that.graph.addOutput(v, that.properties.type);\r\n        //         }\r\n        //         that.name_widget.value = v;\r\n        //         that.name_in_graph = v;\r\n        //     },\r\n        //     enumerable: true\r\n        // });\r\n\r\n        // Object.defineProperty(this.properties, \"type\", {\r\n        //     get: function() {\r\n        //         return that.inputs[0].type;\r\n        //     },\r\n        //     set: function(v) {\r\n        //         if (v == \"action\" || v == \"event\") {\r\n        //             v = LiteGraph.ACTION;\r\n        //         }\r\n\t\t//         if (!LiteGraph.isValidConnection(that.inputs[0].type,v))\r\n\t\t// \t\t\tthat.disconnectInput(0);\r\n        //         that.inputs[0].type = v;\r\n        //         if (that.name_in_graph) {\r\n        //             //already added\r\n        //             that.graph.changeOutputType(\r\n        //                 that.name_in_graph,\r\n        //                 that.inputs[0].type\r\n        //             );\r\n        //         }\r\n        //         that.type_widget.value = v || \"\";\r\n        //     },\r\n        //     enumerable: true\r\n        // });\r\n\r\n        this.name_widget = this.addWidget(\"text\",\"Name\",this.properties.name,\"name\");\r\n        this.type_widget = this.addWidget(\"text\",\"Type\",this.properties.type,\"type\");\r\n        this.widgets_up = true;\r\n        this.size = [180, 60];\r\n    }\r\n\r\n    GraphOutput.title = \"Output\";\r\n    GraphOutput.desc = \"Output of the graph\";\r\n\r\n    GraphOutput.prototype.onPropertyChanged = function (name, v) {\r\n        if (name == \"name\") {\r\n            if (v == \"\" || v == this.name_in_graph || v == \"enabled\") {\r\n                return false;\r\n            }\r\n            if (this.graph) {\r\n                if (this.name_in_graph) {\r\n                    //already added\r\n                    this.graph.renameOutput(this.name_in_graph, v);\r\n                } else {\r\n                    this.graph.addOutput(v, this.properties.type);\r\n                }\r\n            } //what if not?!\r\n            this.name_widget.value = v;\r\n            this.name_in_graph = v;\r\n        }\r\n        else if (name == \"type\") {\r\n            this.updateType();\r\n        }\r\n        else if (name == \"value\") {\r\n        }\r\n    }\r\n     \r\n    GraphOutput.prototype.updateType = function () {\r\n        var type = this.properties.type;\r\n        if (this.type_widget)\r\n            this.type_widget.value = type;\r\n\r\n        //update output\r\n        if (this.inputs[0].type != type) {\r\n\r\n\t\t\tif ( type == \"action\" || type == \"event\")\r\n\t            type = LiteGraph.EVENT;\r\n\t\t\tif (!LiteGraph.isValidConnection(this.inputs[0].type, type))\r\n\t\t\t\tthis.disconnectInput(0);\r\n\t\t\tthis.inputs[0].type = type;\r\n        }\r\n\r\n        //update graph\r\n        if (this.graph && this.name_in_graph) {\r\n            this.graph.changeOutputType(this.name_in_graph, type);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    GraphOutput.prototype.onExecute = function() {\r\n        this._value = this.getInputData(0);\r\n        this.graph.setOutputData(this.properties.name, this._value);\r\n    };\r\n\r\n    GraphOutput.prototype.onAction = function(action, param) {\r\n        if (this.properties.type == LiteGraph.ACTION) {\r\n            this.graph.trigger( this.properties.name, param );\r\n        }\r\n    };\r\n\r\n    GraphOutput.prototype.onRemoved = function() {\r\n        if (this.name_in_graph) {\r\n            this.graph.removeOutput(this.name_in_graph);\r\n        }\r\n    };\r\n\r\n    GraphOutput.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.name;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    LiteGraph.GraphOutput = GraphOutput;\r\n    LiteGraph.registerNodeType(\"graph/output\", GraphOutput);\r\n\r\n    //Constant\r\n    function ConstantNumber() {\r\n        this.addOutput(\"value\", \"number\");\r\n        this.addProperty(\"value\", 1.0);\r\n        this.widget = this.addWidget(\"number\",\"value\",1,\"value\");\r\n        this.widgets_up = true;\r\n        this.size = [180, 30];\r\n    }\r\n\r\n    ConstantNumber.title = \"Const Number\";\r\n    ConstantNumber.desc = \"Constant number\";\r\n\r\n    ConstantNumber.prototype.onExecute = function() {\r\n        this.setOutputData(0, parseFloat(this.properties[\"value\"]));\r\n    };\r\n\r\n    ConstantNumber.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.value;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n\tConstantNumber.prototype.setValue = function(v)\r\n\t{\r\n\t\tthis.setProperty(\"value\",v);\r\n\t}\r\n\r\n    ConstantNumber.prototype.onDrawBackground = function(ctx) {\r\n        //show the current value\r\n        this.outputs[0].label = this.properties[\"value\"].toFixed(3);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/const\", ConstantNumber);\r\n\r\n    function ConstantBoolean() {\r\n        this.addOutput(\"bool\", \"boolean\");\r\n        this.addProperty(\"value\", true);\r\n        this.widget = this.addWidget(\"toggle\",\"value\",true,\"value\");\r\n        this.serialize_widgets = true;\r\n        this.widgets_up = true;\r\n        this.size = [140, 30];\r\n    }\r\n\r\n    ConstantBoolean.title = \"Const Boolean\";\r\n    ConstantBoolean.desc = \"Constant boolean\";\r\n    ConstantBoolean.prototype.getTitle = ConstantNumber.prototype.getTitle;\r\n\r\n    ConstantBoolean.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.properties[\"value\"]);\r\n    };\r\n\r\n\tConstantBoolean.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n\tConstantBoolean.prototype.onGetInputs = function() {\r\n\t\treturn [[\"toggle\", LiteGraph.ACTION]];\r\n\t};\r\n\r\n\tConstantBoolean.prototype.onAction = function(action)\r\n\t{\r\n\t\tthis.setValue( !this.properties.value );\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/boolean\", ConstantBoolean);\r\n\r\n    function ConstantString() {\r\n        this.addOutput(\"string\", \"string\");\r\n        this.addProperty(\"value\", \"\");\r\n        this.widget = this.addWidget(\"text\",\"value\",\"\",\"value\");  //link to property value\r\n        this.widgets_up = true;\r\n        this.size = [180, 30];\r\n    }\r\n\r\n    ConstantString.title = \"Const String\";\r\n    ConstantString.desc = \"Constant string\";\r\n\r\n    ConstantString.prototype.getTitle = ConstantNumber.prototype.getTitle;\r\n\r\n    ConstantString.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.properties[\"value\"]);\r\n    };\r\n\r\n\tConstantString.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n\tConstantString.prototype.onDropFile = function(file)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tvar reader = new FileReader();\r\n\t\treader.onload = function(e)\r\n\t\t{\r\n\t\t\tthat.setProperty(\"value\",e.target.result);\r\n\t\t}\r\n\t\treader.readAsText(file);\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/string\", ConstantString);\r\n\r\n    function ConstantObject() {\r\n        this.addOutput(\"obj\", \"object\");\r\n        this.size = [120, 30];\r\n\t\tthis._object = {};\r\n    }\r\n\r\n    ConstantObject.title = \"Const Object\";\r\n    ConstantObject.desc = \"Constant Object\";\r\n\r\n    ConstantObject.prototype.onExecute = function() {\r\n        this.setOutputData(0, this._object);\r\n    };\r\n\r\n    LiteGraph.registerNodeType( \"basic/object\", ConstantObject );\r\n\r\n    function ConstantFile() {\r\n        this.addInput(\"url\", \"string\");\r\n        this.addOutput(\"file\", \"string\");\r\n        this.addProperty(\"url\", \"\");\r\n        this.addProperty(\"type\", \"text\");\r\n        this.widget = this.addWidget(\"text\",\"url\",\"\",\"url\");\r\n        this._data = null;\r\n    }\r\n\r\n    ConstantFile.title = \"Const File\";\r\n    ConstantFile.desc = \"Fetches a file from an url\";\r\n    ConstantFile[\"@type\"] = { type: \"enum\", values: [\"text\",\"arraybuffer\",\"blob\",\"json\"] };\r\n\r\n    ConstantFile.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"url\")\r\n\t\t{\r\n\t\t\tif( value == null || value == \"\")\r\n\t\t\t\tthis._data = null;\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.fetchFile(value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n    ConstantFile.prototype.onExecute = function() {\r\n\t\tvar url = this.getInputData(0) || this.properties.url;\r\n\t\tif(url && (url != this._url || this._type != this.properties.type))\r\n\t\t\tthis.fetchFile(url);\r\n        this.setOutputData(0, this._data );\r\n    };\r\n\r\n\tConstantFile.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n    ConstantFile.prototype.fetchFile = function(url) {\r\n\t\tvar that = this;\r\n\t\tif(!url || url.constructor !== String)\r\n\t\t{\r\n\t\t\tthat._data = null;\r\n            that.boxcolor = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._url = url;\r\n\t\tthis._type = this.properties.type;\r\n        if (url.substr(0, 4) == \"http\" && LiteGraph.proxy) {\r\n            url = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\r\n        }\r\n\t\tfetch(url)\r\n\t\t.then(function(response) {\r\n\t\t\tif(!response.ok)\r\n\t\t\t\t throw new Error(\"File not found\");\r\n\r\n\t\t\tif(that.properties.type == \"arraybuffer\")\r\n\t\t\t\treturn response.arrayBuffer();\r\n\t\t\telse if(that.properties.type == \"text\")\r\n\t\t\t\treturn response.text();\r\n\t\t\telse if(that.properties.type == \"json\")\r\n\t\t\t\treturn response.json();\r\n\t\t\telse if(that.properties.type == \"blob\")\r\n\t\t\t\treturn response.blob();\r\n\t\t})\r\n\t\t.then(function(data) {\r\n\t\t\tthat._data = data;\r\n            that.boxcolor = \"#AEA\";\r\n\t\t})\r\n\t\t.catch(function(error) {\r\n\t\t\tthat._data = null;\r\n            that.boxcolor = \"red\";\r\n\t\t\tconsole.error(\"error fetching file:\",url);\r\n\t\t});\r\n    };\r\n\r\n\tConstantFile.prototype.onDropFile = function(file)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tthis._url = file.name;\r\n\t\tthis._type = this.properties.type;\r\n\t\tthis.properties.url = file.name;\r\n\t\tvar reader = new FileReader();\r\n\t\treader.onload = function(e)\r\n\t\t{\r\n            that.boxcolor = \"#AEA\";\r\n\t\t\tvar v = e.target.result;\r\n\t\t\tif( that.properties.type == \"json\" )\r\n\t\t\t\tv = JSON.parse(v);\r\n\t\t\tthat._data = v;\r\n\t\t}\r\n\t\tif(that.properties.type == \"arraybuffer\")\r\n\t\t\treader.readAsArrayBuffer(file);\r\n\t\telse if(that.properties.type == \"text\" || that.properties.type == \"json\")\r\n\t\t\treader.readAsText(file);\r\n\t\telse if(that.properties.type == \"blob\")\r\n\t\t\treturn reader.readAsBinaryString(file);\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/file\", ConstantFile);\r\n\r\n\r\n//to store json objects\r\nfunction JSONParse() {\r\n\tthis.addInput(\"parse\", LiteGraph.ACTION);\r\n\tthis.addInput(\"json\", \"string\");\r\n\tthis.addOutput(\"done\", LiteGraph.EVENT);\r\n\tthis.addOutput(\"object\", \"object\");\r\n\tthis.widget = this.addWidget(\"button\",\"parse\",\"\",this.parse.bind(this));\r\n\tthis._str = null;\r\n\tthis._obj = null;\r\n}\r\n\r\nJSONParse.title = \"JSON Parse\";\r\nJSONParse.desc = \"Parses JSON String into object\";\r\n\r\nJSONParse.prototype.parse = function()\r\n{\r\n\tif(!this._str)\r\n\t\treturn;\r\n\r\n\ttry {\r\n\t\tthis._str = this.getInputData(1);\r\n\t\tthis._obj = JSON.parse(this._str);\r\n\t\tthis.boxcolor = \"#AEA\";\r\n\t\tthis.triggerSlot(0);\r\n\t} catch (err) {\r\n\t\tthis.boxcolor = \"red\";\r\n\t}\r\n}\r\n\r\nJSONParse.prototype.onExecute = function() {\r\n\tthis._str = this.getInputData(1);\r\n\tthis.setOutputData(1, this._obj);\r\n};\r\n\r\nJSONParse.prototype.onAction = function(name) {\r\n\tif(name == \"parse\")\r\n\t\tthis.parse();\r\n}\r\n\r\nLiteGraph.registerNodeType(\"basic/jsonparse\", JSONParse);\t\r\n\r\n\t//to store json objects\r\n    function ConstantData() {\r\n        this.addOutput(\"data\", \"object\");\r\n        this.addProperty(\"value\", \"\");\r\n        this.widget = this.addWidget(\"text\",\"json\",\"\",\"value\");\r\n        this.widgets_up = true;\r\n        this.size = [140, 30];\r\n        this._value = null;\r\n    }\r\n\r\n    ConstantData.title = \"Const Data\";\r\n    ConstantData.desc = \"Constant Data\";\r\n\r\n    ConstantData.prototype.onPropertyChanged = function(name, value) {\r\n        this.widget.value = value;\r\n        if (value == null || value == \"\") {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            this._value = JSON.parse(value);\r\n            this.boxcolor = \"#AEA\";\r\n        } catch (err) {\r\n            this.boxcolor = \"red\";\r\n        }\r\n    };\r\n\r\n    ConstantData.prototype.onExecute = function() {\r\n        this.setOutputData(0, this._value);\r\n    };\r\n\r\n\tConstantData.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n    LiteGraph.registerNodeType(\"basic/data\", ConstantData);\r\n\r\n\t//to store json objects\r\n    function ConstantArray() {\r\n\t\tthis._value = [];\r\n        this.addInput(\"json\", \"\");\r\n        this.addOutput(\"arrayOut\", \"array\");\r\n\t\tthis.addOutput(\"length\", \"number\");\r\n        this.addProperty(\"value\", \"[]\");\r\n        this.widget = this.addWidget(\"text\",\"array\",this.properties.value,\"value\");\r\n        this.widgets_up = true;\r\n        this.size = [140, 50];\r\n    }\r\n\r\n    ConstantArray.title = \"Const Array\";\r\n    ConstantArray.desc = \"Constant Array\";\r\n\r\n    ConstantArray.prototype.onPropertyChanged = function(name, value) {\r\n        this.widget.value = value;\r\n        if (value == null || value == \"\") {\r\n            return;\r\n        }\r\n\r\n        try {\r\n\t\t\tif(value[0] != \"[\")\r\n\t            this._value = JSON.parse(\"[\" + value + \"]\");\r\n\t\t\telse\r\n\t            this._value = JSON.parse(value);\r\n            this.boxcolor = \"#AEA\";\r\n        } catch (err) {\r\n            this.boxcolor = \"red\";\r\n        }\r\n    };\r\n\r\n    ConstantArray.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n\t\tif(v && v.length) //clone\r\n\t\t{\r\n\t\t\tif(!this._value)\r\n\t\t\t\tthis._value = new Array();\r\n\t\t\tthis._value.length = v.length;\r\n\t\t\tfor(var i = 0; i < v.length; ++i)\r\n\t\t\t\tthis._value[i] = v[i];\r\n\t\t}\r\n\t\tthis.setOutputData(0, this._value);\r\n\t\tthis.setOutputData(1, this._value ? ( this._value.length || 0) : 0 );\r\n    };\r\n\r\n\tConstantArray.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n    LiteGraph.registerNodeType(\"basic/array\", ConstantArray);\r\n\r\n\tfunction SetArray()\r\n\t{\r\n        this.addInput(\"arr\", \"array\");\r\n        this.addInput(\"value\", \"\");\r\n        this.addOutput(\"arr\", \"array\");\r\n\t\tthis.properties = { index: 0 };\r\n        this.widget = this.addWidget(\"number\",\"i\",this.properties.index,\"index\",{precision: 0, step: 10, min: 0});\r\n\t}\r\n\r\n    SetArray.title = \"Set Array\";\r\n    SetArray.desc = \"Sets index of array\";\r\n\r\n    SetArray.prototype.onExecute = function() {\r\n        var arr = this.getInputData(0);\r\n\t\tif(!arr)\r\n\t\t\treturn;\r\n        var v = this.getInputData(1);\r\n\t\tif(v === undefined )\r\n\t\t\treturn;\r\n\t\tif(this.properties.index)\r\n\t\t\tarr[ Math.floor(this.properties.index) ] = v;\r\n\t\tthis.setOutputData(0,arr);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/set_array\", SetArray );\r\n\r\n    function ArrayElement() {\r\n        this.addInput(\"array\", \"array,table,string\");\r\n        this.addInput(\"index\", \"number\");\r\n        this.addOutput(\"value\", \"\");\r\n\t\tthis.addProperty(\"index\",0);\r\n    }\r\n\r\n    ArrayElement.title = \"Array[i]\";\r\n    ArrayElement.desc = \"Returns an element from an array\";\r\n\r\n    ArrayElement.prototype.onExecute = function() {\r\n        var array = this.getInputData(0);\r\n        var index = this.getInputData(1);\r\n\t\tif(index == null)\r\n\t\t\tindex = this.properties.index;\r\n\t\tif(array == null || index == null )\r\n\t\t\treturn;\r\n        this.setOutputData(0, array[Math.floor(Number(index))] );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/array[]\", ArrayElement);\r\n\r\n    function TableElement() {\r\n        this.addInput(\"table\", \"table\");\r\n        this.addInput(\"row\", \"number\");\r\n        this.addInput(\"col\", \"number\");\r\n        this.addOutput(\"value\", \"\");\r\n\t\tthis.addProperty(\"row\",0);\r\n\t\tthis.addProperty(\"column\",0);\r\n    }\r\n\r\n    TableElement.title = \"Table[row][col]\";\r\n    TableElement.desc = \"Returns an element from a table\";\r\n\r\n    TableElement.prototype.onExecute = function() {\r\n        var table = this.getInputData(0);\r\n        var row = this.getInputData(1);\r\n        var col = this.getInputData(2);\r\n\t\tif(row == null)\r\n\t\t\trow = this.properties.row;\r\n\t\tif(col == null)\r\n\t\t\tcol = this.properties.column;\r\n\t\tif(table == null || row == null || col == null)\r\n\t\t\treturn;\r\n\t\tvar row = table[Math.floor(Number(row))];\r\n\t\tif(row)\r\n\t        this.setOutputData(0, row[Math.floor(Number(col))] );\r\n\t\telse\r\n\t        this.setOutputData(0, null );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/table[][]\", TableElement);\r\n\r\n    function ObjectProperty() {\r\n        this.addInput(\"obj\", \"object\");\r\n        this.addOutput(\"property\", 0);\r\n        this.addProperty(\"value\", 0);\r\n        this.widget = this.addWidget(\"text\",\"prop.\",\"\",this.setValue.bind(this) );\r\n        this.widgets_up = true;\r\n        this.size = [140, 30];\r\n        this._value = null;\r\n    }\r\n\r\n    ObjectProperty.title = \"Object property\";\r\n    ObjectProperty.desc = \"Outputs the property of an object\";\r\n\r\n    ObjectProperty.prototype.setValue = function(v) {\r\n        this.properties.value = v;\r\n        this.widget.value = v;\r\n    };\r\n\r\n    ObjectProperty.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return \"in.\" + this.properties.value;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    ObjectProperty.prototype.onPropertyChanged = function(name, value) {\r\n        this.widget.value = value;\r\n    };\r\n\r\n    ObjectProperty.prototype.onExecute = function() {\r\n        var data = this.getInputData(0);\r\n        if (data != null) {\r\n            this.setOutputData(0, data[this.properties.value]);\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/object_property\", ObjectProperty);\r\n\r\n    function ObjectKeys() {\r\n        this.addInput(\"obj\", \"\");\r\n        this.addOutput(\"keys\", \"array\");\r\n        this.size = [140, 30];\r\n    }\r\n\r\n    ObjectKeys.title = \"Object keys\";\r\n    ObjectKeys.desc = \"Outputs an array with the keys of an object\";\r\n\r\n    ObjectKeys.prototype.onExecute = function() {\r\n        var data = this.getInputData(0);\r\n        if (data != null) {\r\n            this.setOutputData(0, Object.keys(data) );\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/object_keys\", ObjectKeys);\r\n\r\n\r\n\tfunction SetObject()\r\n\t{\r\n        this.addInput(\"obj\", \"\");\r\n        this.addInput(\"value\", \"\");\r\n        this.addOutput(\"obj\", \"\");\r\n\t\tthis.properties = { property: \"\" };\r\n        this.name_widget = this.addWidget(\"text\",\"prop.\",this.properties.property,\"property\");\r\n\t}\r\n\r\n    SetObject.title = \"Set Object\";\r\n    SetObject.desc = \"Adds propertiesrty to object\";\r\n\r\n    SetObject.prototype.onExecute = function() {\r\n        var obj = this.getInputData(0);\r\n\t\tif(!obj)\r\n\t\t\treturn;\r\n        var v = this.getInputData(1);\r\n\t\tif(v === undefined )\r\n\t\t\treturn;\r\n\t\tif(this.properties.property)\r\n\t\t\tobj[ this.properties.property ] = v;\r\n\t\tthis.setOutputData(0,obj);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/set_object\", SetObject );\r\n\r\n\r\n    function MergeObjects() {\r\n        this.addInput(\"A\", \"object\");\r\n        this.addInput(\"B\", \"object\");\r\n        this.addOutput(\"out\", \"object\");\r\n\t\tthis._result = {};\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"clear\",\"\",function(){\r\n\t\t\tthat._result = {};\r\n\t\t});\r\n\t\tthis.size = this.computeSize();\r\n    }\r\n\r\n    MergeObjects.title = \"Merge Objects\";\r\n    MergeObjects.desc = \"Creates an object copying properties from others\";\r\n\r\n    MergeObjects.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        var B = this.getInputData(1);\r\n\t\tvar C = this._result;\r\n\t\tif(A)\r\n\t\t\tfor(var i in A)\r\n\t\t\t\tC[i] = A[i];\r\n\t\tif(B)\r\n\t\t\tfor(var i in B)\r\n\t\t\t\tC[i] = B[i];\r\n\t\tthis.setOutputData(0,C);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/merge_objects\", MergeObjects );\r\n\r\n    //Store as variable\r\n    function Variable() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"in\");\r\n        this.addOutput(\"out\");\r\n\t\tthis.properties = { varname: \"myname\", container: Variable.LITEGRAPH };\r\n        this.value = null;\r\n    }\r\n\r\n    Variable.title = \"Variable\";\r\n    Variable.desc = \"store/read variable value\";\r\n\r\n\tVariable.LITEGRAPH = 0; //between all graphs\r\n\tVariable.GRAPH = 1;\t//only inside this graph\r\n\tVariable.GLOBALSCOPE = 2;\t//attached to Window\r\n\r\n    Variable[\"@container\"] = { type: \"enum\", values: {\"litegraph\":Variable.LITEGRAPH, \"graph\":Variable.GRAPH,\"global\": Variable.GLOBALSCOPE} };\r\n\r\n    Variable.prototype.onExecute = function() {\r\n\t\tvar container = this.getContainer();\r\n\r\n\t\tif(this.isInputConnected(0))\r\n\t\t{\r\n\t\t\tthis.value = this.getInputData(0);\r\n\t\t\tcontainer[ this.properties.varname ] = this.value;\r\n\t\t\tthis.setOutputData(0, this.value );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData( 0, container[ this.properties.varname ] );\r\n    };\r\n\r\n\tVariable.prototype.getContainer = function()\r\n\t{\r\n\t\tswitch(this.properties.container)\r\n\t\t{\r\n\t\t\tcase Variable.GRAPH:\r\n\t\t\t\tif(this.graph)\r\n\t\t\t\t\treturn this.graph.vars;\r\n\t\t\t\treturn {};\r\n\t\t\t\tbreak;\r\n\t\t\tcase Variable.GLOBALSCOPE:\r\n\t\t\t\treturn global;\r\n\t\t\t\tbreak;\r\n\t\t\tcase Variable.LITEGRAPH:\r\n\t\t\tdefault:\r\n\t\t\t\treturn LiteGraph.Globals;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n    Variable.prototype.getTitle = function() {\r\n        return this.properties.varname;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/variable\", Variable);\r\n\r\n    function length(v) {\r\n        if(v && v.length != null)\r\n\t\t\treturn Number(v.length);\r\n\t\treturn 0;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"basic/length\",\r\n        length,\r\n        [\"\"],\r\n        \"number\"\r\n    );\r\n\r\n    function length(v) {\r\n        if(v && v.length != null)\r\n\t\t\treturn Number(v.length);\r\n\t\treturn 0;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"basic/not\",\r\n        function(a){ return !a; },\r\n        [\"\"],\r\n        \"boolean\"\r\n    );\r\n\r\n\tfunction DownloadData() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"data\", 0 );\r\n        this.addInput(\"download\", LiteGraph.ACTION );\r\n\t\tthis.properties = { filename: \"data.json\" };\r\n        this.value = null;\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"Download\",\"\", function(v){\r\n\t\t\tif(!that.value)\r\n\t\t\t\treturn;\r\n\t\t\tthat.downloadAsFile();\r\n\t\t});\r\n    }\r\n\r\n    DownloadData.title = \"Download\";\r\n    DownloadData.desc = \"Download some data\";\r\n\r\n\tDownloadData.prototype.downloadAsFile = function()\r\n\t{\r\n\t\tif(this.value == null)\r\n\t\t\treturn;\r\n\r\n\t\tvar str = null;\r\n\t\tif(this.value.constructor === String)\r\n\t\t\tstr = this.value;\r\n\t\telse\r\n\t\t\tstr = JSON.stringify(this.value);\r\n\r\n\t\tvar file = new Blob([str]);\r\n\t\tvar url = URL.createObjectURL( file );\r\n\t\tvar element = document.createElement(\"a\");\r\n\t\telement.setAttribute('href', url);\r\n\t\telement.setAttribute('download', this.properties.filename );\r\n\t\telement.style.display = 'none';\r\n\t\tdocument.body.appendChild(element);\r\n\t\telement.click();\r\n\t\tdocument.body.removeChild(element);\r\n\t\tsetTimeout( function(){ URL.revokeObjectURL( url ); }, 1000*60 ); //wait one minute to revoke url\r\n\t}\r\n\r\n    DownloadData.prototype.onAction = function(action, param) {\r\n\t\tvar that = this;\r\n\t\tsetTimeout( function(){ that.downloadAsFile(); }, 100); //deferred to avoid blocking the renderer with the popup\r\n\t}\r\n\r\n    DownloadData.prototype.onExecute = function() {\r\n        if (this.inputs[0]) {\r\n            this.value = this.getInputData(0);\r\n        }\r\n    };\r\n\r\n    DownloadData.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.filename;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/download\", DownloadData);\r\n\r\n\r\n\r\n    //Watch a value in the editor\r\n    function Watch() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"value\", 0, { label: \"\" });\r\n        this.value = 0;\r\n    }\r\n\r\n    Watch.title = \"Watch\";\r\n    Watch.desc = \"Show value of input\";\r\n\r\n    Watch.prototype.onExecute = function() {\r\n        if (this.inputs[0]) {\r\n            this.value = this.getInputData(0);\r\n        }\r\n    };\r\n\r\n    Watch.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.inputs[0].label;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    Watch.toString = function(o) {\r\n        if (o == null) {\r\n            return \"null\";\r\n        } else if (o.constructor === Number) {\r\n            return o.toFixed(3);\r\n        } else if (o.constructor === Array) {\r\n            var str = \"[\";\r\n            for (var i = 0; i < o.length; ++i) {\r\n                str += Watch.toString(o[i]) + (i + 1 != o.length ? \",\" : \"\");\r\n            }\r\n            str += \"]\";\r\n            return str;\r\n        } else {\r\n            return String(o);\r\n        }\r\n    };\r\n\r\n    Watch.prototype.onDrawBackground = function(ctx) {\r\n        //show the current value\r\n        this.inputs[0].label = Watch.toString(this.value);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/watch\", Watch);\r\n\r\n    //in case one type doesnt match other type but you want to connect them anyway\r\n    function Cast() {\r\n        this.addInput(\"in\", 0);\r\n        this.addOutput(\"out\", 0);\r\n        this.size = [40, 30];\r\n    }\r\n\r\n    Cast.title = \"Cast\";\r\n    Cast.desc = \"Allows to connect different types\";\r\n\r\n    Cast.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.getInputData(0));\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/cast\", Cast);\r\n\r\n    //Show value inside the debug console\r\n    function Console() {\r\n        this.mode = LiteGraph.ON_EVENT;\r\n        this.size = [80, 30];\r\n        this.addProperty(\"msg\", \"\");\r\n        this.addInput(\"log\", LiteGraph.EVENT);\r\n        this.addInput(\"msg\", 0);\r\n    }\r\n\r\n    Console.title = \"Console\";\r\n    Console.desc = \"Show value inside the console\";\r\n\r\n    Console.prototype.onAction = function(action, param) {\r\n        // param is the action\r\n        var msg = this.getInputData(1); //getInputDataByName(\"msg\");\r\n        //if (msg == null || typeof msg == \"undefined\") return;\r\n        if (!msg) msg = this.properties.msg;\r\n        if (!msg) msg = \"Event: \"+param; // msg is undefined if the slot is lost?\r\n        if (action == \"log\") {\r\n            console.log(msg);\r\n        } else if (action == \"warn\") {\r\n            console.warn(msg);\r\n        } else if (action == \"error\") {\r\n            console.error(msg);\r\n        }\r\n    };\r\n\r\n    Console.prototype.onExecute = function() {\r\n        var msg = this.getInputData(1); //getInputDataByName(\"msg\");\r\n        if (!msg) msg = this.properties.msg;\r\n        if (msg != null && typeof msg != \"undefined\") {\r\n            this.properties.msg = msg;\r\n            console.log(msg);\r\n        }\r\n    };\r\n\r\n    Console.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"log\", LiteGraph.ACTION],\r\n            [\"warn\", LiteGraph.ACTION],\r\n            [\"error\", LiteGraph.ACTION]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/console\", Console);\r\n\r\n    //Show value inside the debug console\r\n    function Alert() {\r\n        this.mode = LiteGraph.ON_EVENT;\r\n        this.addProperty(\"msg\", \"\");\r\n        this.addInput(\"\", LiteGraph.EVENT);\r\n        var that = this;\r\n        this.widget = this.addWidget(\"text\", \"Text\", \"\", \"msg\");\r\n        this.widgets_up = true;\r\n        this.size = [200, 30];\r\n    }\r\n\r\n    Alert.title = \"Alert\";\r\n    Alert.desc = \"Show an alert window\";\r\n    Alert.color = \"#510\";\r\n\r\n    Alert.prototype.onConfigure = function(o) {\r\n        this.widget.value = o.properties.msg;\r\n    };\r\n\r\n    Alert.prototype.onAction = function(action, param) {\r\n        var msg = this.properties.msg;\r\n        setTimeout(function() {\r\n            alert(msg);\r\n        }, 10);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/alert\", Alert);\r\n\r\n    //Execites simple code\r\n    function NodeScript() {\r\n        this.size = [60, 30];\r\n        this.addProperty(\"onExecute\", \"return A;\");\r\n        this.addInput(\"A\", 0);\r\n        this.addInput(\"B\", 0);\r\n        this.addOutput(\"out\", 0);\r\n\r\n        this._func = null;\r\n        this.data = {};\r\n    }\r\n\r\n    NodeScript.prototype.onConfigure = function(o) {\r\n        if (o.properties.onExecute && LiteGraph.allow_scripts)\r\n            this.compileCode(o.properties.onExecute);\r\n\t\telse\r\n\t\t\tconsole.warn(\"Script not compiled, LiteGraph.allow_scripts is false\");\r\n    };\r\n\r\n    NodeScript.title = \"Script\";\r\n    NodeScript.desc = \"executes a code (max 256 characters)\";\r\n\r\n    NodeScript.widgets_info = {\r\n        onExecute: { type: \"code\" }\r\n    };\r\n\r\n    NodeScript.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"onExecute\" && LiteGraph.allow_scripts)\r\n            this.compileCode(value);\r\n\t\telse\r\n\t\t\tconsole.warn(\"Script not compiled, LiteGraph.allow_scripts is false\");\r\n    };\r\n\r\n    NodeScript.prototype.compileCode = function(code) {\r\n        this._func = null;\r\n        if (code.length > 256) {\r\n            console.warn(\"Script too long, max 256 chars\");\r\n        } else {\r\n            var code_low = code.toLowerCase();\r\n            var forbidden_words = [\r\n                \"script\",\r\n                \"body\",\r\n                \"document\",\r\n                \"eval\",\r\n                \"nodescript\",\r\n                \"function\"\r\n            ]; //bad security solution\r\n            for (var i = 0; i < forbidden_words.length; ++i) {\r\n                if (code_low.indexOf(forbidden_words[i]) != -1) {\r\n                    console.warn(\"invalid script\");\r\n                    return;\r\n                }\r\n            }\r\n            try {\r\n                this._func = new Function(\"A\", \"B\", \"C\", \"DATA\", \"node\", code);\r\n            } catch (err) {\r\n                console.error(\"Error parsing script\");\r\n                console.error(err);\r\n            }\r\n        }\r\n    };\r\n\r\n    NodeScript.prototype.onExecute = function() {\r\n        if (!this._func) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            var A = this.getInputData(0);\r\n            var B = this.getInputData(1);\r\n            var C = this.getInputData(2);\r\n            this.setOutputData(0, this._func(A, B, C, this.data, this));\r\n        } catch (err) {\r\n            console.error(\"Error in script\");\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    NodeScript.prototype.onGetOutputs = function() {\r\n        return [[\"C\", \"\"]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/script\", NodeScript);\r\n    \r\n    \r\n    function GenericCompare() {\r\n        this.addInput(\"A\", 0);\r\n        this.addInput(\"B\", 0);\r\n        this.addOutput(\"true\", \"boolean\");\r\n        this.addOutput(\"false\", \"boolean\");\r\n        this.addProperty(\"A\", 1);\r\n        this.addProperty(\"B\", 1);\r\n        this.addProperty(\"OP\", \"==\", \"enum\", { values: GenericCompare.values });\r\n\t\tthis.addWidget(\"combo\",\"Op.\",this.properties.OP,{ property: \"OP\", values: GenericCompare.values } );\r\n\r\n        this.size = [80, 60];\r\n    }\r\n\r\n    GenericCompare.values = [\"==\", \"!=\"]; //[\">\", \"<\", \"==\", \"!=\", \"<=\", \">=\", \"||\", \"&&\" ];\r\n    GenericCompare[\"@OP\"] = {\r\n        type: \"enum\",\r\n        title: \"operation\",\r\n        values: GenericCompare.values\r\n    };\r\n\r\n    GenericCompare.title = \"Compare *\";\r\n    GenericCompare.desc = \"evaluates condition between A and B\";\r\n\r\n    GenericCompare.prototype.getTitle = function() {\r\n        return \"*A \" + this.properties.OP + \" *B\";\r\n    };\r\n\r\n    GenericCompare.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        if (A === undefined) {\r\n            A = this.properties.A;\r\n        } else {\r\n            this.properties.A = A;\r\n        }\r\n\r\n        var B = this.getInputData(1);\r\n        if (B === undefined) {\r\n            B = this.properties.B;\r\n        } else {\r\n            this.properties.B = B;\r\n        }\r\n\r\n        var result = false;\r\n        if (typeof A == typeof B){\r\n            switch (this.properties.OP) {\r\n                case \"==\":\r\n                case \"!=\":\r\n                    // traverse both objects.. consider that this is not a true deep check! consider underscore or other library for thath :: _isEqual()\r\n                    result = true;\r\n                    switch(typeof A){\r\n                        case \"object\":\r\n                            var aProps = Object.getOwnPropertyNames(A);\r\n                            var bProps = Object.getOwnPropertyNames(B);\r\n                            if (aProps.length != bProps.length){\r\n                                result = false;\r\n                                break;\r\n                            }\r\n                            for (var i = 0; i < aProps.length; i++) {\r\n                                var propName = aProps[i];\r\n                                if (A[propName] !== B[propName]) {\r\n                                    result = false;\r\n                                    break;\r\n                                }\r\n                            }\r\n                        break;\r\n                        default:\r\n                            result = A == B;\r\n                    }\r\n                    if (this.properties.OP == \"!=\") result = !result;\r\n                    break;\r\n                /*case \">\":\r\n                    result = A > B;\r\n                    break;\r\n                case \"<\":\r\n                    result = A < B;\r\n                    break;\r\n                case \"<=\":\r\n                    result = A <= B;\r\n                    break;\r\n                case \">=\":\r\n                    result = A >= B;\r\n                    break;\r\n                case \"||\":\r\n                    result = A || B;\r\n                    break;\r\n                case \"&&\":\r\n                    result = A && B;\r\n                    break;*/\r\n            }\r\n        }\r\n        this.setOutputData(0, result);\r\n        this.setOutputData(1, !result);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/CompareValues\", GenericCompare);\r\n    \r\n})(this);\r\n\n//event related nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    //Show value inside the debug console\r\n    function LogEvent() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"event\", LiteGraph.ACTION);\r\n    }\r\n\r\n    LogEvent.title = \"Log Event\";\r\n    LogEvent.desc = \"Log event in console\";\r\n\r\n    LogEvent.prototype.onAction = function(action, param, options) {\r\n        console.log(action, param);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/log\", LogEvent);\r\n\r\n    //convert to Event if the value is true\r\n    function TriggerEvent() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"if\", \"\");\r\n        this.addOutput(\"true\", LiteGraph.EVENT);\r\n        this.addOutput(\"change\", LiteGraph.EVENT);\r\n        this.addOutput(\"false\", LiteGraph.EVENT);\r\n\t\tthis.properties = { only_on_change: true };\r\n\t\tthis.prev = 0;\r\n    }\r\n\r\n    TriggerEvent.title = \"TriggerEvent\";\r\n    TriggerEvent.desc = \"Triggers event if input evaluates to true\";\r\n\r\n    TriggerEvent.prototype.onExecute = function( param, options) {\r\n\t\tvar v = this.getInputData(0);\r\n\t\tvar changed = (v != this.prev);\r\n\t\tif(this.prev === 0)\r\n\t\t\tchanged = false;\r\n\t\tvar must_resend = (changed && this.properties.only_on_change) || (!changed && !this.properties.only_on_change);\r\n\t\tif(v && must_resend )\r\n\t        this.triggerSlot(0, param, null, options);\r\n\t\tif(!v && must_resend)\r\n\t        this.triggerSlot(2, param, null, options);\r\n\t\tif(changed)\r\n\t        this.triggerSlot(1, param, null, options);\r\n\t\tthis.prev = v;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/trigger\", TriggerEvent);\r\n\r\n    //Sequence of events\r\n    function Sequence() {\r\n\t\tvar that = this;\r\n        this.addInput(\"\", LiteGraph.ACTION);\r\n        this.addInput(\"\", LiteGraph.ACTION);\r\n        this.addInput(\"\", LiteGraph.ACTION);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addWidget(\"button\",\"+\",null,function(){\r\n\t        that.addInput(\"\", LiteGraph.ACTION);\r\n\t        that.addOutput(\"\", LiteGraph.EVENT);\r\n        });\r\n        this.size = [90, 70];\r\n        this.flags = { horizontal: true, render_box: false };\r\n    }\r\n\r\n    Sequence.title = \"Sequence\";\r\n    Sequence.desc = \"Triggers a sequence of events when an event arrives\";\r\n\r\n    Sequence.prototype.getTitle = function() {\r\n        return \"\";\r\n    };\r\n\r\n    Sequence.prototype.onAction = function(action, param, options) {\r\n        if (this.outputs) {\r\n            options = options || {};\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n\t\t\t\tvar output = this.outputs[i];\r\n\t\t\t\t//needs more info about this...\r\n\t\t\t\tif( options.action_call ) // CREATE A NEW ID FOR THE ACTION\r\n\t                options.action_call = options.action_call + \"_seq_\" + i;\r\n\t\t\t\telse\r\n\t\t\t\t\toptions.action_call = this.id + \"_\" + (action ? action : \"action\")+\"_seq_\"+i+\"_\"+Math.floor(Math.random()*9999);\r\n                this.triggerSlot(i, param, null, options);\r\n            }\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/sequence\", Sequence);\r\n\r\n\r\n   //Sequence of events\r\n   function WaitAll() {\r\n    var that = this;\r\n    this.addInput(\"\", LiteGraph.ACTION);\r\n    this.addInput(\"\", LiteGraph.ACTION);\r\n    this.addOutput(\"\", LiteGraph.EVENT);\r\n    this.addWidget(\"button\",\"+\",null,function(){\r\n        that.addInput(\"\", LiteGraph.ACTION);\r\n        that.size[0] = 90;\r\n    });\r\n    this.size = [90, 70];\r\n    this.ready = [];\r\n}\r\n\r\nWaitAll.title = \"WaitAll\";\r\nWaitAll.desc = \"Wait until all input events arrive then triggers output\";\r\n\r\nWaitAll.prototype.getTitle = function() {\r\n    return \"\";\r\n};\r\n\r\nWaitAll.prototype.onDrawBackground = function(ctx)\r\n{\r\n    if (this.flags.collapsed) {\r\n        return;\r\n    }\r\n    for(var i = 0; i < this.inputs.length; ++i)\r\n    {\r\n        var y = i * LiteGraph.NODE_SLOT_HEIGHT + 10;\r\n        ctx.fillStyle = this.ready[i] ? \"#AFB\" : \"#000\";\r\n        ctx.fillRect(20, y, 10, 10);\r\n    }\r\n}\r\n\r\nWaitAll.prototype.onAction = function(action, param, options, slot_index) {\r\n    if(slot_index == null)\r\n        return;\r\n\r\n    //check all\r\n    this.ready.length = this.outputs.length;\r\n    this.ready[slot_index] = true;\r\n    for(var i = 0; i < this.ready.length;++i)\r\n        if(!this.ready[i])\r\n            return;\r\n    //pass\r\n    this.reset();\r\n    this.triggerSlot(0);\r\n};\r\n\r\nWaitAll.prototype.reset = function()\r\n{\r\n    this.ready.length = 0;\r\n}\r\n\r\nLiteGraph.registerNodeType(\"events/waitAll\", WaitAll);    \r\n\r\n\r\n    //Sequencer for events\r\n    function Stepper() {\r\n\t\tvar that = this;\r\n\t\tthis.properties = { index: 0 };\r\n        this.addInput(\"index\", \"number\");\r\n        this.addInput(\"step\", LiteGraph.ACTION);\r\n        this.addInput(\"reset\", LiteGraph.ACTION);\r\n        this.addOutput(\"index\", \"number\");\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT,{removable:true});\r\n        this.addWidget(\"button\",\"+\",null,function(){\r\n\t        that.addOutput(\"\", LiteGraph.EVENT, {removable:true});\r\n        });\r\n        this.size = [120, 120];\r\n        this.flags = { render_box: false };\r\n    }\r\n\r\n    Stepper.title = \"Stepper\";\r\n    Stepper.desc = \"Trigger events sequentially when an tick arrives\";\r\n\r\n\tStepper.prototype.onDrawBackground = function(ctx)\r\n\t{\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\t\tvar index = this.properties.index || 0;\r\n        ctx.fillStyle = \"#AFB\";\r\n\t\tvar w = this.size[0];\r\n        var y = (index + 1)* LiteGraph.NODE_SLOT_HEIGHT + 4;\r\n        ctx.beginPath();\r\n        ctx.moveTo(w - 30, y);\r\n        ctx.lineTo(w - 30, y + LiteGraph.NODE_SLOT_HEIGHT);\r\n        ctx.lineTo(w - 15, y + LiteGraph.NODE_SLOT_HEIGHT * 0.5);\r\n        ctx.fill();\r\n\t}\r\n\r\n\tStepper.prototype.onExecute = function()\r\n\t{\r\n\t\tvar index = this.getInputData(0);\r\n\t\tif(index != null)\r\n\t\t{\r\n\t\t\tindex = Math.floor(index);\r\n\t\t\tindex = clamp( index, 0, this.outputs ? (this.outputs.length - 2) : 0 );\r\n\t\t\tif( index != this.properties.index )\r\n\t\t\t{\r\n\t\t\t\tthis.properties.index = index;\r\n\t\t\t    this.triggerSlot( index+1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0, this.properties.index );\r\n\t}\r\n\r\n    Stepper.prototype.onAction = function(action, param) {\r\n\t\tif(action == \"reset\")\r\n\t\t\tthis.properties.index = 0;\r\n\t\telse if(action == \"step\")\r\n\t\t{\r\n            this.triggerSlot(this.properties.index+1, param);\r\n\t\t\tvar n = this.outputs ? this.outputs.length - 1 : 0;\r\n\t\t\tthis.properties.index = (this.properties.index + 1) % n;\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/stepper\", Stepper);\r\n\r\n    //Filter events\r\n    function FilterEvent() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"event\", LiteGraph.ACTION);\r\n        this.addOutput(\"event\", LiteGraph.EVENT);\r\n        this.properties = {\r\n            equal_to: \"\",\r\n            has_property: \"\",\r\n            property_equal_to: \"\"\r\n        };\r\n    }\r\n\r\n    FilterEvent.title = \"Filter Event\";\r\n    FilterEvent.desc = \"Blocks events that do not match the filter\";\r\n\r\n    FilterEvent.prototype.onAction = function(action, param, options) {\r\n        if (param == null) {\r\n            return;\r\n        }\r\n\r\n        if (this.properties.equal_to && this.properties.equal_to != param) {\r\n            return;\r\n        }\r\n\r\n        if (this.properties.has_property) {\r\n            var prop = param[this.properties.has_property];\r\n            if (prop == null) {\r\n                return;\r\n            }\r\n\r\n            if (\r\n                this.properties.property_equal_to &&\r\n                this.properties.property_equal_to != prop\r\n            ) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.triggerSlot(0, param, null, options);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/filter\", FilterEvent);\r\n\r\n\r\n    function EventBranch() {\r\n        this.addInput(\"in\", LiteGraph.ACTION);\r\n        this.addInput(\"cond\", \"boolean\");\r\n        this.addOutput(\"true\", LiteGraph.EVENT);\r\n        this.addOutput(\"false\", LiteGraph.EVENT);\r\n        this.size = [120, 60];\r\n\t\tthis._value = false;\r\n    }\r\n\r\n    EventBranch.title = \"Branch\";\r\n    EventBranch.desc = \"If condition is true, outputs triggers true, otherwise false\";\r\n\r\n    EventBranch.prototype.onExecute = function() {\r\n\t\tthis._value = this.getInputData(1);\r\n\t}\r\n\r\n    EventBranch.prototype.onAction = function(action, param, options) {\r\n        this._value = this.getInputData(1);\r\n\t\tthis.triggerSlot(this._value ? 0 : 1, param, null, options);\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"events/branch\", EventBranch);\r\n\r\n    //Show value inside the debug console\r\n    function EventCounter() {\r\n        this.addInput(\"inc\", LiteGraph.ACTION);\r\n        this.addInput(\"dec\", LiteGraph.ACTION);\r\n        this.addInput(\"reset\", LiteGraph.ACTION);\r\n        this.addOutput(\"change\", LiteGraph.EVENT);\r\n        this.addOutput(\"num\", \"number\");\r\n        this.addProperty(\"doCountExecution\", false, \"boolean\", {name: \"Count Executions\"});\r\n        this.addWidget(\"toggle\",\"Count Exec.\",this.properties.doCountExecution,\"doCountExecution\");\r\n        this.num = 0;\r\n    }\r\n\r\n    EventCounter.title = \"Counter\";\r\n    EventCounter.desc = \"Counts events\";\r\n\r\n    EventCounter.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return String(this.num);\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    EventCounter.prototype.onAction = function(action, param, options) {\r\n        var v = this.num;\r\n        if (action == \"inc\") {\r\n            this.num += 1;\r\n        } else if (action == \"dec\") {\r\n            this.num -= 1;\r\n        } else if (action == \"reset\") {\r\n            this.num = 0;\r\n        }\r\n        if (this.num != v) {\r\n            this.trigger(\"change\", this.num);\r\n        }\r\n    };\r\n\r\n    EventCounter.prototype.onDrawBackground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n        ctx.fillStyle = \"#AAA\";\r\n        ctx.font = \"20px Arial\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(this.num, this.size[0] * 0.5, this.size[1] * 0.5);\r\n    };\r\n\r\n    EventCounter.prototype.onExecute = function() {\r\n        if(this.properties.doCountExecution){\r\n            this.num += 1;\r\n        }\r\n        this.setOutputData(1, this.num);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/counter\", EventCounter);\r\n\r\n    //Show value inside the debug console\r\n    function DelayEvent() {\r\n        this.size = [60, 30];\r\n        this.addProperty(\"time_in_ms\", 1000);\r\n        this.addInput(\"event\", LiteGraph.ACTION);\r\n        this.addOutput(\"on_time\", LiteGraph.EVENT);\r\n\r\n        this._pending = [];\r\n    }\r\n\r\n    DelayEvent.title = \"Delay\";\r\n    DelayEvent.desc = \"Delays one event\";\r\n\r\n    DelayEvent.prototype.onAction = function(action, param, options) {\r\n        var time = this.properties.time_in_ms;\r\n        if (time <= 0) {\r\n            this.trigger(null, param, options);\r\n        } else {\r\n            this._pending.push([time, param]);\r\n        }\r\n    };\r\n\r\n    DelayEvent.prototype.onExecute = function(param, options) {\r\n        var dt = this.graph.elapsed_time * 1000; //in ms\r\n\r\n        if (this.isInputConnected(1)) {\r\n            this.properties.time_in_ms = this.getInputData(1);\r\n        }\r\n\r\n        for (var i = 0; i < this._pending.length; ++i) {\r\n            var actionPass = this._pending[i];\r\n            actionPass[0] -= dt;\r\n            if (actionPass[0] > 0) {\r\n                continue;\r\n            }\r\n\r\n            //remove\r\n            this._pending.splice(i, 1);\r\n            --i;\r\n\r\n            //trigger\r\n            this.trigger(null, actionPass[1], options);\r\n        }\r\n    };\r\n\r\n    DelayEvent.prototype.onGetInputs = function() {\r\n        return [[\"event\", LiteGraph.ACTION], [\"time_in_ms\", \"number\"]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/delay\", DelayEvent);\r\n\r\n    //Show value inside the debug console\r\n    function TimerEvent() {\r\n        this.addProperty(\"interval\", 1000);\r\n        this.addProperty(\"event\", \"tick\");\r\n        this.addOutput(\"on_tick\", LiteGraph.EVENT);\r\n        this.time = 0;\r\n        this.last_interval = 1000;\r\n        this.triggered = false;\r\n    }\r\n\r\n    TimerEvent.title = \"Timer\";\r\n    TimerEvent.desc = \"Sends an event every N milliseconds\";\r\n\r\n    TimerEvent.prototype.onStart = function() {\r\n        this.time = 0;\r\n    };\r\n\r\n    TimerEvent.prototype.getTitle = function() {\r\n        return \"Timer: \" + this.last_interval.toString() + \"ms\";\r\n    };\r\n\r\n    TimerEvent.on_color = \"#AAA\";\r\n    TimerEvent.off_color = \"#222\";\r\n\r\n    TimerEvent.prototype.onDrawBackground = function() {\r\n        this.boxcolor = this.triggered\r\n            ? TimerEvent.on_color\r\n            : TimerEvent.off_color;\r\n        this.triggered = false;\r\n    };\r\n\r\n    TimerEvent.prototype.onExecute = function() {\r\n        var dt = this.graph.elapsed_time * 1000; //in ms\r\n\r\n        var trigger = this.time == 0;\r\n\r\n        this.time += dt;\r\n        this.last_interval = Math.max(\r\n            1,\r\n            this.getInputOrProperty(\"interval\") | 0\r\n        );\r\n\r\n        if (\r\n            !trigger &&\r\n            (this.time < this.last_interval || isNaN(this.last_interval))\r\n        ) {\r\n            if (this.inputs && this.inputs.length > 1 && this.inputs[1]) {\r\n                this.setOutputData(1, false);\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.triggered = true;\r\n        this.time = this.time % this.last_interval;\r\n        this.trigger(\"on_tick\", this.properties.event);\r\n        if (this.inputs && this.inputs.length > 1 && this.inputs[1]) {\r\n            this.setOutputData(1, true);\r\n        }\r\n    };\r\n\r\n    TimerEvent.prototype.onGetInputs = function() {\r\n        return [[\"interval\", \"number\"]];\r\n    };\r\n\r\n    TimerEvent.prototype.onGetOutputs = function() {\r\n        return [[\"tick\", \"boolean\"]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/timer\", TimerEvent);\r\n\r\n\r\n\r\n    function SemaphoreEvent() {\r\n        this.addInput(\"go\", LiteGraph.ACTION );\r\n        this.addInput(\"green\", LiteGraph.ACTION );\r\n        this.addInput(\"red\", LiteGraph.ACTION );\r\n        this.addOutput(\"continue\", LiteGraph.EVENT );\r\n        this.addOutput(\"blocked\", LiteGraph.EVENT );\r\n        this.addOutput(\"is_green\", \"boolean\" );\r\n\t\tthis._ready = false;\r\n\t\tthis.properties = {};\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"reset\",\"\",function(){\r\n\t\t\tthat._ready = false;\r\n\t\t});\r\n    }\r\n\r\n    SemaphoreEvent.title = \"Semaphore Event\";\r\n    SemaphoreEvent.desc = \"Until both events are not triggered, it doesnt continue.\";\r\n\r\n\tSemaphoreEvent.prototype.onExecute = function()\r\n\t{\r\n\t\tthis.setOutputData(1,this._ready);\r\n\t\tthis.boxcolor = this._ready ? \"#9F9\" : \"#FA5\";\r\n\t}\r\n\r\n    SemaphoreEvent.prototype.onAction = function(action, param) {\r\n\t\tif( action == \"go\" )\r\n\t\t\tthis.triggerSlot( this._ready ? 0 : 1 );\r\n\t\telse if( action == \"green\" )\r\n\t\t\tthis._ready = true;\r\n\t\telse if( action == \"red\" )\r\n\t\t\tthis._ready = false;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/semaphore\", SemaphoreEvent);\r\n\r\n    function OnceEvent() {\r\n        this.addInput(\"in\", LiteGraph.ACTION );\r\n        this.addInput(\"reset\", LiteGraph.ACTION );\r\n        this.addOutput(\"out\", LiteGraph.EVENT );\r\n\t\tthis._once = false;\r\n\t\tthis.properties = {};\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"reset\",\"\",function(){\r\n\t\t\tthat._once = false;\r\n\t\t});\r\n    }\r\n\r\n    OnceEvent.title = \"Once\";\r\n    OnceEvent.desc = \"Only passes an event once, then gets locked\";\r\n\r\n    OnceEvent.prototype.onAction = function(action, param) {\r\n\t\tif( action == \"in\" && !this._once )\r\n\t\t{\r\n\t\t\tthis._once = true;\r\n\t\t\tthis.triggerSlot( 0, param );\r\n\t\t}\r\n\t\telse if( action == \"reset\" )\r\n\t\t\tthis._once = false;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/once\", OnceEvent);\r\n\r\n    function DataStore() {\r\n        this.addInput(\"data\", 0);\r\n        this.addInput(\"assign\", LiteGraph.ACTION);\r\n        this.addOutput(\"data\", 0);\r\n\t\tthis._last_value = null;\r\n\t\tthis.properties = { data: null, serialize: true };\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"store\",\"\",function(){\r\n\t\t\tthat.properties.data = that._last_value;\r\n\t\t});\r\n    }\r\n\r\n    DataStore.title = \"Data Store\";\r\n    DataStore.desc = \"Stores data and only changes when event is received\";\r\n\r\n\tDataStore.prototype.onExecute = function()\r\n\t{\r\n\t\tthis._last_value = this.getInputData(0);\r\n\t\tthis.setOutputData(0, this.properties.data );\r\n\t}\r\n\r\n    DataStore.prototype.onAction = function(action, param, options) {\r\n\t\tthis.properties.data = this._last_value;\r\n    };\r\n\r\n\tDataStore.prototype.onSerialize = function(o)\r\n\t{\r\n\t\tif(o.data == null)\r\n\t\t\treturn;\r\n\t\tif(this.properties.serialize == false || (o.data.constructor !== String && o.data.constructor !== Number && o.data.constructor !== Boolean && o.data.constructor !== Array && o.data.constructor !== Object ))\r\n\t\t\to.data = null;\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/data_store\", DataStore);\r\n\r\n\r\n\r\n})(this);\r\n\n//widgets\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    /* Button ****************/\n\n    function WidgetButton() {\n        this.addOutput(\"\", LiteGraph.EVENT);\n        this.addOutput(\"\", \"boolean\");\n        this.addProperty(\"text\", \"click me\");\n        this.addProperty(\"font_size\", 30);\n        this.addProperty(\"message\", \"\");\n        this.size = [164, 84];\n        this.clicked = false;\n    }\n\n    WidgetButton.title = \"Button\";\n    WidgetButton.desc = \"Triggers an event\";\n\n    WidgetButton.font = \"Arial\";\n    WidgetButton.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        var margin = 10;\n        ctx.fillStyle = \"black\";\n        ctx.fillRect(\n            margin + 1,\n            margin + 1,\n            this.size[0] - margin * 2,\n            this.size[1] - margin * 2\n        );\n        ctx.fillStyle = \"#AAF\";\n        ctx.fillRect(\n            margin - 1,\n            margin - 1,\n            this.size[0] - margin * 2,\n            this.size[1] - margin * 2\n        );\n        ctx.fillStyle = this.clicked\n            ? \"white\"\n            : this.mouseOver\n            ? \"#668\"\n            : \"#334\";\n        ctx.fillRect(\n            margin,\n            margin,\n            this.size[0] - margin * 2,\n            this.size[1] - margin * 2\n        );\n\n        if (this.properties.text || this.properties.text === 0) {\n            var font_size = this.properties.font_size || 30;\n            ctx.textAlign = \"center\";\n            ctx.fillStyle = this.clicked ? \"black\" : \"white\";\n            ctx.font = font_size + \"px \" + WidgetButton.font;\n            ctx.fillText(\n                this.properties.text,\n                this.size[0] * 0.5,\n                this.size[1] * 0.5 + font_size * 0.3\n            );\n            ctx.textAlign = \"left\";\n        }\n    };\n\n    WidgetButton.prototype.onMouseDown = function(e, local_pos) {\n        if (\n            local_pos[0] > 1 &&\n            local_pos[1] > 1 &&\n            local_pos[0] < this.size[0] - 2 &&\n            local_pos[1] < this.size[1] - 2\n        ) {\n            this.clicked = true;\n            this.setOutputData(1, this.clicked);\n            this.triggerSlot(0, this.properties.message);\n            return true;\n        }\n    };\n\n    WidgetButton.prototype.onExecute = function() {\n        this.setOutputData(1, this.clicked);\n    };\n\n    WidgetButton.prototype.onMouseUp = function(e) {\n        this.clicked = false;\n    };\n\n    LiteGraph.registerNodeType(\"widget/button\", WidgetButton);\n\n    function WidgetToggle() {\n        this.addInput(\"\", \"boolean\");\n        this.addInput(\"e\", LiteGraph.ACTION);\n        this.addOutput(\"v\", \"boolean\");\n        this.addOutput(\"e\", LiteGraph.EVENT);\n        this.properties = { font: \"\", value: false };\n        this.size = [160, 44];\n    }\n\n    WidgetToggle.title = \"Toggle\";\n    WidgetToggle.desc = \"Toggles between true or false\";\n\n    WidgetToggle.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        var size = this.size[1] * 0.5;\n        var margin = 0.25;\n        var h = this.size[1] * 0.8;\n        ctx.font = this.properties.font || (size * 0.8).toFixed(0) + \"px Arial\";\n        var w = ctx.measureText(this.title).width;\n        var x = (this.size[0] - (w + size)) * 0.5;\n\n        ctx.fillStyle = \"#AAA\";\n        ctx.fillRect(x, h - size, size, size);\n\n        ctx.fillStyle = this.properties.value ? \"#AEF\" : \"#000\";\n        ctx.fillRect(\n            x + size * margin,\n            h - size + size * margin,\n            size * (1 - margin * 2),\n            size * (1 - margin * 2)\n        );\n\n        ctx.textAlign = \"left\";\n        ctx.fillStyle = \"#AAA\";\n        ctx.fillText(this.title, size * 1.2 + x, h * 0.85);\n        ctx.textAlign = \"left\";\n    };\n\n    WidgetToggle.prototype.onAction = function(action) {\n        this.properties.value = !this.properties.value;\n        this.trigger(\"e\", this.properties.value);\n    };\n\n    WidgetToggle.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v != null) {\n            this.properties.value = v;\n        }\n        this.setOutputData(0, this.properties.value);\n    };\n\n    WidgetToggle.prototype.onMouseDown = function(e, local_pos) {\n        if (\n            local_pos[0] > 1 &&\n            local_pos[1] > 1 &&\n            local_pos[0] < this.size[0] - 2 &&\n            local_pos[1] < this.size[1] - 2\n        ) {\n            this.properties.value = !this.properties.value;\n            this.graph._version++;\n            this.trigger(\"e\", this.properties.value);\n            return true;\n        }\n    };\n\n    LiteGraph.registerNodeType(\"widget/toggle\", WidgetToggle);\n\n    /* Number ****************/\n\n    function WidgetNumber() {\n        this.addOutput(\"\", \"number\");\n        this.size = [80, 60];\n        this.properties = { min: -1000, max: 1000, value: 1, step: 1 };\n        this.old_y = -1;\n        this._remainder = 0;\n        this._precision = 0;\n        this.mouse_captured = false;\n    }\n\n    WidgetNumber.title = \"Number\";\n    WidgetNumber.desc = \"Widget to select number value\";\n\n    WidgetNumber.pixels_threshold = 10;\n    WidgetNumber.markers_color = \"#666\";\n\n    WidgetNumber.prototype.onDrawForeground = function(ctx) {\n        var x = this.size[0] * 0.5;\n        var h = this.size[1];\n        if (h > 30) {\n            ctx.fillStyle = WidgetNumber.markers_color;\n            ctx.beginPath();\n            ctx.moveTo(x, h * 0.1);\n            ctx.lineTo(x + h * 0.1, h * 0.2);\n            ctx.lineTo(x + h * -0.1, h * 0.2);\n            ctx.fill();\n            ctx.beginPath();\n            ctx.moveTo(x, h * 0.9);\n            ctx.lineTo(x + h * 0.1, h * 0.8);\n            ctx.lineTo(x + h * -0.1, h * 0.8);\n            ctx.fill();\n            ctx.font = (h * 0.7).toFixed(1) + \"px Arial\";\n        } else {\n            ctx.font = (h * 0.8).toFixed(1) + \"px Arial\";\n        }\n\n        ctx.textAlign = \"center\";\n        ctx.font = (h * 0.7).toFixed(1) + \"px Arial\";\n        ctx.fillStyle = \"#EEE\";\n        ctx.fillText(\n            this.properties.value.toFixed(this._precision),\n            x,\n            h * 0.75\n        );\n    };\n\n    WidgetNumber.prototype.onExecute = function() {\n        this.setOutputData(0, this.properties.value);\n    };\n\n    WidgetNumber.prototype.onPropertyChanged = function(name, value) {\n        var t = (this.properties.step + \"\").split(\".\");\n        this._precision = t.length > 1 ? t[1].length : 0;\n    };\n\n    WidgetNumber.prototype.onMouseDown = function(e, pos) {\n        if (pos[1] < 0) {\n            return;\n        }\n\n        this.old_y = e.canvasY;\n        this.captureInput(true);\n        this.mouse_captured = true;\n\n        return true;\n    };\n\n    WidgetNumber.prototype.onMouseMove = function(e) {\n        if (!this.mouse_captured) {\n            return;\n        }\n\n        var delta = this.old_y - e.canvasY;\n        if (e.shiftKey) {\n            delta *= 10;\n        }\n        if (e.metaKey || e.altKey) {\n            delta *= 0.1;\n        }\n        this.old_y = e.canvasY;\n\n        var steps = this._remainder + delta / WidgetNumber.pixels_threshold;\n        this._remainder = steps % 1;\n        steps = steps | 0;\n\n        var v = clamp(\n            this.properties.value + steps * this.properties.step,\n            this.properties.min,\n            this.properties.max\n        );\n        this.properties.value = v;\n        this.graph._version++;\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetNumber.prototype.onMouseUp = function(e, pos) {\n        if (e.click_time < 200) {\n            var steps = pos[1] > this.size[1] * 0.5 ? -1 : 1;\n            this.properties.value = clamp(\n                this.properties.value + steps * this.properties.step,\n                this.properties.min,\n                this.properties.max\n            );\n            this.graph._version++;\n            this.setDirtyCanvas(true);\n        }\n\n        if (this.mouse_captured) {\n            this.mouse_captured = false;\n            this.captureInput(false);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"widget/number\", WidgetNumber);\n\n\n    /* Combo ****************/\n\n    function WidgetCombo() {\n        this.addOutput(\"\", \"string\");\n        this.addOutput(\"change\", LiteGraph.EVENT);\n        this.size = [80, 60];\n        this.properties = { value: \"A\", values:\"A;B;C\" };\n        this.old_y = -1;\n        this.mouse_captured = false;\n\t\tthis._values = this.properties.values.split(\";\");\n\t\tvar that = this;\n        this.widgets_up = true;\n\t\tthis.widget = this.addWidget(\"combo\",\"\", this.properties.value, function(v){\n\t\t\tthat.properties.value = v;\n            that.triggerSlot(1, v);\n\t\t}, { property: \"value\", values: this._values } );\n    }\n\n    WidgetCombo.title = \"Combo\";\n    WidgetCombo.desc = \"Widget to select from a list\";\n\n    WidgetCombo.prototype.onExecute = function() {\n        this.setOutputData( 0, this.properties.value );\n    };\n\n    WidgetCombo.prototype.onPropertyChanged = function(name, value) {\n\t\tif(name == \"values\")\n\t\t{\n\t\t\tthis._values = value.split(\";\");\n\t\t\tthis.widget.options.values = this._values;\n\t\t}\n\t\telse if(name == \"value\")\n\t\t{\n\t\t\tthis.widget.value = value;\n\t\t}\n\t};\n\n    LiteGraph.registerNodeType(\"widget/combo\", WidgetCombo);\n\n\n    /* Knob ****************/\n\n    function WidgetKnob() {\n        this.addOutput(\"\", \"number\");\n        this.size = [64, 84];\n        this.properties = {\n            min: 0,\n            max: 1,\n            value: 0.5,\n            color: \"#7AF\",\n            precision: 2\n        };\n        this.value = -1;\n    }\n\n    WidgetKnob.title = \"Knob\";\n    WidgetKnob.desc = \"Circular controller\";\n    WidgetKnob.size = [80, 100];\n\n    WidgetKnob.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        if (this.value == -1) {\n            this.value =\n                (this.properties.value - this.properties.min) /\n                (this.properties.max - this.properties.min);\n        }\n\n        var center_x = this.size[0] * 0.5;\n        var center_y = this.size[1] * 0.5;\n        var radius = Math.min(this.size[0], this.size[1]) * 0.5 - 5;\n        var w = Math.floor(radius * 0.05);\n\n        ctx.globalAlpha = 1;\n        ctx.save();\n        ctx.translate(center_x, center_y);\n        ctx.rotate(Math.PI * 0.75);\n\n        //bg\n        ctx.fillStyle = \"rgba(0,0,0,0.5)\";\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.arc(0, 0, radius, 0, Math.PI * 1.5);\n        ctx.fill();\n\n        //value\n        ctx.strokeStyle = \"black\";\n        ctx.fillStyle = this.properties.color;\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.arc(\n            0,\n            0,\n            radius - 4,\n            0,\n            Math.PI * 1.5 * Math.max(0.01, this.value)\n        );\n        ctx.closePath();\n        ctx.fill();\n        //ctx.stroke();\n        ctx.lineWidth = 1;\n        ctx.globalAlpha = 1;\n        ctx.restore();\n\n        //inner\n        ctx.fillStyle = \"black\";\n        ctx.beginPath();\n        ctx.arc(center_x, center_y, radius * 0.75, 0, Math.PI * 2, true);\n        ctx.fill();\n\n        //miniball\n        ctx.fillStyle = this.mouseOver ? \"white\" : this.properties.color;\n        ctx.beginPath();\n        var angle = this.value * Math.PI * 1.5 + Math.PI * 0.75;\n        ctx.arc(\n            center_x + Math.cos(angle) * radius * 0.65,\n            center_y + Math.sin(angle) * radius * 0.65,\n            radius * 0.05,\n            0,\n            Math.PI * 2,\n            true\n        );\n        ctx.fill();\n\n        //text\n        ctx.fillStyle = this.mouseOver ? \"white\" : \"#AAA\";\n        ctx.font = Math.floor(radius * 0.5) + \"px Arial\";\n        ctx.textAlign = \"center\";\n        ctx.fillText(\n            this.properties.value.toFixed(this.properties.precision),\n            center_x,\n            center_y + radius * 0.15\n        );\n    };\n\n    WidgetKnob.prototype.onExecute = function() {\n        this.setOutputData(0, this.properties.value);\n        this.boxcolor = LiteGraph.colorToString([\n            this.value,\n            this.value,\n            this.value\n        ]);\n    };\n\n    WidgetKnob.prototype.onMouseDown = function(e) {\n        this.center = [this.size[0] * 0.5, this.size[1] * 0.5 + 20];\n        this.radius = this.size[0] * 0.5;\n        if (\n            e.canvasY - this.pos[1] < 20 ||\n            LiteGraph.distance(\n                [e.canvasX, e.canvasY],\n                [this.pos[0] + this.center[0], this.pos[1] + this.center[1]]\n            ) > this.radius\n        ) {\n            return false;\n        }\n        this.oldmouse = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n        this.captureInput(true);\n        return true;\n    };\n\n    WidgetKnob.prototype.onMouseMove = function(e) {\n        if (!this.oldmouse) {\n            return;\n        }\n\n        var m = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n\n        var v = this.value;\n        v -= (m[1] - this.oldmouse[1]) * 0.01;\n        if (v > 1.0) {\n            v = 1.0;\n        } else if (v < 0.0) {\n            v = 0.0;\n        }\n        this.value = v;\n        this.properties.value =\n            this.properties.min +\n            (this.properties.max - this.properties.min) * this.value;\n        this.oldmouse = m;\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetKnob.prototype.onMouseUp = function(e) {\n        if (this.oldmouse) {\n            this.oldmouse = null;\n            this.captureInput(false);\n        }\n    };\n\n    WidgetKnob.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"min\" || name == \"max\" || name == \"value\") {\n            this.properties[name] = parseFloat(value);\n            return true; //block\n        }\n    };\n\n    LiteGraph.registerNodeType(\"widget/knob\", WidgetKnob);\n\n    //Show value inside the debug console\n    function WidgetSliderGUI() {\n        this.addOutput(\"\", \"number\");\n        this.properties = {\n            value: 0.5,\n            min: 0,\n            max: 1,\n            text: \"V\"\n        };\n        var that = this;\n        this.size = [140, 40];\n        this.slider = this.addWidget(\n            \"slider\",\n            \"V\",\n            this.properties.value,\n            function(v) {\n                that.properties.value = v;\n            },\n            this.properties\n        );\n        this.widgets_up = true;\n    }\n\n    WidgetSliderGUI.title = \"Inner Slider\";\n\n    WidgetSliderGUI.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"value\") {\n            this.slider.value = value;\n        }\n    };\n\n    WidgetSliderGUI.prototype.onExecute = function() {\n        this.setOutputData(0, this.properties.value);\n    };\n\n    LiteGraph.registerNodeType(\"widget/internal_slider\", WidgetSliderGUI);\n\n    //Widget H SLIDER\n    function WidgetHSlider() {\n        this.size = [160, 26];\n        this.addOutput(\"\", \"number\");\n        this.properties = { color: \"#7AF\", min: 0, max: 1, value: 0.5 };\n        this.value = -1;\n    }\n\n    WidgetHSlider.title = \"H.Slider\";\n    WidgetHSlider.desc = \"Linear slider controller\";\n\n    WidgetHSlider.prototype.onDrawForeground = function(ctx) {\n        if (this.value == -1) {\n            this.value =\n                (this.properties.value - this.properties.min) /\n                (this.properties.max - this.properties.min);\n        }\n\n        //border\n        ctx.globalAlpha = 1;\n        ctx.lineWidth = 1;\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(2, 2, this.size[0] - 4, this.size[1] - 4);\n\n        ctx.fillStyle = this.properties.color;\n        ctx.beginPath();\n        ctx.rect(4, 4, (this.size[0] - 8) * this.value, this.size[1] - 8);\n        ctx.fill();\n    };\n\n    WidgetHSlider.prototype.onExecute = function() {\n        this.properties.value =\n            this.properties.min +\n            (this.properties.max - this.properties.min) * this.value;\n        this.setOutputData(0, this.properties.value);\n        this.boxcolor = LiteGraph.colorToString([\n            this.value,\n            this.value,\n            this.value\n        ]);\n    };\n\n    WidgetHSlider.prototype.onMouseDown = function(e) {\n        if (e.canvasY - this.pos[1] < 0) {\n            return false;\n        }\n\n        this.oldmouse = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n        this.captureInput(true);\n        return true;\n    };\n\n    WidgetHSlider.prototype.onMouseMove = function(e) {\n        if (!this.oldmouse) {\n            return;\n        }\n\n        var m = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n\n        var v = this.value;\n        var delta = m[0] - this.oldmouse[0];\n        v += delta / this.size[0];\n        if (v > 1.0) {\n            v = 1.0;\n        } else if (v < 0.0) {\n            v = 0.0;\n        }\n\n        this.value = v;\n\n        this.oldmouse = m;\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetHSlider.prototype.onMouseUp = function(e) {\n        this.oldmouse = null;\n        this.captureInput(false);\n    };\n\n    WidgetHSlider.prototype.onMouseLeave = function(e) {\n        //this.oldmouse = null;\n    };\n\n    LiteGraph.registerNodeType(\"widget/hslider\", WidgetHSlider);\n\n    function WidgetProgress() {\n        this.size = [160, 26];\n        this.addInput(\"\", \"number\");\n        this.properties = { min: 0, max: 1, value: 0, color: \"#AAF\" };\n    }\n\n    WidgetProgress.title = \"Progress\";\n    WidgetProgress.desc = \"Shows data in linear progress\";\n\n    WidgetProgress.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v != undefined) {\n            this.properties[\"value\"] = v;\n        }\n    };\n\n    WidgetProgress.prototype.onDrawForeground = function(ctx) {\n        //border\n        ctx.lineWidth = 1;\n        ctx.fillStyle = this.properties.color;\n        var v =\n            (this.properties.value - this.properties.min) /\n            (this.properties.max - this.properties.min);\n        v = Math.min(1, v);\n        v = Math.max(0, v);\n        ctx.fillRect(2, 2, (this.size[0] - 4) * v, this.size[1] - 4);\n    };\n\n    LiteGraph.registerNodeType(\"widget/progress\", WidgetProgress);\n\n    function WidgetText() {\n        this.addInputs(\"\", 0);\n        this.properties = {\n            value: \"...\",\n            font: \"Arial\",\n            fontsize: 18,\n            color: \"#AAA\",\n            align: \"left\",\n            glowSize: 0,\n            decimals: 1\n        };\n    }\n\n    WidgetText.title = \"Text\";\n    WidgetText.desc = \"Shows the input value\";\n    WidgetText.widgets = [\n        { name: \"resize\", text: \"Resize box\", type: \"button\" },\n        { name: \"led_text\", text: \"LED\", type: \"minibutton\" },\n        { name: \"normal_text\", text: \"Normal\", type: \"minibutton\" }\n    ];\n\n    WidgetText.prototype.onDrawForeground = function(ctx) {\n        //ctx.fillStyle=\"#000\";\n        //ctx.fillRect(0,0,100,60);\n        ctx.fillStyle = this.properties[\"color\"];\n        var v = this.properties[\"value\"];\n\n        if (this.properties[\"glowSize\"]) {\n            ctx.shadowColor = this.properties.color;\n            ctx.shadowOffsetX = 0;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = this.properties[\"glowSize\"];\n        } else {\n            ctx.shadowColor = \"transparent\";\n        }\n\n        var fontsize = this.properties[\"fontsize\"];\n\n        ctx.textAlign = this.properties[\"align\"];\n        ctx.font = fontsize.toString() + \"px \" + this.properties[\"font\"];\n        this.str =\n            typeof v == \"number\" ? v.toFixed(this.properties[\"decimals\"]) : v;\n\n        if (typeof this.str == \"string\") {\n            var lines = this.str.replace(/[\\r\\n]/g, \"\\\\n\").split(\"\\\\n\");\n            for (var i=0; i < lines.length; i++) {\n                ctx.fillText(\n                    lines[i],\n                    this.properties[\"align\"] == \"left\" ? 15 : this.size[0] - 15,\n                    fontsize * -0.15 + fontsize * (parseInt(i) + 1)\n                );\n            }\n        }\n\n        ctx.shadowColor = \"transparent\";\n        this.last_ctx = ctx;\n        ctx.textAlign = \"left\";\n    };\n\n    WidgetText.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v != null) {\n            this.properties[\"value\"] = v;\n        }\n        //this.setDirtyCanvas(true);\n    };\n\n    WidgetText.prototype.resize = function() {\n        if (!this.last_ctx) {\n            return;\n        }\n\n        var lines = this.str.split(\"\\\\n\");\n        this.last_ctx.font =\n            this.properties[\"fontsize\"] + \"px \" + this.properties[\"font\"];\n        var max = 0;\n        for (var i=0; i < lines.length; i++) {\n            var w = this.last_ctx.measureText(lines[i]).width;\n            if (max < w) {\n                max = w;\n            }\n        }\n        this.size[0] = max + 20;\n        this.size[1] = 4 + lines.length * this.properties[\"fontsize\"];\n\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetText.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n        this.str = typeof value == \"number\" ? value.toFixed(3) : value;\n        //this.resize();\n        return true;\n    };\n\n    LiteGraph.registerNodeType(\"widget/text\", WidgetText);\n\n    function WidgetPanel() {\n        this.size = [200, 100];\n        this.properties = {\n            borderColor: \"#ffffff\",\n            bgcolorTop: \"#f0f0f0\",\n            bgcolorBottom: \"#e0e0e0\",\n            shadowSize: 2,\n            borderRadius: 3\n        };\n    }\n\n    WidgetPanel.title = \"Panel\";\n    WidgetPanel.desc = \"Non interactive panel\";\n    WidgetPanel.widgets = [{ name: \"update\", text: \"Update\", type: \"button\" }];\n\n    WidgetPanel.prototype.createGradient = function(ctx) {\n        if (\n            this.properties[\"bgcolorTop\"] == \"\" ||\n            this.properties[\"bgcolorBottom\"] == \"\"\n        ) {\n            this.lineargradient = 0;\n            return;\n        }\n\n        this.lineargradient = ctx.createLinearGradient(0, 0, 0, this.size[1]);\n        this.lineargradient.addColorStop(0, this.properties[\"bgcolorTop\"]);\n        this.lineargradient.addColorStop(1, this.properties[\"bgcolorBottom\"]);\n    };\n\n    WidgetPanel.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        if (this.lineargradient == null) {\n            this.createGradient(ctx);\n        }\n\n        if (!this.lineargradient) {\n            return;\n        }\n\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = this.properties[\"borderColor\"];\n        //ctx.fillStyle = \"#ebebeb\";\n        ctx.fillStyle = this.lineargradient;\n\n        if (this.properties[\"shadowSize\"]) {\n            ctx.shadowColor = \"#000\";\n            ctx.shadowOffsetX = 0;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = this.properties[\"shadowSize\"];\n        } else {\n            ctx.shadowColor = \"transparent\";\n        }\n\n        ctx.roundRect(\n            0,\n            0,\n            this.size[0] - 1,\n            this.size[1] - 1,\n            this.properties[\"shadowSize\"]\n        );\n        ctx.fill();\n        ctx.shadowColor = \"transparent\";\n        ctx.stroke();\n    };\n\n    LiteGraph.registerNodeType(\"widget/panel\", WidgetPanel);\n})(this);\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    function GamepadInput() {\r\n        this.addOutput(\"left_x_axis\", \"number\");\r\n        this.addOutput(\"left_y_axis\", \"number\");\r\n        this.addOutput(\"button_pressed\", LiteGraph.EVENT);\r\n        this.properties = { gamepad_index: 0, threshold: 0.1 };\r\n\r\n        this._left_axis = new Float32Array(2);\r\n        this._right_axis = new Float32Array(2);\r\n        this._triggers = new Float32Array(2);\r\n        this._previous_buttons = new Uint8Array(17);\r\n        this._current_buttons = new Uint8Array(17);\r\n    }\r\n\r\n    GamepadInput.title = \"Gamepad\";\r\n    GamepadInput.desc = \"gets the input of the gamepad\";\r\n\r\n    GamepadInput.CENTER = 0;\r\n    GamepadInput.LEFT = 1;\r\n    GamepadInput.RIGHT = 2;\r\n    GamepadInput.UP = 4;\r\n    GamepadInput.DOWN = 8;\r\n\r\n    GamepadInput.zero = new Float32Array(2);\r\n    GamepadInput.buttons = [\r\n        \"a\",\r\n        \"b\",\r\n        \"x\",\r\n        \"y\",\r\n        \"lb\",\r\n        \"rb\",\r\n        \"lt\",\r\n        \"rt\",\r\n        \"back\",\r\n        \"start\",\r\n        \"ls\",\r\n        \"rs\",\r\n        \"home\"\r\n    ];\r\n\r\n    GamepadInput.prototype.onExecute = function() {\r\n        //get gamepad\r\n        var gamepad = this.getGamepad();\r\n        var threshold = this.properties.threshold || 0.0;\r\n\r\n        if (gamepad) {\r\n            this._left_axis[0] =\r\n                Math.abs(gamepad.xbox.axes[\"lx\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"lx\"]\r\n                    : 0;\r\n            this._left_axis[1] =\r\n                Math.abs(gamepad.xbox.axes[\"ly\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"ly\"]\r\n                    : 0;\r\n            this._right_axis[0] =\r\n                Math.abs(gamepad.xbox.axes[\"rx\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"rx\"]\r\n                    : 0;\r\n            this._right_axis[1] =\r\n                Math.abs(gamepad.xbox.axes[\"ry\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"ry\"]\r\n                    : 0;\r\n            this._triggers[0] =\r\n                Math.abs(gamepad.xbox.axes[\"ltrigger\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"ltrigger\"]\r\n                    : 0;\r\n            this._triggers[1] =\r\n                Math.abs(gamepad.xbox.axes[\"rtrigger\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"rtrigger\"]\r\n                    : 0;\r\n        }\r\n\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; i++) {\r\n                var output = this.outputs[i];\r\n                if (!output.links || !output.links.length) {\r\n                    continue;\r\n                }\r\n                var v = null;\r\n\r\n                if (gamepad) {\r\n                    switch (output.name) {\r\n                        case \"left_axis\":\r\n                            v = this._left_axis;\r\n                            break;\r\n                        case \"right_axis\":\r\n                            v = this._right_axis;\r\n                            break;\r\n                        case \"left_x_axis\":\r\n                            v = this._left_axis[0];\r\n                            break;\r\n                        case \"left_y_axis\":\r\n                            v = this._left_axis[1];\r\n                            break;\r\n                        case \"right_x_axis\":\r\n                            v = this._right_axis[0];\r\n                            break;\r\n                        case \"right_y_axis\":\r\n                            v = this._right_axis[1];\r\n                            break;\r\n                        case \"trigger_left\":\r\n                            v = this._triggers[0];\r\n                            break;\r\n                        case \"trigger_right\":\r\n                            v = this._triggers[1];\r\n                            break;\r\n                        case \"a_button\":\r\n                            v = gamepad.xbox.buttons[\"a\"] ? 1 : 0;\r\n                            break;\r\n                        case \"b_button\":\r\n                            v = gamepad.xbox.buttons[\"b\"] ? 1 : 0;\r\n                            break;\r\n                        case \"x_button\":\r\n                            v = gamepad.xbox.buttons[\"x\"] ? 1 : 0;\r\n                            break;\r\n                        case \"y_button\":\r\n                            v = gamepad.xbox.buttons[\"y\"] ? 1 : 0;\r\n                            break;\r\n                        case \"lb_button\":\r\n                            v = gamepad.xbox.buttons[\"lb\"] ? 1 : 0;\r\n                            break;\r\n                        case \"rb_button\":\r\n                            v = gamepad.xbox.buttons[\"rb\"] ? 1 : 0;\r\n                            break;\r\n                        case \"ls_button\":\r\n                            v = gamepad.xbox.buttons[\"ls\"] ? 1 : 0;\r\n                            break;\r\n                        case \"rs_button\":\r\n                            v = gamepad.xbox.buttons[\"rs\"] ? 1 : 0;\r\n                            break;\r\n                        case \"hat_left\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.LEFT;\r\n                            break;\r\n                        case \"hat_right\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.RIGHT;\r\n                            break;\r\n                        case \"hat_up\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.UP;\r\n                            break;\r\n                        case \"hat_down\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.DOWN;\r\n                            break;\r\n                        case \"hat\":\r\n                            v = gamepad.xbox.hatmap;\r\n                            break;\r\n                        case \"start_button\":\r\n                            v = gamepad.xbox.buttons[\"start\"] ? 1 : 0;\r\n                            break;\r\n                        case \"back_button\":\r\n                            v = gamepad.xbox.buttons[\"back\"] ? 1 : 0;\r\n                            break;\r\n                        case \"button_pressed\":\r\n                            for (\r\n                                var j = 0;\r\n                                j < this._current_buttons.length;\r\n                                ++j\r\n                            ) {\r\n                                if (\r\n                                    this._current_buttons[j] &&\r\n                                    !this._previous_buttons[j]\r\n                                ) {\r\n                                    this.triggerSlot(\r\n                                        i,\r\n                                        GamepadInput.buttons[j]\r\n                                    );\r\n                                }\r\n                            }\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                } else {\r\n                    //if no gamepad is connected, output 0\r\n                    switch (output.name) {\r\n                        case \"button_pressed\":\r\n                            break;\r\n                        case \"left_axis\":\r\n                        case \"right_axis\":\r\n                            v = GamepadInput.zero;\r\n                            break;\r\n                        default:\r\n                            v = 0;\r\n                    }\r\n                }\r\n                this.setOutputData(i, v);\r\n            }\r\n        }\r\n    };\r\n\r\n\tGamepadInput.mapping = {a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11 };\r\n\tGamepadInput.mapping_array = [\"a\",\"b\",\"x\",\"y\",\"lb\",\"rb\",\"lt\",\"rt\",\"back\",\"start\",\"ls\",\"rs\"];\r\n\r\n    GamepadInput.prototype.getGamepad = function() {\r\n        var getGamepads =\r\n            navigator.getGamepads ||\r\n            navigator.webkitGetGamepads ||\r\n            navigator.mozGetGamepads;\r\n        if (!getGamepads) {\r\n            return null;\r\n        }\r\n        var gamepads = getGamepads.call(navigator);\r\n        var gamepad = null;\r\n\r\n        this._previous_buttons.set(this._current_buttons);\r\n\r\n        //pick the first connected\r\n        for (var i = this.properties.gamepad_index; i < 4; i++) {\r\n            if (!gamepads[i]) {\r\n                continue;\r\n            }\r\n            gamepad = gamepads[i];\r\n\r\n            //xbox controller mapping\r\n            var xbox = this.xbox_mapping;\r\n            if (!xbox) {\r\n                xbox = this.xbox_mapping = {\r\n                    axes: [],\r\n                    buttons: {},\r\n                    hat: \"\",\r\n                    hatmap: GamepadInput.CENTER\r\n                };\r\n            }\r\n\r\n            xbox.axes[\"lx\"] = gamepad.axes[0];\r\n            xbox.axes[\"ly\"] = gamepad.axes[1];\r\n            xbox.axes[\"rx\"] = gamepad.axes[2];\r\n            xbox.axes[\"ry\"] = gamepad.axes[3];\r\n            xbox.axes[\"ltrigger\"] = gamepad.buttons[6].value;\r\n            xbox.axes[\"rtrigger\"] = gamepad.buttons[7].value;\r\n            xbox.hat = \"\";\r\n            xbox.hatmap = GamepadInput.CENTER;\r\n\r\n            for (var j = 0; j < gamepad.buttons.length; j++) {\r\n                this._current_buttons[j] = gamepad.buttons[j].pressed;\r\n\r\n\t\t\t\tif(j < 12)\r\n\t\t\t\t{\r\n\t\t\t\t\txbox.buttons[ GamepadInput.mapping_array[j] ] = gamepad.buttons[j].pressed;\r\n\t\t\t\t\tif(gamepad.buttons[j].was_pressed)\r\n\t\t\t\t\t\tthis.trigger( GamepadInput.mapping_array[j] + \"_button_event\" );\r\n\t\t\t\t}\r\n\t\t\t\telse //mapping of XBOX\r\n\t\t\t\t\tswitch ( j ) //I use a switch to ensure that a player with another gamepad could play\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase 12:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"up\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.UP;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 13:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"down\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.DOWN;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 14:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"left\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.LEFT;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 15:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"right\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.RIGHT;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 16:\r\n\t\t\t\t\t\t\txbox.buttons[\"home\"] = gamepad.buttons[j].pressed;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t}\r\n            }\r\n            gamepad.xbox = xbox;\r\n            return gamepad;\r\n        }\r\n    };\r\n\r\n    GamepadInput.prototype.onDrawBackground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        //render gamepad state?\r\n        var la = this._left_axis;\r\n        var ra = this._right_axis;\r\n        ctx.strokeStyle = \"#88A\";\r\n        ctx.strokeRect(\r\n            (la[0] + 1) * 0.5 * this.size[0] - 4,\r\n            (la[1] + 1) * 0.5 * this.size[1] - 4,\r\n            8,\r\n            8\r\n        );\r\n        ctx.strokeStyle = \"#8A8\";\r\n        ctx.strokeRect(\r\n            (ra[0] + 1) * 0.5 * this.size[0] - 4,\r\n            (ra[1] + 1) * 0.5 * this.size[1] - 4,\r\n            8,\r\n            8\r\n        );\r\n        var h = this.size[1] / this._current_buttons.length;\r\n        ctx.fillStyle = \"#AEB\";\r\n        for (var i = 0; i < this._current_buttons.length; ++i) {\r\n            if (this._current_buttons[i]) {\r\n                ctx.fillRect(0, h * i, 6, h);\r\n            }\r\n        }\r\n    };\r\n\r\n    GamepadInput.prototype.onGetOutputs = function() {\r\n        return [\r\n            [\"left_axis\", \"vec2\"],\r\n            [\"right_axis\", \"vec2\"],\r\n            [\"left_x_axis\", \"number\"],\r\n            [\"left_y_axis\", \"number\"],\r\n            [\"right_x_axis\", \"number\"],\r\n            [\"right_y_axis\", \"number\"],\r\n            [\"trigger_left\", \"number\"],\r\n            [\"trigger_right\", \"number\"],\r\n            [\"a_button\", \"number\"],\r\n            [\"b_button\", \"number\"],\r\n            [\"x_button\", \"number\"],\r\n            [\"y_button\", \"number\"],\r\n            [\"lb_button\", \"number\"],\r\n            [\"rb_button\", \"number\"],\r\n            [\"ls_button\", \"number\"],\r\n            [\"rs_button\", \"number\"],\r\n            [\"start_button\", \"number\"],\r\n            [\"back_button\", \"number\"],\r\n            [\"a_button_event\", LiteGraph.EVENT ],\r\n            [\"b_button_event\", LiteGraph.EVENT ],\r\n            [\"x_button_event\", LiteGraph.EVENT ],\r\n            [\"y_button_event\", LiteGraph.EVENT ],\r\n            [\"lb_button_event\", LiteGraph.EVENT ],\r\n            [\"rb_button_event\", LiteGraph.EVENT ],\r\n            [\"ls_button_event\", LiteGraph.EVENT ],\r\n            [\"rs_button_event\", LiteGraph.EVENT ],\r\n            [\"start_button_event\", LiteGraph.EVENT ],\r\n            [\"back_button_event\", LiteGraph.EVENT ],\r\n            [\"hat_left\", \"number\"],\r\n            [\"hat_right\", \"number\"],\r\n            [\"hat_up\", \"number\"],\r\n            [\"hat_down\", \"number\"],\r\n            [\"hat\", \"number\"],\r\n            [\"button_pressed\", LiteGraph.EVENT]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"input/gamepad\", GamepadInput);\r\n\r\n})(this);\r\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    //Converter\n    function Converter() {\n        this.addInput(\"in\", 0);\n\t\tthis.addOutput(\"out\", 0);\n        this.size = [80, 30];\n    }\n\n    Converter.title = \"Converter\";\n    Converter.desc = \"type A to type B\";\n\n    Converter.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        if (this.outputs) {\n            for (var i = 0; i < this.outputs.length; i++) {\n                var output = this.outputs[i];\n                if (!output.links || !output.links.length) {\n                    continue;\n                }\n\n                var result = null;\n                switch (output.name) {\n                    case \"number\":\n                        result = v.length ? v[0] : parseFloat(v);\n                        break;\n                    case \"vec2\":\n                    case \"vec3\":\n                    case \"vec4\":\n                        var result = null;\n                        var count = 1;\n                        switch (output.name) {\n                            case \"vec2\":\n                                count = 2;\n                                break;\n                            case \"vec3\":\n                                count = 3;\n                                break;\n                            case \"vec4\":\n                                count = 4;\n                                break;\n                        }\n\n                        var result = new Float32Array(count);\n                        if (v.length) {\n                            for (\n                                var j = 0;\n                                j < v.length && j < result.length;\n                                j++\n                            ) {\n                                result[j] = v[j];\n                            }\n                        } else {\n                            result[0] = parseFloat(v);\n                        }\n                        break;\n                }\n                this.setOutputData(i, result);\n            }\n        }\n    };\n\n    Converter.prototype.onGetOutputs = function() {\n        return [\n            [\"number\", \"number\"],\n            [\"vec2\", \"vec2\"],\n            [\"vec3\", \"vec3\"],\n            [\"vec4\", \"vec4\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/converter\", Converter);\n\n    //Bypass\n    function Bypass() {\n        this.addInput(\"in\");\n        this.addOutput(\"out\");\n        this.size = [80, 30];\n    }\n\n    Bypass.title = \"Bypass\";\n    Bypass.desc = \"removes the type\";\n\n    Bypass.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        this.setOutputData(0, v);\n    };\n\n    LiteGraph.registerNodeType(\"math/bypass\", Bypass);\n\n    function ToNumber() {\n        this.addInput(\"in\");\n        this.addOutput(\"out\");\n    }\n\n    ToNumber.title = \"to Number\";\n    ToNumber.desc = \"Cast to number\";\n\n    ToNumber.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        this.setOutputData(0, Number(v));\n    };\n\n    LiteGraph.registerNodeType(\"math/to_number\", ToNumber);\n\n    function MathRange() {\n        this.addInput(\"in\", \"number\", { locked: true });\n        this.addOutput(\"out\", \"number\", { locked: true });\n        this.addOutput(\"clamped\", \"number\", { locked: true });\n\n        this.addProperty(\"in\", 0);\n        this.addProperty(\"in_min\", 0);\n        this.addProperty(\"in_max\", 1);\n        this.addProperty(\"out_min\", 0);\n        this.addProperty(\"out_max\", 1);\n\n        this.size = [120, 50];\n    }\n\n    MathRange.title = \"Range\";\n    MathRange.desc = \"Convert a number from one range to another\";\n\n    MathRange.prototype.getTitle = function() {\n        if (this.flags.collapsed) {\n            return (this._last_v || 0).toFixed(2);\n        }\n        return this.title;\n    };\n\n    MathRange.prototype.onExecute = function() {\n        if (this.inputs) {\n            for (var i = 0; i < this.inputs.length; i++) {\n                var input = this.inputs[i];\n                var v = this.getInputData(i);\n                if (v === undefined) {\n                    continue;\n                }\n                this.properties[input.name] = v;\n            }\n        }\n\n        var v = this.properties[\"in\"];\n        if (v === undefined || v === null || v.constructor !== Number) {\n            v = 0;\n        }\n\n        var in_min = this.properties.in_min;\n        var in_max = this.properties.in_max;\n        var out_min = this.properties.out_min;\n        var out_max = this.properties.out_max;\n\t\t/*\n\t\tif( in_min > in_max )\n\t\t{\n\t\t\tin_min = in_max;\n\t\t\tin_max = this.properties.in_min;\n\t\t}\n\t\tif( out_min > out_max )\n\t\t{\n\t\t\tout_min = out_max;\n\t\t\tout_max = this.properties.out_min;\n\t\t}\n\t\t*/\n\n        this._last_v = ((v - in_min) / (in_max - in_min)) * (out_max - out_min) + out_min;\n        this.setOutputData(0, this._last_v);\n        this.setOutputData(1, clamp( this._last_v, out_min, out_max ));\n    };\n\n    MathRange.prototype.onDrawBackground = function(ctx) {\n        //show the current value\n        if (this._last_v) {\n            this.outputs[0].label = this._last_v.toFixed(3);\n        } else {\n            this.outputs[0].label = \"?\";\n        }\n    };\n\n    MathRange.prototype.onGetInputs = function() {\n        return [\n            [\"in_min\", \"number\"],\n            [\"in_max\", \"number\"],\n            [\"out_min\", \"number\"],\n            [\"out_max\", \"number\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/range\", MathRange);\n\n    function MathRand() {\n        this.addOutput(\"value\", \"number\");\n        this.addProperty(\"min\", 0);\n        this.addProperty(\"max\", 1);\n        this.size = [80, 30];\n    }\n\n    MathRand.title = \"Rand\";\n    MathRand.desc = \"Random number\";\n\n    MathRand.prototype.onExecute = function() {\n        if (this.inputs) {\n            for (var i = 0; i < this.inputs.length; i++) {\n                var input = this.inputs[i];\n                var v = this.getInputData(i);\n                if (v === undefined) {\n                    continue;\n                }\n                this.properties[input.name] = v;\n            }\n        }\n\n        var min = this.properties.min;\n        var max = this.properties.max;\n        this._last_v = Math.random() * (max - min) + min;\n        this.setOutputData(0, this._last_v);\n    };\n\n    MathRand.prototype.onDrawBackground = function(ctx) {\n        //show the current value\n        this.outputs[0].label = (this._last_v || 0).toFixed(3);\n    };\n\n    MathRand.prototype.onGetInputs = function() {\n        return [[\"min\", \"number\"], [\"max\", \"number\"]];\n    };\n\n    LiteGraph.registerNodeType(\"math/rand\", MathRand);\n\n    //basic continuous noise\n    function MathNoise() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.addProperty(\"min\", 0);\n        this.addProperty(\"max\", 1);\n        this.addProperty(\"smooth\", true);\n        this.addProperty(\"seed\", 0);\n        this.addProperty(\"octaves\", 1);\n        this.addProperty(\"persistence\", 0.8);\n        this.addProperty(\"speed\", 1);\n        this.size = [90, 30];\n    }\n\n    MathNoise.title = \"Noise\";\n    MathNoise.desc = \"Random number with temporal continuity\";\n    MathNoise.data = null;\n\n    MathNoise.getValue = function(f, smooth) {\n        if (!MathNoise.data) {\n            MathNoise.data = new Float32Array(1024);\n            for (var i = 0; i < MathNoise.data.length; ++i) {\n                MathNoise.data[i] = Math.random();\n            }\n        }\n        f = f % 1024;\n        if (f < 0) {\n            f += 1024;\n        }\n        var f_min = Math.floor(f);\n        var f = f - f_min;\n        var r1 = MathNoise.data[f_min];\n        var r2 = MathNoise.data[f_min == 1023 ? 0 : f_min + 1];\n        if (smooth) {\n            f = f * f * f * (f * (f * 6.0 - 15.0) + 10.0);\n        }\n        return r1 * (1 - f) + r2 * f;\n    };\n\n    MathNoise.prototype.onExecute = function() {\n        var f = this.getInputData(0) || 0;\n\t\tvar iterations = this.properties.octaves || 1;\n\t\tvar r = 0;\n\t\tvar amp = 1;\n\t\tvar seed = this.properties.seed || 0;\n\t\tf += seed;\n\t\tvar speed = this.properties.speed || 1;\n\t\tvar total_amp = 0;\n\t\tfor(var i = 0; i < iterations; ++i)\n\t\t{\n\t\t\tr += MathNoise.getValue(f * (1+i) * speed, this.properties.smooth) * amp;\n\t\t\ttotal_amp += amp;\n\t\t\tamp *= this.properties.persistence;\n\t\t\tif(amp < 0.001)\n\t\t\t\tbreak;\n\t\t}\n\t\tr /= total_amp;\n        var min = this.properties.min;\n        var max = this.properties.max;\n        this._last_v = r * (max - min) + min;\n        this.setOutputData(0, this._last_v);\n    };\n\n    MathNoise.prototype.onDrawBackground = function(ctx) {\n        //show the current value\n        this.outputs[0].label = (this._last_v || 0).toFixed(3);\n    };\n\n    LiteGraph.registerNodeType(\"math/noise\", MathNoise);\n\n    //generates spikes every random time\n    function MathSpikes() {\n        this.addOutput(\"out\", \"number\");\n        this.addProperty(\"min_time\", 1);\n        this.addProperty(\"max_time\", 2);\n        this.addProperty(\"duration\", 0.2);\n        this.size = [90, 30];\n        this._remaining_time = 0;\n        this._blink_time = 0;\n    }\n\n    MathSpikes.title = \"Spikes\";\n    MathSpikes.desc = \"spike every random time\";\n\n    MathSpikes.prototype.onExecute = function() {\n        var dt = this.graph.elapsed_time; //in secs\n\n        this._remaining_time -= dt;\n        this._blink_time -= dt;\n\n        var v = 0;\n        if (this._blink_time > 0) {\n            var f = this._blink_time / this.properties.duration;\n            v = 1 / (Math.pow(f * 8 - 4, 4) + 1);\n        }\n\n        if (this._remaining_time < 0) {\n            this._remaining_time =\n                Math.random() *\n                    (this.properties.max_time - this.properties.min_time) +\n                this.properties.min_time;\n            this._blink_time = this.properties.duration;\n            this.boxcolor = \"#FFF\";\n        } else {\n            this.boxcolor = \"#000\";\n        }\n        this.setOutputData(0, v);\n    };\n\n    LiteGraph.registerNodeType(\"math/spikes\", MathSpikes);\n\n    //Math clamp\n    function MathClamp() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n        this.addProperty(\"min\", 0);\n        this.addProperty(\"max\", 1);\n    }\n\n    MathClamp.title = \"Clamp\";\n    MathClamp.desc = \"Clamp number between min and max\";\n    //MathClamp.filter = \"shader\";\n\n    MathClamp.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        v = Math.max(this.properties.min, v);\n        v = Math.min(this.properties.max, v);\n        this.setOutputData(0, v);\n    };\n\n    MathClamp.prototype.getCode = function(lang) {\n        var code = \"\";\n        if (this.isInputConnected(0)) {\n            code +=\n                \"clamp({{0}},\" +\n                this.properties.min +\n                \",\" +\n                this.properties.max +\n                \")\";\n        }\n        return code;\n    };\n\n    LiteGraph.registerNodeType(\"math/clamp\", MathClamp);\n\n    //Math ABS\n    function MathLerp() {\n        this.properties = { f: 0.5 };\n        this.addInput(\"A\", \"number\");\n        this.addInput(\"B\", \"number\");\n\n        this.addOutput(\"out\", \"number\");\n    }\n\n    MathLerp.title = \"Lerp\";\n    MathLerp.desc = \"Linear Interpolation\";\n\n    MathLerp.prototype.onExecute = function() {\n        var v1 = this.getInputData(0);\n        if (v1 == null) {\n            v1 = 0;\n        }\n        var v2 = this.getInputData(1);\n        if (v2 == null) {\n            v2 = 0;\n        }\n\n        var f = this.properties.f;\n\n        var _f = this.getInputData(2);\n        if (_f !== undefined) {\n            f = _f;\n        }\n\n        this.setOutputData(0, v1 * (1 - f) + v2 * f);\n    };\n\n    MathLerp.prototype.onGetInputs = function() {\n        return [[\"f\", \"number\"]];\n    };\n\n    LiteGraph.registerNodeType(\"math/lerp\", MathLerp);\n\n    //Math ABS\n    function MathAbs() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n    }\n\n    MathAbs.title = \"Abs\";\n    MathAbs.desc = \"Absolute\";\n\n    MathAbs.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        this.setOutputData(0, Math.abs(v));\n    };\n\n    LiteGraph.registerNodeType(\"math/abs\", MathAbs);\n\n    //Math Floor\n    function MathFloor() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n    }\n\n    MathFloor.title = \"Floor\";\n    MathFloor.desc = \"Floor number to remove fractional part\";\n\n    MathFloor.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        this.setOutputData(0, Math.floor(v));\n    };\n\n    LiteGraph.registerNodeType(\"math/floor\", MathFloor);\n\n    //Math frac\n    function MathFrac() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n    }\n\n    MathFrac.title = \"Frac\";\n    MathFrac.desc = \"Returns fractional part\";\n\n    MathFrac.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        this.setOutputData(0, v % 1);\n    };\n\n    LiteGraph.registerNodeType(\"math/frac\", MathFrac);\n\n    //Math Floor\n    function MathSmoothStep() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n        this.properties = { A: 0, B: 1 };\n    }\n\n    MathSmoothStep.title = \"Smoothstep\";\n    MathSmoothStep.desc = \"Smoothstep\";\n\n    MathSmoothStep.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v === undefined) {\n            return;\n        }\n\n        var edge0 = this.properties.A;\n        var edge1 = this.properties.B;\n\n        // Scale, bias and saturate x to 0..1 range\n        v = clamp((v - edge0) / (edge1 - edge0), 0.0, 1.0);\n        // Evaluate polynomial\n        v = v * v * (3 - 2 * v);\n\n        this.setOutputData(0, v);\n    };\n\n    LiteGraph.registerNodeType(\"math/smoothstep\", MathSmoothStep);\n\n    //Math scale\n    function MathScale() {\n        this.addInput(\"in\", \"number\", { label: \"\" });\n        this.addOutput(\"out\", \"number\", { label: \"\" });\n        this.size = [80, 30];\n        this.addProperty(\"factor\", 1);\n    }\n\n    MathScale.title = \"Scale\";\n    MathScale.desc = \"v * factor\";\n\n    MathScale.prototype.onExecute = function() {\n        var value = this.getInputData(0);\n        if (value != null) {\n            this.setOutputData(0, value * this.properties.factor);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"math/scale\", MathScale);\n\n\t//Gate\n\tfunction Gate() {\n\t\tthis.addInput(\"v\",\"boolean\");\n\t\tthis.addInput(\"A\");\n\t\tthis.addInput(\"B\");\n\t\tthis.addOutput(\"out\");\n\t}\n\n\tGate.title = \"Gate\";\n\tGate.desc = \"if v is true, then outputs A, otherwise B\";\n\n\tGate.prototype.onExecute = function() {\n\t\tvar v = this.getInputData(0);\n\t\tthis.setOutputData(0, this.getInputData( v ? 1 : 2 ));\n\t};\n\n\tLiteGraph.registerNodeType(\"math/gate\", Gate);\n\n\n    //Math Average\n    function MathAverageFilter() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n        this.addProperty(\"samples\", 10);\n        this._values = new Float32Array(10);\n        this._current = 0;\n    }\n\n    MathAverageFilter.title = \"Average\";\n    MathAverageFilter.desc = \"Average Filter\";\n\n    MathAverageFilter.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            v = 0;\n        }\n\n        var num_samples = this._values.length;\n\n        this._values[this._current % num_samples] = v;\n        this._current += 1;\n        if (this._current > num_samples) {\n            this._current = 0;\n        }\n\n        var avr = 0;\n        for (var i = 0; i < num_samples; ++i) {\n            avr += this._values[i];\n        }\n\n        this.setOutputData(0, avr / num_samples);\n    };\n\n    MathAverageFilter.prototype.onPropertyChanged = function(name, value) {\n        if (value < 1) {\n            value = 1;\n        }\n        this.properties.samples = Math.round(value);\n        var old = this._values;\n\n        this._values = new Float32Array(this.properties.samples);\n        if (old.length <= this._values.length) {\n            this._values.set(old);\n        } else {\n            this._values.set(old.subarray(0, this._values.length));\n        }\n    };\n\n    LiteGraph.registerNodeType(\"math/average\", MathAverageFilter);\n\n    //Math\n    function MathTendTo() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.addProperty(\"factor\", 0.1);\n        this.size = [80, 30];\n        this._value = null;\n    }\n\n    MathTendTo.title = \"TendTo\";\n    MathTendTo.desc = \"moves the output value always closer to the input\";\n\n    MathTendTo.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            v = 0;\n        }\n        var f = this.properties.factor;\n        if (this._value == null) {\n            this._value = v;\n        } else {\n            this._value = this._value * (1 - f) + v * f;\n        }\n        this.setOutputData(0, this._value);\n    };\n\n    LiteGraph.registerNodeType(\"math/tendTo\", MathTendTo);\n\n    //Math operation\n    function MathOperation() {\n        this.addInput(\"A\", \"number,array,object\");\n        this.addInput(\"B\", \"number\");\n        this.addOutput(\"=\", \"number\");\n        this.addProperty(\"A\", 1);\n        this.addProperty(\"B\", 1);\n        this.addProperty(\"OP\", \"+\", \"enum\", { values: MathOperation.values });\n\t\tthis._func = MathOperation.funcs[this.properties.OP];\n\t\tthis._result = []; //only used for arrays\n    }\n\n    MathOperation.values = [\"+\", \"-\", \"*\", \"/\", \"%\", \"^\", \"max\", \"min\"];\n    MathOperation.funcs = {\n        \"+\": function(A,B) { return A + B; },\n        \"-\": function(A,B) { return A - B; },\n        \"x\": function(A,B) { return A * B; },\n        \"X\": function(A,B) { return A * B; },\n        \"*\": function(A,B) { return A * B; },\n        \"/\": function(A,B) { return A / B; },\n        \"%\": function(A,B) { return A % B; },\n        \"^\": function(A,B) { return Math.pow(A, B); },\n        \"max\": function(A,B) { return Math.max(A, B); },\n        \"min\": function(A,B) { return Math.min(A, B); }\n    };\n\n\tMathOperation.title = \"Operation\";\n    MathOperation.desc = \"Easy math operators\";\n    MathOperation[\"@OP\"] = {\n        type: \"enum\",\n        title: \"operation\",\n        values: MathOperation.values\n    };\n    MathOperation.size = [100, 60];\n\n    MathOperation.prototype.getTitle = function() {\n\t\tif(this.properties.OP == \"max\" || this.properties.OP == \"min\")\n\t\t\treturn this.properties.OP + \"(A,B)\";\n        return \"A \" + this.properties.OP + \" B\";\n    };\n\n    MathOperation.prototype.setValue = function(v) {\n        if (typeof v == \"string\") {\n            v = parseFloat(v);\n        }\n        this.properties[\"value\"] = v;\n    };\n\n    MathOperation.prototype.onPropertyChanged = function(name, value)\n\t{\n\t\tif (name != \"OP\")\n\t\t\treturn;\n        this._func = MathOperation.funcs[this.properties.OP];\n        if(!this._func)\n        {\n            console.warn(\"Unknown operation: \" + this.properties.OP);\n            this._func = function(A) { return A; };\n        }\n\t}\n\n    MathOperation.prototype.onExecute = function() {\n        var A = this.getInputData(0);\n        var B = this.getInputData(1);\n        if ( A != null ) {\n\t\t\tif( A.constructor === Number )\n\t            this.properties[\"A\"] = A;\n        } else {\n            A = this.properties[\"A\"];\n        }\n\n        if (B != null) {\n            this.properties[\"B\"] = B;\n        } else {\n            B = this.properties[\"B\"];\n        }\n\n        var func = MathOperation.funcs[this.properties.OP];\n\n\t\tvar result;\n\t\tif(A.constructor === Number)\n\t\t{\n\t        result = 0;\n\t\t\tresult = func(A,B);\n\t\t}\n\t\telse if(A.constructor === Array)\n\t\t{\n\t\t\tresult = this._result;\n\t\t\tresult.length = A.length;\n\t\t\tfor(var i = 0; i < A.length; ++i)\n\t\t\t\tresult[i] = func(A[i],B);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\t\t\tfor(var i in A)\n\t\t\t\tresult[i] = func(A[i],B);\n\t\t}\n\t    this.setOutputData(0, result);\n    };\n\n    MathOperation.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        ctx.font = \"40px Arial\";\n        ctx.fillStyle = \"#666\";\n        ctx.textAlign = \"center\";\n        ctx.fillText(\n            this.properties.OP,\n            this.size[0] * 0.5,\n            (this.size[1] + LiteGraph.NODE_TITLE_HEIGHT) * 0.5\n        );\n        ctx.textAlign = \"left\";\n    };\n\n    LiteGraph.registerNodeType(\"math/operation\", MathOperation);\n\n    LiteGraph.registerSearchboxExtra(\"math/operation\", \"MAX\", {\n        properties: {OP:\"max\"},\n        title: \"MAX()\"\n    });\n\n    LiteGraph.registerSearchboxExtra(\"math/operation\", \"MIN\", {\n        properties: {OP:\"min\"},\n        title: \"MIN()\"\n    });\n\n\n    //Math compare\n    function MathCompare() {\n        this.addInput(\"A\", \"number\");\n        this.addInput(\"B\", \"number\");\n        this.addOutput(\"A==B\", \"boolean\");\n        this.addOutput(\"A!=B\", \"boolean\");\n        this.addProperty(\"A\", 0);\n        this.addProperty(\"B\", 0);\n    }\n\n    MathCompare.title = \"Compare\";\n    MathCompare.desc = \"compares between two values\";\n\n    MathCompare.prototype.onExecute = function() {\n        var A = this.getInputData(0);\n        var B = this.getInputData(1);\n        if (A !== undefined) {\n            this.properties[\"A\"] = A;\n        } else {\n            A = this.properties[\"A\"];\n        }\n\n        if (B !== undefined) {\n            this.properties[\"B\"] = B;\n        } else {\n            B = this.properties[\"B\"];\n        }\n\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            var output = this.outputs[i];\n            if (!output.links || !output.links.length) {\n                continue;\n            }\n            var value;\n            switch (output.name) {\n                case \"A==B\":\n                    value = A == B;\n                    break;\n                case \"A!=B\":\n                    value = A != B;\n                    break;\n                case \"A>B\":\n                    value = A > B;\n                    break;\n                case \"A<B\":\n                    value = A < B;\n                    break;\n                case \"A<=B\":\n                    value = A <= B;\n                    break;\n                case \"A>=B\":\n                    value = A >= B;\n                    break;\n            }\n            this.setOutputData(i, value);\n        }\n    };\n\n    MathCompare.prototype.onGetOutputs = function() {\n        return [\n            [\"A==B\", \"boolean\"],\n            [\"A!=B\", \"boolean\"],\n            [\"A>B\", \"boolean\"],\n            [\"A<B\", \"boolean\"],\n            [\"A>=B\", \"boolean\"],\n            [\"A<=B\", \"boolean\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/compare\", MathCompare);\n\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"==\", {\n        outputs: [[\"A==B\", \"boolean\"]],\n        title: \"A==B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"!=\", {\n        outputs: [[\"A!=B\", \"boolean\"]],\n        title: \"A!=B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \">\", {\n        outputs: [[\"A>B\", \"boolean\"]],\n        title: \"A>B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"<\", {\n        outputs: [[\"A<B\", \"boolean\"]],\n        title: \"A<B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \">=\", {\n        outputs: [[\"A>=B\", \"boolean\"]],\n        title: \"A>=B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"<=\", {\n        outputs: [[\"A<=B\", \"boolean\"]],\n        title: \"A<=B\"\n    });\n\n    function MathCondition() {\n        this.addInput(\"A\", \"number\");\n        this.addInput(\"B\", \"number\");\n        this.addOutput(\"true\", \"boolean\");\n        this.addOutput(\"false\", \"boolean\");\n        this.addProperty(\"A\", 1);\n        this.addProperty(\"B\", 1);\n        this.addProperty(\"OP\", \">\", \"enum\", { values: MathCondition.values });\n\t\tthis.addWidget(\"combo\",\"Cond.\",this.properties.OP,{ property: \"OP\", values: MathCondition.values } );\n\n        this.size = [80, 60];\n    }\n\n    MathCondition.values = [\">\", \"<\", \"==\", \"!=\", \"<=\", \">=\", \"||\", \"&&\" ];\n    MathCondition[\"@OP\"] = {\n        type: \"enum\",\n        title: \"operation\",\n        values: MathCondition.values\n    };\n\n    MathCondition.title = \"Condition\";\n    MathCondition.desc = \"evaluates condition between A and B\";\n\n    MathCondition.prototype.getTitle = function() {\n        return \"A \" + this.properties.OP + \" B\";\n    };\n\n    MathCondition.prototype.onExecute = function() {\n        var A = this.getInputData(0);\n        if (A === undefined) {\n            A = this.properties.A;\n        } else {\n            this.properties.A = A;\n        }\n\n        var B = this.getInputData(1);\n        if (B === undefined) {\n            B = this.properties.B;\n        } else {\n            this.properties.B = B;\n        }\n\n        var result = true;\n        switch (this.properties.OP) {\n            case \">\":\n                result = A > B;\n                break;\n            case \"<\":\n                result = A < B;\n                break;\n            case \"==\":\n                result = A == B;\n                break;\n            case \"!=\":\n                result = A != B;\n                break;\n            case \"<=\":\n                result = A <= B;\n                break;\n            case \">=\":\n                result = A >= B;\n                break;\n            case \"||\":\n                result = A || B;\n                break;\n            case \"&&\":\n                result = A && B;\n                break;\n        }\n\n        this.setOutputData(0, result);\n        this.setOutputData(1, !result);\n    };\n\n    LiteGraph.registerNodeType(\"math/condition\", MathCondition);\n\n\n    function MathBranch() {\n        this.addInput(\"in\", 0);\n        this.addInput(\"cond\", \"boolean\");\n        this.addOutput(\"true\", 0);\n        this.addOutput(\"false\", 0);\n        this.size = [80, 60];\n    }\n\n    MathBranch.title = \"Branch\";\n    MathBranch.desc = \"If condition is true, outputs IN in true, otherwise in false\";\n\n    MathBranch.prototype.onExecute = function() {\n        var V = this.getInputData(0);\n        var cond = this.getInputData(1);\n\n\t\tif(cond)\n\t\t{\n\t\t\tthis.setOutputData(0, V);\n\t\t\tthis.setOutputData(1, null);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setOutputData(0, null);\n\t\t\tthis.setOutputData(1, V);\n\t\t}\n\t}\n\n    LiteGraph.registerNodeType(\"math/branch\", MathBranch);\n\n\n    function MathAccumulate() {\n        this.addInput(\"inc\", \"number\");\n        this.addOutput(\"total\", \"number\");\n        this.addProperty(\"increment\", 1);\n        this.addProperty(\"value\", 0);\n    }\n\n    MathAccumulate.title = \"Accumulate\";\n    MathAccumulate.desc = \"Increments a value every time\";\n\n    MathAccumulate.prototype.onExecute = function() {\n        if (this.properties.value === null) {\n            this.properties.value = 0;\n        }\n\n        var inc = this.getInputData(0);\n        if (inc !== null) {\n            this.properties.value += inc;\n        } else {\n            this.properties.value += this.properties.increment;\n        }\n        this.setOutputData(0, this.properties.value);\n    };\n\n    LiteGraph.registerNodeType(\"math/accumulate\", MathAccumulate);\n\n    //Math Trigonometry\n    function MathTrigonometry() {\n        this.addInput(\"v\", \"number\");\n        this.addOutput(\"sin\", \"number\");\n\n        this.addProperty(\"amplitude\", 1);\n        this.addProperty(\"offset\", 0);\n        this.bgImageUrl = \"nodes/imgs/icon-sin.png\";\n    }\n\n    MathTrigonometry.title = \"Trigonometry\";\n    MathTrigonometry.desc = \"Sin Cos Tan\";\n    //MathTrigonometry.filter = \"shader\";\n\n    MathTrigonometry.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            v = 0;\n        }\n        var amplitude = this.properties[\"amplitude\"];\n        var slot = this.findInputSlot(\"amplitude\");\n        if (slot != -1) {\n            amplitude = this.getInputData(slot);\n        }\n        var offset = this.properties[\"offset\"];\n        slot = this.findInputSlot(\"offset\");\n        if (slot != -1) {\n            offset = this.getInputData(slot);\n        }\n\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            var output = this.outputs[i];\n            var value;\n            switch (output.name) {\n                case \"sin\":\n                    value = Math.sin(v);\n                    break;\n                case \"cos\":\n                    value = Math.cos(v);\n                    break;\n                case \"tan\":\n                    value = Math.tan(v);\n                    break;\n                case \"asin\":\n                    value = Math.asin(v);\n                    break;\n                case \"acos\":\n                    value = Math.acos(v);\n                    break;\n                case \"atan\":\n                    value = Math.atan(v);\n                    break;\n            }\n            this.setOutputData(i, amplitude * value + offset);\n        }\n    };\n\n    MathTrigonometry.prototype.onGetInputs = function() {\n        return [[\"v\", \"number\"], [\"amplitude\", \"number\"], [\"offset\", \"number\"]];\n    };\n\n    MathTrigonometry.prototype.onGetOutputs = function() {\n        return [\n            [\"sin\", \"number\"],\n            [\"cos\", \"number\"],\n            [\"tan\", \"number\"],\n            [\"asin\", \"number\"],\n            [\"acos\", \"number\"],\n            [\"atan\", \"number\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/trigonometry\", MathTrigonometry);\n\n    LiteGraph.registerSearchboxExtra(\"math/trigonometry\", \"SIN()\", {\n        outputs: [[\"sin\", \"number\"]],\n        title: \"SIN()\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/trigonometry\", \"COS()\", {\n        outputs: [[\"cos\", \"number\"]],\n        title: \"COS()\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/trigonometry\", \"TAN()\", {\n        outputs: [[\"tan\", \"number\"]],\n        title: \"TAN()\"\n    });\n\n    //math library for safe math operations without eval\n    function MathFormula() {\n        this.addInput(\"x\", \"number\");\n        this.addInput(\"y\", \"number\");\n        this.addOutput(\"\", \"number\");\n        this.properties = { x: 1.0, y: 1.0, formula: \"x+y\" };\n        this.code_widget = this.addWidget(\n            \"text\",\n            \"F(x,y)\",\n            this.properties.formula,\n            function(v, canvas, node) {\n                node.properties.formula = v;\n            }\n        );\n        this.addWidget(\"toggle\", \"allow\", LiteGraph.allow_scripts, function(v) {\n            LiteGraph.allow_scripts = v;\n        });\n        this._func = null;\n    }\n\n    MathFormula.title = \"Formula\";\n    MathFormula.desc = \"Compute formula\";\n    MathFormula.size = [160, 100];\n\n    MathAverageFilter.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"formula\") {\n            this.code_widget.value = value;\n        }\n    };\n\n    MathFormula.prototype.onExecute = function() {\n        if (!LiteGraph.allow_scripts) {\n            return;\n        }\n\n        var x = this.getInputData(0);\n        var y = this.getInputData(1);\n        if (x != null) {\n            this.properties[\"x\"] = x;\n        } else {\n            x = this.properties[\"x\"];\n        }\n\n        if (y != null) {\n            this.properties[\"y\"] = y;\n        } else {\n            y = this.properties[\"y\"];\n        }\n\n        var f = this.properties[\"formula\"];\n\n        var value;\n        try {\n            if (!this._func || this._func_code != this.properties.formula) {\n                this._func = new Function(\n                    \"x\",\n                    \"y\",\n                    \"TIME\",\n                    \"return \" + this.properties.formula\n                );\n                this._func_code = this.properties.formula;\n            }\n            value = this._func(x, y, this.graph.globaltime);\n            this.boxcolor = null;\n        } catch (err) {\n            this.boxcolor = \"red\";\n        }\n        this.setOutputData(0, value);\n    };\n\n    MathFormula.prototype.getTitle = function() {\n        return this._func_code || \"Formula\";\n    };\n\n    MathFormula.prototype.onDrawBackground = function() {\n        var f = this.properties[\"formula\"];\n        if (this.outputs && this.outputs.length) {\n            this.outputs[0].label = f;\n        }\n    };\n\n    LiteGraph.registerNodeType(\"math/formula\", MathFormula);\n\n    function Math3DVec2ToXY() {\n        this.addInput(\"vec2\", \"vec2\");\n        this.addOutput(\"x\", \"number\");\n        this.addOutput(\"y\", \"number\");\n    }\n\n    Math3DVec2ToXY.title = \"Vec2->XY\";\n    Math3DVec2ToXY.desc = \"vector 2 to components\";\n\n    Math3DVec2ToXY.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        this.setOutputData(0, v[0]);\n        this.setOutputData(1, v[1]);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/vec2-to-xy\", Math3DVec2ToXY);\n\n    function Math3DXYToVec2() {\n        this.addInputs([[\"x\", \"number\"], [\"y\", \"number\"]]);\n        this.addOutput(\"vec2\", \"vec2\");\n        this.properties = { x: 0, y: 0 };\n        this._data = new Float32Array(2);\n    }\n\n    Math3DXYToVec2.title = \"XY->Vec2\";\n    Math3DXYToVec2.desc = \"components to vector2\";\n\n    Math3DXYToVec2.prototype.onExecute = function() {\n        var x = this.getInputData(0);\n        if (x == null) {\n            x = this.properties.x;\n        }\n        var y = this.getInputData(1);\n        if (y == null) {\n            y = this.properties.y;\n        }\n\n        var data = this._data;\n        data[0] = x;\n        data[1] = y;\n\n        this.setOutputData(0, data);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/xy-to-vec2\", Math3DXYToVec2);\n\n    function Math3DVec3ToXYZ() {\n        this.addInput(\"vec3\", \"vec3\");\n        this.addOutput(\"x\", \"number\");\n        this.addOutput(\"y\", \"number\");\n        this.addOutput(\"z\", \"number\");\n    }\n\n    Math3DVec3ToXYZ.title = \"Vec3->XYZ\";\n    Math3DVec3ToXYZ.desc = \"vector 3 to components\";\n\n    Math3DVec3ToXYZ.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        this.setOutputData(0, v[0]);\n        this.setOutputData(1, v[1]);\n        this.setOutputData(2, v[2]);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/vec3-to-xyz\", Math3DVec3ToXYZ);\n\n    function Math3DXYZToVec3() {\n        this.addInputs([[\"x\", \"number\"], [\"y\", \"number\"], [\"z\", \"number\"]]);\n        this.addOutput(\"vec3\", \"vec3\");\n        this.properties = { x: 0, y: 0, z: 0 };\n        this._data = new Float32Array(3);\n    }\n\n    Math3DXYZToVec3.title = \"XYZ->Vec3\";\n    Math3DXYZToVec3.desc = \"components to vector3\";\n\n    Math3DXYZToVec3.prototype.onExecute = function() {\n        var x = this.getInputData(0);\n        if (x == null) {\n            x = this.properties.x;\n        }\n        var y = this.getInputData(1);\n        if (y == null) {\n            y = this.properties.y;\n        }\n        var z = this.getInputData(2);\n        if (z == null) {\n            z = this.properties.z;\n        }\n\n        var data = this._data;\n        data[0] = x;\n        data[1] = y;\n        data[2] = z;\n\n        this.setOutputData(0, data);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/xyz-to-vec3\", Math3DXYZToVec3);\n\n    function Math3DVec4ToXYZW() {\n        this.addInput(\"vec4\", \"vec4\");\n        this.addOutput(\"x\", \"number\");\n        this.addOutput(\"y\", \"number\");\n        this.addOutput(\"z\", \"number\");\n        this.addOutput(\"w\", \"number\");\n    }\n\n    Math3DVec4ToXYZW.title = \"Vec4->XYZW\";\n    Math3DVec4ToXYZW.desc = \"vector 4 to components\";\n\n    Math3DVec4ToXYZW.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        this.setOutputData(0, v[0]);\n        this.setOutputData(1, v[1]);\n        this.setOutputData(2, v[2]);\n        this.setOutputData(3, v[3]);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/vec4-to-xyzw\", Math3DVec4ToXYZW);\n\n    function Math3DXYZWToVec4() {\n        this.addInputs([\n            [\"x\", \"number\"],\n            [\"y\", \"number\"],\n            [\"z\", \"number\"],\n            [\"w\", \"number\"]\n        ]);\n        this.addOutput(\"vec4\", \"vec4\");\n        this.properties = { x: 0, y: 0, z: 0, w: 0 };\n        this._data = new Float32Array(4);\n    }\n\n    Math3DXYZWToVec4.title = \"XYZW->Vec4\";\n    Math3DXYZWToVec4.desc = \"components to vector4\";\n\n    Math3DXYZWToVec4.prototype.onExecute = function() {\n        var x = this.getInputData(0);\n        if (x == null) {\n            x = this.properties.x;\n        }\n        var y = this.getInputData(1);\n        if (y == null) {\n            y = this.properties.y;\n        }\n        var z = this.getInputData(2);\n        if (z == null) {\n            z = this.properties.z;\n        }\n        var w = this.getInputData(3);\n        if (w == null) {\n            w = this.properties.w;\n        }\n\n        var data = this._data;\n        data[0] = x;\n        data[1] = y;\n        data[2] = z;\n        data[3] = w;\n\n        this.setOutputData(0, data);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/xyzw-to-vec4\", Math3DXYZWToVec4);\n\n})(this);\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n\r\n\tfunction Math3DMat4()\r\n\t{\r\n        this.addInput(\"T\", \"vec3\");\r\n        this.addInput(\"R\", \"vec3\");\r\n        this.addInput(\"S\", \"vec3\");\r\n        this.addOutput(\"mat4\", \"mat4\");\r\n\t\tthis.properties = {\r\n\t\t\t\"T\":[0,0,0],\r\n\t\t\t\"R\":[0,0,0],\r\n\t\t\t\"S\":[1,1,1],\r\n\t\t\tR_in_degrees: true\r\n\t\t};\r\n\t\tthis._result = mat4.create();\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tMath3DMat4.title = \"mat4\";\r\n\tMath3DMat4.temp_quat = new Float32Array([0,0,0,1]);\r\n\tMath3DMat4.temp_mat4 = new Float32Array(16);\r\n\tMath3DMat4.temp_vec3 = new Float32Array(3);\r\n\r\n\tMath3DMat4.prototype.onPropertyChanged = function(name, value)\r\n\t{\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tMath3DMat4.prototype.onExecute = function()\r\n\t{\r\n\t\tvar M = this._result;\r\n\t\tvar Q = Math3DMat4.temp_quat;\r\n\t\tvar temp_mat4 = Math3DMat4.temp_mat4;\r\n\t\tvar temp_vec3 = Math3DMat4.temp_vec3;\r\n\r\n\t\tvar T = this.getInputData(0);\r\n\t\tvar R = this.getInputData(1);\r\n\t\tvar S = this.getInputData(2);\r\n\r\n\t\tif( this._must_update || T || R || S )\r\n\t\t{\r\n\t\t\tT = T || this.properties.T;\r\n\t\t\tR = R || this.properties.R;\r\n\t\t\tS = S || this.properties.S;\r\n\t\t\tmat4.identity( M );\r\n\t\t\tmat4.translate( M, M, T );\r\n\t\t\tif(this.properties.R_in_degrees)\r\n\t\t\t{\r\n\t\t\t\ttemp_vec3.set( R );\r\n\t\t\t\tvec3.scale(temp_vec3,temp_vec3,DEG2RAD);\r\n\t\t\t\tquat.fromEuler( Q, temp_vec3 );\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tquat.fromEuler( Q, R );\r\n\t\t\tmat4.fromQuat( temp_mat4, Q );\r\n\t\t\tmat4.multiply( M, M, temp_mat4 );\r\n\t\t\tmat4.scale( M, M, S );\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0, M);\t\t\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"math3d/mat4\", Math3DMat4);\r\n\r\n    //Math 3D operation\r\n    function Math3DOperation() {\r\n        this.addInput(\"A\", \"number,vec3\");\r\n        this.addInput(\"B\", \"number,vec3\");\r\n        this.addOutput(\"=\", \"number,vec3\");\r\n        this.addProperty(\"OP\", \"+\", \"enum\", { values: Math3DOperation.values });\r\n\t\tthis._result = vec3.create();\r\n    }\r\n\r\n    Math3DOperation.values = [\"+\", \"-\", \"*\", \"/\", \"%\", \"^\", \"max\", \"min\",\"dot\",\"cross\"];\r\n\r\n    LiteGraph.registerSearchboxExtra(\"math3d/operation\", \"CROSS()\", {\r\n        properties: {\"OP\":\"cross\"},\r\n        title: \"CROSS()\"\r\n    });\r\n\r\n    LiteGraph.registerSearchboxExtra(\"math3d/operation\", \"DOT()\", {\r\n        properties: {\"OP\":\"dot\"},\r\n        title: \"DOT()\"\r\n    });\r\n\r\n\tMath3DOperation.title = \"Operation\";\r\n    Math3DOperation.desc = \"Easy math 3D operators\";\r\n    Math3DOperation[\"@OP\"] = {\r\n        type: \"enum\",\r\n        title: \"operation\",\r\n        values: Math3DOperation.values\r\n    };\r\n    Math3DOperation.size = [100, 60];\r\n\r\n    Math3DOperation.prototype.getTitle = function() {\r\n\t\tif(this.properties.OP == \"max\" || this.properties.OP == \"min\" )\r\n\t\t\treturn this.properties.OP + \"(A,B)\";\r\n        return \"A \" + this.properties.OP + \" B\";\r\n    };\r\n\r\n    Math3DOperation.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        var B = this.getInputData(1);\r\n\t\tif(A == null || B == null)\r\n\t\t\treturn;\r\n\t\tif(A.constructor === Number)\r\n\t\t\tA = [A,A,A];\r\n\t\tif(B.constructor === Number)\r\n\t\t\tB = [B,B,B];\r\n\r\n        var result = this._result;\r\n        switch (this.properties.OP) {\r\n            case \"+\":\r\n                result = vec3.add(result,A,B);\r\n                break;\r\n            case \"-\":\r\n                result = vec3.sub(result,A,B);\r\n                break;\r\n            case \"x\":\r\n            case \"X\":\r\n            case \"*\":\r\n                result = vec3.mul(result,A,B);\r\n                break;\r\n            case \"/\":\r\n                result = vec3.div(result,A,B);\r\n                break;\r\n            case \"%\":\r\n                result[0] = A[0]%B[0];\r\n                result[1] = A[1]%B[1];\r\n                result[2] = A[2]%B[2];\r\n                break;\r\n            case \"^\":\r\n                result[0] = Math.pow(A[0],B[0]);\r\n                result[1] = Math.pow(A[1],B[1]);\r\n                result[2] = Math.pow(A[2],B[2]);\r\n                break;\r\n            case \"max\":\r\n                result[0] = Math.max(A[0],B[0]);\r\n                result[1] = Math.max(A[1],B[1]);\r\n                result[2] = Math.max(A[2],B[2]);\r\n                break;\r\n            case \"min\":\r\n                result[0] = Math.min(A[0],B[0]);\r\n                result[1] = Math.min(A[1],B[1]);\r\n                result[2] = Math.min(A[2],B[2]);\r\n            case \"dot\":\r\n                result = vec3.dot(A,B);\r\n                break;\r\n            case \"cross\":\r\n                vec3.cross(result,A,B);\r\n                break;\r\n            default:\r\n                console.warn(\"Unknown operation: \" + this.properties.OP);\r\n        }\r\n        this.setOutputData(0, result);\r\n    };\r\n\r\n    Math3DOperation.prototype.onDrawBackground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        ctx.font = \"40px Arial\";\r\n        ctx.fillStyle = \"#666\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(\r\n            this.properties.OP,\r\n            this.size[0] * 0.5,\r\n            (this.size[1] + LiteGraph.NODE_TITLE_HEIGHT) * 0.5\r\n        );\r\n        ctx.textAlign = \"left\";\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/operation\", Math3DOperation);\r\n\r\n    function Math3DVec3Scale() {\r\n        this.addInput(\"in\", \"vec3\");\r\n        this.addInput(\"f\", \"number\");\r\n        this.addOutput(\"out\", \"vec3\");\r\n        this.properties = { f: 1 };\r\n        this._data = new Float32Array(3);\r\n    }\r\n\r\n    Math3DVec3Scale.title = \"vec3_scale\";\r\n    Math3DVec3Scale.desc = \"scales the components of a vec3\";\r\n\r\n    Math3DVec3Scale.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n        if (v == null) {\r\n            return;\r\n        }\r\n        var f = this.getInputData(1);\r\n        if (f == null) {\r\n            f = this.properties.f;\r\n        }\r\n\r\n        var data = this._data;\r\n        data[0] = v[0] * f;\r\n        data[1] = v[1] * f;\r\n        data[2] = v[2] * f;\r\n        this.setOutputData(0, data);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-scale\", Math3DVec3Scale);\r\n\r\n    function Math3DVec3Length() {\r\n        this.addInput(\"in\", \"vec3\");\r\n        this.addOutput(\"out\", \"number\");\r\n    }\r\n\r\n    Math3DVec3Length.title = \"vec3_length\";\r\n    Math3DVec3Length.desc = \"returns the module of a vector\";\r\n\r\n    Math3DVec3Length.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n        if (v == null) {\r\n            return;\r\n        }\r\n        var dist = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n        this.setOutputData(0, dist);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-length\", Math3DVec3Length);\r\n\r\n    function Math3DVec3Normalize() {\r\n        this.addInput(\"in\", \"vec3\");\r\n        this.addOutput(\"out\", \"vec3\");\r\n        this._data = new Float32Array(3);\r\n    }\r\n\r\n    Math3DVec3Normalize.title = \"vec3_normalize\";\r\n    Math3DVec3Normalize.desc = \"returns the vector normalized\";\r\n\r\n    Math3DVec3Normalize.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n        if (v == null) {\r\n            return;\r\n        }\r\n        var dist = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n        var data = this._data;\r\n        data[0] = v[0] / dist;\r\n        data[1] = v[1] / dist;\r\n        data[2] = v[2] / dist;\r\n\r\n        this.setOutputData(0, data);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-normalize\", Math3DVec3Normalize);\r\n\r\n    function Math3DVec3Lerp() {\r\n        this.addInput(\"A\", \"vec3\");\r\n        this.addInput(\"B\", \"vec3\");\r\n        this.addInput(\"f\", \"vec3\");\r\n        this.addOutput(\"out\", \"vec3\");\r\n        this.properties = { f: 0.5 };\r\n        this._data = new Float32Array(3);\r\n    }\r\n\r\n    Math3DVec3Lerp.title = \"vec3_lerp\";\r\n    Math3DVec3Lerp.desc = \"returns the interpolated vector\";\r\n\r\n    Math3DVec3Lerp.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        if (A == null) {\r\n            return;\r\n        }\r\n        var B = this.getInputData(1);\r\n        if (B == null) {\r\n            return;\r\n        }\r\n        var f = this.getInputOrProperty(\"f\");\r\n\r\n        var data = this._data;\r\n        data[0] = A[0] * (1 - f) + B[0] * f;\r\n        data[1] = A[1] * (1 - f) + B[1] * f;\r\n        data[2] = A[2] * (1 - f) + B[2] * f;\r\n\r\n        this.setOutputData(0, data);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-lerp\", Math3DVec3Lerp);\r\n\r\n    function Math3DVec3Dot() {\r\n        this.addInput(\"A\", \"vec3\");\r\n        this.addInput(\"B\", \"vec3\");\r\n        this.addOutput(\"out\", \"number\");\r\n    }\r\n\r\n    Math3DVec3Dot.title = \"vec3_dot\";\r\n    Math3DVec3Dot.desc = \"returns the dot product\";\r\n\r\n    Math3DVec3Dot.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        if (A == null) {\r\n            return;\r\n        }\r\n        var B = this.getInputData(1);\r\n        if (B == null) {\r\n            return;\r\n        }\r\n\r\n        var dot = A[0] * B[0] + A[1] * B[1] + A[2] * B[2];\r\n        this.setOutputData(0, dot);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-dot\", Math3DVec3Dot);\r\n\r\n    //if glMatrix is installed...\r\n    if (global.glMatrix) {\r\n        function Math3DQuaternion() {\r\n            this.addOutput(\"quat\", \"quat\");\r\n            this.properties = { x: 0, y: 0, z: 0, w: 1, normalize: false };\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DQuaternion.title = \"Quaternion\";\r\n        Math3DQuaternion.desc = \"quaternion\";\r\n\r\n        Math3DQuaternion.prototype.onExecute = function() {\r\n            this._value[0] = this.getInputOrProperty(\"x\");\r\n            this._value[1] = this.getInputOrProperty(\"y\");\r\n            this._value[2] = this.getInputOrProperty(\"z\");\r\n            this._value[3] = this.getInputOrProperty(\"w\");\r\n            if (this.properties.normalize) {\r\n                quat.normalize(this._value, this._value);\r\n            }\r\n            this.setOutputData(0, this._value);\r\n        };\r\n\r\n        Math3DQuaternion.prototype.onGetInputs = function() {\r\n            return [\r\n                [\"x\", \"number\"],\r\n                [\"y\", \"number\"],\r\n                [\"z\", \"number\"],\r\n                [\"w\", \"number\"]\r\n            ];\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/quaternion\", Math3DQuaternion);\r\n\r\n        function Math3DRotation() {\r\n            this.addInputs([[\"degrees\", \"number\"], [\"axis\", \"vec3\"]]);\r\n            this.addOutput(\"quat\", \"quat\");\r\n            this.properties = { angle: 90.0, axis: vec3.fromValues(0, 1, 0) };\r\n\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DRotation.title = \"Rotation\";\r\n        Math3DRotation.desc = \"quaternion rotation\";\r\n\r\n        Math3DRotation.prototype.onExecute = function() {\r\n            var angle = this.getInputData(0);\r\n            if (angle == null) {\r\n                angle = this.properties.angle;\r\n            }\r\n            var axis = this.getInputData(1);\r\n            if (axis == null) {\r\n                axis = this.properties.axis;\r\n            }\r\n\r\n            var R = quat.setAxisAngle(this._value, axis, angle * 0.0174532925);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/rotation\", Math3DRotation);\r\n\r\n\r\n        function MathEulerToQuat() {\r\n            this.addInput(\"euler\", \"vec3\");\r\n            this.addOutput(\"quat\", \"quat\");\r\n            this.properties = { euler:[0,0,0], use_yaw_pitch_roll: false };\r\n\t\t\tthis._degs = vec3.create();\r\n            this._value = quat.create();\r\n        }\r\n\r\n        MathEulerToQuat.title = \"Euler->Quat\";\r\n        MathEulerToQuat.desc = \"Converts euler angles (in degrees) to quaternion\";\r\n\r\n        MathEulerToQuat.prototype.onExecute = function() {\r\n            var euler = this.getInputData(0);\r\n            if (euler == null) {\r\n                euler = this.properties.euler;\r\n            }\r\n\t\t\tvec3.scale( this._degs, euler, DEG2RAD );\r\n\t\t\tif(this.properties.use_yaw_pitch_roll)\r\n\t\t\t\tthis._degs = [this._degs[2],this._degs[0],this._degs[1]];\r\n            var R = quat.fromEuler(this._value, this._degs);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/euler_to_quat\", MathEulerToQuat);\r\n\r\n        function MathQuatToEuler() {\r\n            this.addInput([\"quat\", \"quat\"]);\r\n            this.addOutput(\"euler\", \"vec3\");\r\n\t\t\tthis._value = vec3.create();\r\n        }\r\n\r\n        MathQuatToEuler.title = \"Euler->Quat\";\r\n        MathQuatToEuler.desc = \"Converts rotX,rotY,rotZ in degrees to quat\";\r\n\r\n        MathQuatToEuler.prototype.onExecute = function() {\r\n            var q = this.getInputData(0);\r\n\t\t\tif(!q)\r\n\t\t\t\treturn;\r\n            var R = quat.toEuler(this._value, q);\r\n\t\t\tvec3.scale( this._value, this._value, DEG2RAD );\r\n            this.setOutputData(0, this._value);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/quat_to_euler\", MathQuatToEuler);\r\n\r\n\r\n        //Math3D rotate vec3\r\n        function Math3DRotateVec3() {\r\n            this.addInputs([[\"vec3\", \"vec3\"], [\"quat\", \"quat\"]]);\r\n            this.addOutput(\"result\", \"vec3\");\r\n            this.properties = { vec: [0, 0, 1] };\r\n        }\r\n\r\n        Math3DRotateVec3.title = \"Rot. Vec3\";\r\n        Math3DRotateVec3.desc = \"rotate a point\";\r\n\r\n        Math3DRotateVec3.prototype.onExecute = function() {\r\n            var vec = this.getInputData(0);\r\n            if (vec == null) {\r\n                vec = this.properties.vec;\r\n            }\r\n            var quat = this.getInputData(1);\r\n            if (quat == null) {\r\n                this.setOutputData(vec);\r\n            } else {\r\n                this.setOutputData(\r\n                    0,\r\n                    vec3.transformQuat(vec3.create(), vec, quat)\r\n                );\r\n            }\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/rotate_vec3\", Math3DRotateVec3);\r\n\r\n        function Math3DMultQuat() {\r\n            this.addInputs([[\"A\", \"quat\"], [\"B\", \"quat\"]]);\r\n            this.addOutput(\"A*B\", \"quat\");\r\n\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DMultQuat.title = \"Mult. Quat\";\r\n        Math3DMultQuat.desc = \"rotate quaternion\";\r\n\r\n        Math3DMultQuat.prototype.onExecute = function() {\r\n            var A = this.getInputData(0);\r\n            if (A == null) {\r\n                return;\r\n            }\r\n            var B = this.getInputData(1);\r\n            if (B == null) {\r\n                return;\r\n            }\r\n\r\n            var R = quat.multiply(this._value, A, B);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/mult-quat\", Math3DMultQuat);\r\n\r\n        function Math3DQuatSlerp() {\r\n            this.addInputs([\r\n                [\"A\", \"quat\"],\r\n                [\"B\", \"quat\"],\r\n                [\"factor\", \"number\"]\r\n            ]);\r\n            this.addOutput(\"slerp\", \"quat\");\r\n            this.addProperty(\"factor\", 0.5);\r\n\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DQuatSlerp.title = \"Quat Slerp\";\r\n        Math3DQuatSlerp.desc = \"quaternion spherical interpolation\";\r\n\r\n        Math3DQuatSlerp.prototype.onExecute = function() {\r\n            var A = this.getInputData(0);\r\n            if (A == null) {\r\n                return;\r\n            }\r\n            var B = this.getInputData(1);\r\n            if (B == null) {\r\n                return;\r\n            }\r\n            var factor = this.properties.factor;\r\n            if (this.getInputData(2) != null) {\r\n                factor = this.getInputData(2);\r\n            }\r\n\r\n            var R = quat.slerp(this._value, A, B, factor);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/quat-slerp\", Math3DQuatSlerp);\r\n\r\n\r\n        //Math3D rotate vec3\r\n        function Math3DRemapRange() {\r\n            this.addInput(\"vec3\", \"vec3\");\r\n            this.addOutput(\"remap\", \"vec3\");\r\n\t\t\tthis.addOutput(\"clamped\", \"vec3\");\r\n            this.properties = { clamp: true, range_min: [-1, -1, 0], range_max: [1, 1, 0], target_min: [-1,-1,0], target_max:[1,1,0] };\r\n\t\t\tthis._value = vec3.create();\r\n\t\t\tthis._clamped = vec3.create();\r\n        }\r\n\r\n        Math3DRemapRange.title = \"Remap Range\";\r\n        Math3DRemapRange.desc = \"remap a 3D range\";\r\n\r\n        Math3DRemapRange.prototype.onExecute = function() {\r\n            var vec = this.getInputData(0);\r\n\t\t\tif(vec)\r\n\t\t\t\tthis._value.set(vec);\r\n\t\t\tvar range_min = this.properties.range_min;\r\n\t\t\tvar range_max = this.properties.range_max;\r\n\t\t\tvar target_min = this.properties.target_min;\r\n\t\t\tvar target_max = this.properties.target_max;\r\n\r\n\t\t\t//swap to avoid errors\r\n\t\t\t/*\r\n\t\t\tif(range_min > range_max)\r\n\t\t\t{\r\n\t\t\t\trange_min = range_max;\r\n\t\t\t\trange_max = this.properties.range_min;\r\n\t\t\t}\r\n\r\n\t\t\tif(target_min > target_max)\r\n\t\t\t{\r\n\t\t\t\ttarget_min = target_max;\r\n\t\t\t\ttarget_max = this.properties.target_min;\r\n\t\t\t}\r\n\t\t\t*/\r\n\r\n\t\t\tfor(var i = 0; i < 3; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar r = range_max[i] - range_min[i];\r\n\t\t\t\tthis._clamped[i] = clamp( this._value[i], range_min[i], range_max[i] );\r\n\t\t\t\tif(r == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._value[i] = (target_min[i] + target_max[i]) * 0.5;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar n = (this._value[i] - range_min[i]) / r;\r\n\t\t\t\tif(this.properties.clamp)\r\n\t\t\t\t\tn = clamp(n,0,1);\r\n\t\t\t\tvar t = target_max[i] - target_min[i];\r\n\t\t\t\tthis._value[i] = target_min[i] + n * t;\r\n\t\t\t}\r\n\r\n\t\t\tthis.setOutputData(0,this._value);\r\n\t\t\tthis.setOutputData(1,this._clamped);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/remap_range\", Math3DRemapRange);\r\n\r\n\r\n\r\n    } //glMatrix\r\n\telse if (LiteGraph.debug)\r\n\t\tconsole.warn(\"No glmatrix found, some Math3D nodes may not work\");\r\n\r\n})(this);\r\n\n//basic nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    function toString(a) {\r\n\t\tif(a && a.constructor === Object)\r\n\t\t{\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\treturn JSON.stringify(a);\r\n\t\t\t}\r\n\t\t\tcatch (err)\r\n\t\t\t{\r\n\t\t\t\treturn String(a);\r\n\t\t\t}\r\n\t\t}\r\n        return String(a);\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\"string/toString\", toString, [\"\"], \"string\");\r\n\r\n    function compare(a, b) {\r\n        return a == b;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/compare\",\r\n        compare,\r\n        [\"string\", \"string\"],\r\n        \"boolean\"\r\n    );\r\n\r\n    function concatenate(a, b) {\r\n        if (a === undefined) {\r\n            return b;\r\n        }\r\n        if (b === undefined) {\r\n            return a;\r\n        }\r\n        return a + b;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/concatenate\",\r\n        concatenate,\r\n        [\"string\", \"string\"],\r\n        \"string\"\r\n    );\r\n\r\n    function contains(a, b) {\r\n        if (a === undefined || b === undefined) {\r\n            return false;\r\n        }\r\n        return a.indexOf(b) != -1;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/contains\",\r\n        contains,\r\n        [\"string\", \"string\"],\r\n        \"boolean\"\r\n    );\r\n\r\n    function toUpperCase(a) {\r\n        if (a != null && a.constructor === String) {\r\n            return a.toUpperCase();\r\n        }\r\n        return a;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/toUpperCase\",\r\n        toUpperCase,\r\n        [\"string\"],\r\n        \"string\"\r\n    );\r\n\r\n    function split(str, separator) {\r\n\t\tif(separator == null)\r\n\t\t\tseparator = this.properties.separator;\r\n        if (str == null )\r\n\t        return [];\r\n\t\tif( str.constructor === String )\r\n\t\t\treturn str.split(separator || \" \");\r\n\t\telse if( str.constructor === Array )\r\n\t\t{\r\n\t\t\tvar r = [];\r\n\t\t\tfor(var i = 0; i < str.length; ++i){\r\n                if (typeof str[i] == \"string\")\r\n\t\t\t\t    r[i] = str[i].split(separator || \" \");\r\n            }\r\n\t\t\treturn r;\r\n\t\t}\r\n        return null;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/split\",\r\n        split,\r\n        [\"string,array\", \"string\"],\r\n        \"array\",\r\n\t\t{ separator: \",\" }\r\n    );\r\n\r\n    function toFixed(a) {\r\n        if (a != null && a.constructor === Number) {\r\n            return a.toFixed(this.properties.precision);\r\n        }\r\n        return a;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/toFixed\",\r\n        toFixed,\r\n        [\"number\"],\r\n        \"string\",\r\n        { precision: 0 }\r\n    );\r\n\r\n\r\n    function StringToTable() {\r\n        this.addInput(\"\", \"string\");\r\n        this.addOutput(\"table\", \"table\");\r\n        this.addOutput(\"rows\", \"number\");\r\n        this.addProperty(\"value\", \"\");\r\n        this.addProperty(\"separator\", \",\");\r\n\t\tthis._table = null;\r\n    }\r\n\r\n    StringToTable.title = \"toTable\";\r\n    StringToTable.desc = \"Splits a string to table\";\r\n\r\n    StringToTable.prototype.onExecute = function() {\r\n        var input = this.getInputData(0);\r\n\t\tif(!input)\r\n\t\t\treturn;\r\n\t\tvar separator = this.properties.separator || \",\";\r\n\t\tif(input != this._str || separator != this._last_separator )\r\n\t\t{\r\n\t\t\tthis._last_separator = separator;\r\n\t\t\tthis._str = input;\r\n\t\t\tthis._table = input.split(\"\\n\").map(function(a){ return a.trim().split(separator)});\r\n\t\t}\r\n        this.setOutputData(0, this._table );\r\n        this.setOutputData(1, this._table ? this._table.length : 0 );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"string/toTable\", StringToTable);\r\n\r\n})(this);\r\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    function Selector() {\n        this.addInput(\"sel\", \"number\");\n        this.addInput(\"A\");\n        this.addInput(\"B\");\n        this.addInput(\"C\");\n        this.addInput(\"D\");\n        this.addOutput(\"out\");\n\n        this.selected = 0;\n    }\n\n    Selector.title = \"Selector\";\n    Selector.desc = \"selects an output\";\n\n    Selector.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        ctx.fillStyle = \"#AFB\";\n        var y = (this.selected + 1) * LiteGraph.NODE_SLOT_HEIGHT + 6;\n        ctx.beginPath();\n        ctx.moveTo(50, y);\n        ctx.lineTo(50, y + LiteGraph.NODE_SLOT_HEIGHT);\n        ctx.lineTo(34, y + LiteGraph.NODE_SLOT_HEIGHT * 0.5);\n        ctx.fill();\n    };\n\n    Selector.prototype.onExecute = function() {\n        var sel = this.getInputData(0);\n        if (sel == null || sel.constructor !== Number)\n            sel = 0;\n        this.selected = sel = Math.round(sel) % (this.inputs.length - 1);\n        var v = this.getInputData(sel + 1);\n        if (v !== undefined) {\n            this.setOutputData(0, v);\n        }\n    };\n\n    Selector.prototype.onGetInputs = function() {\n        return [[\"E\", 0], [\"F\", 0], [\"G\", 0], [\"H\", 0]];\n    };\n\n    LiteGraph.registerNodeType(\"logic/selector\", Selector);\n\n    function Sequence() {\n        this.properties = {\n            sequence: \"A,B,C\"\n        };\n        this.addInput(\"index\", \"number\");\n        this.addInput(\"seq\");\n        this.addOutput(\"out\");\n\n        this.index = 0;\n        this.values = this.properties.sequence.split(\",\");\n    }\n\n    Sequence.title = \"Sequence\";\n    Sequence.desc = \"select one element from a sequence from a string\";\n\n    Sequence.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"sequence\") {\n            this.values = value.split(\",\");\n        }\n    };\n\n    Sequence.prototype.onExecute = function() {\n        var seq = this.getInputData(1);\n        if (seq && seq != this.current_sequence) {\n            this.values = seq.split(\",\");\n            this.current_sequence = seq;\n        }\n        var index = this.getInputData(0);\n        if (index == null) {\n            index = 0;\n        }\n        this.index = index = Math.round(index) % this.values.length;\n\n        this.setOutputData(0, this.values[index]);\n    };\n\n    LiteGraph.registerNodeType(\"logic/sequence\", Sequence);\n\t\n    \n    function logicAnd(){\n        this.properties = { };\n        this.addInput(\"a\", \"boolean\");\n        this.addInput(\"b\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicAnd.title = \"AND\";\n    logicAnd.desc = \"Return true if all inputs are true\";\n    logicAnd.prototype.onExecute = function() {\n        var ret = true;\n        for (var inX in this.inputs){\n            if (!this.getInputData(inX)){\n                var ret = false;\n                break;\n            }\n        }\n        this.setOutputData(0, ret);\n    };\n    logicAnd.prototype.onGetInputs = function() {\n        return [\n            [\"and\", \"boolean\"]\n        ];\n    };\n    LiteGraph.registerNodeType(\"logic/AND\", logicAnd);\n    \n    \n    function logicOr(){\n        this.properties = { };\n        this.addInput(\"a\", \"boolean\");\n        this.addInput(\"b\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicOr.title = \"OR\";\n    logicOr.desc = \"Return true if at least one input is true\";\n    logicOr.prototype.onExecute = function() {\n        var ret = false;\n        for (var inX in this.inputs){\n            if (this.getInputData(inX)){\n                ret = true;\n                break;\n            }\n        }\n        this.setOutputData(0, ret);\n    };\n    logicOr.prototype.onGetInputs = function() {\n        return [\n            [\"or\", \"boolean\"]\n        ];\n    };\n    LiteGraph.registerNodeType(\"logic/OR\", logicOr);\n    \n    \n    function logicNot(){\n        this.properties = { };\n        this.addInput(\"in\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicNot.title = \"NOT\";\n    logicNot.desc = \"Return the logical negation\";\n    logicNot.prototype.onExecute = function() {\n        var ret = !this.getInputData(0);\n        this.setOutputData(0, ret);\n    };\n    LiteGraph.registerNodeType(\"logic/NOT\", logicNot);\n    \n    \n    function logicCompare(){\n        this.properties = { };\n        this.addInput(\"a\", \"boolean\");\n        this.addInput(\"b\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicCompare.title = \"bool == bool\";\n    logicCompare.desc = \"Compare for logical equality\";\n    logicCompare.prototype.onExecute = function() {\n        var last = null;\n        var ret = true;\n        for (var inX in this.inputs){\n            if (last === null) last = this.getInputData(inX);\n            else\n                if (last != this.getInputData(inX)){\n                    ret = false;\n                    break;\n                }\n        }\n        this.setOutputData(0, ret);\n    };\n    logicCompare.prototype.onGetInputs = function() {\n        return [\n            [\"bool\", \"boolean\"]\n        ];\n    };\n    LiteGraph.registerNodeType(\"logic/CompareBool\", logicCompare);\n    \n    \n    function logicBranch(){\n        this.properties = { };\n        this.addInput(\"onTrigger\", LiteGraph.ACTION);\n        this.addInput(\"condition\", \"boolean\");\n        this.addOutput(\"true\", LiteGraph.EVENT);\n        this.addOutput(\"false\", LiteGraph.EVENT);\n        this.mode = LiteGraph.ON_TRIGGER;\n    }\n    logicBranch.title = \"Branch\";\n    logicBranch.desc = \"Branch execution on condition\";\n    logicBranch.prototype.onExecute = function(param, options) {\n        var condtition = this.getInputData(1);\n        if (condtition){\n            this.triggerSlot(0);\n        }else{\n            this.triggerSlot(1);\n        }\n    };\n    LiteGraph.registerNodeType(\"logic/IF\", logicBranch);\n})(this);\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    function GraphicsPlot() {\n        this.addInput(\"A\", \"Number\");\n        this.addInput(\"B\", \"Number\");\n        this.addInput(\"C\", \"Number\");\n        this.addInput(\"D\", \"Number\");\n\n        this.values = [[], [], [], []];\n        this.properties = { scale: 2 };\n    }\n\n    GraphicsPlot.title = \"Plot\";\n    GraphicsPlot.desc = \"Plots data over time\";\n    GraphicsPlot.colors = [\"#FFF\", \"#F99\", \"#9F9\", \"#99F\"];\n\n    GraphicsPlot.prototype.onExecute = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        var size = this.size;\n\n        for (var i = 0; i < 4; ++i) {\n            var v = this.getInputData(i);\n            if (v == null) {\n                continue;\n            }\n            var values = this.values[i];\n            values.push(v);\n            if (values.length > size[0]) {\n                values.shift();\n            }\n        }\n    };\n\n    GraphicsPlot.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        var size = this.size;\n\n        var scale = (0.5 * size[1]) / this.properties.scale;\n        var colors = GraphicsPlot.colors;\n        var offset = size[1] * 0.5;\n\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, size[0], size[1]);\n        ctx.strokeStyle = \"#555\";\n        ctx.beginPath();\n        ctx.moveTo(0, offset);\n        ctx.lineTo(size[0], offset);\n        ctx.stroke();\n\n        if (this.inputs) {\n            for (var i = 0; i < 4; ++i) {\n                var values = this.values[i];\n                if (!this.inputs[i] || !this.inputs[i].link) {\n                    continue;\n                }\n                ctx.strokeStyle = colors[i];\n                ctx.beginPath();\n                var v = values[0] * scale * -1 + offset;\n                ctx.moveTo(0, clamp(v, 0, size[1]));\n                for (var j = 1; j < values.length && j < size[0]; ++j) {\n                    var v = values[j] * scale * -1 + offset;\n                    ctx.lineTo(j, clamp(v, 0, size[1]));\n                }\n                ctx.stroke();\n            }\n        }\n    };\n\n    LiteGraph.registerNodeType(\"graphics/plot\", GraphicsPlot);\n\n    function GraphicsImage() {\n        this.addOutput(\"frame\", \"image\");\n        this.properties = { url: \"\" };\n    }\n\n    GraphicsImage.title = \"Image\";\n    GraphicsImage.desc = \"Image loader\";\n    GraphicsImage.widgets = [{ name: \"load\", text: \"Load\", type: \"button\" }];\n\n    GraphicsImage.supported_extensions = [\"jpg\", \"jpeg\", \"png\", \"gif\"];\n\n    GraphicsImage.prototype.onAdded = function() {\n        if (this.properties[\"url\"] != \"\" && this.img == null) {\n            this.loadImage(this.properties[\"url\"]);\n        }\n    };\n\n    GraphicsImage.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        if (this.img && this.size[0] > 5 && this.size[1] > 5 && this.img.width) {\n            ctx.drawImage(this.img, 0, 0, this.size[0], this.size[1]);\n        }\n    };\n\n    GraphicsImage.prototype.onExecute = function() {\n        if (!this.img) {\n            this.boxcolor = \"#000\";\n        }\n        if (this.img && this.img.width) {\n            this.setOutputData(0, this.img);\n        } else {\n            this.setOutputData(0, null);\n        }\n        if (this.img && this.img.dirty) {\n            this.img.dirty = false;\n        }\n    };\n\n    GraphicsImage.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n        if (name == \"url\" && value != \"\") {\n            this.loadImage(value);\n        }\n\n        return true;\n    };\n\n    GraphicsImage.prototype.loadImage = function(url, callback) {\n        if (url == \"\") {\n            this.img = null;\n            return;\n        }\n\n        this.img = document.createElement(\"img\");\n\n        if (url.substr(0, 4) == \"http\" && LiteGraph.proxy) {\n            url = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\n        }\n\n        this.img.src = url;\n        this.boxcolor = \"#F95\";\n        var that = this;\n        this.img.onload = function() {\n            if (callback) {\n                callback(this);\n            }\n            console.log( \"Image loaded, size: \" + that.img.width + \"x\" + that.img.height );\n            this.dirty = true;\n            that.boxcolor = \"#9F9\";\n            that.setDirtyCanvas(true);\n        };\n        this.img.onerror = function() {\n\t\t\tconsole.log(\"error loading the image:\" + url);\n\t\t}\n    };\n\n    GraphicsImage.prototype.onWidget = function(e, widget) {\n        if (widget.name == \"load\") {\n            this.loadImage(this.properties[\"url\"]);\n        }\n    };\n\n    GraphicsImage.prototype.onDropFile = function(file) {\n        var that = this;\n        if (this._url) {\n            URL.revokeObjectURL(this._url);\n        }\n        this._url = URL.createObjectURL(file);\n        this.properties.url = this._url;\n        this.loadImage(this._url, function(img) {\n            that.size[1] = (img.height / img.width) * that.size[0];\n        });\n    };\n\n    LiteGraph.registerNodeType(\"graphics/image\", GraphicsImage);\n\n    function ColorPalette() {\n        this.addInput(\"f\", \"number\");\n        this.addOutput(\"Color\", \"color\");\n        this.properties = {\n            colorA: \"#444444\",\n            colorB: \"#44AAFF\",\n            colorC: \"#44FFAA\",\n            colorD: \"#FFFFFF\"\n        };\n    }\n\n    ColorPalette.title = \"Palette\";\n    ColorPalette.desc = \"Generates a color\";\n\n    ColorPalette.prototype.onExecute = function() {\n        var c = [];\n\n        if (this.properties.colorA != null) {\n            c.push(hex2num(this.properties.colorA));\n        }\n        if (this.properties.colorB != null) {\n            c.push(hex2num(this.properties.colorB));\n        }\n        if (this.properties.colorC != null) {\n            c.push(hex2num(this.properties.colorC));\n        }\n        if (this.properties.colorD != null) {\n            c.push(hex2num(this.properties.colorD));\n        }\n\n        var f = this.getInputData(0);\n        if (f == null) {\n            f = 0.5;\n        }\n        if (f > 1.0) {\n            f = 1.0;\n        } else if (f < 0.0) {\n            f = 0.0;\n        }\n\n        if (c.length == 0) {\n            return;\n        }\n\n        var result = [0, 0, 0];\n        if (f == 0) {\n            result = c[0];\n        } else if (f == 1) {\n            result = c[c.length - 1];\n        } else {\n            var pos = (c.length - 1) * f;\n            var c1 = c[Math.floor(pos)];\n            var c2 = c[Math.floor(pos) + 1];\n            var t = pos - Math.floor(pos);\n            result[0] = c1[0] * (1 - t) + c2[0] * t;\n            result[1] = c1[1] * (1 - t) + c2[1] * t;\n            result[2] = c1[2] * (1 - t) + c2[2] * t;\n        }\n\n        /*\n\tc[0] = 1.0 - Math.abs( Math.sin( 0.1 * reModular.getTime() * Math.PI) );\n\tc[1] = Math.abs( Math.sin( 0.07 * reModular.getTime() * Math.PI) );\n\tc[2] = Math.abs( Math.sin( 0.01 * reModular.getTime() * Math.PI) );\n\t*/\n\n        for (var i=0; i < result.length; i++) {\n            result[i] /= 255;\n        }\n\n        this.boxcolor = colorToString(result);\n        this.setOutputData(0, result);\n    };\n\n    LiteGraph.registerNodeType(\"color/palette\", ColorPalette);\n\n    function ImageFrame() {\n        this.addInput(\"\", \"image,canvas\");\n        this.size = [200, 200];\n    }\n\n    ImageFrame.title = \"Frame\";\n    ImageFrame.desc = \"Frame viewerew\";\n    ImageFrame.widgets = [\n        { name: \"resize\", text: \"Resize box\", type: \"button\" },\n        { name: \"view\", text: \"View Image\", type: \"button\" }\n    ];\n\n    ImageFrame.prototype.onDrawBackground = function(ctx) {\n        if (this.frame && !this.flags.collapsed) {\n            ctx.drawImage(this.frame, 0, 0, this.size[0], this.size[1]);\n        }\n    };\n\n    ImageFrame.prototype.onExecute = function() {\n        this.frame = this.getInputData(0);\n        this.setDirtyCanvas(true);\n    };\n\n    ImageFrame.prototype.onWidget = function(e, widget) {\n        if (widget.name == \"resize\" && this.frame) {\n            var width = this.frame.width;\n            var height = this.frame.height;\n\n            if (!width && this.frame.videoWidth != null) {\n                width = this.frame.videoWidth;\n                height = this.frame.videoHeight;\n            }\n\n            if (width && height) {\n                this.size = [width, height];\n            }\n            this.setDirtyCanvas(true, true);\n        } else if (widget.name == \"view\") {\n            this.show();\n        }\n    };\n\n    ImageFrame.prototype.show = function() {\n        //var str = this.canvas.toDataURL(\"image/png\");\n        if (showElement && this.frame) {\n            showElement(this.frame);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"graphics/frame\", ImageFrame);\n\n    function ImageFade() {\n        this.addInputs([\n            [\"img1\", \"image\"],\n            [\"img2\", \"image\"],\n            [\"fade\", \"number\"]\n        ]);\n        this.addOutput(\"\", \"image\");\n        this.properties = { fade: 0.5, width: 512, height: 512 };\n    }\n\n    ImageFade.title = \"Image fade\";\n    ImageFade.desc = \"Fades between images\";\n    ImageFade.widgets = [\n        { name: \"resizeA\", text: \"Resize to A\", type: \"button\" },\n        { name: \"resizeB\", text: \"Resize to B\", type: \"button\" }\n    ];\n\n    ImageFade.prototype.onAdded = function() {\n        this.createCanvas();\n        var ctx = this.canvas.getContext(\"2d\");\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, this.properties[\"width\"], this.properties[\"height\"]);\n    };\n\n    ImageFade.prototype.createCanvas = function() {\n        this.canvas = document.createElement(\"canvas\");\n        this.canvas.width = this.properties[\"width\"];\n        this.canvas.height = this.properties[\"height\"];\n    };\n\n    ImageFade.prototype.onExecute = function() {\n        var ctx = this.canvas.getContext(\"2d\");\n        this.canvas.width = this.canvas.width;\n\n        var A = this.getInputData(0);\n        if (A != null) {\n            ctx.drawImage(A, 0, 0, this.canvas.width, this.canvas.height);\n        }\n\n        var fade = this.getInputData(2);\n        if (fade == null) {\n            fade = this.properties[\"fade\"];\n        } else {\n            this.properties[\"fade\"] = fade;\n        }\n\n        ctx.globalAlpha = fade;\n        var B = this.getInputData(1);\n        if (B != null) {\n            ctx.drawImage(B, 0, 0, this.canvas.width, this.canvas.height);\n        }\n        ctx.globalAlpha = 1.0;\n\n        this.setOutputData(0, this.canvas);\n        this.setDirtyCanvas(true);\n    };\n\n    LiteGraph.registerNodeType(\"graphics/imagefade\", ImageFade);\n\n    function ImageCrop() {\n        this.addInput(\"\", \"image\");\n        this.addOutput(\"\", \"image\");\n        this.properties = { width: 256, height: 256, x: 0, y: 0, scale: 1.0 };\n        this.size = [50, 20];\n    }\n\n    ImageCrop.title = \"Crop\";\n    ImageCrop.desc = \"Crop Image\";\n\n    ImageCrop.prototype.onAdded = function() {\n        this.createCanvas();\n    };\n\n    ImageCrop.prototype.createCanvas = function() {\n        this.canvas = document.createElement(\"canvas\");\n        this.canvas.width = this.properties[\"width\"];\n        this.canvas.height = this.properties[\"height\"];\n    };\n\n    ImageCrop.prototype.onExecute = function() {\n        var input = this.getInputData(0);\n        if (!input) {\n            return;\n        }\n\n        if (input.width) {\n            var ctx = this.canvas.getContext(\"2d\");\n\n            ctx.drawImage(\n                input,\n                -this.properties[\"x\"],\n                -this.properties[\"y\"],\n                input.width * this.properties[\"scale\"],\n                input.height * this.properties[\"scale\"]\n            );\n            this.setOutputData(0, this.canvas);\n        } else {\n            this.setOutputData(0, null);\n        }\n    };\n\n    ImageCrop.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        if (this.canvas) {\n            ctx.drawImage(\n                this.canvas,\n                0,\n                0,\n                this.canvas.width,\n                this.canvas.height,\n                0,\n                0,\n                this.size[0],\n                this.size[1]\n            );\n        }\n    };\n\n    ImageCrop.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n\n        if (name == \"scale\") {\n            this.properties[name] = parseFloat(value);\n            if (this.properties[name] == 0) {\n                console.error(\"Error in scale\");\n                this.properties[name] = 1.0;\n            }\n        } else {\n            this.properties[name] = parseInt(value);\n        }\n\n        this.createCanvas();\n\n        return true;\n    };\n\n    LiteGraph.registerNodeType(\"graphics/cropImage\", ImageCrop);\n\n    //CANVAS stuff\n\n    function CanvasNode() {\n        this.addInput(\"clear\", LiteGraph.ACTION);\n        this.addOutput(\"\", \"canvas\");\n        this.properties = { width: 512, height: 512, autoclear: true };\n\n        this.canvas = document.createElement(\"canvas\");\n        this.ctx = this.canvas.getContext(\"2d\");\n    }\n\n    CanvasNode.title = \"Canvas\";\n    CanvasNode.desc = \"Canvas to render stuff\";\n\n    CanvasNode.prototype.onExecute = function() {\n        var canvas = this.canvas;\n        var w = this.properties.width | 0;\n        var h = this.properties.height | 0;\n        if (canvas.width != w) {\n            canvas.width = w;\n        }\n        if (canvas.height != h) {\n            canvas.height = h;\n        }\n\n        if (this.properties.autoclear) {\n            this.ctx.clearRect(0, 0, canvas.width, canvas.height);\n        }\n        this.setOutputData(0, canvas);\n    };\n\n    CanvasNode.prototype.onAction = function(action, param) {\n        if (action == \"clear\") {\n            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"graphics/canvas\", CanvasNode);\n\n    function DrawImageNode() {\n        this.addInput(\"canvas\", \"canvas\");\n        this.addInput(\"img\", \"image,canvas\");\n        this.addInput(\"x\", \"number\");\n        this.addInput(\"y\", \"number\");\n        this.properties = { x: 0, y: 0, opacity: 1 };\n    }\n\n    DrawImageNode.title = \"DrawImage\";\n    DrawImageNode.desc = \"Draws image into a canvas\";\n\n    DrawImageNode.prototype.onExecute = function() {\n        var canvas = this.getInputData(0);\n        if (!canvas) {\n            return;\n        }\n\n        var img = this.getInputOrProperty(\"img\");\n        if (!img) {\n            return;\n        }\n\n        var x = this.getInputOrProperty(\"x\");\n        var y = this.getInputOrProperty(\"y\");\n        var ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(img, x, y);\n    };\n\n    LiteGraph.registerNodeType(\"graphics/drawImage\", DrawImageNode);\n\n    function DrawRectangleNode() {\n        this.addInput(\"canvas\", \"canvas\");\n        this.addInput(\"x\", \"number\");\n        this.addInput(\"y\", \"number\");\n        this.addInput(\"w\", \"number\");\n        this.addInput(\"h\", \"number\");\n        this.properties = {\n            x: 0,\n            y: 0,\n            w: 10,\n            h: 10,\n            color: \"white\",\n            opacity: 1\n        };\n    }\n\n    DrawRectangleNode.title = \"DrawRectangle\";\n    DrawRectangleNode.desc = \"Draws rectangle in canvas\";\n\n    DrawRectangleNode.prototype.onExecute = function() {\n        var canvas = this.getInputData(0);\n        if (!canvas) {\n            return;\n        }\n\n        var x = this.getInputOrProperty(\"x\");\n        var y = this.getInputOrProperty(\"y\");\n        var w = this.getInputOrProperty(\"w\");\n        var h = this.getInputOrProperty(\"h\");\n        var ctx = canvas.getContext(\"2d\");\n        ctx.fillRect(x, y, w, h);\n    };\n\n    LiteGraph.registerNodeType(\"graphics/drawRectangle\", DrawRectangleNode);\n\n    function ImageVideo() {\n        this.addInput(\"t\", \"number\");\n        this.addOutputs([[\"frame\", \"image\"], [\"t\", \"number\"], [\"d\", \"number\"]]);\n        this.properties = { url: \"\", use_proxy: true };\n    }\n\n    ImageVideo.title = \"Video\";\n    ImageVideo.desc = \"Video playback\";\n    ImageVideo.widgets = [\n        { name: \"play\", text: \"PLAY\", type: \"minibutton\" },\n        { name: \"stop\", text: \"STOP\", type: \"minibutton\" },\n        { name: \"demo\", text: \"Demo video\", type: \"button\" },\n        { name: \"mute\", text: \"Mute video\", type: \"button\" }\n    ];\n\n    ImageVideo.prototype.onExecute = function() {\n        if (!this.properties.url) {\n            return;\n        }\n\n        if (this.properties.url != this._video_url) {\n            this.loadVideo(this.properties.url);\n        }\n\n        if (!this._video || this._video.width == 0) {\n            return;\n        }\n\n        var t = this.getInputData(0);\n        if (t && t >= 0 && t <= 1.0) {\n            this._video.currentTime = t * this._video.duration;\n            this._video.pause();\n        }\n\n        this._video.dirty = true;\n        this.setOutputData(0, this._video);\n        this.setOutputData(1, this._video.currentTime);\n        this.setOutputData(2, this._video.duration);\n        this.setDirtyCanvas(true);\n    };\n\n    ImageVideo.prototype.onStart = function() {\n        this.play();\n    };\n\n    ImageVideo.prototype.onStop = function() {\n        this.stop();\n    };\n\n    ImageVideo.prototype.loadVideo = function(url) {\n        this._video_url = url;\n\n\t\tvar pos = url.substr(0,10).indexOf(\":\");\n\t\tvar protocol = \"\";\n\t\tif(pos != -1)\n\t\t\tprotocol = url.substr(0,pos);\n\n\t\tvar host = \"\";\n\t\tif(protocol)\n\t\t{\n\t\t\thost = url.substr(0,url.indexOf(\"/\",protocol.length + 3));\n\t\t\thost = host.substr(protocol.length+3);\n\t\t}\n\n        if (\n            this.properties.use_proxy &&\n            protocol &&\n            LiteGraph.proxy &&\n\t\t\thost != location.host\n        ) {\n            url = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\n        }\n\n        this._video = document.createElement(\"video\");\n        this._video.src = url;\n        this._video.type = \"type=video/mp4\";\n\n        this._video.muted = true;\n        this._video.autoplay = true;\n\n        var that = this;\n        this._video.addEventListener(\"loadedmetadata\", function(e) {\n            //onload\n            console.log(\"Duration: \" + this.duration + \" seconds\");\n            console.log(\"Size: \" + this.videoWidth + \",\" + this.videoHeight);\n            that.setDirtyCanvas(true);\n            this.width = this.videoWidth;\n            this.height = this.videoHeight;\n        });\n        this._video.addEventListener(\"progress\", function(e) {\n            //onload\n            console.log(\"video loading...\");\n        });\n        this._video.addEventListener(\"error\", function(e) {\n            console.error(\"Error loading video: \" + this.src);\n            if (this.error) {\n                switch (this.error.code) {\n                    case this.error.MEDIA_ERR_ABORTED:\n                        console.error(\"You stopped the video.\");\n                        break;\n                    case this.error.MEDIA_ERR_NETWORK:\n                        console.error(\"Network error - please try again later.\");\n                        break;\n                    case this.error.MEDIA_ERR_DECODE:\n                        console.error(\"Video is broken..\");\n                        break;\n                    case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:\n                        console.error(\"Sorry, your browser can't play this video.\");\n                        break;\n                }\n            }\n        });\n\n        this._video.addEventListener(\"ended\", function(e) {\n            console.log(\"Video Ended.\");\n            this.play(); //loop\n        });\n\n        //document.body.appendChild(this.video);\n    };\n\n    ImageVideo.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n        if (name == \"url\" && value != \"\") {\n            this.loadVideo(value);\n        }\n\n        return true;\n    };\n\n    ImageVideo.prototype.play = function() {\n        if (this._video && this._video.videoWidth ) { //is loaded\n            this._video.play();\n        }\n    };\n\n    ImageVideo.prototype.playPause = function() {\n        if (!this._video) {\n            return;\n        }\n        if (this._video.paused) {\n            this.play();\n        } else {\n            this.pause();\n        }\n    };\n\n    ImageVideo.prototype.stop = function() {\n        if (!this._video) {\n            return;\n        }\n        this._video.pause();\n        this._video.currentTime = 0;\n    };\n\n    ImageVideo.prototype.pause = function() {\n        if (!this._video) {\n            return;\n        }\n        console.log(\"Video paused\");\n        this._video.pause();\n    };\n\n    ImageVideo.prototype.onWidget = function(e, widget) {\n        /*\n\tif(widget.name == \"demo\")\n\t{\n\t\tthis.loadVideo();\n\t}\n\telse if(widget.name == \"play\")\n\t{\n\t\tif(this._video)\n\t\t\tthis.playPause();\n\t}\n\tif(widget.name == \"stop\")\n\t{\n\t\tthis.stop();\n\t}\n\telse if(widget.name == \"mute\")\n\t{\n\t\tif(this._video)\n\t\t\tthis._video.muted = !this._video.muted;\n\t}\n\t*/\n    };\n\n    LiteGraph.registerNodeType(\"graphics/video\", ImageVideo);\n\n    // Texture Webcam *****************************************\n    function ImageWebcam() {\n        this.addOutput(\"Webcam\", \"image\");\n        this.properties = { filterFacingMode: false, facingMode: \"user\" };\n        this.boxcolor = \"black\";\n        this.frame = 0;\n    }\n\n    ImageWebcam.title = \"Webcam\";\n    ImageWebcam.desc = \"Webcam image\";\n    ImageWebcam.is_webcam_open = false;\n\n    ImageWebcam.prototype.openStream = function() {\n        if (!navigator.mediaDevices.getUserMedia) {\n            console.log('getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags');\n            return;\n        }\n\n        this._waiting_confirmation = true;\n\n        // Not showing vendor prefixes.\n        var constraints = {\n            audio: false,\n            video: !this.properties.filterFacingMode ? true : { facingMode: this.properties.facingMode }\n        };\n        navigator.mediaDevices\n            .getUserMedia(constraints)\n            .then(this.streamReady.bind(this))\n            .catch(onFailSoHard);\n\n        var that = this;\n        function onFailSoHard(e) {\n            console.log(\"Webcam rejected\", e);\n            that._webcam_stream = false;\n            ImageWebcam.is_webcam_open = false;\n            that.boxcolor = \"red\";\n            that.trigger(\"stream_error\");\n        }\n    };\n\n    ImageWebcam.prototype.closeStream = function() {\n        if (this._webcam_stream) {\n            var tracks = this._webcam_stream.getTracks();\n            if (tracks.length) {\n                for (var i = 0; i < tracks.length; ++i) {\n                    tracks[i].stop();\n                }\n            }\n            ImageWebcam.is_webcam_open = false;\n            this._webcam_stream = null;\n            this._video = null;\n            this.boxcolor = \"black\";\n            this.trigger(\"stream_closed\");\n        }\n    };\n\n    ImageWebcam.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"facingMode\") {\n            this.properties.facingMode = value;\n            this.closeStream();\n            this.openStream();\n        }\n    };\n\n    ImageWebcam.prototype.onRemoved = function() {\n        this.closeStream();\n    };\n\n    ImageWebcam.prototype.streamReady = function(localMediaStream) {\n        this._webcam_stream = localMediaStream;\n        //this._waiting_confirmation = false;\n        this.boxcolor = \"green\";\n\n        var video = this._video;\n        if (!video) {\n            video = document.createElement(\"video\");\n            video.autoplay = true;\n            video.srcObject = localMediaStream;\n            this._video = video;\n            //document.body.appendChild( video ); //debug\n            //when video info is loaded (size and so)\n            video.onloadedmetadata = function(e) {\n                // Ready to go. Do some stuff.\n                console.log(e);\n                ImageWebcam.is_webcam_open = true;\n            };\n        }\n\n        this.trigger(\"stream_ready\", video);\n    };\n\n    ImageWebcam.prototype.onExecute = function() {\n        if (this._webcam_stream == null && !this._waiting_confirmation) {\n            this.openStream();\n        }\n\n        if (!this._video || !this._video.videoWidth) {\n            return;\n        }\n\n        this._video.frame = ++this.frame;\n        this._video.width = this._video.videoWidth;\n        this._video.height = this._video.videoHeight;\n        this.setOutputData(0, this._video);\n        for (var i = 1; i < this.outputs.length; ++i) {\n            if (!this.outputs[i]) {\n                continue;\n            }\n            switch (this.outputs[i].name) {\n                case \"width\":\n                    this.setOutputData(i, this._video.videoWidth);\n                    break;\n                case \"height\":\n                    this.setOutputData(i, this._video.videoHeight);\n                    break;\n            }\n        }\n    };\n\n    ImageWebcam.prototype.getExtraMenuOptions = function(graphcanvas) {\n        var that = this;\n        var txt = !that.properties.show ? \"Show Frame\" : \"Hide Frame\";\n        return [\n            {\n                content: txt,\n                callback: function() {\n                    that.properties.show = !that.properties.show;\n                }\n            }\n        ];\n    };\n\n    ImageWebcam.prototype.onDrawBackground = function(ctx) {\n        if (\n            this.flags.collapsed ||\n            this.size[1] <= 20 ||\n            !this.properties.show\n        ) {\n            return;\n        }\n\n        if (!this._video) {\n            return;\n        }\n\n        //render to graph canvas\n        ctx.save();\n        ctx.drawImage(this._video, 0, 0, this.size[0], this.size[1]);\n        ctx.restore();\n    };\n\n    ImageWebcam.prototype.onGetOutputs = function() {\n        return [\n            [\"width\", \"number\"],\n            [\"height\", \"number\"],\n            [\"stream_ready\", LiteGraph.EVENT],\n            [\"stream_closed\", LiteGraph.EVENT],\n            [\"stream_error\", LiteGraph.EVENT]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"graphics/webcam\", ImageWebcam);\n})(this);\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\tvar LGraphCanvas = global.LGraphCanvas;\n\n    //Works with Litegl.js to create WebGL nodes\n    global.LGraphTexture = null;\n\n    if (typeof GL == \"undefined\")\n\t\treturn;\n\n\tLGraphCanvas.link_type_colors[\"Texture\"] = \"#987\";\n\n\tfunction LGraphTexture() {\n\t\tthis.addOutput(\"tex\", \"Texture\");\n\t\tthis.addOutput(\"name\", \"string\");\n\t\tthis.properties = { name: \"\", filter: true };\n\t\tthis.size = [\n\t\t\tLGraphTexture.image_preview_size,\n\t\t\tLGraphTexture.image_preview_size\n\t\t];\n\t}\n\n\tglobal.LGraphTexture = LGraphTexture;\n\n\tLGraphTexture.title = \"Texture\";\n\tLGraphTexture.desc = \"Texture\";\n\tLGraphTexture.widgets_info = {\n\t\tname: { widget: \"texture\" },\n\t\tfilter: { widget: \"checkbox\" }\n\t};\n\n\t//REPLACE THIS TO INTEGRATE WITH YOUR FRAMEWORK\n\tLGraphTexture.loadTextureCallback = null; //function in charge of loading textures when not present in the container\n\tLGraphTexture.image_preview_size = 256;\n\n\t//flags to choose output texture type\n\tLGraphTexture.UNDEFINED = 0; //not specified\n\tLGraphTexture.PASS_THROUGH = 1; //do not apply FX (like disable but passing the in to the out)\n\tLGraphTexture.COPY = 2; //create new texture with the same properties as the origin texture\n\tLGraphTexture.LOW = 3; //create new texture with low precision (byte)\n\tLGraphTexture.HIGH = 4; //create new texture with high precision (half-float)\n\tLGraphTexture.REUSE = 5; //reuse input texture\n\tLGraphTexture.DEFAULT = 2; //use the default\n\n\tLGraphTexture.MODE_VALUES = {\n\t\t\"undefined\": LGraphTexture.UNDEFINED,\n\t\t\"pass through\": LGraphTexture.PASS_THROUGH,\n\t\tcopy: LGraphTexture.COPY,\n\t\tlow: LGraphTexture.LOW,\n\t\thigh: LGraphTexture.HIGH,\n\t\treuse: LGraphTexture.REUSE,\n\t\tdefault: LGraphTexture.DEFAULT\n\t};\n\n\t//returns the container where all the loaded textures are stored (overwrite if you have a Resources Manager)\n\tLGraphTexture.getTexturesContainer = function() {\n\t\treturn gl.textures;\n\t};\n\n\t//process the loading of a texture (overwrite it if you have a Resources Manager)\n\tLGraphTexture.loadTexture = function(name, options) {\n\t\toptions = options || {};\n\t\tvar url = name;\n\t\tif (url.substr(0, 7) == \"http://\") {\n\t\t\tif (LiteGraph.proxy) {\n\t\t\t\t//proxy external files\n\t\t\t\turl = LiteGraph.proxy + url.substr(7);\n\t\t\t}\n\t\t}\n\n\t\tvar container = LGraphTexture.getTexturesContainer();\n\t\tvar tex = (container[name] = GL.Texture.fromURL(url, options));\n\t\treturn tex;\n\t};\n\n\tLGraphTexture.getTexture = function(name) {\n\t\tvar container = this.getTexturesContainer();\n\n\t\tif (!container) {\n\t\t\tthrow \"Cannot load texture, container of textures not found\";\n\t\t}\n\n\t\tvar tex = container[name];\n\t\tif (!tex && name && name[0] != \":\") {\n\t\t\treturn this.loadTexture(name);\n\t\t}\n\n\t\treturn tex;\n\t};\n\n\t//used to compute the appropiate output texture\n\tLGraphTexture.getTargetTexture = function(origin, target, mode) {\n\t\tif (!origin) {\n\t\t\tthrow \"LGraphTexture.getTargetTexture expects a reference texture\";\n\t\t}\n\n\t\tvar tex_type = null;\n\n\t\tswitch (mode) {\n\t\t\tcase LGraphTexture.LOW:\n\t\t\t\ttex_type = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.HIGH:\n\t\t\t\ttex_type = gl.HIGH_PRECISION_FORMAT;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.REUSE:\n\t\t\t\treturn origin;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.COPY:\n\t\t\tdefault:\n\t\t\t\ttex_type = origin ? origin.type : gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (\n\t\t\t!target ||\n\t\t\ttarget.width != origin.width ||\n\t\t\ttarget.height != origin.height ||\n\t\t\ttarget.type != tex_type ||\n\t\t\ttarget.format != origin.format \n\t\t) {\n\t\t\ttarget = new GL.Texture(origin.width, origin.height, {\n\t\t\t\ttype: tex_type,\n\t\t\t\tformat: origin.format,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\treturn target;\n\t};\n\n\tLGraphTexture.getTextureType = function(precision, ref_texture) {\n\t\tvar type = ref_texture ? ref_texture.type : gl.UNSIGNED_BYTE;\n\t\tswitch (precision) {\n\t\t\tcase LGraphTexture.HIGH:\n\t\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.LOW:\n\t\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\t//no default\n\t\t}\n\t\treturn type;\n\t};\n\n\tLGraphTexture.getWhiteTexture = function() {\n\t\tif (this._white_texture) {\n\t\t\treturn this._white_texture;\n\t\t}\n\t\tvar texture = (this._white_texture = GL.Texture.fromMemory(\n\t\t\t1,\n\t\t\t1,\n\t\t\t[255, 255, 255, 255],\n\t\t\t{ format: gl.RGBA, wrap: gl.REPEAT, filter: gl.NEAREST }\n\t\t));\n\t\treturn texture;\n\t};\n\n\tLGraphTexture.getNoiseTexture = function() {\n\t\tif (this._noise_texture) {\n\t\t\treturn this._noise_texture;\n\t\t}\n\n\t\tvar noise = new Uint8Array(512 * 512 * 4);\n\t\tfor (var i = 0; i < 512 * 512 * 4; ++i) {\n\t\t\tnoise[i] = Math.random() * 255;\n\t\t}\n\n\t\tvar texture = GL.Texture.fromMemory(512, 512, noise, {\n\t\t\tformat: gl.RGBA,\n\t\t\twrap: gl.REPEAT,\n\t\t\tfilter: gl.NEAREST\n\t\t});\n\t\tthis._noise_texture = texture;\n\t\treturn texture;\n\t};\n\n\tLGraphTexture.prototype.onDropFile = function(data, filename, file) {\n\t\tif (!data) {\n\t\t\tthis._drop_texture = null;\n\t\t\tthis.properties.name = \"\";\n\t\t} else {\n\t\t\tvar texture = null;\n\t\t\tif (typeof data == \"string\") {\n\t\t\t\ttexture = GL.Texture.fromURL(data);\n\t\t\t} else if (filename.toLowerCase().indexOf(\".dds\") != -1) {\n\t\t\t\ttexture = GL.Texture.fromDDSInMemory(data);\n\t\t\t} else {\n\t\t\t\tvar blob = new Blob([file]);\n\t\t\t\tvar url = URL.createObjectURL(blob);\n\t\t\t\ttexture = GL.Texture.fromURL(url);\n\t\t\t}\n\n\t\t\tthis._drop_texture = texture;\n\t\t\tthis.properties.name = filename;\n\t\t}\n\t};\n\n\tLGraphTexture.prototype.getExtraMenuOptions = function(graphcanvas) {\n\t\tvar that = this;\n\t\tif (!this._drop_texture) {\n\t\t\treturn;\n\t\t}\n\t\treturn [\n\t\t\t{\n\t\t\t\tcontent: \"Clear\",\n\t\t\t\tcallback: function() {\n\t\t\t\t\tthat._drop_texture = null;\n\t\t\t\t\tthat.properties.name = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t};\n\n\tLGraphTexture.prototype.onExecute = function() {\n\t\tvar tex = null;\n\t\tif (this.isOutputConnected(1)) {\n\t\t\ttex = this.getInputData(0);\n\t\t}\n\n\t\tif (!tex && this._drop_texture) {\n\t\t\ttex = this._drop_texture;\n\t\t}\n\n\t\tif (!tex && this.properties.name) {\n\t\t\ttex = LGraphTexture.getTexture(this.properties.name);\n\t\t}\n\n\t\tif (!tex) {\n\t\t\tthis.setOutputData( 0, null );\n\t\t\tthis.setOutputData( 1, \"\" );\n\t\t\treturn;\n\t\t}\n\n\t\tthis._last_tex = tex;\n\n\t\tif (this.properties.filter === false) {\n\t\t\ttex.setParameter(gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t} else {\n\t\t\ttex.setParameter(gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t}\n\n\t\tthis.setOutputData( 0, tex );\n\t\tthis.setOutputData( 1, tex.fullpath || tex.filename );\n\n\t\tfor (var i = 2; i < this.outputs.length; i++) {\n\t\t\tvar output = this.outputs[i];\n\t\t\tif (!output) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar v = null;\n\t\t\tif (output.name == \"width\") {\n\t\t\t\tv = tex.width;\n\t\t\t} else if (output.name == \"height\") {\n\t\t\t\tv = tex.height;\n\t\t\t} else if (output.name == \"aspect\") {\n\t\t\t\tv = tex.width / tex.height;\n\t\t\t}\n\t\t\tthis.setOutputData(i, v);\n\t\t}\n\t};\n\n\tLGraphTexture.prototype.onResourceRenamed = function(\n\t\told_name,\n\t\tnew_name\n\t) {\n\t\tif (this.properties.name == old_name) {\n\t\t\tthis.properties.name = new_name;\n\t\t}\n\t};\n\n\tLGraphTexture.prototype.onDrawBackground = function(ctx) {\n\t\tif (this.flags.collapsed || this.size[1] <= 20) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._drop_texture && ctx.webgl) {\n\t\t\tctx.drawImage(\n\t\t\t\tthis._drop_texture,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tthis.size[0],\n\t\t\t\tthis.size[1]\n\t\t\t);\n\t\t\t//this._drop_texture.renderQuad(this.pos[0],this.pos[1],this.size[0],this.size[1]);\n\t\t\treturn;\n\t\t}\n\n\t\t//Different texture? then get it from the GPU\n\t\tif (this._last_preview_tex != this._last_tex) {\n\t\t\tif (ctx.webgl) {\n\t\t\t\tthis._canvas = this._last_tex;\n\t\t\t} else {\n\t\t\t\tvar tex_canvas = LGraphTexture.generateLowResTexturePreview(\n\t\t\t\t\tthis._last_tex\n\t\t\t\t);\n\t\t\t\tif (!tex_canvas) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._last_preview_tex = this._last_tex;\n\t\t\t\tthis._canvas = cloneCanvas(tex_canvas);\n\t\t\t}\n\t\t}\n\n\t\tif (!this._canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tif (!ctx.webgl) {\n\t\t\t//reverse image\n\t\t\tctx.translate(0, this.size[1]);\n\t\t\tctx.scale(1, -1);\n\t\t}\n\t\tctx.drawImage(this._canvas, 0, 0, this.size[0], this.size[1]);\n\t\tctx.restore();\n\t};\n\n\t//very slow, used at your own risk\n\tLGraphTexture.generateLowResTexturePreview = function(tex) {\n\t\tif (!tex) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar size = LGraphTexture.image_preview_size;\n\t\tvar temp_tex = tex;\n\n\t\tif (tex.format == gl.DEPTH_COMPONENT) {\n\t\t\treturn null;\n\t\t} //cannot generate from depth\n\n\t\t//Generate low-level version in the GPU to speed up\n\t\tif (tex.width > size || tex.height > size) {\n\t\t\ttemp_tex = this._preview_temp_tex;\n\t\t\tif (!this._preview_temp_tex) {\n\t\t\t\ttemp_tex = new GL.Texture(size, size, {\n\t\t\t\t\tminFilter: gl.NEAREST\n\t\t\t\t});\n\t\t\t\tthis._preview_temp_tex = temp_tex;\n\t\t\t}\n\n\t\t\t//copy\n\t\t\ttex.copyTo(temp_tex);\n\t\t\ttex = temp_tex;\n\t\t}\n\n\t\t//create intermediate canvas with lowquality version\n\t\tvar tex_canvas = this._preview_canvas;\n\t\tif (!tex_canvas) {\n\t\t\ttex_canvas = createCanvas(size, size);\n\t\t\tthis._preview_canvas = tex_canvas;\n\t\t}\n\n\t\tif (temp_tex) {\n\t\t\ttemp_tex.toCanvas(tex_canvas);\n\t\t}\n\t\treturn tex_canvas;\n\t};\n\n\tLGraphTexture.prototype.getResources = function(res) {\n\t\tif(this.properties.name)\n\t\t\tres[this.properties.name] = GL.Texture;\n\t\treturn res;\n\t};\n\n\tLGraphTexture.prototype.onGetInputs = function() {\n\t\treturn [[\"in\", \"Texture\"]];\n\t};\n\n\tLGraphTexture.prototype.onGetOutputs = function() {\n\t\treturn [\n\t\t\t[\"width\", \"number\"],\n\t\t\t[\"height\", \"number\"],\n\t\t\t[\"aspect\", \"number\"]\n\t\t];\n\t};\n\n\t//used to replace shader code\n\tLGraphTexture.replaceCode = function( code, context )\n\t{\n\t\treturn code.replace(/\\{\\{[a-zA-Z0-9_]*\\}\\}/g, function(v){\n\t\t\tv = v.replace( /[\\{\\}]/g, \"\" );\n\t\t\treturn context[v] || \"\";\n\t\t});\n\t}\n\n\tLiteGraph.registerNodeType(\"texture/texture\", LGraphTexture);\n\n\t//**************************\n\tfunction LGraphTexturePreview() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.properties = { flipY: false };\n\t\tthis.size = [\n\t\t\tLGraphTexture.image_preview_size,\n\t\t\tLGraphTexture.image_preview_size\n\t\t];\n\t}\n\n\tLGraphTexturePreview.title = \"Preview\";\n\tLGraphTexturePreview.desc = \"Show a texture in the graph canvas\";\n\tLGraphTexturePreview.allow_preview = false;\n\n\tLGraphTexturePreview.prototype.onDrawBackground = function(ctx) {\n\t\tif (this.flags.collapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!ctx.webgl && !LGraphTexturePreview.allow_preview) {\n\t\t\treturn;\n\t\t} //not working well\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tex_canvas = null;\n\n\t\tif (!tex.handle && ctx.webgl) {\n\t\t\ttex_canvas = tex;\n\t\t} else {\n\t\t\ttex_canvas = LGraphTexture.generateLowResTexturePreview(tex);\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tif (this.properties.flipY) {\n\t\t\tctx.translate(0, this.size[1]);\n\t\t\tctx.scale(1, -1);\n\t\t}\n\t\tctx.drawImage(tex_canvas, 0, 0, this.size[0], this.size[1]);\n\t\tctx.restore();\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/preview\", LGraphTexturePreview);\n\n\t//**************************************\n\n\tfunction LGraphTextureSave() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"tex\", \"Texture\");\n\t\tthis.addOutput(\"name\", \"string\");\n\t\tthis.properties = { name: \"\", generate_mipmaps: false };\n\t}\n\n\tLGraphTextureSave.title = \"Save\";\n\tLGraphTextureSave.desc = \"Save a texture in the repository\";\n\n\tLGraphTextureSave.prototype.getPreviewTexture = function()\n\t{\n\t\treturn this._texture;\n\t}\n\n\tLGraphTextureSave.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\ttex.bind(0);\n\t\t\ttex.setParameter( gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR );\n\t\t\tgl.generateMipmap(tex.texture_type);\n\t\t\ttex.unbind(0);\n\t\t}\n\n\t\tif (this.properties.name) {\n\t\t\t//for cases where we want to perform something when storing it\n\t\t\tif (LGraphTexture.storeTexture) {\n\t\t\t\tLGraphTexture.storeTexture(this.properties.name, tex);\n\t\t\t} else {\n\t\t\t\tvar container = LGraphTexture.getTexturesContainer();\n\t\t\t\tcontainer[this.properties.name] = tex;\n\t\t\t}\n\t\t}\n\n\t\tthis._texture = tex;\n\t\tthis.setOutputData(0, tex);\n\t\tthis.setOutputData(1, this.properties.name);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/save\", LGraphTextureSave);\n\n\t//****************************************************\n\n\tfunction LGraphTextureOperation() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"TextureB\", \"Texture\");\n\t\tthis.addInput(\"value\", \"number\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.help = \"<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>\\\n\t\t<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>\";\n\n\t\tthis.properties = {\n\t\t\tvalue: 1,\n\t\t\tpixelcode: \"color + colorB * value\",\n\t\t\tuvcode: \"\",\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis.has_error = false;\n\t}\n\n\tLGraphTextureOperation.widgets_info = {\n\t\tuvcode: { widget: \"code\" },\n\t\tpixelcode: { widget: \"code\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureOperation.title = \"Operation\";\n\tLGraphTextureOperation.desc = \"Texture shader operation\";\n\n\tLGraphTextureOperation.presets = {};\n\n\tLGraphTextureOperation.prototype.getExtraMenuOptions = function(\n\t\tgraphcanvas\n\t) {\n\t\tvar that = this;\n\t\tvar txt = !that.properties.show ? \"Show Texture\" : \"Hide Texture\";\n\t\treturn [\n\t\t\t{\n\t\t\t\tcontent: txt,\n\t\t\t\tcallback: function() {\n\t\t\t\t\tthat.properties.show = !that.properties.show;\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t};\n\n\tLGraphTextureOperation.prototype.onPropertyChanged = function()\n\t{\n\t\tthis.has_error = false;\n\t}\n\n\tLGraphTextureOperation.prototype.onDrawBackground = function(ctx) {\n\t\tif (\n\t\t\tthis.flags.collapsed ||\n\t\t\tthis.size[1] <= 20 ||\n\t\t\t!this.properties.show\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._tex) {\n\t\t\treturn;\n\t\t}\n\n\t\t//only works if using a webgl renderer\n\t\tif (this._tex.gl != ctx) {\n\t\t\treturn;\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tctx.drawImage(this._tex, 0, 0, this.size[0], this.size[1]);\n\t\tctx.restore();\n\t};\n\n\tLGraphTextureOperation.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar texB = this.getInputData(1);\n\n\t\tif (!this.properties.uvcode && !this.properties.pixelcode) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = 512;\n\t\tvar height = 512;\n\t\tif (tex) {\n\t\t\twidth = tex.width;\n\t\t\theight = tex.height;\n\t\t} else if (texB) {\n\t\t\twidth = texB.width;\n\t\t\theight = texB.height;\n\t\t}\n\n\t\tif(!texB)\n\t\t\ttexB = GL.Texture.getWhiteTexture();\n\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, tex );\n\n\t\tif (!tex && !this._tex) {\n\t\t\tthis._tex = new GL.Texture(width, height, { type: type, format: gl.RGBA, filter: gl.LINEAR });\n\t\t} else {\n\t\t\tthis._tex = LGraphTexture.getTargetTexture( tex || this._tex, this._tex, this.properties.precision );\n\t\t}\n\n\t\tvar uvcode = \"\";\n\t\tif (this.properties.uvcode) {\n\t\t\tuvcode = \"uv = \" + this.properties.uvcode;\n\t\t\tif (this.properties.uvcode.indexOf(\";\") != -1) {\n\t\t\t\t//there are line breaks, means multiline code\n\t\t\t\tuvcode = this.properties.uvcode;\n\t\t\t}\n\t\t}\n\n\t\tvar pixelcode = \"\";\n\t\tif (this.properties.pixelcode) {\n\t\t\tpixelcode = \"result = \" + this.properties.pixelcode;\n\t\t\tif (this.properties.pixelcode.indexOf(\";\") != -1) {\n\t\t\t\t//there are line breaks, means multiline code\n\t\t\t\tpixelcode = this.properties.pixelcode;\n\t\t\t}\n\t\t}\n\n\t\tvar shader = this._shader;\n\n\t\tif ( !this.has_error && (!shader || this._shader_code != uvcode + \"|\" + pixelcode) ) {\n\n\t\t\tvar final_pixel_code = LGraphTexture.replaceCode( LGraphTextureOperation.pixel_shader, { UV_CODE:uvcode, PIXEL_CODE:pixelcode });\n\n\t\t\ttry {\n\t\t\t\tshader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, final_pixel_code );\n\t\t\t\tthis.boxcolor = \"#00FF00\";\n\t\t\t} catch (err) {\n\t\t\t\t//console.log(\"Error compiling shader: \", err, final_pixel_code );\n\t\t\t\tGL.Shader.dumpErrorToConsole(err,Shader.SCREEN_VERTEX_SHADER, final_pixel_code);\n\t\t\t\tthis.boxcolor = \"#FF0000\";\n\t\t\t\tthis.has_error = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._shader = shader;\n\t\t\tthis._shader_code = uvcode + \"|\" + pixelcode;\n\t\t}\n\n\t\tif(!this._shader)\n\t\t\treturn;\n\n\t\tvar value = this.getInputData(2);\n\t\tif (value != null) {\n\t\t\tthis.properties.value = value;\n\t\t} else {\n\t\t\tvalue = parseFloat(this.properties.value);\n\t\t}\n\n\t\tvar time = this.graph.getTime();\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\tgl.disable(gl.CULL_FACE);\n\t\t\tgl.disable(gl.BLEND);\n\t\t\tif (tex) {\n\t\t\t\ttex.bind(0);\n\t\t\t}\n\t\t\tif (texB) {\n\t\t\t\ttexB.bind(1);\n\t\t\t}\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_textureB: 1,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\ttexSize: [width, height,1/width,1/height],\n\t\t\t\t\ttime: time\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureOperation.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\t\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform vec4 texSize;\\n\\\n\t\tuniform float time;\\n\\\n\t\tuniform float value;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord;\\n\\\n\t\t\t{{UV_CODE}};\\n\\\n\t\t\tvec4 color4 = texture2D(u_texture, uv);\\n\\\n\t\t\tvec3 color = color4.rgb;\\n\\\n\t\t\tvec4 color4B = texture2D(u_textureB, uv);\\n\\\n\t\t\tvec3 colorB = color4B.rgb;\\n\\\n\t\t\tvec3 result = color;\\n\\\n\t\t\tfloat alpha = 1.0;\\n\\\n\t\t\t{{PIXEL_CODE}};\\n\\\n\t\t\tgl_FragColor = vec4(result, alpha);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLGraphTextureOperation.registerPreset = function ( name, code )\n\t{\n\t\tLGraphTextureOperation.presets[name] = code;\n\t}\n\n\tLGraphTextureOperation.registerPreset(\"\",\"\");\n\tLGraphTextureOperation.registerPreset(\"bypass\",\"color\");\n\tLGraphTextureOperation.registerPreset(\"add\",\"color + colorB * value\");\n\tLGraphTextureOperation.registerPreset(\"substract\",\"(color - colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"mate\",\"mix( color, colorB, color4B.a * value)\");\n\tLGraphTextureOperation.registerPreset(\"invert\",\"vec3(1.0) - color\");\n\tLGraphTextureOperation.registerPreset(\"multiply\",\"color * colorB * value\");\n\tLGraphTextureOperation.registerPreset(\"divide\",\"(color / colorB) / value\");\n\tLGraphTextureOperation.registerPreset(\"difference\",\"abs(color - colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"max\",\"max(color, colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"min\",\"min(color, colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"displace\",\"texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz\");\n\tLGraphTextureOperation.registerPreset(\"grayscale\",\"vec3(color.x + color.y + color.z) * value / 3.0\");\n\tLGraphTextureOperation.registerPreset(\"saturation\",\"mix( vec3(color.x + color.y + color.z) / 3.0, color, value )\");\n\tLGraphTextureOperation.registerPreset(\"normalmap\",\"\\n\\\n\t\tfloat z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;\\n\\\n\t\tfloat z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;\\n\\\n\t\tfloat z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;\\n\\\n\t\tfloat z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;\\n\\\n\t\tfloat z4 = color.x;\\n\\\n\t\tfloat z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;\\n\\\n\t\tfloat z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;\\n\\\n\t\tfloat z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;\\n\\\n\t\tfloat z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;\\n\\\n\t\tvec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );\\n\\\n\t\tnormal.xy *= value;\\n\\\n\t\tresult.xyz = normalize(normal) * 0.5 + vec3(0.5);\\n\\\n\t\");\n\tLGraphTextureOperation.registerPreset(\"threshold\",\"vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)\");\n\n\t//webglstudio stuff...\n\tLGraphTextureOperation.prototype.onInspect = function(widgets)\n\t{\n\t\tvar that = this;\n\t\twidgets.addCombo(\"Presets\",\"\",{ values: Object.keys(LGraphTextureOperation.presets), callback: function(v){\n\t\t\tvar code = LGraphTextureOperation.presets[v];\n\t\t\tif(!code)\n\t\t\t\treturn;\n\t\t\tthat.setProperty(\"pixelcode\",code);\n\t\t\tthat.title = v;\n\t\t\twidgets.refresh();\n\t\t}});\n\t}\n\n\tLiteGraph.registerNodeType(\"texture/operation\", LGraphTextureOperation);\n\n\t//****************************************************\n\n\tfunction LGraphTextureShader() {\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tcode: \"\",\n\t\t\tu_value: 1,\n\t\t\tu_color: [1,1,1,1],\n\t\t\twidth: 512,\n\t\t\theight: 512,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis.properties.code = LGraphTextureShader.pixel_shader;\n\t\tthis._uniforms = { u_value: 1, u_color: vec4.create(), in_texture: 0, texSize: vec4.create(), time: 0 };\n\t}\n\n\tLGraphTextureShader.title = \"Shader\";\n\tLGraphTextureShader.desc = \"Texture shader\";\n\tLGraphTextureShader.widgets_info = {\n\t\tcode: { type: \"code\", lang: \"glsl\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureShader.prototype.onPropertyChanged = function(\n\t\tname,\n\t\tvalue\n\t) {\n\t\tif (name != \"code\") {\n\t\t\treturn;\n\t\t}\n\n\t\tvar shader = this.getShader();\n\t\tif (!shader) {\n\t\t\treturn;\n\t\t}\n\n\t\t//update connections\n\t\tvar uniforms = shader.uniformInfo;\n\n\t\t//remove deprecated slots\n\t\tif (this.inputs) {\n\t\t\tvar already = {};\n\t\t\tfor (var i = 0; i < this.inputs.length; ++i) {\n\t\t\t\tvar info = this.getInputInfo(i);\n\t\t\t\tif (!info) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (uniforms[info.name] && !already[info.name]) {\n\t\t\t\t\talready[info.name] = true;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.removeInput(i);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\t//update existing ones\n\t\tfor (var i in uniforms) {\n\t\t\tvar info = shader.uniformInfo[i];\n\t\t\tif (info.loc === null) {\n\t\t\t\tcontinue;\n\t\t\t} //is an attribute, not a uniform\n\t\t\tif (i == \"time\") {\n\t\t\t\t//default one\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar type = \"number\";\n\t\t\tif (this._shader.samplers[i]) {\n\t\t\t\ttype = \"texture\";\n\t\t\t} else {\n\t\t\t\tswitch (info.size) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\ttype = \"vec2\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\ttype = \"vec3\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\ttype = \"vec4\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 9:\n\t\t\t\t\t\ttype = \"mat3\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttype = \"mat4\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar slot = this.findInputSlot(i);\n\t\t\tif (slot == -1) {\n\t\t\t\tthis.addInput(i, type);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar input_info = this.getInputInfo(slot);\n\t\t\tif (!input_info) {\n\t\t\t\tthis.addInput(i, type);\n\t\t\t} else {\n\t\t\t\tif (input_info.type == type) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.removeInput(slot, type);\n\t\t\t\tthis.addInput(i, type);\n\t\t\t}\n\t\t}\n\t};\n\n\tLGraphTextureShader.prototype.getShader = function() {\n\t\t//replug\n\t\tif (this._shader && this._shader_code == this.properties.code) {\n\t\t\treturn this._shader;\n\t\t}\n\n\t\tthis._shader_code = this.properties.code;\n\t\tthis._shader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, this.properties.code );\n\t\tif (!this._shader) {\n\t\t\tthis.boxcolor = \"red\";\n\t\t\treturn null;\n\t\t} else {\n\t\t\tthis.boxcolor = \"green\";\n\t\t}\n\t\treturn this._shader;\n\t};\n\n\tLGraphTextureShader.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar shader = this.getShader();\n\t\tif (!shader) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tex_slot = 0;\n\t\tvar in_tex = null;\n\n\t\t//set uniforms\n\t\tif(this.inputs)\n\t\tfor (var i = 0; i < this.inputs.length; ++i) {\n\t\t\tvar info = this.getInputInfo(i);\n\t\t\tvar data = this.getInputData(i);\n\t\t\tif (data == null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (data.constructor === GL.Texture) {\n\t\t\t\tdata.bind(tex_slot);\n\t\t\t\tif (!in_tex) {\n\t\t\t\t\tin_tex = data;\n\t\t\t\t}\n\t\t\t\tdata = tex_slot;\n\t\t\t\ttex_slot++;\n\t\t\t}\n\t\t\tshader.setUniform(info.name, data); //data is tex_slot\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, in_tex );\n\n\t\t//render to texture\n\t\tvar w = this.properties.width | 0;\n\t\tvar h = this.properties.height | 0;\n\t\tif (w == 0) {\n\t\t\tw = in_tex ? in_tex.width : gl.canvas.width;\n\t\t}\n\t\tif (h == 0) {\n\t\t\th = in_tex ? in_tex.height : gl.canvas.height;\n\t\t}\n\t\tuniforms.texSize[0] = w;\n\t\tuniforms.texSize[1] = h;\n\t\tuniforms.texSize[2] = 1/w;\n\t\tuniforms.texSize[3] = 1/h;\n\t\tuniforms.time = this.graph.getTime();\n\t\tuniforms.u_value = this.properties.u_value;\n\t\tuniforms.u_color.set( this.properties.u_color );\n\n\t\tif ( !this._tex || this._tex.type != type ||  this._tex.width != w || this._tex.height != h ) {\n\t\t\tthis._tex = new GL.Texture(w, h, {  type: type, format: gl.RGBA, filter: gl.LINEAR });\n\t\t}\n\t\tvar tex = this._tex;\n\t\ttex.drawTo(function() {\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureShader.pixel_shader =\n\"precision highp float;\\n\\\n\\n\\\nvarying vec2 v_coord;\\n\\\nuniform float time; //time in seconds\\n\\\nuniform vec4 texSize; //tex resolution\\n\\\nuniform float u_value;\\n\\\nuniform vec4 u_color;\\n\\n\\\nvoid main() {\\n\\\n\tvec2 uv = v_coord;\\n\\\n\tvec3 color = vec3(0.0);\\n\\\n\t//your code here\\n\\\n\tcolor.xy=uv;\\n\\n\\\n\tgl_FragColor = vec4(color, 1.0);\\n\\\n}\\n\\\n\";\n\n\tLiteGraph.registerNodeType(\"texture/shader\", LGraphTextureShader);\n\n\t// Texture Scale Offset\n\n\tfunction LGraphTextureScaleOffset() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"scale\", \"vec2\");\n\t\tthis.addInput(\"offset\", \"vec2\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\toffset: vec2.fromValues(0, 0),\n\t\t\tscale: vec2.fromValues(1, 1),\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureScaleOffset.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureScaleOffset.title = \"Scale/Offset\";\n\tLGraphTextureScaleOffset.desc = \"Applies an scaling and offseting\";\n\n\tLGraphTextureScaleOffset.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0) || !tex) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = tex.width;\n\t\tvar height = tex.height;\n\t\tvar type =  this.precision === LGraphTexture.LOW ? gl.UNSIGNED_BYTE : gl.HIGH_PRECISION_FORMAT;\n\t\tif (this.precision === LGraphTexture.DEFAULT) {\n\t\t\ttype = tex.type;\n\t\t}\n\n\t\tif (\n\t\t\t!this._tex ||\n\t\t\tthis._tex.width != width ||\n\t\t\tthis._tex.height != height ||\n\t\t\tthis._tex.type != type\n\t\t) {\n\t\t\tthis._tex = new GL.Texture(width, height, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar shader = this._shader;\n\n\t\tif (!shader) {\n\t\t\tshader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureScaleOffset.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar scale = this.getInputData(1);\n\t\tif (scale) {\n\t\t\tthis.properties.scale[0] = scale[0];\n\t\t\tthis.properties.scale[1] = scale[1];\n\t\t} else {\n\t\t\tscale = this.properties.scale;\n\t\t}\n\n\t\tvar offset = this.getInputData(2);\n\t\tif (offset) {\n\t\t\tthis.properties.offset[0] = offset[0];\n\t\t\tthis.properties.offset[1] = offset[1];\n\t\t} else {\n\t\t\toffset = this.properties.offset;\n\t\t}\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\tgl.disable(gl.CULL_FACE);\n\t\t\tgl.disable(gl.BLEND);\n\t\t\ttex.bind(0);\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_scale: scale,\n\t\t\t\t\tu_offset: offset\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureScaleOffset.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\t\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform vec2 u_scale;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord;\\n\\\n\t\t\tuv = uv / u_scale - u_offset;\\n\\\n\t\t\tgl_FragColor = texture2D(u_texture, uv);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/scaleOffset\",\n\t\tLGraphTextureScaleOffset\n\t);\n\n\t// Warp (distort a texture) *************************\n\n\tfunction LGraphTextureWarp() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"warp\", \"Texture\");\n\t\tthis.addInput(\"factor\", \"number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tfactor: 0.01,\n\t\t\tscale: [1,1],\n\t\t\toffset: [0,0],\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis._uniforms = { \n\t\t\tu_texture: 0, \n\t\t\tu_textureB: 1, \n\t\t\tu_factor: 1, \n\t\t\tu_scale: vec2.create(),\n\t\t\tu_offset: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTextureWarp.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureWarp.title = \"Warp\";\n\tLGraphTextureWarp.desc = \"Texture warp operation\";\n\n\tLGraphTextureWarp.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar texB = this.getInputData(1);\n\n\t\tvar width = 512;\n\t\tvar height = 512;\n\t\tvar type = gl.UNSIGNED_BYTE;\n\t\tif (tex) {\n\t\t\twidth = tex.width;\n\t\t\theight = tex.height;\n\t\t\ttype = tex.type;\n\t\t} else if (texB) {\n\t\t\twidth = texB.width;\n\t\t\theight = texB.height;\n\t\t\ttype = texB.type;\n\t\t}\n\n\t\tif (!tex && !this._tex) {\n\t\t\tthis._tex = new GL.Texture(width, height, {\n\t\t\t\ttype:\n\t\t\t\t\tthis.precision === LGraphTexture.LOW\n\t\t\t\t\t\t? gl.UNSIGNED_BYTE\n\t\t\t\t\t\t: gl.HIGH_PRECISION_FORMAT,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t} else {\n\t\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\t\ttex || this._tex,\n\t\t\t\tthis._tex,\n\t\t\t\tthis.properties.precision\n\t\t\t);\n\t\t}\n\n\t\tvar shader = this._shader;\n\n\t\tif (!shader) {\n\t\t\tshader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureWarp.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar factor = this.getInputData(2);\n\t\tif (factor != null) {\n\t\t\tthis.properties.factor = factor;\n\t\t} else {\n\t\t\tfactor = parseFloat(this.properties.factor);\n\t\t}\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_factor = factor;\n\t\tuniforms.u_scale.set( this.properties.scale );\n\t\tuniforms.u_offset.set( this.properties.offset );\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\tgl.disable(gl.CULL_FACE);\n\t\t\tgl.disable(gl.BLEND);\n\t\t\tif (tex) {\n\t\t\t\ttex.bind(0);\n\t\t\t}\n\t\t\tif (texB) {\n\t\t\t\ttexB.bind(1);\n\t\t\t}\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\tshader\n\t\t\t\t.uniforms( uniforms )\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureWarp.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\t\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tuniform vec2 u_scale;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord;\\n\\\n\t\t\tuv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;\\n\\\n\t\t\tgl_FragColor = texture2D(u_texture, uv);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/warp\", LGraphTextureWarp);\n\n\t//****************************************************\n\n\t// Texture to Viewport *****************************************\n\tfunction LGraphTextureToViewport() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tadditive: false,\n\t\t\tantialiasing: false,\n\t\t\tfilter: true,\n\t\t\tdisable_alpha: false,\n\t\t\tgamma: 1.0,\n\t\t\tviewport: [0,0,1,1]\n\t\t};\n\t\tthis.size[0] = 130;\n\t}\n\n\tLGraphTextureToViewport.title = \"to Viewport\";\n\tLGraphTextureToViewport.desc = \"Texture to viewport\";\n\n\tLGraphTextureToViewport._prev_viewport = new Float32Array(4);\n\n\tLGraphTextureToViewport.prototype.onDrawBackground = function( ctx )\n\t{\n\t\tif ( this.flags.collapsed || this.size[1] <= 40 )\n\t\t\treturn;\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.drawImage( ctx == gl ? tex : gl.canvas, 10,30, this.size[0] -20, this.size[1] -40);\n\t}\n\n\tLGraphTextureToViewport.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.properties.disable_alpha) {\n\t\t\tgl.disable(gl.BLEND);\n\t\t} else {\n\t\t\tgl.enable(gl.BLEND);\n\t\t\tif (this.properties.additive) {\n\t\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE);\n\t\t\t} else {\n\t\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\t\t\t}\n\t\t}\n\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tvar gamma = this.properties.gamma || 1.0;\n\t\tif (this.isInputConnected(1)) {\n\t\t\tgamma = this.getInputData(1);\n\t\t}\n\n\t\ttex.setParameter(\n\t\t\tgl.TEXTURE_MAG_FILTER,\n\t\t\tthis.properties.filter ? gl.LINEAR : gl.NEAREST\n\t\t);\n\n\t\tvar old_viewport = LGraphTextureToViewport._prev_viewport;\n\t\told_viewport.set( gl.viewport_data );\n\t\tvar new_view = this.properties.viewport;\n\t\tgl.viewport( old_viewport[0] + old_viewport[2] * new_view[0], old_viewport[1] + old_viewport[3] * new_view[1], old_viewport[2] * new_view[2], old_viewport[3] * new_view[3] );\n\t\tvar viewport = gl.getViewport(); //gl.getParameter(gl.VIEWPORT);\n\n\t\tif (this.properties.antialiasing) {\n\t\t\tif (!LGraphTextureToViewport._shader) {\n\t\t\t\tLGraphTextureToViewport._shader = new GL.Shader(\n\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphTextureToViewport.aa_pixel_shader\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\ttex.bind(0);\n\t\t\tLGraphTextureToViewport._shader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tuViewportSize: [tex.width, tex.height],\n\t\t\t\t\tu_igamma: 1 / gamma,\n\t\t\t\t\tinverseVP: [1 / tex.width, 1 / tex.height]\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t} else {\n\t\t\tif (gamma != 1.0) {\n\t\t\t\tif (!LGraphTextureToViewport._gamma_shader) {\n\t\t\t\t\tLGraphTextureToViewport._gamma_shader = new GL.Shader(\n\t\t\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\t\tLGraphTextureToViewport.gamma_pixel_shader\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\ttex.toViewport(LGraphTextureToViewport._gamma_shader, {\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_igamma: 1 / gamma\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttex.toViewport();\n\t\t\t}\n\t\t}\n\n\t\tgl.viewport( old_viewport[0], old_viewport[1], old_viewport[2], old_viewport[3] );\n\t};\n\n\tLGraphTextureToViewport.prototype.onGetInputs = function() {\n\t\treturn [[\"gamma\", \"number\"]];\n\t};\n\n\tLGraphTextureToViewport.aa_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 uViewportSize;\\n\\\n\t\tuniform vec2 inverseVP;\\n\\\n\t\tuniform float u_igamma;\\n\\\n\t\t#define FXAA_REDUCE_MIN   (1.0/ 128.0)\\n\\\n\t\t#define FXAA_REDUCE_MUL   (1.0 / 8.0)\\n\\\n\t\t#define FXAA_SPAN_MAX     8.0\\n\\\n\t\t\\n\\\n\t\t/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */\\n\\\n\t\tvec4 applyFXAA(sampler2D tex, vec2 fragCoord)\\n\\\n\t\t{\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\t/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/\\n\\\n\t\t\tvec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;\\n\\\n\t\t\tvec3 luma = vec3(0.299, 0.587, 0.114);\\n\\\n\t\t\tfloat lumaNW = dot(rgbNW, luma);\\n\\\n\t\t\tfloat lumaNE = dot(rgbNE, luma);\\n\\\n\t\t\tfloat lumaSW = dot(rgbSW, luma);\\n\\\n\t\t\tfloat lumaSE = dot(rgbSE, luma);\\n\\\n\t\t\tfloat lumaM  = dot(rgbM,  luma);\\n\\\n\t\t\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\n\\\n\t\t\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\n\\\n\t\t\t\\n\\\n\t\t\tvec2 dir;\\n\\\n\t\t\tdir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\\n\\\n\t\t\tdir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\\n\\\n\t\t\t\\n\\\n\t\t\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\\n\\\n\t\t\t\\n\\\n\t\t\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\n\\\n\t\t\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;\\n\\\n\t\t\t\\n\\\n\t\t\tvec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + \\n\\\n\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\\n\\\n\t\t\tvec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + \\n\\\n\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\\n\\\n\t\t\t\\n\\\n\t\t\t//return vec4(rgbA,1.0);\\n\\\n\t\t\tfloat lumaB = dot(rgbB, luma);\\n\\\n\t\t\tif ((lumaB < lumaMin) || (lumaB > lumaMax))\\n\\\n\t\t\t\tcolor = vec4(rgbA, 1.0);\\n\\\n\t\t\telse\\n\\\n\t\t\t\tcolor = vec4(rgbB, 1.0);\\n\\\n\t\t\tif(u_igamma != 1.0)\\n\\\n\t\t\t\tcolor.xyz = pow( color.xyz, vec3(u_igamma) );\\n\\\n\t\t\treturn color;\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLGraphTextureToViewport.gamma_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_igamma;\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord);\\n\\\n\t\t\tcolor.xyz = pow(color.xyz, vec3(u_igamma) );\\n\\\n\t\t   gl_FragColor = color;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/toviewport\",\n\t\tLGraphTextureToViewport\n\t);\n\n\t// Texture Copy *****************************************\n\tfunction LGraphTextureCopy() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tsize: 0,\n\t\t\tgenerate_mipmaps: false,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureCopy.title = \"Copy\";\n\tLGraphTextureCopy.desc = \"Copy Texture\";\n\tLGraphTextureCopy.widgets_info = {\n\t\tsize: {\n\t\t\twidget: \"combo\",\n\t\t\tvalues: [0, 32, 64, 128, 256, 512, 1024, 2048]\n\t\t},\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureCopy.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex && !this._temp_texture) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\t//copy the texture\n\t\tif (tex) {\n\t\t\tvar width = tex.width;\n\t\t\tvar height = tex.height;\n\n\t\t\tif (this.properties.size != 0) {\n\t\t\t\twidth = this.properties.size;\n\t\t\t\theight = this.properties.size;\n\t\t\t}\n\n\t\t\tvar temp = this._temp_texture;\n\n\t\t\tvar type = tex.type;\n\t\t\tif (this.properties.precision === LGraphTexture.LOW) {\n\t\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t\t} else if (this.properties.precision === LGraphTexture.HIGH) {\n\t\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!temp ||\n\t\t\t\ttemp.width != width ||\n\t\t\t\ttemp.height != height ||\n\t\t\t\ttemp.type != type\n\t\t\t) {\n\t\t\t\tvar minFilter = gl.LINEAR;\n\t\t\t\tif (\n\t\t\t\t\tthis.properties.generate_mipmaps &&\n\t\t\t\t\tisPowerOfTwo(width) &&\n\t\t\t\t\tisPowerOfTwo(height)\n\t\t\t\t) {\n\t\t\t\t\tminFilter = gl.LINEAR_MIPMAP_LINEAR;\n\t\t\t\t}\n\t\t\t\tthis._temp_texture = new GL.Texture(width, height, {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tminFilter: minFilter,\n\t\t\t\t\tmagFilter: gl.LINEAR\n\t\t\t\t});\n\t\t\t}\n\t\t\ttex.copyTo(this._temp_texture);\n\n\t\t\tif (this.properties.generate_mipmaps) {\n\t\t\t\tthis._temp_texture.bind(0);\n\t\t\t\tgl.generateMipmap(this._temp_texture.texture_type);\n\t\t\t\tthis._temp_texture.unbind(0);\n\t\t\t}\n\t\t}\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/copy\", LGraphTextureCopy);\n\n\t// Texture Downsample *****************************************\n\tfunction LGraphTextureDownsample() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {\n\t\t\titerations: 1,\n\t\t\tgenerate_mipmaps: false,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureDownsample.title = \"Downsample\";\n\tLGraphTextureDownsample.desc = \"Downsample Texture\";\n\tLGraphTextureDownsample.widgets_info = {\n\t\titerations: { type: \"number\", step: 1, precision: 0, min: 0 },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureDownsample.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex && !this._temp_texture) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\t//we do not allow any texture different than texture 2D\n\t\tif (!tex || tex.texture_type !== GL.TEXTURE_2D) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.properties.iterations < 1) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar shader = LGraphTextureDownsample._shader;\n\t\tif (!shader) {\n\t\t\tLGraphTextureDownsample._shader = shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureDownsample.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar width = tex.width | 0;\n\t\tvar height = tex.height | 0;\n\t\tvar type = tex.type;\n\t\tif (this.properties.precision === LGraphTexture.LOW) {\n\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t} else if (this.properties.precision === LGraphTexture.HIGH) {\n\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t}\n\t\tvar iterations = this.properties.iterations || 1;\n\n\t\tvar origin = tex;\n\t\tvar target = null;\n\n\t\tvar temp = [];\n\t\tvar options = {\n\t\t\ttype: type,\n\t\t\tformat: tex.format\n\t\t};\n\n\t\tvar offset = vec2.create();\n\t\tvar uniforms = {\n\t\t\tu_offset: offset\n\t\t};\n\n\t\tif (this._texture) {\n\t\t\tGL.Texture.releaseTemporary(this._texture);\n\t\t}\n\n\t\tfor (var i = 0; i < iterations; ++i) {\n\t\t\toffset[0] = 1 / width;\n\t\t\toffset[1] = 1 / height;\n\t\t\twidth = width >> 1 || 0;\n\t\t\theight = height >> 1 || 0;\n\t\t\ttarget = GL.Texture.getTemporary(width, height, options);\n\t\t\ttemp.push(target);\n\t\t\torigin.setParameter(GL.TEXTURE_MAG_FILTER, GL.NEAREST);\n\t\t\torigin.copyTo(target, shader, uniforms);\n\t\t\tif (width == 1 && height == 1) {\n\t\t\t\tbreak;\n\t\t\t} //nothing else to do\n\t\t\torigin = target;\n\t\t}\n\n\t\t//keep the last texture used\n\t\tthis._texture = temp.pop();\n\n\t\t//free the rest\n\t\tfor (var i = 0; i < temp.length; ++i) {\n\t\t\tGL.Texture.releaseTemporary(temp[i]);\n\t\t}\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\tthis._texture.bind(0);\n\t\t\tgl.generateMipmap(this._texture.texture_type);\n\t\t\tthis._texture.unbind(0);\n\t\t}\n\n\t\tthis.setOutputData(0, this._texture);\n\t};\n\n\tLGraphTextureDownsample.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D(u_texture, v_coord );\\n\\\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );\\n\\\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );\\n\\\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );\\n\\\n\t\t   gl_FragColor = color * 0.25;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/downsample\",\n\t\tLGraphTextureDownsample\n\t);\n\n\n\n\tfunction LGraphTextureResize() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tsize: [512,512],\n\t\t\tgenerate_mipmaps: false,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureResize.title = \"Resize\";\n\tLGraphTextureResize.desc = \"Resize Texture\";\n\tLGraphTextureResize.widgets_info = {\n\t\titerations: { type: \"number\", step: 1, precision: 0, min: 0 },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureResize.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex && !this._temp_texture) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\t//we do not allow any texture different than texture 2D\n\t\tif (!tex || tex.texture_type !== GL.TEXTURE_2D) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = this.properties.size[0] | 0;\n\t\tvar height = this.properties.size[1] | 0;\n\t\tif(width == 0)\n\t\t\twidth = tex.width;\n\t\tif(height == 0)\n\t\t\theight = tex.height;\n\t\tvar type = tex.type;\n\t\tif (this.properties.precision === LGraphTexture.LOW) {\n\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t} else if (this.properties.precision === LGraphTexture.HIGH) {\n\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t}\n\n\t\tif( !this._texture || this._texture.width != width || this._texture.height != height || this._texture.type != type )\n\t\t\tthis._texture = new GL.Texture( width, height, { type: type } );\n\n\t\ttex.copyTo( this._texture );\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\tthis._texture.bind(0);\n\t\t\tgl.generateMipmap(this._texture.texture_type);\n\t\t\tthis._texture.unbind(0);\n\t\t}\n\n\t\tthis.setOutputData(0, this._texture);\n\t};\n\n\tLiteGraph.registerNodeType( \"texture/resize\", LGraphTextureResize );\n\n\t// Texture Average  *****************************************\n\tfunction LGraphTextureAverage() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"tex\", \"Texture\");\n\t\tthis.addOutput(\"avg\", \"vec4\");\n\t\tthis.addOutput(\"lum\", \"number\");\n\t\tthis.properties = {\n\t\t\tuse_previous_frame: true, //to avoid stalls \n\t\t\thigh_quality: false //to use as much pixels as possible\n\t\t};\n\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_mipmap_offset: 0\n\t\t};\n\t\tthis._luminance = new Float32Array(4);\n\t}\n\n\tLGraphTextureAverage.title = \"Average\";\n\tLGraphTextureAverage.desc =\n\t\t\"Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.\\n If high_quality is true, then it generates the mipmaps first and reads from the lower one.\";\n\n\tLGraphTextureAverage.prototype.onExecute = function() {\n\t\tif (!this.properties.use_previous_frame) {\n\t\t\tthis.updateAverage();\n\t\t}\n\n\t\tvar v = this._luminance;\n\t\tthis.setOutputData(0, this._temp_texture);\n\t\tthis.setOutputData(1, v);\n\t\tthis.setOutputData(2, (v[0] + v[1] + v[2]) / 3);\n\t};\n\n\t//executed before rendering the frame\n\tLGraphTextureAverage.prototype.onPreRenderExecute = function() {\n\t\tthis.updateAverage();\n\t};\n\n\tLGraphTextureAverage.prototype.updateAverage = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!this.isOutputConnected(0) &&\n\t\t\t!this.isOutputConnected(1) &&\n\t\t\t!this.isOutputConnected(2)\n\t\t) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (!LGraphTextureAverage._shader) {\n\t\t\tLGraphTextureAverage._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureAverage.pixel_shader\n\t\t\t);\n\t\t\t//creates 256 random numbers and stores them in two mat4\n\t\t\tvar samples = new Float32Array(16);\n\t\t\tfor (var i = 0; i < samples.length; ++i) {\n\t\t\t\tsamples[i] = Math.random(); //poorly distributed samples\n\t\t\t}\n\t\t\t//upload only once\n\t\t\tLGraphTextureAverage._shader.uniforms({\n\t\t\t\tu_samples_a: samples.subarray(0, 16),\n\t\t\t\tu_samples_b: samples.subarray(16, 32)\n\t\t\t});\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tvar type = gl.UNSIGNED_BYTE;\n\t\tif (tex.type != type) {\n\t\t\t//force floats, half floats cannot be read with gl.readPixels\n\t\t\ttype = gl.FLOAT;\n\t\t}\n\n\t\tif (!temp || temp.type != type) {\n\t\t\tthis._temp_texture = new GL.Texture(1, 1, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.NEAREST\n\t\t\t});\n\t\t}\n\n\t\tthis._uniforms.u_mipmap_offset = 0;\n\n\t\tif(this.properties.high_quality)\n\t\t{\n\t\t\tif( !this._temp_pot2_texture || this._temp_pot2_texture.type != type )\n\t\t\t\tthis._temp_pot2_texture = new GL.Texture(512, 512, {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tminFilter: gl.LINEAR_MIPMAP_LINEAR,\n\t\t\t\t\tmagFilter: gl.LINEAR\n\t\t\t\t});\n\n\t\t\ttex.copyTo( this._temp_pot2_texture );\n\t\t\ttex = this._temp_pot2_texture;\n\t\t\ttex.bind(0);\n\t\t\tgl.generateMipmap(GL.TEXTURE_2D);\n\t\t\tthis._uniforms.u_mipmap_offset = 9;\n\t\t}\n\n\t\tvar shader = LGraphTextureAverage._shader;\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_mipmap_offset = this.properties.mipmap_offset;\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tgl.disable(gl.BLEND);\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.toViewport(shader, uniforms);\n\t\t});\n\n\t\tif (this.isOutputConnected(1) || this.isOutputConnected(2)) {\n\t\t\tvar pixel = this._temp_texture.getPixels();\n\t\t\tif (pixel) {\n\t\t\t\tvar v = this._luminance;\n\t\t\t\tvar type = this._temp_texture.type;\n\t\t\t\tv.set(pixel);\n\t\t\t\tif (type == gl.UNSIGNED_BYTE) {\n\t\t\t\t\tvec4.scale(v, v, 1 / 255);\n\t\t\t\t} else if (\n\t\t\t\t\ttype == GL.HALF_FLOAT ||\n\t\t\t\t\ttype == GL.HALF_FLOAT_OES\n\t\t\t\t) {\n\t\t\t\t\t//no half floats possible, hard to read back unless copyed to a FLOAT texture, so temp_texture is always forced to FLOAT\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tLGraphTextureAverage.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform mat4 u_samples_a;\\n\\\n\t\tuniform mat4 u_samples_b;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_mipmap_offset;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\t//random average\\n\\\n\t\t\tfor(int i = 0; i < 4; ++i)\\n\\\n\t\t\t\tfor(int j = 0; j < 4; ++j)\\n\\\n\t\t\t\t{\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t}\\n\\\n\t\t   gl_FragColor = color * 0.03125;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/average\", LGraphTextureAverage);\n\n\n\n\t// Computes operation between pixels (max, min)  *****************************************\n\tfunction LGraphTextureMinMax() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"min_t\", \"Texture\");\n\t\tthis.addOutput(\"max_t\", \"Texture\");\n\t\tthis.addOutput(\"min\", \"vec4\");\n\t\tthis.addOutput(\"max\", \"vec4\");\n\t\tthis.properties = {\n\t\t\tmode: \"max\",\n\t\t\tuse_previous_frame: true //to avoid stalls \n\t\t};\n\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0\n\t\t};\n\n\t\tthis._max = new Float32Array(4);\n\t\tthis._min = new Float32Array(4);\n\n\t\tthis._textures_chain = [];\n\t}\n\n\tLGraphTextureMinMax.widgets_info = {\n\t\tmode: { widget: \"combo\", values: [\"min\",\"max\",\"avg\"] }\n\t};\n\n\tLGraphTextureMinMax.title = \"MinMax\";\n\tLGraphTextureMinMax.desc = \"Compute the scene min max\";\n\n\tLGraphTextureMinMax.prototype.onExecute = function() {\n\t\tif (!this.properties.use_previous_frame) {\n\t\t\tthis.update();\n\t\t}\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t\tthis.setOutputData(1, this._luminance);\n\t};\n\n\t//executed before rendering the frame\n\tLGraphTextureMinMax.prototype.onPreRenderExecute = function() {\n\t\tthis.update();\n\t};\n\n\tLGraphTextureMinMax.prototype.update = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !this.isOutputConnected(0) && !this.isOutputConnected(1) ) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (!LGraphTextureMinMax._shader) {\n\t\t\tLGraphTextureMinMax._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureMinMax.pixel_shader );\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tvar type = gl.UNSIGNED_BYTE;\n\t\tif (tex.type != type) {\n\t\t\t//force floats, half floats cannot be read with gl.readPixels\n\t\t\ttype = gl.FLOAT;\n\t\t}\n\n\t\tvar size = 512;\n\n\t\tif( !this._textures_chain.length || this._textures_chain[0].type != type )\n\t\t{\n\t\t\tvar index = 0;\n\t\t\twhile(i)\n\t\t\t{\n\t\t\t\tthis._textures_chain[i] = new GL.Texture( size, size, {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tfilter: gl.NEAREST\n\t\t\t\t});\n\t\t\t\tsize = size >> 2;\n\t\t\t\ti++;\n\t\t\t\tif(size == 1)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\ttex.copyTo( this._textures_chain[0] );\n\t\tvar prev = this._textures_chain[0];\n\t\tfor(var i = 1; i <= this._textures_chain.length; ++i)\n\t\t{\n\t\t\tvar tex = this._textures_chain[i];\n\n\t\t\tprev = tex;\t\t\t\t\n\t\t}\n\n\t\tvar shader = LGraphTextureMinMax._shader;\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_mipmap_offset = this.properties.mipmap_offset;\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tgl.disable(gl.BLEND);\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.toViewport(shader, uniforms);\n\t\t});\n\t};\n\n\tLGraphTextureMinMax.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform mat4 u_samples_a;\\n\\\n\t\tuniform mat4 u_samples_b;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_mipmap_offset;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\t//random average\\n\\\n\t\t\tfor(int i = 0; i < 4; ++i)\\n\\\n\t\t\t\tfor(int j = 0; j < 4; ++j)\\n\\\n\t\t\t\t{\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t}\\n\\\n\t\t   gl_FragColor = color * 0.03125;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\t//LiteGraph.registerNodeType(\"texture/clustered_operation\", LGraphTextureClusteredOperation);\n\n\n\tfunction LGraphTextureTemporalSmooth() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"factor\", \"Number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = { factor: 0.5 };\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_textureB: 1,\n\t\t\tu_factor: this.properties.factor\n\t\t};\n\t}\n\n\tLGraphTextureTemporalSmooth.title = \"Smooth\";\n\tLGraphTextureTemporalSmooth.desc = \"Smooth texture over time\";\n\n\tLGraphTextureTemporalSmooth.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex || !this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!LGraphTextureTemporalSmooth._shader) {\n\t\t\tLGraphTextureTemporalSmooth._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureTemporalSmooth.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.type != tex.type ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height\n\t\t) {\n\t\t\tvar options = {\n\t\t\t\ttype: tex.type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.NEAREST\n\t\t\t};\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, options );\n\t\t\tthis._temp_texture2 = new GL.Texture(tex.width, tex.height, options );\n\t\t\ttex.copyTo(this._temp_texture2);\n\t\t}\n\n\t\tvar tempA = this._temp_texture;\n\t\tvar tempB = this._temp_texture2;\n\n\t\tvar shader = LGraphTextureTemporalSmooth._shader;\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_factor = 1.0 - this.getInputOrProperty(\"factor\");\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\ttempA.drawTo(function() {\n\t\t\ttempB.bind(1);\n\t\t\ttex.toViewport(shader, uniforms);\n\t\t});\n\n\t\tthis.setOutputData(0, tempA);\n\n\t\t//swap\n\t\tthis._temp_texture = tempB;\n\t\tthis._temp_texture2 = tempA;\n\t};\n\n\tLGraphTextureTemporalSmooth.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tgl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType( \"texture/temporal_smooth\", LGraphTextureTemporalSmooth );\n\n\n\tfunction LGraphTextureLinearAvgSmooth() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addOutput(\"avg\", \"Texture\");\n\t\tthis.addOutput(\"array\", \"Texture\");\n\t\tthis.properties = { samples: 64, frames_interval: 1 };\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_textureB: 1,\n\t\t\tu_samples: this.properties.samples,\n\t\t\tu_isamples: 1/this.properties.samples\n\t\t};\n\t\tthis.frame = 0;\n\t}\n\n\tLGraphTextureLinearAvgSmooth.title = \"Lineal Avg Smooth\";\n\tLGraphTextureLinearAvgSmooth.desc = \"Smooth texture linearly over time\";\n\n\tLGraphTextureLinearAvgSmooth[\"@samples\"] = { type: \"number\", min: 1, max: 64, step: 1, precision: 1 };\n\n\tLGraphTextureLinearAvgSmooth.prototype.getPreviewTexture = function()\n\t{\n\t\treturn this._temp_texture2;\n\t}\n\n\tLGraphTextureLinearAvgSmooth.prototype.onExecute = function() {\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex || !this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!LGraphTextureLinearAvgSmooth._shader) {\n\t\t\tLGraphTextureLinearAvgSmooth._shader_copy = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureLinearAvgSmooth.pixel_shader_copy );\n\t\t\tLGraphTextureLinearAvgSmooth._shader_avg = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureLinearAvgSmooth.pixel_shader_avg );\n\t\t}\n\n\t\tvar samples = clamp(this.properties.samples,0,64);\n\t\tvar frame = this.frame;\n\t\tvar interval = this.properties.frames_interval;\n\n\t\tif( interval == 0 || frame % interval == 0 )\n\t\t{\n\t\t\tvar temp = this._temp_texture;\n\t\t\tif ( !temp || temp.type != tex.type || temp.width != samples ) {\n\t\t\t\tvar options = {\n\t\t\t\t\ttype: tex.type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tfilter: gl.NEAREST\n\t\t\t\t};\n\t\t\t\tthis._temp_texture = new GL.Texture( samples, 1, options );\n\t\t\t\tthis._temp_texture2 = new GL.Texture( samples, 1, options );\n\t\t\t\tthis._temp_texture_out = new GL.Texture( 1, 1, options );\n\t\t\t}\n\n\t\t\tvar tempA = this._temp_texture;\n\t\t\tvar tempB = this._temp_texture2;\n\n\t\t\tvar shader_copy = LGraphTextureLinearAvgSmooth._shader_copy;\n\t\t\tvar shader_avg = LGraphTextureLinearAvgSmooth._shader_avg;\n\t\t\tvar uniforms = this._uniforms;\n\t\t\tuniforms.u_samples = samples;\n\t\t\tuniforms.u_isamples = 1.0 / samples;\n\n\t\t\tgl.disable(gl.BLEND);\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\ttempA.drawTo(function() {\n\t\t\t\ttempB.bind(1);\n\t\t\t\ttex.toViewport( shader_copy, uniforms );\n\t\t\t});\n\n\t\t\tthis._temp_texture_out.drawTo(function() {\n\t\t\t\ttempA.toViewport( shader_avg, uniforms );\n\t\t\t});\n\n\t\t\tthis.setOutputData( 0, this._temp_texture_out );\n\n\t\t\t//swap\n\t\t\tthis._temp_texture = tempB;\n\t\t\tthis._temp_texture2 = tempA;\n\t\t}\n\t\telse\n\t\t\tthis.setOutputData(0, this._temp_texture_out);\n\t\tthis.setOutputData(1, this._temp_texture2);\n\t\tthis.frame++;\n\t};\n\n\tLGraphTextureLinearAvgSmooth.pixel_shader_copy =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_isamples;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tif( v_coord.x <= u_isamples )\\n\\\n\t\t\t\tgl_FragColor = texture2D( u_texture, vec2(0.5) );\\n\\\n\t\t\telse\\n\\\n\t\t\t\tgl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLGraphTextureLinearAvgSmooth.pixel_shader_avg =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform int u_samples;\\n\\\n\t\tuniform float u_isamples;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\tfor(int i = 0; i < 64; ++i)\\n\\\n\t\t\t{\\n\\\n\t\t\t\tcolor += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );\\n\\\n\t\t\t\tif(i == (u_samples - 1))\\n\\\n\t\t\t\t\tbreak;\\n\\\n\t\t\t}\\n\\\n\t\t\tgl_FragColor = color * u_isamples;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\n\tLiteGraph.registerNodeType( \"texture/linear_avg_smooth\", LGraphTextureLinearAvgSmooth );\n\n\t// Image To Texture *****************************************\n\tfunction LGraphImageToTexture() {\n\t\tthis.addInput(\"Image\", \"image\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {};\n\t}\n\n\tLGraphImageToTexture.title = \"Image to Texture\";\n\tLGraphImageToTexture.desc = \"Uploads an image to the GPU\";\n\t//LGraphImageToTexture.widgets_info = { size: { widget:\"combo\", values:[0,32,64,128,256,512,1024,2048]} };\n\n\tLGraphImageToTexture.prototype.onExecute = function() {\n\t\tvar img = this.getInputData(0);\n\t\tif (!img) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = img.videoWidth || img.width;\n\t\tvar height = img.videoHeight || img.height;\n\n\t\t//this is in case we are using a webgl canvas already, no need to reupload it\n\t\tif (img.gltexture) {\n\t\t\tthis.setOutputData(0, img.gltexture);\n\t\t\treturn;\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tif (!temp || temp.width != width || temp.height != height) {\n\t\t\tthis._temp_texture = new GL.Texture(width, height, {\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tthis._temp_texture.uploadImage(img);\n\t\t} catch (err) {\n\t\t\tconsole.error(\n\t\t\t\t\"image comes from an unsafe location, cannot be uploaded to webgl: \" +\n\t\t\t\t\terr\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/imageToTexture\",\n\t\tLGraphImageToTexture\n\t);\n\n\t// Texture LUT *****************************************\n\tfunction LGraphTextureLUT() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"LUT\", \"Texture\");\n\t\tthis.addInput(\"Intensity\", \"number\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = { enabled: true, intensity: 1, precision: LGraphTexture.DEFAULT, texture: null };\n\n\t\tif (!LGraphTextureLUT._shader) {\n\t\t\tLGraphTextureLUT._shader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, LGraphTextureLUT.pixel_shader );\n\t\t}\n\t}\n\n\tLGraphTextureLUT.widgets_info = {\n\t\ttexture: { widget: \"texture\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureLUT.title = \"LUT\";\n\tLGraphTextureLUT.desc = \"Apply LUT to Texture\";\n\n\tLGraphTextureLUT.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH || this.properties.enabled === false) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar lut_tex = this.getInputData(1);\n\n\t\tif (!lut_tex) {\n\t\t\tlut_tex = LGraphTexture.getTexture(this.properties.texture);\n\t\t}\n\n\t\tif (!lut_tex) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tlut_tex.bind(0);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\tgl.texParameteri(\n\t\t\tgl.TEXTURE_2D,\n\t\t\tgl.TEXTURE_WRAP_S,\n\t\t\tgl.CLAMP_TO_EDGE\n\t\t);\n\t\tgl.texParameteri(\n\t\t\tgl.TEXTURE_2D,\n\t\t\tgl.TEXTURE_WRAP_T,\n\t\t\tgl.CLAMP_TO_EDGE\n\t\t);\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\n\t\tvar intensity = this.properties.intensity;\n\t\tif (this.isInputConnected(2)) {\n\t\t\tthis.properties.intensity = intensity = this.getInputData(2);\n\t\t}\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\ttex,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\t//var mesh = Mesh.getScreenQuad();\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tlut_tex.bind(1);\n\t\t\ttex.toViewport(LGraphTextureLUT._shader, {\n\t\t\t\tu_texture: 0,\n\t\t\t\tu_textureB: 1,\n\t\t\t\tu_amount: intensity\n\t\t\t});\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureLUT.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_amount;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\t lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );\\n\\\n\t\t\t mediump float blueColor = textureColor.b * 63.0;\\n\\\n\t\t\t mediump vec2 quad1;\\n\\\n\t\t\t quad1.y = floor(floor(blueColor) / 8.0);\\n\\\n\t\t\t quad1.x = floor(blueColor) - (quad1.y * 8.0);\\n\\\n\t\t\t mediump vec2 quad2;\\n\\\n\t\t\t quad2.y = floor(ceil(blueColor) / 8.0);\\n\\\n\t\t\t quad2.x = ceil(blueColor) - (quad2.y * 8.0);\\n\\\n\t\t\t highp vec2 texPos1;\\n\\\n\t\t\t texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\\n\\\n\t\t\t texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\\n\\\n\t\t\t highp vec2 texPos2;\\n\\\n\t\t\t texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\\n\\\n\t\t\t texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\\n\\\n\t\t\t lowp vec4 newColor1 = texture2D(u_textureB, texPos1);\\n\\\n\t\t\t lowp vec4 newColor2 = texture2D(u_textureB, texPos2);\\n\\\n\t\t\t lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\\n\\\n\t\t\t gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/LUT\", LGraphTextureLUT);\n\n\n\t// Texture LUT *****************************************\n\tfunction LGraphTextureEncode() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"Atlas\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = { enabled: true, num_row_symbols: 4, symbol_size: 16, brightness: 1, colorize: false, filter: false, invert: false, precision: LGraphTexture.DEFAULT, generate_mipmaps: false, texture: null };\n\n\t\tif (!LGraphTextureEncode._shader) {\n\t\t\tLGraphTextureEncode._shader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, LGraphTextureEncode.pixel_shader );\n\t\t}\n\n\t\tthis._uniforms = {\n\t\t\t\tu_texture: 0,\n\t\t\t\tu_textureB: 1,\n\t\t\t\tu_row_simbols: 4,\n\t\t\t\tu_simbol_size: 16,\n\t\t\t\tu_res: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTextureEncode.widgets_info = {\n\t\ttexture: { widget: \"texture\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureEncode.title = \"Encode\";\n\tLGraphTextureEncode.desc = \"Apply a texture atlas to encode a texture\";\n\n\tLGraphTextureEncode.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH || this.properties.enabled === false) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar symbols_tex = this.getInputData(1);\n\n\t\tif (!symbols_tex) {\n\t\t\tsymbols_tex = LGraphTexture.getTexture(this.properties.texture);\n\t\t}\n\n\t\tif (!symbols_tex) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tsymbols_tex.bind(0);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, this.properties.filter ? gl.LINEAR : gl.NEAREST );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, this.properties.filter ? gl.LINEAR : gl.NEAREST );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_row_simbols = Math.floor(this.properties.num_row_symbols);\n\t\tuniforms.u_symbol_size = this.properties.symbol_size;\n\t\tuniforms.u_brightness = this.properties.brightness;\n\t\tuniforms.u_invert = this.properties.invert ? 1 : 0;\n\t\tuniforms.u_colorize = this.properties.colorize ? 1 : 0;\n\n\t\tthis._tex = LGraphTexture.getTargetTexture( tex, this._tex, this.properties.precision );\n\t\tuniforms.u_res[0] = this._tex.width;\n\t\tuniforms.u_res[1] = this._tex.height;\n\t\tthis._tex.bind(0);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tsymbols_tex.bind(1);\n\t\t\ttex.toViewport(LGraphTextureEncode._shader, uniforms);\n\t\t});\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\tthis._tex.bind(0);\n\t\t\tgl.generateMipmap(this._tex.texture_type);\n\t\t\tthis._tex.unbind(0);\n\t\t}\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureEncode.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_row_simbols;\\n\\\n\t\tuniform float u_symbol_size;\\n\\\n\t\tuniform float u_brightness;\\n\\\n\t\tuniform float u_invert;\\n\\\n\t\tuniform float u_colorize;\\n\\\n\t\tuniform vec2 u_res;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 total_symbols = u_res / u_symbol_size;\\n\\\n\t\t\tvec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate \\n\\\n\t\t\tvec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;\\n\\\n\t\t\tlowp vec4 textureColor = texture2D(u_texture, uv );\\n\\\n\t\t\tfloat lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);\\n\\\n\t\t\tif( u_invert == 1.0 ) lum = 1.0 - lum;\\n\\\n\t\t\tfloat index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));\\n\\\n\t\t\tfloat col = mod( index, u_row_simbols );\\n\\\n\t\t\tfloat row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;\\n\\\n\t\t\tvec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;\\n\\\n\t\t\tvec4 color = texture2D( u_textureB, simbol_uv );\\n\\\n\t\t\tif(u_colorize == 1.0)\\n\\\n\t\t\t\tcolor *= textureColor;\\n\\\n\t\t\tgl_FragColor = color;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/encode\", LGraphTextureEncode);\n\n\t// Texture Channels *****************************************\n\tfunction LGraphTextureChannels() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\n\t\tthis.addOutput(\"R\", \"Texture\");\n\t\tthis.addOutput(\"G\", \"Texture\");\n\t\tthis.addOutput(\"B\", \"Texture\");\n\t\tthis.addOutput(\"A\", \"Texture\");\n\n\t\t//this.properties = { use_single_channel: true };\n\t\tif (!LGraphTextureChannels._shader) {\n\t\t\tLGraphTextureChannels._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureChannels.pixel_shader\n\t\t\t);\n\t\t}\n\t}\n\n\tLGraphTextureChannels.title = \"Texture to Channels\";\n\tLGraphTextureChannels.desc = \"Split texture channels\";\n\n\tLGraphTextureChannels.prototype.onExecute = function() {\n\t\tvar texA = this.getInputData(0);\n\t\tif (!texA) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._channels) {\n\t\t\tthis._channels = Array(4);\n\t\t}\n\n\t\t//var format = this.properties.use_single_channel ? gl.LUMINANCE : gl.RGBA; //not supported by WebGL1\n\t\tvar format = gl.RGB;\n\t\tvar connections = 0;\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\tif (this.isOutputConnected(i)) {\n\t\t\t\tif (\n\t\t\t\t\t!this._channels[i] ||\n\t\t\t\t\tthis._channels[i].width != texA.width ||\n\t\t\t\t\tthis._channels[i].height != texA.height ||\n\t\t\t\t\tthis._channels[i].type != texA.type ||\n\t\t\t\t\tthis._channels[i].format != format\n\t\t\t\t) {\n\t\t\t\t\tthis._channels[i] = new GL.Texture(\n\t\t\t\t\t\ttexA.width,\n\t\t\t\t\t\ttexA.height,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: texA.type,\n\t\t\t\t\t\t\tformat: format,\n\t\t\t\t\t\t\tfilter: gl.LINEAR\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tconnections++;\n\t\t\t} else {\n\t\t\t\tthis._channels[i] = null;\n\t\t\t}\n\t\t}\n\n\t\tif (!connections) {\n\t\t\treturn;\n\t\t}\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureChannels._shader;\n\t\tvar masks = [\n\t\t\t[1, 0, 0, 0],\n\t\t\t[0, 1, 0, 0],\n\t\t\t[0, 0, 1, 0],\n\t\t\t[0, 0, 0, 1]\n\t\t];\n\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\tif (!this._channels[i]) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis._channels[i].drawTo(function() {\n\t\t\t\ttexA.bind(0);\n\t\t\t\tshader\n\t\t\t\t\t.uniforms({ u_texture: 0, u_mask: masks[i] })\n\t\t\t\t\t.draw(mesh);\n\t\t\t});\n\t\t\tthis.setOutputData(i, this._channels[i]);\n\t\t}\n\t};\n\n\tLGraphTextureChannels.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec4 u_mask;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/textureChannels\",\n\t\tLGraphTextureChannels\n\t);\n\n\t// Texture Channels to Texture *****************************************\n\tfunction LGraphChannelsTexture() {\n\t\tthis.addInput(\"R\", \"Texture\");\n\t\tthis.addInput(\"G\", \"Texture\");\n\t\tthis.addInput(\"B\", \"Texture\");\n\t\tthis.addInput(\"A\", \"Texture\");\n\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\n\t\tthis.properties = {\n\t\t\tprecision: LGraphTexture.DEFAULT,\n\t\t\tR: 1,\n\t\t\tG: 1,\n\t\t\tB: 1,\n\t\t\tA: 1\n\t\t};\n\t\tthis._color = vec4.create();\n\t\tthis._uniforms = {\n\t\t\tu_textureR: 0,\n\t\t\tu_textureG: 1,\n\t\t\tu_textureB: 2,\n\t\t\tu_textureA: 3,\n\t\t\tu_color: this._color\n\t\t};\n\t}\n\n\tLGraphChannelsTexture.title = \"Channels to Texture\";\n\tLGraphChannelsTexture.desc = \"Split texture channels\";\n\tLGraphChannelsTexture.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphChannelsTexture.prototype.onExecute = function() {\n\t\tvar white = LGraphTexture.getWhiteTexture();\n\t\tvar texR = this.getInputData(0) || white;\n\t\tvar texG = this.getInputData(1) || white;\n\t\tvar texB = this.getInputData(2) || white;\n\t\tvar texA = this.getInputData(3) || white;\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tif (!LGraphChannelsTexture._shader) {\n\t\t\tLGraphChannelsTexture._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphChannelsTexture.pixel_shader\n\t\t\t);\n\t\t}\n\t\tvar shader = LGraphChannelsTexture._shader;\n\n\t\tvar w = Math.max(texR.width, texG.width, texB.width, texA.width);\n\t\tvar h = Math.max(\n\t\t\ttexR.height,\n\t\t\ttexG.height,\n\t\t\ttexB.height,\n\t\t\ttexA.height\n\t\t);\n\t\tvar type =\n\t\t\tthis.properties.precision == LGraphTexture.HIGH\n\t\t\t\t? LGraphTexture.HIGH_PRECISION_FORMAT\n\t\t\t\t: gl.UNSIGNED_BYTE;\n\n\t\tif (\n\t\t\t!this._texture ||\n\t\t\tthis._texture.width != w ||\n\t\t\tthis._texture.height != h ||\n\t\t\tthis._texture.type != type\n\t\t) {\n\t\t\tthis._texture = new GL.Texture(w, h, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar color = this._color;\n\t\tcolor[0] = this.properties.R;\n\t\tcolor[1] = this.properties.G;\n\t\tcolor[2] = this.properties.B;\n\t\tcolor[3] = this.properties.A;\n\t\tvar uniforms = this._uniforms;\n\n\t\tthis._texture.drawTo(function() {\n\t\t\ttexR.bind(0);\n\t\t\ttexG.bind(1);\n\t\t\ttexB.bind(2);\n\t\t\ttexA.bind(3);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\t\tthis.setOutputData(0, this._texture);\n\t};\n\n\tLGraphChannelsTexture.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_textureR;\\n\\\n\t\tuniform sampler2D u_textureG;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform sampler2D u_textureA;\\n\\\n\t\tuniform vec4 u_color;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t   gl_FragColor = u_color * vec4( \\\n\t\t\t\t\ttexture2D(u_textureR, v_coord).r,\\\n\t\t\t\t\ttexture2D(u_textureG, v_coord).r,\\\n\t\t\t\t\ttexture2D(u_textureB, v_coord).r,\\\n\t\t\t\t\ttexture2D(u_textureA, v_coord).r);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/channelsTexture\",\n\t\tLGraphChannelsTexture\n\t);\n\n\t// Texture Color *****************************************\n\tfunction LGraphTextureColor() {\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\n\t\tthis._tex_color = vec4.create();\n\t\tthis.properties = {\n\t\t\tcolor: vec4.create(),\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureColor.title = \"Color\";\n\tLGraphTextureColor.desc =\n\t\t\"Generates a 1x1 texture with a constant color\";\n\n\tLGraphTextureColor.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureColor.prototype.onDrawBackground = function(ctx) {\n\t\tvar c = this.properties.color;\n\t\tctx.fillStyle =\n\t\t\t\"rgb(\" +\n\t\t\tMath.floor(clamp(c[0], 0, 1) * 255) +\n\t\t\t\",\" +\n\t\t\tMath.floor(clamp(c[1], 0, 1) * 255) +\n\t\t\t\",\" +\n\t\t\tMath.floor(clamp(c[2], 0, 1) * 255) +\n\t\t\t\")\";\n\t\tif (this.flags.collapsed) {\n\t\t\tthis.boxcolor = ctx.fillStyle;\n\t\t} else {\n\t\t\tctx.fillRect(0, 0, this.size[0], this.size[1]);\n\t\t}\n\t};\n\n\tLGraphTextureColor.prototype.onExecute = function() {\n\t\tvar type =\n\t\t\tthis.properties.precision == LGraphTexture.HIGH\n\t\t\t\t? LGraphTexture.HIGH_PRECISION_FORMAT\n\t\t\t\t: gl.UNSIGNED_BYTE;\n\n\t\tif (!this._tex || this._tex.type != type) {\n\t\t\tthis._tex = new GL.Texture(1, 1, {\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\ttype: type,\n\t\t\t\tminFilter: gl.NEAREST\n\t\t\t});\n\t\t}\n\t\tvar color = this.properties.color;\n\n\t\tif (this.inputs) {\n\t\t\tfor (var i = 0; i < this.inputs.length; i++) {\n\t\t\t\tvar input = this.inputs[i];\n\t\t\t\tvar v = this.getInputData(i);\n\t\t\t\tif (v === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tswitch (input.name) {\n\t\t\t\t\tcase \"RGB\":\n\t\t\t\t\tcase \"RGBA\":\n\t\t\t\t\t\tcolor.set(v);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"R\":\n\t\t\t\t\t\tcolor[0] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"G\":\n\t\t\t\t\t\tcolor[1] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"B\":\n\t\t\t\t\t\tcolor[2] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"A\":\n\t\t\t\t\t\tcolor[3] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (vec4.sqrDist(this._tex_color, color) > 0.001) {\n\t\t\tthis._tex_color.set(color);\n\t\t\tthis._tex.fill(color);\n\t\t}\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureColor.prototype.onGetInputs = function() {\n\t\treturn [\n\t\t\t[\"RGB\", \"vec3\"],\n\t\t\t[\"RGBA\", \"vec4\"],\n\t\t\t[\"R\", \"number\"],\n\t\t\t[\"G\", \"number\"],\n\t\t\t[\"B\", \"number\"],\n\t\t\t[\"A\", \"number\"]\n\t\t];\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/color\", LGraphTextureColor);\n\n\t// Texture Channels to Texture *****************************************\n\tfunction LGraphTextureGradient() {\n\t\tthis.addInput(\"A\", \"color\");\n\t\tthis.addInput(\"B\", \"color\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\n\t\tthis.properties = {\n\t\t\tangle: 0,\n\t\t\tscale: 1,\n\t\t\tA: [0, 0, 0],\n\t\t\tB: [1, 1, 1],\n\t\t\ttexture_size: 32\n\t\t};\n\t\tif (!LGraphTextureGradient._shader) {\n\t\t\tLGraphTextureGradient._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureGradient.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tthis._uniforms = {\n\t\t\tu_angle: 0,\n\t\t\tu_colorA: vec3.create(),\n\t\t\tu_colorB: vec3.create()\n\t\t};\n\t}\n\n\tLGraphTextureGradient.title = \"Gradient\";\n\tLGraphTextureGradient.desc = \"Generates a gradient\";\n\tLGraphTextureGradient[\"@A\"] = { type: \"color\" };\n\tLGraphTextureGradient[\"@B\"] = { type: \"color\" };\n\tLGraphTextureGradient[\"@texture_size\"] = {\n\t\ttype: \"enum\",\n\t\tvalues: [32, 64, 128, 256, 512]\n\t};\n\n\tLGraphTextureGradient.prototype.onExecute = function() {\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = GL.Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureGradient._shader;\n\n\t\tvar A = this.getInputData(0);\n\t\tif (!A) {\n\t\t\tA = this.properties.A;\n\t\t}\n\t\tvar B = this.getInputData(1);\n\t\tif (!B) {\n\t\t\tB = this.properties.B;\n\t\t}\n\n\t\t//angle and scale\n\t\tfor (var i = 2; i < this.inputs.length; i++) {\n\t\t\tvar input = this.inputs[i];\n\t\t\tvar v = this.getInputData(i);\n\t\t\tif (v === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.properties[input.name] = v;\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tthis._uniforms.u_angle = this.properties.angle * DEG2RAD;\n\t\tthis._uniforms.u_scale = this.properties.scale;\n\t\tvec3.copy(uniforms.u_colorA, A);\n\t\tvec3.copy(uniforms.u_colorB, B);\n\n\t\tvar size = parseInt(this.properties.texture_size);\n\t\tif (!this._tex || this._tex.width != size) {\n\t\t\tthis._tex = new GL.Texture(size, size, {\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureGradient.prototype.onGetInputs = function() {\n\t\treturn [[\"angle\", \"number\"], [\"scale\", \"number\"]];\n\t};\n\n\tLGraphTextureGradient.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform float u_angle;\\n\\\n\t\tuniform float u_scale;\\n\\\n\t\tuniform vec3 u_colorA;\\n\\\n\t\tuniform vec3 u_colorB;\\n\\\n\t\t\\n\\\n\t\tvec2 rotate(vec2 v, float angle)\\n\\\n\t\t{\\n\\\n\t\t\tvec2 result;\\n\\\n\t\t\tfloat _cos = cos(angle);\\n\\\n\t\t\tfloat _sin = sin(angle);\\n\\\n\t\t\tresult.x = v.x * _cos - v.y * _sin;\\n\\\n\t\t\tresult.y = v.x * _sin + v.y * _cos;\\n\\\n\t\t\treturn result;\\n\\\n\t\t}\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tfloat f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;\\n\\\n\t\t\tvec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));\\n\\\n\t\t   gl_FragColor = vec4(color,1.0);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/gradient\", LGraphTextureGradient);\n\n\t// Texture Mix *****************************************\n\tfunction LGraphTextureMix() {\n\t\tthis.addInput(\"A\", \"Texture\");\n\t\tthis.addInput(\"B\", \"Texture\");\n\t\tthis.addInput(\"Mixer\", \"Texture\");\n\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.properties = { factor: 0.5, size_from_biggest: true, invert: false, precision: LGraphTexture.DEFAULT };\n\t\tthis._uniforms = {\n\t\t\tu_textureA: 0,\n\t\t\tu_textureB: 1,\n\t\t\tu_textureMix: 2,\n\t\t\tu_mix: vec4.create()\n\t\t};\n\t}\n\n\tLGraphTextureMix.title = \"Mix\";\n\tLGraphTextureMix.desc = \"Generates a texture mixing two textures\";\n\n\tLGraphTextureMix.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureMix.prototype.onExecute = function() {\n\t\tvar texA = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, texA);\n\t\t\treturn;\n\t\t}\n\n\t\tvar texB = this.getInputData(1);\n\t\tif (!texA || !texB) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar texMix = this.getInputData(2);\n\n\t\tvar factor = this.getInputData(3);\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\tthis.properties.size_from_biggest && texB.width > texA.width ? texB : texA,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = null;\n\t\tvar uniforms = this._uniforms;\n\t\tif (texMix) {\n\t\t\tshader = LGraphTextureMix._shader_tex;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphTextureMix._shader_tex = new GL.Shader(\n\t\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphTextureMix.pixel_shader,\n\t\t\t\t\t{ MIX_TEX: \"\" }\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tshader = LGraphTextureMix._shader_factor;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphTextureMix._shader_factor = new GL.Shader(\n\t\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphTextureMix.pixel_shader\n\t\t\t\t);\n\t\t\t}\n\t\t\tvar f = factor == null ? this.properties.factor : factor;\n\t\t\tuniforms.u_mix.set([f, f, f, f]);\n\t\t}\n\n\t\tvar invert = this.properties.invert;\n\n\t\tthis._tex.drawTo(function() {\n\t\t\ttexA.bind( invert ? 1 : 0 );\n\t\t\ttexB.bind( invert ? 0 : 1 );\n\t\t\tif (texMix) {\n\t\t\t\ttexMix.bind(2);\n\t\t\t}\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureMix.prototype.onGetInputs = function() {\n\t\treturn [[\"factor\", \"number\"]];\n\t};\n\n\tLGraphTextureMix.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_textureA;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\t#ifdef MIX_TEX\\n\\\n\t\t\tuniform sampler2D u_textureMix;\\n\\\n\t\t#else\\n\\\n\t\t\tuniform vec4 u_mix;\\n\\\n\t\t#endif\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\t#ifdef MIX_TEX\\n\\\n\t\t\t   vec4 f = texture2D(u_textureMix, v_coord);\\n\\\n\t\t\t#else\\n\\\n\t\t\t   vec4 f = u_mix;\\n\\\n\t\t\t#endif\\n\\\n\t\t   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/mix\", LGraphTextureMix);\n\n\t// Texture Edges detection *****************************************\n\tfunction LGraphTextureEdges() {\n\t\tthis.addInput(\"Tex.\", \"Texture\");\n\n\t\tthis.addOutput(\"Edges\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tinvert: true,\n\t\t\tthreshold: false,\n\t\t\tfactor: 1,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tif (!LGraphTextureEdges._shader) {\n\t\t\tLGraphTextureEdges._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureEdges.pixel_shader\n\t\t\t);\n\t\t}\n\t}\n\n\tLGraphTextureEdges.title = \"Edges\";\n\tLGraphTextureEdges.desc = \"Detects edges\";\n\n\tLGraphTextureEdges.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureEdges.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\ttex,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureEdges._shader;\n\t\tvar invert = this.properties.invert;\n\t\tvar factor = this.properties.factor;\n\t\tvar threshold = this.properties.threshold ? 1 : 0;\n\n\t\tthis._tex.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_isize: [1 / tex.width, 1 / tex.height],\n\t\t\t\t\tu_factor: factor,\n\t\t\t\t\tu_threshold: threshold,\n\t\t\t\t\tu_invert: invert ? 1 : 0\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureEdges.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_isize;\\n\\\n\t\tuniform int u_invert;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tuniform float u_threshold;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 center = texture2D(u_texture, v_coord);\\n\\\n\t\t\tvec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );\\n\\\n\t\t\tvec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );\\n\\\n\t\t\tvec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );\\n\\\n\t\t\tvec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );\\n\\\n\t\t\tvec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);\\n\\\n\t\t\tdiff *= u_factor;\\n\\\n\t\t\tif(u_invert == 1)\\n\\\n\t\t\t\tdiff.xyz = vec3(1.0) - diff.xyz;\\n\\\n\t\t\tif( u_threshold == 0.0 )\\n\\\n\t\t\t\tgl_FragColor = vec4( diff.xyz, center.a );\\n\\\n\t\t\telse\\n\\\n\t\t\t\tgl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/edges\", LGraphTextureEdges);\n\n\t// Texture Depth *****************************************\n\tfunction LGraphTextureDepthRange() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"Distance\", \"number\");\n\t\tthis.addInput(\"Range\", \"number\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tdistance: 100,\n\t\t\trange: 50,\n\t\t\tonly_depth: false,\n\t\t\thigh_precision: false\n\t\t};\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_distance: 100,\n\t\t\tu_range: 50,\n\t\t\tu_camera_planes: null\n\t\t};\n\t}\n\n\tLGraphTextureDepthRange.title = \"Depth Range\";\n\tLGraphTextureDepthRange.desc = \"Generates a texture with a depth range\";\n\n\tLGraphTextureDepthRange.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar precision = gl.UNSIGNED_BYTE;\n\t\tif (this.properties.high_precision) {\n\t\t\tprecision = gl.half_float_ext ? gl.HALF_FLOAT_OES : gl.FLOAT;\n\t\t}\n\n\t\tif (\n\t\t\t!this._temp_texture ||\n\t\t\tthis._temp_texture.type != precision ||\n\t\t\tthis._temp_texture.width != tex.width ||\n\t\t\tthis._temp_texture.height != tex.height\n\t\t) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: precision,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\n\t\t//iterations\n\t\tvar distance = this.properties.distance;\n\t\tif (this.isInputConnected(1)) {\n\t\t\tdistance = this.getInputData(1);\n\t\t\tthis.properties.distance = distance;\n\t\t}\n\n\t\tvar range = this.properties.range;\n\t\tif (this.isInputConnected(2)) {\n\t\t\trange = this.getInputData(2);\n\t\t\tthis.properties.range = range;\n\t\t}\n\n\t\tuniforms.u_distance = distance;\n\t\tuniforms.u_range = range;\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tif (!LGraphTextureDepthRange._shader) {\n\t\t\tLGraphTextureDepthRange._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureDepthRange.pixel_shader\n\t\t\t);\n\t\t\tLGraphTextureDepthRange._shader_onlydepth = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureDepthRange.pixel_shader,\n\t\t\t\t{ ONLY_DEPTH: \"\" }\n\t\t\t);\n\t\t}\n\t\tvar shader = this.properties.only_depth\n\t\t\t? LGraphTextureDepthRange._shader_onlydepth\n\t\t\t: LGraphTextureDepthRange._shader;\n\n\t\t//NEAR AND FAR PLANES\n\t\tvar planes = null;\n\t\tif (tex.near_far_planes) {\n\t\t\tplanes = tex.near_far_planes;\n\t\t} else if (window.LS && LS.Renderer._main_camera) {\n\t\t\tplanes = LS.Renderer._main_camera._uniforms.u_camera_planes;\n\t\t} else {\n\t\t\tplanes = [0.1, 1000];\n\t\t} //hardcoded\n\t\tuniforms.u_camera_planes = planes;\n\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis._temp_texture.near_far_planes = planes;\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLGraphTextureDepthRange.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_camera_planes;\\n\\\n\t\tuniform float u_distance;\\n\\\n\t\tuniform float u_range;\\n\\\n\t\t\\n\\\n\t\tfloat LinearDepth()\\n\\\n\t\t{\\n\\\n\t\t\tfloat zNear = u_camera_planes.x;\\n\\\n\t\t\tfloat zFar = u_camera_planes.y;\\n\\\n\t\t\tfloat depth = texture2D(u_texture, v_coord).x;\\n\\\n\t\t\tdepth = depth * 2.0 - 1.0;\\n\\\n\t\t\treturn zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tfloat depth = LinearDepth();\\n\\\n\t\t\t#ifdef ONLY_DEPTH\\n\\\n\t\t\t   gl_FragColor = vec4(depth);\\n\\\n\t\t\t#else\\n\\\n\t\t\t\tfloat diff = abs(depth * u_camera_planes.y - u_distance);\\n\\\n\t\t\t\tfloat dof = 1.0;\\n\\\n\t\t\t\tif(diff <= u_range)\\n\\\n\t\t\t\t\tdof = diff / u_range;\\n\\\n\t\t\t   gl_FragColor = vec4(dof);\\n\\\n\t\t\t#endif\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType( \"texture/depth_range\", LGraphTextureDepthRange );\n\n\n\t// Texture Depth *****************************************\n\tfunction LGraphTextureLinearDepth() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tprecision: LGraphTexture.DEFAULT,\n\t\t\tinvert: false\n\t\t};\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_camera_planes: null, //filled later\n\t\t\tu_ires: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTextureLinearDepth.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureLinearDepth.title = \"Linear Depth\";\n\tLGraphTextureLinearDepth.desc = \"Creates a color texture with linear depth\";\n\n\tLGraphTextureLinearDepth.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex || (tex.format != gl.DEPTH_COMPONENT && tex.format != gl.DEPTH_STENCIL) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar precision = this.properties.precision == LGraphTexture.HIGH ? gl.HIGH_PRECISION_FORMAT : gl.UNSIGNED_BYTE;\n\n\t\tif ( !this._temp_texture || this._temp_texture.type != precision || this._temp_texture.width != tex.width || this._temp_texture.height != tex.height ) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: precision,\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_invert = this.properties.invert ? 1 : 0;\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tif(!LGraphTextureLinearDepth._shader)\n\t\t\tLGraphTextureLinearDepth._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureLinearDepth.pixel_shader);\n\t\tvar shader = LGraphTextureLinearDepth._shader;\n\n\t\t//NEAR AND FAR PLANES\n\t\tvar planes = null;\n\t\tif (tex.near_far_planes) {\n\t\t\tplanes = tex.near_far_planes;\n\t\t} else if (window.LS && LS.Renderer._main_camera) {\n\t\t\tplanes = LS.Renderer._main_camera._uniforms.u_camera_planes;\n\t\t} else {\n\t\t\tplanes = [0.1, 1000];\n\t\t} //hardcoded\n\t\tuniforms.u_camera_planes = planes;\n\t\t//uniforms.u_ires.set([1/tex.width, 1/tex.height]);\n\t\tuniforms.u_ires.set([0,0]);\n\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis._temp_texture.near_far_planes = planes;\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLGraphTextureLinearDepth.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_camera_planes;\\n\\\n\t\tuniform int u_invert;\\n\\\n\t\tuniform vec2 u_ires;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tfloat zNear = u_camera_planes.x;\\n\\\n\t\t\tfloat zFar = u_camera_planes.y;\\n\\\n\t\t\tfloat depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;\\n\\\n\t\t\tfloat f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));\\n\\\n\t\t\tif( u_invert == 1 )\\n\\\n\t\t\t\tf = 1.0 - f;\\n\\\n\t\t\tgl_FragColor = vec4(vec3(f),1.0);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType( \"texture/linear_depth\", LGraphTextureLinearDepth );\n\n\t// Texture Blur *****************************************\n\tfunction LGraphTextureBlur() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"Iterations\", \"number\");\n\t\tthis.addInput(\"Intensity\", \"number\");\n\t\tthis.addOutput(\"Blurred\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tintensity: 1,\n\t\t\titerations: 1,\n\t\t\tpreserve_aspect: false,\n\t\t\tscale: [1, 1],\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureBlur.title = \"Blur\";\n\tLGraphTextureBlur.desc = \"Blur a texture\";\n\n\tLGraphTextureBlur.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureBlur.max_iterations = 20;\n\n\tLGraphTextureBlur.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._final_texture;\n\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\t//we need two textures to do the blurring\n\t\t\t//this._temp_texture = new GL.Texture( tex.width, tex.height, { type: tex.type, format: gl.RGBA, filter: gl.LINEAR });\n\t\t\ttemp = this._final_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\t//iterations\n\t\tvar iterations = this.properties.iterations;\n\t\tif (this.isInputConnected(1)) {\n\t\t\titerations = this.getInputData(1);\n\t\t\tthis.properties.iterations = iterations;\n\t\t}\n\t\titerations = Math.min(\n\t\t\tMath.floor(iterations),\n\t\t\tLGraphTextureBlur.max_iterations\n\t\t);\n\t\tif (iterations == 0) {\n\t\t\t//skip blurring\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar intensity = this.properties.intensity;\n\t\tif (this.isInputConnected(2)) {\n\t\t\tintensity = this.getInputData(2);\n\t\t\tthis.properties.intensity = intensity;\n\t\t}\n\n\t\t//blur sometimes needs an aspect correction\n\t\tvar aspect = LiteGraph.camera_aspect;\n\t\tif (!aspect && window.gl !== undefined) {\n\t\t\taspect = gl.canvas.height / gl.canvas.width;\n\t\t}\n\t\tif (!aspect) {\n\t\t\taspect = 1;\n\t\t}\n\t\taspect = this.properties.preserve_aspect ? aspect : 1;\n\n\t\tvar scale = this.properties.scale || [1, 1];\n\t\ttex.applyBlur(aspect * scale[0], scale[1], intensity, temp);\n\t\tfor (var i = 1; i < iterations; ++i) {\n\t\t\ttemp.applyBlur(\n\t\t\t\taspect * scale[0] * (i + 1),\n\t\t\t\tscale[1] * (i + 1),\n\t\t\t\tintensity\n\t\t\t);\n\t\t}\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\t/*\nLGraphTextureBlur.pixel_shader = \"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\tuniform float u_intensity;\\n\\\n\t\tvoid main() {\\n\\\n\t\t   vec4 sum = vec4(0.0);\\n\\\n\t\t   vec4 center = texture2D(u_texture, v_coord);\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -4.0) * 0.05/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -3.0) * 0.09/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -2.0) * 0.12/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -1.0) * 0.15/0.98;\\n\\\n\t\t   sum += center * 0.16/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 4.0) * 0.05/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 3.0) * 0.09/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 2.0) * 0.12/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 1.0) * 0.15/0.98;\\n\\\n\t\t   gl_FragColor = u_intensity * sum;\\n\\\n\t\t}\\n\\\n\t\t\";\n*/\n\n\tLiteGraph.registerNodeType(\"texture/blur\", LGraphTextureBlur);\n\n\t//Independent glow FX\n\t//based on https://catlikecoding.com/unity/tutorials/advanced-rendering/bloom/\n\tfunction FXGlow()\n\t{\n\t\tthis.intensity = 0.5;\n\t\tthis.persistence = 0.6;\n\t\tthis.iterations = 8;\n\t\tthis.threshold = 0.8;\n\t\tthis.scale = 1;\n\n\t\tthis.dirt_texture = null;\n\t\tthis.dirt_factor = 0.5;\n\n\t\tthis._textures = [];\n\t\tthis._uniforms = {\n\t\t\tu_intensity: 1,\n\t\t\tu_texture: 0,\n\t\t\tu_glow_texture: 1,\n\t\t\tu_threshold: 0,\n\t\t\tu_texel_size: vec2.create()\n\t\t};\n\t}\n\n\tFXGlow.prototype.applyFX = function( tex, output_texture, glow_texture, average_texture ) {\n\n\t\tvar width = tex.width;\n\t\tvar height = tex.height;\n\n\t\tvar texture_info = {\n\t\t\tformat: tex.format,\n\t\t\ttype: tex.type,\n\t\t\tminFilter: GL.LINEAR,\n\t\t\tmagFilter: GL.LINEAR,\n\t\t\twrap: gl.CLAMP_TO_EDGE\n\t\t};\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar textures = this._textures;\n\n\t\t//cut\n\t\tvar shader = FXGlow._cut_shader;\n\t\tif (!shader) {\n\t\t\tshader = FXGlow._cut_shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tFXGlow.cut_pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tgl.disable(gl.BLEND);\n\n\t\tuniforms.u_threshold = this.threshold;\n\t\tvar currentDestination = (textures[0] = GL.Texture.getTemporary(\n\t\t\twidth,\n\t\t\theight,\n\t\t\ttexture_info\n\t\t));\n\t\ttex.blit( currentDestination, shader.uniforms(uniforms) );\n\t\tvar currentSource = currentDestination;\n\n\t\tvar iterations = this.iterations;\n\t\titerations = clamp(iterations, 1, 16) | 0;\n\t\tvar texel_size = uniforms.u_texel_size;\n\t\tvar intensity = this.intensity;\n\n\t\tuniforms.u_intensity = 1;\n\t\tuniforms.u_delta = this.scale; //1\n\n\t\t//downscale/upscale shader\n\t\tvar shader = FXGlow._shader;\n\t\tif (!shader) {\n\t\t\tshader = FXGlow._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tFXGlow.scale_pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar i = 1;\n\t\t//downscale\n\t\tfor (; i < iterations; i++) {\n\t\t\twidth = width >> 1;\n\t\t\tif ((height | 0) > 1) {\n\t\t\t\theight = height >> 1;\n\t\t\t}\n\t\t\tif (width < 2) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcurrentDestination = textures[i] = GL.Texture.getTemporary(\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\ttexture_info\n\t\t\t);\n\t\t\ttexel_size[0] = 1 / currentSource.width;\n\t\t\ttexel_size[1] = 1 / currentSource.height;\n\t\t\tcurrentSource.blit(\n\t\t\t\tcurrentDestination,\n\t\t\t\tshader.uniforms(uniforms)\n\t\t\t);\n\t\t\tcurrentSource = currentDestination;\n\t\t}\n\n\t\t//average\n\t\tif (average_texture) {\n\t\t\ttexel_size[0] = 1 / currentSource.width;\n\t\t\ttexel_size[1] = 1 / currentSource.height;\n\t\t\tuniforms.u_intensity = intensity;\n\t\t\tuniforms.u_delta = 1;\n\t\t\tcurrentSource.blit(average_texture, shader.uniforms(uniforms));\n\t\t}\n\n\t\t//upscale and blend\n\t\tgl.enable(gl.BLEND);\n\t\tgl.blendFunc(gl.ONE, gl.ONE);\n\t\tuniforms.u_intensity = this.persistence;\n\t\tuniforms.u_delta = 0.5;\n\n\t\t// i-=2 => -1 to point to last element in array, -1 to go to texture above\n\t\tfor ( i -= 2; i >= 0; i-- ) \n\t\t{\n\t\t\tcurrentDestination = textures[i];\n\t\t\ttextures[i] = null;\n\t\t\ttexel_size[0] = 1 / currentSource.width;\n\t\t\ttexel_size[1] = 1 / currentSource.height;\n\t\t\tcurrentSource.blit(\n\t\t\t\tcurrentDestination,\n\t\t\t\tshader.uniforms(uniforms)\n\t\t\t);\n\t\t\tGL.Texture.releaseTemporary(currentSource);\n\t\t\tcurrentSource = currentDestination;\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\n\t\t//glow\n\t\tif (glow_texture) {\n\t\t\tcurrentSource.blit(glow_texture);\n\t\t}\n\n\t\t//final composition\n\t\tif ( output_texture ) {\n\t\t\tvar final_texture = output_texture;\n\t\t\tvar dirt_texture = this.dirt_texture;\n\t\t\tvar dirt_factor = this.dirt_factor;\n\t\t\tuniforms.u_intensity = intensity;\n\n\t\t\tshader = dirt_texture\n\t\t\t\t? FXGlow._dirt_final_shader\n\t\t\t\t: FXGlow._final_shader;\n\t\t\tif (!shader) {\n\t\t\t\tif (dirt_texture) {\n\t\t\t\t\tshader = FXGlow._dirt_final_shader = new GL.Shader(\n\t\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\t\tFXGlow.final_pixel_shader,\n\t\t\t\t\t\t{ USE_DIRT: \"\" }\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tshader = FXGlow._final_shader = new GL.Shader(\n\t\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\t\tFXGlow.final_pixel_shader\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfinal_texture.drawTo(function() {\n\t\t\t\ttex.bind(0);\n\t\t\t\tcurrentSource.bind(1);\n\t\t\t\tif (dirt_texture) {\n\t\t\t\t\tshader.setUniform(\"u_dirt_factor\", dirt_factor);\n\t\t\t\t\tshader.setUniform(\n\t\t\t\t\t\t\"u_dirt_texture\",\n\t\t\t\t\t\tdirt_texture.bind(2)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tshader.toViewport(uniforms);\n\t\t\t});\n\t\t}\n\n\t\tGL.Texture.releaseTemporary(currentSource);\n\t};\n\n\tFXGlow.cut_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\tvarying vec2 v_coord;\\n\\\n\tuniform sampler2D u_texture;\\n\\\n\tuniform float u_threshold;\\n\\\n\tvoid main() {\\n\\\n\t\tgl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );\\n\\\n\t}\";\n\n\tFXGlow.scale_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\tvarying vec2 v_coord;\\n\\\n\tuniform sampler2D u_texture;\\n\\\n\tuniform vec2 u_texel_size;\\n\\\n\tuniform float u_delta;\\n\\\n\tuniform float u_intensity;\\n\\\n\t\\n\\\n\tvec4 sampleBox(vec2 uv) {\\n\\\n\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\\n\\\n\t\tvec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);\\n\\\n\t\treturn s * 0.25;\\n\\\n\t}\\n\\\n\tvoid main() {\\n\\\n\t\tgl_FragColor = u_intensity * sampleBox( v_coord );\\n\\\n\t}\";\n\n\tFXGlow.final_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\tvarying vec2 v_coord;\\n\\\n\tuniform sampler2D u_texture;\\n\\\n\tuniform sampler2D u_glow_texture;\\n\\\n\t#ifdef USE_DIRT\\n\\\n\t\tuniform sampler2D u_dirt_texture;\\n\\\n\t#endif\\n\\\n\tuniform vec2 u_texel_size;\\n\\\n\tuniform float u_delta;\\n\\\n\tuniform float u_intensity;\\n\\\n\tuniform float u_dirt_factor;\\n\\\n\t\\n\\\n\tvec4 sampleBox(vec2 uv) {\\n\\\n\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\\n\\\n\t\tvec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);\\n\\\n\t\treturn s * 0.25;\\n\\\n\t}\\n\\\n\tvoid main() {\\n\\\n\t\tvec4 glow = sampleBox( v_coord );\\n\\\n\t\t#ifdef USE_DIRT\\n\\\n\t\t\tglow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );\\n\\\n\t\t#endif\\n\\\n\t\tgl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;\\n\\\n\t}\";\n\n\n\t// Texture Glow *****************************************\n\tfunction LGraphTextureGlow() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"dirt\", \"Texture\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.addOutput(\"glow\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tenabled: true,\n\t\t\tintensity: 1,\n\t\t\tpersistence: 0.99,\n\t\t\titerations: 16,\n\t\t\tthreshold: 0,\n\t\t\tscale: 1,\n\t\t\tdirt_factor: 0.5,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis.fx = new FXGlow();\n\t}\n\n\tLGraphTextureGlow.title = \"Glow\";\n\tLGraphTextureGlow.desc = \"Filters a texture giving it a glow effect\";\n\n\tLGraphTextureGlow.widgets_info = {\n\t\titerations: {\n\t\t\ttype: \"number\",\n\t\t\tmin: 0,\n\t\t\tmax: 16,\n\t\t\tstep: 1,\n\t\t\tprecision: 0\n\t\t},\n\t\tthreshold: {\n\t\t\ttype: \"number\",\n\t\t\tmin: 0,\n\t\t\tmax: 10,\n\t\t\tstep: 0.01,\n\t\t\tprecision: 2\n\t\t},\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureGlow.prototype.onGetInputs = function() {\n\t\treturn [\n\t\t\t[\"enabled\", \"boolean\"],\n\t\t\t[\"threshold\", \"number\"],\n\t\t\t[\"intensity\", \"number\"],\n\t\t\t[\"persistence\", \"number\"],\n\t\t\t[\"iterations\", \"number\"],\n\t\t\t[\"dirt_factor\", \"number\"]\n\t\t];\n\t};\n\n\tLGraphTextureGlow.prototype.onGetOutputs = function() {\n\t\treturn [[\"average\", \"Texture\"]];\n\t};\n\n\tLGraphTextureGlow.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isAnyOutputConnected()) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (\n\t\t\tthis.properties.precision === LGraphTexture.PASS_THROUGH ||\n\t\t\tthis.getInputOrProperty(\"enabled\") === false\n\t\t) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = tex.width;\n\t\tvar height = tex.height;\n\n\t\tvar fx = this.fx;\n\t\tfx.threshold = this.getInputOrProperty(\"threshold\");\n\t\tfx.iterations = this.getInputOrProperty(\"iterations\");\n\t\tfx.intensity = this.getInputOrProperty(\"intensity\");\n\t\tfx.persistence = this.getInputOrProperty(\"persistence\");\n\t\tfx.dirt_texture = this.getInputData(1);\n\t\tfx.dirt_factor = this.getInputOrProperty(\"dirt_factor\");\n\t\tfx.scale = this.properties.scale;\n\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, tex );\n\n\t\tvar average_texture = null;\n\t\tif (this.isOutputConnected(2)) {\n\t\t\taverage_texture = this._average_texture;\n\t\t\tif (\n\t\t\t\t!average_texture ||\n\t\t\t\taverage_texture.type != tex.type ||\n\t\t\t\taverage_texture.format != tex.format\n\t\t\t) {\n\t\t\t\taverage_texture = this._average_texture = new GL.Texture(\n\t\t\t\t\t1,\n\t\t\t\t\t1,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: tex.type,\n\t\t\t\t\t\tformat: tex.format,\n\t\t\t\t\t\tfilter: gl.LINEAR\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tvar glow_texture = null;\n\t\tif (this.isOutputConnected(1)) {\n\t\t\tglow_texture = this._glow_texture;\n\t\t\tif (\n\t\t\t\t!glow_texture ||\n\t\t\t\tglow_texture.width != tex.width ||\n\t\t\t\tglow_texture.height != tex.height ||\n\t\t\t\tglow_texture.type != type ||\n\t\t\t\tglow_texture.format != tex.format\n\t\t\t) {\n\t\t\t\tglow_texture = this._glow_texture = new GL.Texture(\n\t\t\t\t\ttex.width,\n\t\t\t\t\ttex.height,\n\t\t\t\t\t{ type: type, format: tex.format, filter: gl.LINEAR }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tvar final_texture = null;\n\t\tif (this.isOutputConnected(0)) {\n\t\t\tfinal_texture = this._final_texture;\n\t\t\tif (\n\t\t\t\t!final_texture ||\n\t\t\t\tfinal_texture.width != tex.width ||\n\t\t\t\tfinal_texture.height != tex.height ||\n\t\t\t\tfinal_texture.type != type ||\n\t\t\t\tfinal_texture.format != tex.format\n\t\t\t) {\n\t\t\t\tfinal_texture = this._final_texture = new GL.Texture(\n\t\t\t\t\ttex.width,\n\t\t\t\t\ttex.height,\n\t\t\t\t\t{ type: type, format: tex.format, filter: gl.LINEAR }\n\t\t\t\t);\n\t\t\t}\n\n\t\t}\n\n\t\t//apply FX\n\t\tfx.applyFX(tex, final_texture, glow_texture, average_texture );\n\n\t\tif (this.isOutputConnected(0))\n\t\t\tthis.setOutputData(0, final_texture);\n\n\t\tif (this.isOutputConnected(1))\n\t\t\tthis.setOutputData(1, average_texture);\n\n\t\tif (this.isOutputConnected(2))\n\t\t\tthis.setOutputData(2, glow_texture);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/glow\", LGraphTextureGlow);\n\n\t// Texture Filter *****************************************\n\tfunction LGraphTextureKuwaharaFilter() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"Filtered\", \"Texture\");\n\t\tthis.properties = { intensity: 1, radius: 5 };\n\t}\n\n\tLGraphTextureKuwaharaFilter.title = \"Kuwahara Filter\";\n\tLGraphTextureKuwaharaFilter.desc =\n\t\t\"Filters a texture giving an artistic oil canvas painting\";\n\n\tLGraphTextureKuwaharaFilter.max_radius = 10;\n\tLGraphTextureKuwaharaFilter._shaders = [];\n\n\tLGraphTextureKuwaharaFilter.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._temp_texture;\n\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: tex.type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\t//iterations\n\t\tvar radius = this.properties.radius;\n\t\tradius = Math.min(\n\t\t\tMath.floor(radius),\n\t\t\tLGraphTextureKuwaharaFilter.max_radius\n\t\t);\n\t\tif (radius == 0) {\n\t\t\t//skip blurring\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar intensity = this.properties.intensity;\n\n\t\t//blur sometimes needs an aspect correction\n\t\tvar aspect = LiteGraph.camera_aspect;\n\t\tif (!aspect && window.gl !== undefined) {\n\t\t\taspect = gl.canvas.height / gl.canvas.width;\n\t\t}\n\t\tif (!aspect) {\n\t\t\taspect = 1;\n\t\t}\n\t\taspect = this.properties.preserve_aspect ? aspect : 1;\n\n\t\tif (!LGraphTextureKuwaharaFilter._shaders[radius]) {\n\t\t\tLGraphTextureKuwaharaFilter._shaders[radius] = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureKuwaharaFilter.pixel_shader,\n\t\t\t\t{ RADIUS: radius.toFixed(0) }\n\t\t\t);\n\t\t}\n\n\t\tvar shader = LGraphTextureKuwaharaFilter._shaders[radius];\n\t\tvar mesh = GL.Mesh.getScreenQuad();\n\t\ttex.bind(0);\n\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_intensity: intensity,\n\t\t\t\t\tu_resolution: [tex.width, tex.height],\n\t\t\t\t\tu_iResolution: [1 / tex.width, 1 / tex.height]\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\t//from https://www.shadertoy.com/view/MsXSz4\n\tLGraphTextureKuwaharaFilter.pixel_shader =\n\t\t\"\\n\\\nprecision highp float;\\n\\\nvarying vec2 v_coord;\\n\\\nuniform sampler2D u_texture;\\n\\\nuniform float u_intensity;\\n\\\nuniform vec2 u_resolution;\\n\\\nuniform vec2 u_iResolution;\\n\\\n#ifndef RADIUS\\n\\\n\t#define RADIUS 7\\n\\\n#endif\\n\\\nvoid main() {\\n\\\n\\n\\\n\tconst int radius = RADIUS;\\n\\\n\tvec2 fragCoord = v_coord;\\n\\\n\tvec2 src_size = u_iResolution;\\n\\\n\tvec2 uv = v_coord;\\n\\\n\tfloat n = float((radius + 1) * (radius + 1));\\n\\\n\tint i;\\n\\\n\tint j;\\n\\\n\tvec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);\\n\\\n\tvec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);\\n\\\n\tvec3 c;\\n\\\n\t\\n\\\n\tfor (int j = -radius; j <= 0; ++j)  {\\n\\\n\t\tfor (int i = -radius; i <= 0; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm0 += c;\\n\\\n\t\t\ts0 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfor (int j = -radius; j <= 0; ++j)  {\\n\\\n\t\tfor (int i = 0; i <= radius; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm1 += c;\\n\\\n\t\t\ts1 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfor (int j = 0; j <= radius; ++j)  {\\n\\\n\t\tfor (int i = 0; i <= radius; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm2 += c;\\n\\\n\t\t\ts2 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfor (int j = 0; j <= radius; ++j)  {\\n\\\n\t\tfor (int i = -radius; i <= 0; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm3 += c;\\n\\\n\t\t\ts3 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfloat min_sigma2 = 1e+2;\\n\\\n\tm0 /= n;\\n\\\n\ts0 = abs(s0 / n - m0 * m0);\\n\\\n\t\\n\\\n\tfloat sigma2 = s0.r + s0.g + s0.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m0, 1.0);\\n\\\n\t}\\n\\\n\t\\n\\\n\tm1 /= n;\\n\\\n\ts1 = abs(s1 / n - m1 * m1);\\n\\\n\t\\n\\\n\tsigma2 = s1.r + s1.g + s1.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m1, 1.0);\\n\\\n\t}\\n\\\n\t\\n\\\n\tm2 /= n;\\n\\\n\ts2 = abs(s2 / n - m2 * m2);\\n\\\n\t\\n\\\n\tsigma2 = s2.r + s2.g + s2.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m2, 1.0);\\n\\\n\t}\\n\\\n\t\\n\\\n\tm3 /= n;\\n\\\n\ts3 = abs(s3 / n - m3 * m3);\\n\\\n\t\\n\\\n\tsigma2 = s3.r + s3.g + s3.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m3, 1.0);\\n\\\n\t}\\n\\\n}\\n\\\n\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/kuwahara\",\n\t\tLGraphTextureKuwaharaFilter\n\t);\n\n\t// Texture  *****************************************\n\tfunction LGraphTextureXDoGFilter() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"Filtered\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tsigma: 1.4,\n\t\t\tk: 1.6,\n\t\t\tp: 21.7,\n\t\t\tepsilon: 79,\n\t\t\tphi: 0.017\n\t\t};\n\t}\n\n\tLGraphTextureXDoGFilter.title = \"XDoG Filter\";\n\tLGraphTextureXDoGFilter.desc =\n\t\t\"Filters a texture giving an artistic ink style\";\n\n\tLGraphTextureXDoGFilter.max_radius = 10;\n\tLGraphTextureXDoGFilter._shaders = [];\n\n\tLGraphTextureXDoGFilter.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: tex.type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tif (!LGraphTextureXDoGFilter._xdog_shader) {\n\t\t\tLGraphTextureXDoGFilter._xdog_shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureXDoGFilter.xdog_pixel_shader\n\t\t\t);\n\t\t}\n\t\tvar shader = LGraphTextureXDoGFilter._xdog_shader;\n\t\tvar mesh = GL.Mesh.getScreenQuad();\n\n\t\tvar sigma = this.properties.sigma;\n\t\tvar k = this.properties.k;\n\t\tvar p = this.properties.p;\n\t\tvar epsilon = this.properties.epsilon;\n\t\tvar phi = this.properties.phi;\n\t\ttex.bind(0);\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tsrc: 0,\n\t\t\t\t\tsigma: sigma,\n\t\t\t\t\tk: k,\n\t\t\t\t\tp: p,\n\t\t\t\t\tepsilon: epsilon,\n\t\t\t\t\tphi: phi,\n\t\t\t\t\tcvsWidth: tex.width,\n\t\t\t\t\tcvsHeight: tex.height\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\t//from https://github.com/RaymondMcGuire/GPU-Based-Image-Processing-Tools/blob/master/lib_webgl/scripts/main.js\n\tLGraphTextureXDoGFilter.xdog_pixel_shader =\n\t\t\"\\n\\\nprecision highp float;\\n\\\nuniform sampler2D src;\\n\\n\\\nuniform float cvsHeight;\\n\\\nuniform float cvsWidth;\\n\\n\\\nuniform float sigma;\\n\\\nuniform float k;\\n\\\nuniform float p;\\n\\\nuniform float epsilon;\\n\\\nuniform float phi;\\n\\\nvarying vec2 v_coord;\\n\\n\\\nfloat cosh(float val)\\n\\\n{\\n\\\n\tfloat tmp = exp(val);\\n\\\n\tfloat cosH = (tmp + 1.0 / tmp) / 2.0;\\n\\\n\treturn cosH;\\n\\\n}\\n\\n\\\nfloat tanh(float val)\\n\\\n{\\n\\\n\tfloat tmp = exp(val);\\n\\\n\tfloat tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);\\n\\\n\treturn tanH;\\n\\\n}\\n\\n\\\nfloat sinh(float val)\\n\\\n{\\n\\\n\tfloat tmp = exp(val);\\n\\\n\tfloat sinH = (tmp - 1.0 / tmp) / 2.0;\\n\\\n\treturn sinH;\\n\\\n}\\n\\n\\\nvoid main(void){\\n\\\n\tvec3 destColor = vec3(0.0);\\n\\\n\tfloat tFrag = 1.0 / cvsHeight;\\n\\\n\tfloat sFrag = 1.0 / cvsWidth;\\n\\\n\tvec2 Frag = vec2(sFrag,tFrag);\\n\\\n\tvec2 uv = gl_FragCoord.st;\\n\\\n\tfloat twoSigmaESquared = 2.0 * sigma * sigma;\\n\\\n\tfloat twoSigmaRSquared = twoSigmaESquared * k * k;\\n\\\n\tint halfWidth = int(ceil( 1.0 * sigma * k ));\\n\\n\\\n\tconst int MAX_NUM_ITERATION = 99999;\\n\\\n\tvec2 sum = vec2(0.0);\\n\\\n\tvec2 norm = vec2(0.0);\\n\\n\\\n\tfor(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){\\n\\\n\t\tif(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}\\n\\\n\t\tint i = int(cnt / (2*halfWidth+1)) - halfWidth;\\n\\\n\t\tint j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);\\n\\n\\\n\t\tfloat d = length(vec2(i,j));\\n\\\n\t\tvec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), \\n\\\n\t\t\t\t\t\t\texp( -d * d / twoSigmaRSquared ));\\n\\n\\\n\t\tvec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;\\n\\n\\\n\t\tnorm += kernel;\\n\\\n\t\tsum += kernel * L;\\n\\\n\t}\\n\\n\\\n\tsum /= norm;\\n\\n\\\n\tfloat H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);\\n\\\n\tfloat edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));\\n\\\n\tdestColor = vec3(edge);\\n\\\n\tgl_FragColor = vec4(destColor, 1.0);\\n\\\n}\";\n\n\tLiteGraph.registerNodeType(\"texture/xDoG\", LGraphTextureXDoGFilter);\n\n\t// Texture Webcam *****************************************\n\tfunction LGraphTextureWebcam() {\n\t\tthis.addOutput(\"Webcam\", \"Texture\");\n\t\tthis.properties = { texture_name: \"\", facingMode: \"user\" };\n\t\tthis.boxcolor = \"black\";\n\t\tthis.version = 0;\n\t}\n\n\tLGraphTextureWebcam.title = \"Webcam\";\n\tLGraphTextureWebcam.desc = \"Webcam texture\";\n\n\tLGraphTextureWebcam.is_webcam_open = false;\n\n\tLGraphTextureWebcam.prototype.openStream = function() {\n\t\tif (!navigator.getUserMedia) {\n\t\t\t//console.log('getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags');\n\t\t\treturn;\n\t\t}\n\n\t\tthis._waiting_confirmation = true;\n\n\t\t// Not showing vendor prefixes.\n\t\tvar constraints = {\n\t\t\taudio: false,\n\t\t\tvideo: { facingMode: this.properties.facingMode }\n\t\t};\n\t\tnavigator.mediaDevices\n\t\t\t.getUserMedia(constraints)\n\t\t\t.then(this.streamReady.bind(this))\n\t\t\t.catch(onFailSoHard);\n\n\t\tvar that = this;\n\t\tfunction onFailSoHard(e) {\n\t\t\tLGraphTextureWebcam.is_webcam_open = false;\n\t\t\tconsole.log(\"Webcam rejected\", e);\n\t\t\tthat._webcam_stream = false;\n\t\t\tthat.boxcolor = \"red\";\n\t\t\tthat.trigger(\"stream_error\");\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.closeStream = function() {\n\t\tif (this._webcam_stream) {\n\t\t\tvar tracks = this._webcam_stream.getTracks();\n\t\t\tif (tracks.length) {\n\t\t\t\tfor (var i = 0; i < tracks.length; ++i) {\n\t\t\t\t\ttracks[i].stop();\n\t\t\t\t}\n\t\t\t}\n\t\t\tLGraphTextureWebcam.is_webcam_open = false;\n\t\t\tthis._webcam_stream = null;\n\t\t\tthis._video = null;\n\t\t\tthis.boxcolor = \"black\";\n\t\t\tthis.trigger(\"stream_closed\");\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.streamReady = function(localMediaStream) {\n\t\tthis._webcam_stream = localMediaStream;\n\t\t//this._waiting_confirmation = false;\n\t\tthis.boxcolor = \"green\";\n\t\tvar video = this._video;\n\t\tif (!video) {\n\t\t\tvideo = document.createElement(\"video\");\n\t\t\tvideo.autoplay = true;\n\t\t\tvideo.srcObject = localMediaStream;\n\t\t\tthis._video = video;\n\t\t\t//document.body.appendChild( video ); //debug\n\t\t\t//when video info is loaded (size and so)\n\t\t\tvideo.onloadedmetadata = function(e) {\n\t\t\t\t// Ready to go. Do some stuff.\n\t\t\t\tLGraphTextureWebcam.is_webcam_open = true;\n\t\t\t\tconsole.log(e);\n\t\t\t};\n\t\t}\n\t\tthis.trigger(\"stream_ready\", video);\n\t};\n\n\tLGraphTextureWebcam.prototype.onPropertyChanged = function(\n\t\tname,\n\t\tvalue\n\t) {\n\t\tif (name == \"facingMode\") {\n\t\t\tthis.properties.facingMode = value;\n\t\t\tthis.closeStream();\n\t\t\tthis.openStream();\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.onRemoved = function() {\n\t\tif (!this._webcam_stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tracks = this._webcam_stream.getTracks();\n\t\tif (tracks.length) {\n\t\t\tfor (var i = 0; i < tracks.length; ++i) {\n\t\t\t\ttracks[i].stop();\n\t\t\t}\n\t\t}\n\n\t\tthis._webcam_stream = null;\n\t\tthis._video = null;\n\t};\n\n\tLGraphTextureWebcam.prototype.onDrawBackground = function(ctx) {\n\t\tif (this.flags.collapsed || this.size[1] <= 20) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._video) {\n\t\t\treturn;\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tif (!ctx.webgl) {\n\t\t\t//reverse image\n\t\t\tctx.drawImage(this._video, 0, 0, this.size[0], this.size[1]);\n\t\t} else {\n\t\t\tif (this._video_texture) {\n\t\t\t\tctx.drawImage(\n\t\t\t\t\tthis._video_texture,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tthis.size[0],\n\t\t\t\t\tthis.size[1]\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tctx.restore();\n\t};\n\n\tLGraphTextureWebcam.prototype.onExecute = function() {\n\t\tif (this._webcam_stream == null && !this._waiting_confirmation) {\n\t\t\tthis.openStream();\n\t\t}\n\n\t\tif (!this._video || !this._video.videoWidth) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = this._video.videoWidth;\n\t\tvar height = this._video.videoHeight;\n\n\t\tvar temp = this._video_texture;\n\t\tif (!temp || temp.width != width || temp.height != height) {\n\t\t\tthis._video_texture = new GL.Texture(width, height, {\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tthis._video_texture.uploadImage(this._video);\n\t\tthis._video_texture.version = ++this.version;\n\n\t\tif (this.properties.texture_name) {\n\t\t\tvar container = LGraphTexture.getTexturesContainer();\n\t\t\tcontainer[this.properties.texture_name] = this._video_texture;\n\t\t}\n\n\t\tthis.setOutputData(0, this._video_texture);\n\t\tfor (var i = 1; i < this.outputs.length; ++i) {\n\t\t\tif (!this.outputs[i]) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tswitch (this.outputs[i].name) {\n\t\t\t\tcase \"width\":\n\t\t\t\t\tthis.setOutputData(i, this._video.videoWidth);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"height\":\n\t\t\t\t\tthis.setOutputData(i, this._video.videoHeight);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.onGetOutputs = function() {\n\t\treturn [\n\t\t\t[\"width\", \"number\"],\n\t\t\t[\"height\", \"number\"],\n\t\t\t[\"stream_ready\", LiteGraph.EVENT],\n\t\t\t[\"stream_closed\", LiteGraph.EVENT],\n\t\t\t[\"stream_error\", LiteGraph.EVENT]\n\t\t];\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/webcam\", LGraphTextureWebcam);\n\n\t//from https://github.com/spite/Wagner\n\tfunction LGraphLensFX() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"f\", \"number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tenabled: true,\n\t\t\tfactor: 1,\n\t\t\tprecision: LGraphTexture.LOW\n\t\t};\n\n\t\tthis._uniforms = { u_texture: 0, u_factor: 1 };\n\t}\n\n\tLGraphLensFX.title = \"Lens FX\";\n\tLGraphLensFX.desc = \"distortion and chromatic aberration\";\n\n\tLGraphLensFX.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphLensFX.prototype.onGetInputs = function() {\n\t\treturn [[\"enabled\", \"boolean\"]];\n\t};\n\n\tLGraphLensFX.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (\n\t\t\tthis.properties.precision === LGraphTexture.PASS_THROUGH ||\n\t\t\tthis.getInputOrProperty(\"enabled\") === false\n\t\t) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\tvar shader = LGraphLensFX._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphLensFX._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphLensFX.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar factor = this.getInputData(1);\n\t\tif (factor == null) {\n\t\t\tfactor = this.properties.factor;\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_factor = factor;\n\n\t\t//apply shader\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\ttemp.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLGraphLensFX.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tvec2 barrelDistortion(vec2 coord, float amt) {\\n\\\n\t\t\tvec2 cc = coord - 0.5;\\n\\\n\t\t\tfloat dist = dot(cc, cc);\\n\\\n\t\t\treturn coord + cc * dist * amt;\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat sat( float t )\\n\\\n\t\t{\\n\\\n\t\t\treturn clamp( t, 0.0, 1.0 );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat linterp( float t ) {\\n\\\n\t\t\treturn sat( 1.0 - abs( 2.0*t - 1.0 ) );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat remap( float t, float a, float b ) {\\n\\\n\t\t\treturn sat( (t - a) / (b - a) );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvec4 spectrum_offset( float t ) {\\n\\\n\t\t\tvec4 ret;\\n\\\n\t\t\tfloat lo = step(t,0.5);\\n\\\n\t\t\tfloat hi = 1.0-lo;\\n\\\n\t\t\tfloat w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );\\n\\\n\t\t\tret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);\\n\\\n\t\t\\n\\\n\t\t\treturn pow( ret, vec4(1.0/2.2) );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tconst float max_distort = 2.2;\\n\\\n\t\tconst int num_iter = 12;\\n\\\n\t\tconst float reci_num_iter_f = 1.0 / float(num_iter);\\n\\\n\t\t\\n\\\n\t\tvoid main()\\n\\\n\t\t{\t\\n\\\n\t\t\tvec2 uv=v_coord;\\n\\\n\t\t\tvec4 sumcol = vec4(0.0);\\n\\\n\t\t\tvec4 sumw = vec4(0.0);\t\\n\\\n\t\t\tfor ( int i=0; i<num_iter;++i )\\n\\\n\t\t\t{\\n\\\n\t\t\t\tfloat t = float(i) * reci_num_iter_f;\\n\\\n\t\t\t\tvec4 w = spectrum_offset( t );\\n\\\n\t\t\t\tsumw += w;\\n\\\n\t\t\t\tsumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );\\n\\\n\t\t\t}\\n\\\n\t\t\tgl_FragColor = sumcol / sumw;\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/lensfx\", LGraphLensFX);\n\n\n\tfunction LGraphTextureFromData() {\n\t\tthis.addInput(\"in\", \"\");\n\t\tthis.properties = { precision: LGraphTexture.LOW, width: 0, height: 0, channels: 1 };\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t}\n\n\tLGraphTextureFromData.title = \"Data->Tex\";\n\tLGraphTextureFromData.desc = \"Generates or applies a curve to a texture\";\n\tLGraphTextureFromData.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureFromData.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar data = this.getInputData(0);\n\t\tif(!data)\n\t\t\treturn;\n\n\t\tvar channels = this.properties.channels;\n\t\tvar w = this.properties.width;\n\t\tvar h = this.properties.height;\n\t\tif(!w || !h)\n\t\t{\n\t\t\tw = Math.floor(data.length / channels);\n\t\t\th = 1;\n\t\t}\n\t\tvar format = gl.RGBA;\n\t\tif( channels == 3 )\n\t\t\tformat = gl.RGB;\n\t\telse if( channels == 1 )\n\t\t\tformat = gl.LUMINANCE;\n\n\t\tvar temp = this._temp_texture;\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision );\n\t\tif ( !temp || temp.width != w || temp.height != h || temp.type != type ) {\n\t\t\ttemp = this._temp_texture = new GL.Texture( w, h, { type: type, format: format, filter: gl.LINEAR } );\n\t\t}\n\n\t\ttemp.uploadData( data );\n\t\tthis.setOutputData(0, temp);\n\t}\n\n\tLiteGraph.registerNodeType(\"texture/fromdata\", LGraphTextureFromData);\n\n\t//applies a curve (or generates one)\n\tfunction LGraphTextureCurve() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = { precision: LGraphTexture.LOW, split_channels: false };\n\t\tthis._values = new Uint8Array(256*4);\n\t\tthis._values.fill(255);\n\t\tthis._curve_texture = null;\n\t\tthis._uniforms = { u_texture: 0, u_curve: 1, u_range: 1.0 };\n\t\tthis._must_update = true;\n\t\tthis._points = {\n\t\t\tRGB: [[0,0],[1,1]],\n\t\t\tR: [[0,0],[1,1]],\n\t\t\tG: [[0,0],[1,1]],\n\t\t\tB: [[0,0],[1,1]]\n\t\t};\n\t\tthis.curve_editor = null;\n\t\tthis.addWidget(\"toggle\",\"Split Channels\",false,\"split_channels\");\n\t\tthis.addWidget(\"combo\",\"Channel\",\"RGB\",{ values:[\"RGB\",\"R\",\"G\",\"B\"]});\n\t\tthis.curve_offset = 68;\n\t\tthis.size = [ 240, 160 ];\n\t}\n\n\tLGraphTextureCurve.title = \"Curve\";\n\tLGraphTextureCurve.desc = \"Generates or applies a curve to a texture\";\n\tLGraphTextureCurve.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureCurve.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tvar temp = this._temp_texture;\n\t\tif(!tex) //generate one texture, nothing else\n\t\t{\n\t\t\tif(this._must_update || !this._curve_texture )\n\t\t\t\tthis.updateCurve();\n\t\t\tthis.setOutputData(0, this._curve_texture);\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, tex );\n\t\t\n\t\t//apply curve to input texture\n\t\tif ( !temp || temp.type != type || temp.width != tex.width || temp.height != tex.height || temp.format != tex.format)\n\t\t\ttemp = this._temp_texture = new GL.Texture( tex.width, tex.height, { type: type, format: tex.format, filter: gl.LINEAR } );\n\n\t\tvar shader = LGraphTextureCurve._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphTextureCurve._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureCurve.pixel_shader );\n\t\t}\n\n\t\tif(this._must_update || !this._curve_texture )\n\t\t\tthis.updateCurve();\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar curve_texture = this._curve_texture;\n\n\t\t//apply shader\n\t\ttemp.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\ttex.bind(0);\n\t\t\tcurve_texture.bind(1);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t}\n\n\tLGraphTextureCurve.prototype.sampleCurve = function(f,points)\n\t{\n\t\tvar points = points || this._points.RGB;\n\t\tif(!points)\n\t\t\treturn;\n\t\tfor(var i = 0; i < points.length - 1; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tvar pn = points[i+1];\n\t\t\tif(pn[0] < f)\n\t\t\t\tcontinue;\n\t\t\tvar r = (pn[0] - p[0]);\n\t\t\tif( Math.abs(r) < 0.00001 )\n\t\t\t\treturn p[1];\n\t\t\tvar local_f = (f - p[0]) / r;\n\t\t\treturn p[1] * (1.0 - local_f) + pn[1] * local_f;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tLGraphTextureCurve.prototype.updateCurve = function()\n\t{\n\t\tvar values = this._values;\n\t\tvar num = values.length / 4;\n\t\tvar split = this.properties.split_channels;\n\t\tfor(var i = 0; i < num; ++i)\n\t\t{\n\t\t\tif(split)\n\t\t\t{\n\t\t\t\tvalues[i*4] = clamp( this.sampleCurve(i/num,this._points.R)*255,0,255);\n\t\t\t\tvalues[i*4+1] = clamp( this.sampleCurve(i/num,this._points.G)*255,0,255);\n\t\t\t\tvalues[i*4+2] = clamp( this.sampleCurve(i/num,this._points.B)*255,0,255);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar v = this.sampleCurve(i/num);//sample curve\n\t\t\t\tvalues[i*4] = values[i*4+1] = values[i*4+2] = clamp(v*255,0,255);\n\t\t\t}\n\t\t\tvalues[i*4+3] = 255; //alpha fixed\n\t\t}\n\t\tif(!this._curve_texture)\n\t\t\tthis._curve_texture = new GL.Texture(256,1,{ format: gl.RGBA, magFilter: gl.LINEAR, wrap: gl.CLAMP_TO_EDGE });\n\t\tthis._curve_texture.uploadData(values,null,true);\n\t}\n\n\tLGraphTextureCurve.prototype.onSerialize = function(o)\n\t{\n\t\tvar curves = {};\n\t\tfor(var i in this._points)\n\t\t\tcurves[i] = this._points[i].concat();\n\t\to.curves = curves;\n\t}\n\n\tLGraphTextureCurve.prototype.onConfigure = function(o)\n\t{\n\t\tthis._points = o.curves;\n\t\tif(this.curve_editor)\n\t\t\tcurve_editor.points = this._points;\n\t\tthis._must_update = true;\n\t}\n\n\tLGraphTextureCurve.prototype.onMouseDown = function(e, localpos, graphcanvas)\n\t{\n\t\tif(this.curve_editor)\n\t\t{\n\t\t\tvar r = this.curve_editor.onMouseDown([localpos[0],localpos[1]-this.curve_offset], graphcanvas);\n\t\t\tif(r)\n\t\t\t\tthis.captureInput(true);\n\t\t\treturn r;\n\t\t}\n\t}\n\n\tLGraphTextureCurve.prototype.onMouseMove = function(e, localpos, graphcanvas)\n\t{\n\t\tif(this.curve_editor)\n\t\t\treturn this.curve_editor.onMouseMove([localpos[0],localpos[1]-this.curve_offset], graphcanvas);\n\t}\n\n\tLGraphTextureCurve.prototype.onMouseUp = function(e, localpos, graphcanvas)\n\t{\n\t\tif(this.curve_editor)\n\t\t\treturn this.curve_editor.onMouseUp([localpos[0],localpos[1]-this.curve_offset], graphcanvas);\n\t\tthis.captureInput(false);\n\t}\n\n\tLGraphTextureCurve.channel_line_colors = { \"RGB\":\"#666\",\"R\":\"#F33\",\"G\":\"#3F3\",\"B\":\"#33F\" };\n\n\tLGraphTextureCurve.prototype.onDrawBackground = function(ctx, graphcanvas)\n\t{\n\t\tif(this.flags.collapsed)\n\t\t\treturn;\n\n\t\tif(!this.curve_editor)\n\t\t\tthis.curve_editor = new LiteGraph.CurveEditor(this._points.R);\n\t\tctx.save();\n\t\tctx.translate(0,this.curve_offset);\n\t\tvar channel = this.widgets[1].value;\n\n\t\tif(this.properties.split_channels)\n\t\t{\n\t\t\tif(channel == \"RGB\")\n\t\t\t{\n\t\t\t\tthis.widgets[1].value = channel = \"R\";\n\t\t\t\tthis.widgets[1].disabled = false;\n\t\t\t}\n\t\t\tthis.curve_editor.points = this._points.R;\n\t\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, \"#111\", LGraphTextureCurve.channel_line_colors.R, true );\n\t\t\tctx.globalCompositeOperation = \"lighten\";\n\t\t\tthis.curve_editor.points = this._points.G;\n\t\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, null, LGraphTextureCurve.channel_line_colors.G, true );\n\t\t\tthis.curve_editor.points = this._points.B;\n\t\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, null, LGraphTextureCurve.channel_line_colors.B, true );\n\t\t\tctx.globalCompositeOperation = \"source-over\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.widgets[1].value = channel = \"RGB\";\n\t\t\tthis.widgets[1].disabled = true;\n\t\t}\n\n\t\tthis.curve_editor.points = this._points[channel];\n\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, this.properties.split_channels ? null : \"#111\", LGraphTextureCurve.channel_line_colors[channel]  );\n\t\tctx.restore();\n\t}\n\n\tLGraphTextureCurve.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_curve;\\n\\\n\t\tuniform float u_range;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord ) * u_range;\\n\\\n\t\t\tcolor.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;\\n\\\n\t\t\tcolor.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;\\n\\\n\t\t\tcolor.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;\\n\\\n\t\t\t//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;\\n\\\n\t\t\tgl_FragColor = color;\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/curve\", LGraphTextureCurve);\n\n\t//simple exposition, but plan to expand it to support different gamma curves\n\tfunction LGraphExposition() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"exp\", \"number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = { exposition: 1, precision: LGraphTexture.LOW };\n\t\tthis._uniforms = { u_texture: 0, u_exposition: 1 };\n\t}\n\n\tLGraphExposition.title = \"Exposition\";\n\tLGraphExposition.desc = \"Controls texture exposition\";\n\n\tLGraphExposition.widgets_info = {\n\t\texposition: { widget: \"slider\", min: 0, max: 3 },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphExposition.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\tvar shader = LGraphExposition._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphExposition._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphExposition.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar exp = this.properties.exposition;\n\t\tvar exp_input = this.getInputData(1);\n\t\tif (exp_input != null) {\n\t\t\texp = this.properties.exposition = exp_input;\n\t\t}\n\t\tvar uniforms = this._uniforms;\n\n\t\t//apply shader\n\t\ttemp.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLGraphExposition.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_exposition;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord );\\n\\\n\t\t\tgl_FragColor = vec4( color.xyz * u_exposition, color.a );\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/exposition\", LGraphExposition);\n\n\tfunction LGraphToneMapping() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"avg\", \"number,Texture\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tenabled: true,\n\t\t\tscale: 1,\n\t\t\tgamma: 1,\n\t\t\taverage_lum: 1,\n\t\t\tlum_white: 1,\n\t\t\tprecision: LGraphTexture.LOW\n\t\t};\n\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_lumwhite2: 1,\n\t\t\tu_igamma: 1,\n\t\t\tu_scale: 1,\n\t\t\tu_average_lum: 1\n\t\t};\n\t}\n\n\tLGraphToneMapping.title = \"Tone Mapping\";\n\tLGraphToneMapping.desc =\n\t\t\"Applies Tone Mapping to convert from high to low\";\n\n\tLGraphToneMapping.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphToneMapping.prototype.onGetInputs = function() {\n\t\treturn [[\"enabled\", \"boolean\"]];\n\t};\n\n\tLGraphToneMapping.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (\n\t\t\tthis.properties.precision === LGraphTexture.PASS_THROUGH ||\n\t\t\tthis.getInputOrProperty(\"enabled\") === false\n\t\t) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\tvar avg = this.getInputData(1);\n\t\tif (avg == null) {\n\t\t\tavg = this.properties.average_lum;\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar shader = null;\n\n\t\tif (avg.constructor === Number) {\n\t\t\tthis.properties.average_lum = avg;\n\t\t\tuniforms.u_average_lum = this.properties.average_lum;\n\t\t\tshader = LGraphToneMapping._shader;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphToneMapping._shader = new GL.Shader(\n\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphToneMapping.pixel_shader\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (avg.constructor === GL.Texture) {\n\t\t\tuniforms.u_average_texture = avg.bind(1);\n\t\t\tshader = LGraphToneMapping._shader_texture;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphToneMapping._shader_texture = new GL.Shader(\n\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphToneMapping.pixel_shader,\n\t\t\t\t\t{ AVG_TEXTURE: \"\" }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tuniforms.u_lumwhite2 =\n\t\t\tthis.properties.lum_white * this.properties.lum_white;\n\t\tuniforms.u_scale = this.properties.scale;\n\t\tuniforms.u_igamma = 1 / this.properties.gamma;\n\n\t\t//apply shader\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\ttemp.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLGraphToneMapping.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_scale;\\n\\\n\t\t#ifdef AVG_TEXTURE\\n\\\n\t\t\tuniform sampler2D u_average_texture;\\n\\\n\t\t#else\\n\\\n\t\t\tuniform float u_average_lum;\\n\\\n\t\t#endif\\n\\\n\t\tuniform float u_lumwhite2;\\n\\\n\t\tuniform float u_igamma;\\n\\\n\t\tvec3 RGB2xyY (vec3 rgb)\\n\\\n\t\t{\\n\\\n\t\t\t const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,\\n\\\n\t\t\t\t\t\t\t\t\t   0.2126, 0.7152, 0.0722,\\n\\\n\t\t\t\t\t\t\t\t\t   0.0193, 0.1192, 0.9505);\\n\\\n\t\t\tvec3 XYZ = RGB2XYZ * rgb;\\n\\\n\t\t\t\\n\\\n\t\t\tfloat f = (XYZ.x + XYZ.y + XYZ.z);\\n\\\n\t\t\treturn vec3(XYZ.x / f,\\n\\\n\t\t\t\t\t\tXYZ.y / f,\\n\\\n\t\t\t\t\t\tXYZ.y);\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord );\\n\\\n\t\t\tvec3 rgb = color.xyz;\\n\\\n\t\t\tfloat average_lum = 0.0;\\n\\\n\t\t\t#ifdef AVG_TEXTURE\\n\\\n\t\t\t\tvec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;\\n\\\n\t\t\t\taverage_lum = (pixel.x + pixel.y + pixel.z) / 3.0;\\n\\\n\t\t\t#else\\n\\\n\t\t\t\taverage_lum = u_average_lum;\\n\\\n\t\t\t#endif\\n\\\n\t\t\t//Ld - this part of the code is the same for both versions\\n\\\n\t\t\tfloat lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));\\n\\\n\t\t\tfloat L = (u_scale / average_lum) * lum;\\n\\\n\t\t\tfloat Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);\\n\\\n\t\t\t//first\\n\\\n\t\t\t//vec3 xyY = RGB2xyY(rgb);\\n\\\n\t\t\t//xyY.z *= Ld;\\n\\\n\t\t\t//rgb = xyYtoRGB(xyY);\\n\\\n\t\t\t//second\\n\\\n\t\t\trgb = (rgb / lum) * Ld;\\n\\\n\t\t\trgb = max(rgb,vec3(0.001));\\n\\\n\t\t\trgb = pow( rgb, vec3( u_igamma ) );\\n\\\n\t\t\tgl_FragColor = vec4( rgb, color.a );\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/tonemapping\", LGraphToneMapping);\n\n\tfunction LGraphTexturePerlin() {\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\twidth: 512,\n\t\t\theight: 512,\n\t\t\tseed: 0,\n\t\t\tpersistence: 0.1,\n\t\t\toctaves: 8,\n\t\t\tscale: 1,\n\t\t\toffset: [0, 0],\n\t\t\tamplitude: 1,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t\tthis._key = 0;\n\t\tthis._texture = null;\n\t\tthis._uniforms = {\n\t\t\tu_persistence: 0.1,\n\t\t\tu_seed: 0,\n\t\t\tu_offset: vec2.create(),\n\t\t\tu_scale: 1,\n\t\t\tu_viewport: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTexturePerlin.title = \"Perlin\";\n\tLGraphTexturePerlin.desc = \"Generates a perlin noise texture\";\n\n\tLGraphTexturePerlin.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES },\n\t\twidth: { type: \"number\", precision: 0, step: 1 },\n\t\theight: { type: \"number\", precision: 0, step: 1 },\n\t\toctaves: { type: \"number\", precision: 0, step: 1, min: 1, max: 50 }\n\t};\n\n\tLGraphTexturePerlin.prototype.onGetInputs = function() {\n\t\treturn [\n\t\t\t[\"seed\", \"number\"],\n\t\t\t[\"persistence\", \"number\"],\n\t\t\t[\"octaves\", \"number\"],\n\t\t\t[\"scale\", \"number\"],\n\t\t\t[\"amplitude\", \"number\"],\n\t\t\t[\"offset\", \"vec2\"]\n\t\t];\n\t};\n\n\tLGraphTexturePerlin.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar w = this.properties.width | 0;\n\t\tvar h = this.properties.height | 0;\n\t\tif (w == 0) {\n\t\t\tw = gl.viewport_data[2];\n\t\t} //0 means default\n\t\tif (h == 0) {\n\t\t\th = gl.viewport_data[3];\n\t\t} //0 means default\n\t\tvar type = LGraphTexture.getTextureType(this.properties.precision);\n\n\t\tvar temp = this._texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != w ||\n\t\t\ttemp.height != h ||\n\t\t\ttemp.type != type\n\t\t) {\n\t\t\ttemp = this._texture = new GL.Texture(w, h, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar persistence = this.getInputOrProperty(\"persistence\");\n\t\tvar octaves = this.getInputOrProperty(\"octaves\");\n\t\tvar offset = this.getInputOrProperty(\"offset\");\n\t\tvar scale = this.getInputOrProperty(\"scale\");\n\t\tvar amplitude = this.getInputOrProperty(\"amplitude\");\n\t\tvar seed = this.getInputOrProperty(\"seed\");\n\n\t\t//reusing old texture\n\t\tvar key =\n\t\t\t\"\" +\n\t\t\tw +\n\t\t\th +\n\t\t\ttype +\n\t\t\tpersistence +\n\t\t\toctaves +\n\t\t\tscale +\n\t\t\tseed +\n\t\t\toffset[0] +\n\t\t\toffset[1] +\n\t\t\tamplitude;\n\t\tif (key == this._key) {\n\t\t\tthis.setOutputData(0, temp);\n\t\t\treturn;\n\t\t}\n\t\tthis._key = key;\n\n\t\t//gather uniforms\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_persistence = persistence;\n\t\tuniforms.u_octaves = octaves;\n\t\tuniforms.u_offset.set(offset);\n\t\tuniforms.u_scale = scale;\n\t\tuniforms.u_amplitude = amplitude;\n\t\tuniforms.u_seed = seed * 128;\n\t\tuniforms.u_viewport[0] = w;\n\t\tuniforms.u_viewport[1] = h;\n\n\t\t//render\n\t\tvar shader = LGraphTexturePerlin._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphTexturePerlin._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTexturePerlin.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\ttemp.drawTo(function() {\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLGraphTexturePerlin.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\tuniform float u_scale;\\n\\\n\t\tuniform float u_persistence;\\n\\\n\t\tuniform int u_octaves;\\n\\\n\t\tuniform float u_amplitude;\\n\\\n\t\tuniform vec2 u_viewport;\\n\\\n\t\tuniform float u_seed;\\n\\\n\t\t#define M_PI 3.14159265358979323846\\n\\\n\t\t\\n\\\n\t\tfloat rand(vec2 c){\treturn fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }\\n\\\n\t\t\\n\\\n\t\tfloat noise(vec2 p, float freq ){\\n\\\n\t\t\tfloat unit = u_viewport.x/freq;\\n\\\n\t\t\tvec2 ij = floor(p/unit);\\n\\\n\t\t\tvec2 xy = mod(p,unit)/unit;\\n\\\n\t\t\t//xy = 3.*xy*xy-2.*xy*xy*xy;\\n\\\n\t\t\txy = .5*(1.-cos(M_PI*xy));\\n\\\n\t\t\tfloat a = rand((ij+vec2(0.,0.)));\\n\\\n\t\t\tfloat b = rand((ij+vec2(1.,0.)));\\n\\\n\t\t\tfloat c = rand((ij+vec2(0.,1.)));\\n\\\n\t\t\tfloat d = rand((ij+vec2(1.,1.)));\\n\\\n\t\t\tfloat x1 = mix(a, b, xy.x);\\n\\\n\t\t\tfloat x2 = mix(c, d, xy.x);\\n\\\n\t\t\treturn mix(x1, x2, xy.y);\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat pNoise(vec2 p, int res){\\n\\\n\t\t\tfloat persistance = u_persistence;\\n\\\n\t\t\tfloat n = 0.;\\n\\\n\t\t\tfloat normK = 0.;\\n\\\n\t\t\tfloat f = 4.;\\n\\\n\t\t\tfloat amp = 1.0;\\n\\\n\t\t\tint iCount = 0;\\n\\\n\t\t\tfor (int i = 0; i<50; i++){\\n\\\n\t\t\t\tn+=amp*noise(p, f);\\n\\\n\t\t\t\tf*=2.;\\n\\\n\t\t\t\tnormK+=amp;\\n\\\n\t\t\t\tamp*=persistance;\\n\\\n\t\t\t\tif (iCount >= res)\\n\\\n\t\t\t\t\tbreak;\\n\\\n\t\t\t\tiCount++;\\n\\\n\t\t\t}\\n\\\n\t\t\tfloat nf = n/normK;\\n\\\n\t\t\treturn nf*nf*nf*nf;\\n\\\n\t\t}\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;\\n\\\n\t\t\tvec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );\\n\\\n\t\t\tgl_FragColor = color;\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/perlin\", LGraphTexturePerlin);\n\n\tfunction LGraphTextureCanvas2D() {\n\t\tthis.addInput(\"v\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tcode: LGraphTextureCanvas2D.default_code,\n\t\t\twidth: 512,\n\t\t\theight: 512,\n\t\t\tclear: true,\n\t\t\tprecision: LGraphTexture.DEFAULT,\n\t\t\tuse_html_canvas: false\n\t\t};\n\t\tthis._func = null;\n\t\tthis._temp_texture = null;\n\t\tthis.compileCode();\n\t}\n\n\tLGraphTextureCanvas2D.title = \"Canvas2D\";\n\tLGraphTextureCanvas2D.desc = \"Executes Canvas2D code inside a texture or the viewport.\";\n\tLGraphTextureCanvas2D.help = \"Set width and height to 0 to match viewport size.\";\n\n\tLGraphTextureCanvas2D.default_code = \"//vars: canvas,ctx,time\\nctx.fillStyle='red';\\nctx.fillRect(0,0,50,50);\\n\";\n\n\tLGraphTextureCanvas2D.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES },\n\t\tcode: { type: \"code\" },\n\t\twidth: { type: \"number\", precision: 0, step: 1 },\n\t\theight: { type: \"number\", precision: 0, step: 1 }\n\t};\n\n\tLGraphTextureCanvas2D.prototype.onPropertyChanged = function( name, value ) {\n\t\tif (name == \"code\" )\n\t\t\tthis.compileCode( value );\n\t}\n\t\n\tLGraphTextureCanvas2D.prototype.compileCode = function( code ) {\n\t\tthis._func = null;\n\t\tif( !LiteGraph.allow_scripts )\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tthis._func = new Function( \"canvas\", \"ctx\", \"time\", \"script\",\"v\", code );\n\t\t\tthis.boxcolor = \"#00FF00\";\n\t\t} catch (err) {\n\t\t\tthis.boxcolor = \"#FF0000\";\n\t\t\tconsole.error(\"Error parsing script\");\n\t\t\tconsole.error(err);\n\t\t}\n\t};\n\n\tLGraphTextureCanvas2D.prototype.onExecute = function() {\n\t\tvar func = this._func;\n\t\tif (!func || !this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.executeDraw( func );\n\t}\n\n\tLGraphTextureCanvas2D.prototype.executeDraw = function( func_context ) {\n\n\t\tvar width = this.properties.width || gl.canvas.width;\n\t\tvar height = this.properties.height || gl.canvas.height;\n\t\tvar temp = this._temp_texture;\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision );\n\t\tif (!temp || temp.width != width || temp.height != height || temp.type != type ) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(width, height, {\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR,\n\t\t\t\ttype: type\n\t\t\t});\n\t\t}\n\n\t\tvar v = this.getInputData(0);\n\n\t\tvar properties = this.properties;\n\t\tvar that = this;\n\t\tvar time = this.graph.getTime();\n\t\tvar ctx = gl;\n\t\tvar canvas = gl.canvas;\n\t\tif( this.properties.use_html_canvas || !global.enableWebGLCanvas )\n\t\t{\n\t\t\tif(!this._canvas)\n\t\t\t{\n\t\t\t\tcanvas = this._canvas = createCanvas(width.height);\n\t\t\t\tctx = this._ctx = canvas.getContext(\"2d\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcanvas = this._canvas;\n\t\t\t\tctx = this._ctx;\n\t\t\t}\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\t\t}\n\n\t\tif(ctx == gl) //using Canvas2DtoWebGL\n\t\t\ttemp.drawTo(function() {\n\t\t\t\tgl.start2D();\n\t\t\t\tif(properties.clear)\n\t\t\t\t{\n\t\t\t\t\tgl.clearColor(0,0,0,0);\n\t\t\t\t\tgl.clear( gl.COLOR_BUFFER_BIT );\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tif (func_context.draw) {\n\t\t\t\t\t\tfunc_context.draw.call(that, canvas, ctx, time, func_context, v);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfunc_context.call(that, canvas, ctx, time, func_context,v);\n\t\t\t\t\t}\n\t\t\t\t\tthat.boxcolor = \"#00FF00\";\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthat.boxcolor = \"#FF0000\";\n\t\t\t\t\tconsole.error(\"Error executing script\");\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t}\n\t\t\t\tgl.finish2D();\n\t\t\t});\n\t\telse //rendering to offscreen canvas and uploading to texture\n\t\t{\n\t\t\tif(properties.clear)\n\t\t\t\tctx.clearRect(0,0,canvas.width,canvas.height);\n\n\t\t\ttry {\n\t\t\t\tif (func_context.draw) {\n\t\t\t\t\tfunc_context.draw.call(this, canvas, ctx, time, func_context, v);\n\t\t\t\t} else {\n\t\t\t\t\tfunc_context.call(this, canvas, ctx, time, func_context,v);\n\t\t\t\t}\n\t\t\t\tthis.boxcolor = \"#00FF00\";\n\t\t\t} catch (err) {\n\t\t\t\tthis.boxcolor = \"#FF0000\";\n\t\t\t\tconsole.error(\"Error executing script\");\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t\ttemp.uploadImage( canvas );\n\t\t}\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/canvas2D\", LGraphTextureCanvas2D);\n\n\t// To do chroma keying *****************\n\n\tfunction LGraphTextureMatte() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tkey_color: vec3.fromValues(0, 1, 0),\n\t\t\tthreshold: 0.8,\n\t\t\tslope: 0.2,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureMatte.title = \"Matte\";\n\tLGraphTextureMatte.desc = \"Extracts background\";\n\n\tLGraphTextureMatte.widgets_info = {\n\t\tkey_color: { widget: \"color\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureMatte.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\ttex,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tif (!this._uniforms) {\n\t\t\tthis._uniforms = {\n\t\t\t\tu_texture: 0,\n\t\t\t\tu_key_color: this.properties.key_color,\n\t\t\t\tu_threshold: 1,\n\t\t\t\tu_slope: 1\n\t\t\t};\n\t\t}\n\t\tvar uniforms = this._uniforms;\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureMatte._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphTextureMatte._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureMatte.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tuniforms.u_key_color = this.properties.key_color;\n\t\tuniforms.u_threshold = this.properties.threshold;\n\t\tuniforms.u_slope = this.properties.slope;\n\n\t\tthis._tex.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureMatte.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec3 u_key_color;\\n\\\n\t\tuniform float u_threshold;\\n\\\n\t\tuniform float u_slope;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec3 color = texture2D( u_texture, v_coord ).xyz;\\n\\\n\t\t\tfloat diff = length( normalize(color) - normalize(u_key_color) );\\n\\\n\t\t\tfloat edge = u_threshold * (1.0 - u_slope);\\n\\\n\t\t\tfloat alpha = smoothstep( edge, u_threshold, diff);\\n\\\n\t\t\tgl_FragColor = vec4( color, alpha );\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/matte\", LGraphTextureMatte);\n\n\t//***********************************\n\tfunction LGraphCubemapToTexture2D() {\n\t\tthis.addInput(\"in\", \"texture\");\n\t\tthis.addInput(\"yaw\", \"number\");\n\t\tthis.addOutput(\"out\", \"texture\");\n\t\tthis.properties = { yaw: 0 };\n\t}\n\n\tLGraphCubemapToTexture2D.title = \"CubemapToTexture2D\";\n\tLGraphCubemapToTexture2D.desc = \"Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation\";\n\n\tLGraphCubemapToTexture2D.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0))\n\t\t\treturn;\n\n\t\tvar tex = this.getInputData(0);\n\t\tif ( !tex || tex.texture_type != GL.TEXTURE_CUBE_MAP )\n\t\t\treturn;\n\t\tif( this._last_tex && ( this._last_tex.height != tex.height || this._last_tex.type != tex.type ))\n\t\t\tthis._last_tex = null;\n\t\tvar yaw = this.getInputOrProperty(\"yaw\");\n\t\tthis._last_tex = GL.Texture.cubemapToTexture2D( tex, tex.height, this._last_tex, true, yaw );\n\t\tthis.setOutputData( 0, this._last_tex );\n\t};\n\n\tLiteGraph.registerNodeType( \"texture/cubemapToTexture2D\", LGraphCubemapToTexture2D );\n})(this);\n\n(function(global) {\r\n\r\n    if (typeof GL == \"undefined\")\r\n\t\treturn;\r\n\r\n    var LiteGraph = global.LiteGraph;\r\n\tvar LGraphCanvas = global.LGraphCanvas;\r\n\r\n\tvar SHADERNODES_COLOR = \"#345\";\r\n\r\n\tvar LGShaders = LiteGraph.Shaders = {};\r\n\r\n\tvar GLSL_types = LGShaders.GLSL_types = [\"float\",\"vec2\",\"vec3\",\"vec4\",\"mat3\",\"mat4\",\"sampler2D\",\"samplerCube\"];\r\n\tvar GLSL_types_const = LGShaders.GLSL_types_const = [\"float\",\"vec2\",\"vec3\",\"vec4\"];\r\n\r\n\tvar GLSL_functions_desc = {\r\n\t\t\"radians\": \"T radians(T degrees)\",\r\n\t\t\"degrees\": \"T degrees(T radians)\",\r\n\t\t\"sin\": \"T sin(T angle)\",\r\n\t\t\"cos\": \"T cos(T angle)\",\r\n\t\t\"tan\": \"T tan(T angle)\",\r\n\t\t\"asin\": \"T asin(T x)\",\r\n\t\t\"acos\": \"T acos(T x)\",\r\n\t\t\"atan\": \"T atan(T x)\",\r\n\t\t\"atan2\": \"T atan(T x,T y)\",\r\n\t\t\"pow\": \"T pow(T x,T y)\",\r\n\t\t\"exp\": \"T exp(T x)\",\r\n\t\t\"log\": \"T log(T x)\",\r\n\t\t\"exp2\": \"T exp2(T x)\",\r\n\t\t\"log2\": \"T log2(T x)\",\r\n\t\t\"sqrt\": \"T sqrt(T x)\",\r\n\t\t\"inversesqrt\": \"T inversesqrt(T x)\",\r\n\t\t\"abs\": \"T abs(T x)\",\r\n\t\t\"sign\": \"T sign(T x)\",\r\n\t\t\"floor\": \"T floor(T x)\",\r\n\t\t\"round\": \"T round(T x)\",\r\n\t\t\"ceil\": \"T ceil(T x)\",\r\n\t\t\"fract\": \"T fract(T x)\",\r\n\t\t\"mod\": \"T mod(T x,T y)\", //\"T mod(T x,float y)\"\r\n\t\t\"min\": \"T min(T x,T y)\",\r\n\t\t\"max\": \"T max(T x,T y)\",\r\n\t\t\"clamp\": \"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)\",\r\n\t\t\"mix\": \"T mix(T x,T y,T a)\", //\"T mix(T x,T y,float a)\"\r\n\t\t\"step\": \"T step(T edge, T edge2, T x)\", //\"T step(float edge, T x)\"\r\n\t\t\"smoothstep\": \"T smoothstep(T edge, T edge2, T x)\", //\"T smoothstep(float edge, T x)\"\r\n\t\t\"length\":\"float length(T x)\",\r\n\t\t\"distance\":\"float distance(T p0, T p1)\",\r\n\t\t\"normalize\":\"T normalize(T x)\",\r\n\t\t\"dot\": \"float dot(T x,T y)\",\r\n\t\t\"cross\": \"vec3 cross(vec3 x,vec3 y)\",\r\n\t\t\"reflect\": \"vec3 reflect(vec3 V,vec3 N)\",\r\n\t\t\"refract\": \"vec3 refract(vec3 V,vec3 N, float IOR)\"\r\n\t};\r\n\r\n\t//parse them\r\n\tvar GLSL_functions = {};\r\n\tvar GLSL_functions_name = [];\r\n\tparseGLSLDescriptions();\r\n\r\n\tLGShaders.ALL_TYPES = \"float,vec2,vec3,vec4\";\r\n\r\n\tfunction parseGLSLDescriptions()\r\n\t{\r\n\t\tGLSL_functions_name.length = 0;\r\n\r\n\t\tfor(var i in GLSL_functions_desc)\r\n\t\t{\r\n\t\t\tvar op = GLSL_functions_desc[i];\r\n\t\t\tvar index = op.indexOf(\" \");\r\n\t\t\tvar return_type = op.substr(0,index);\r\n\t\t\tvar index2 = op.indexOf(\"(\",index);\r\n\t\t\tvar func_name = op.substr(index,index2-index).trim();\r\n\t\t\tvar params = op.substr(index2 + 1, op.length - index2 - 2).split(\",\");\r\n\t\t\tfor(var j in params)\r\n\t\t\t{\r\n\t\t\t\tvar p = params[j].split(\" \").filter(function(a){ return a; });\r\n\t\t\t\tparams[j] = { type: p[0].trim(), name: p[1].trim() };\r\n\t\t\t\tif(p[2] == \"=\")\r\n\t\t\t\t\tparams[j].value = p[3].trim();\r\n\t\t\t}\r\n\t\t\tGLSL_functions[i] = { return_type: return_type, func: func_name, params: params };\r\n\t\t\tGLSL_functions_name.push( func_name );\r\n\t\t\t//console.log( GLSL_functions[i] );\r\n\t\t}\r\n\t}\r\n\r\n\t//common actions to all shader node classes\r\n\tfunction registerShaderNode( type, node_ctor )\r\n\t{\r\n\t\t//static attributes\r\n\t\tnode_ctor.color = SHADERNODES_COLOR;\r\n\t\tnode_ctor.filter = \"shader\";\r\n\r\n\t\t//common methods\r\n\t\tnode_ctor.prototype.clearDestination = function(){ this.shader_destination = {};  }\r\n\t\tnode_ctor.prototype.propagateDestination = function propagateDestination( dest_name )\r\n\t\t{\r\n\t\t\tthis.shader_destination[ dest_name ] = true;\r\n\t\t\tif(this.inputs)\r\n\t\t\tfor(var i = 0; i < this.inputs.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar origin_node = this.getInputNode(i);\r\n\t\t\t\tif(origin_node)\r\n\t\t\t\t\torigin_node.propagateDestination( dest_name );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!node_ctor.prototype.onPropertyChanged)\r\n\t\t\tnode_ctor.prototype.onPropertyChanged = function()\r\n\t\t\t{\r\n\t\t\t\tif(this.graph)\r\n\t\t\t\t\t this.graph._version++;\r\n\t\t\t}\r\n\r\n\t\t/*\r\n\t\tif(!node_ctor.prototype.onGetCode)\r\n\t\t\tnode_ctor.prototype.onGetCode = function()\r\n\t\t\t{\r\n\t\t\t\t//check destination to avoid lonely nodes\r\n\t\t\t\tif(!this.shader_destination)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t//grab inputs with types\r\n\t\t\t\tvar inputs = [];\r\n\t\t\t\tif(this.inputs)\r\n\t\t\t\tfor(var i = 0; i < this.inputs.length; ++i)\r\n\t\t\t\t\tinputs.push({ type: this.getInputData(i), name: getInputLinkID(this,i) });\r\n\t\t\t\tvar outputs = [];\r\n\t\t\t\tif(this.outputs)\r\n\t\t\t\tfor(var i = 0; i < this.outputs.length; ++i)\r\n\t\t\t\t\toutputs.push({ name: getOutputLinkID(this,i) });\r\n\t\t\t\t//pass to code func\r\n\t\t\t\tvar results = this.extractCode(inputs);\r\n\t\t\t\t//grab output, pass to next\r\n\t\t\t\tif(results)\r\n\t\t\t\tfor(var i = 0; i < results.length; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar r = results[i];\r\n\t\t\t\t\tif(!r)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tthis.setOutputData(i,r.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t*/\r\n\r\n\t\tLiteGraph.registerNodeType( \"shader::\" + type, node_ctor );\r\n\t}\r\n\r\n\tfunction getShaderNodeVarName( node, name )\r\n\t{\r\n\t\treturn \"VAR_\" + (name || \"TEMP\") + \"_\" + node.id;\r\n\t}\r\n\r\n\tfunction getInputLinkID( node, slot )\r\n\t{\r\n\t\tif(!node.inputs)\r\n\t\t\treturn null;\r\n\t\tvar link = node.getInputLink( slot );\r\n\t\tif( !link )\r\n\t\t\treturn null;\r\n\t\tvar origin_node = node.graph.getNodeById( link.origin_id );\r\n\t\tif( !origin_node )\r\n\t\t\treturn null;\r\n\t\tif(origin_node.getOutputVarName)\r\n\t\t\treturn origin_node.getOutputVarName(link.origin_slot);\r\n\t\t//generate\r\n\t\treturn \"link_\" + origin_node.id + \"_\" + link.origin_slot;\r\n\t}\r\n\r\n\tfunction getOutputLinkID( node, slot )\r\n\t{\r\n\t\tif (!node.isOutputConnected(slot))\r\n\t\t\treturn null;\r\n\t\treturn \"link_\" + node.id + \"_\" + slot;\r\n\t}\r\n\r\n\tLGShaders.registerShaderNode = registerShaderNode;\r\n\tLGShaders.getInputLinkID = getInputLinkID;\r\n\tLGShaders.getOutputLinkID = getOutputLinkID;\r\n\tLGShaders.getShaderNodeVarName = getShaderNodeVarName;\r\n\tLGShaders.parseGLSLDescriptions = parseGLSLDescriptions;\r\n\r\n\t//given a const number, it transform it to a string that matches a type\r\n\tvar valueToGLSL = LiteGraph.valueToGLSL = function valueToGLSL( v, type, precision )\r\n\t{\r\n\t\tvar n = 5; //num decimals\r\n\t\tif(precision != null)\r\n\t\t\tn = precision;\r\n\t\tif(!type)\r\n\t\t{\r\n\t\t\tif(v.constructor === Number)\r\n\t\t\t\ttype = \"float\";\r\n\t\t\telse if(v.length)\r\n\t\t\t{\r\n\t\t\t\tswitch(v.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 2: type = \"vec2\"; break;\r\n\t\t\t\t\tcase 3: type = \"vec3\"; break;\r\n\t\t\t\t\tcase 4: type = \"vec4\"; break;\r\n\t\t\t\t\tcase 9: type = \"mat3\"; break;\r\n\t\t\t\t\tcase 16: type = \"mat4\"; break;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow(\"unknown type for glsl value size\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthrow(\"unknown type for glsl value: \" + v.constructor);\r\n\t\t}\r\n\t\tswitch(type)\r\n\t\t{\r\n\t\t\tcase 'float': return v.toFixed(n); break;\r\n\t\t\tcase 'vec2': return \"vec2(\" + v[0].toFixed(n) + \",\" + v[1].toFixed(n) + \")\"; break;\r\n\t\t\tcase 'color3':\r\n\t\t\tcase 'vec3': return \"vec3(\" + v[0].toFixed(n) + \",\" + v[1].toFixed(n) + \",\" + v[2].toFixed(n) + \")\"; break;\r\n\t\t\tcase 'color4':\r\n\t\t\tcase 'vec4': return \"vec4(\" + v[0].toFixed(n) + \",\" + v[1].toFixed(n) + \",\" + v[2].toFixed(n) + \",\" + v[3].toFixed(n) + \")\"; break;\r\n\t\t\tcase 'mat3': return \"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)\"; break; //not fully supported yet\r\n\t\t\tcase 'mat4': return \"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)\"; break;//not fully supported yet\r\n\t\t\tdefault:\r\n\t\t\t\tthrow(\"unknown glsl type in valueToGLSL:\", type);\r\n\t\t}\r\n\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t//makes sure that a var is of a type, and if not, it converts it\r\n\tvar varToTypeGLSL = LiteGraph.varToTypeGLSL = function varToTypeGLSL( v, input_type, output_type )\r\n\t{\r\n\t\tif(input_type == output_type)\r\n\t\t\treturn v;\r\n\t\tif(v == null)\r\n\t\t\tswitch(output_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\": return \"0.0\";\r\n\t\t\t\tcase \"vec2\":  return \"vec2(0.0)\";\r\n\t\t\t\tcase \"vec3\":  return \"vec3(0.0)\";\r\n\t\t\t\tcase \"vec4\":  return \"vec4(0.0,0.0,0.0,1.0)\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\tif(!output_type)\r\n\t\t\tthrow(\"error: no output type specified\");\r\n\t\tif(output_type == \"float\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\t//case \"float\":\r\n\t\t\t\tcase \"vec2\":\r\n\t\t\t\tcase \"vec3\":\r\n\t\t\t\tcase \"vec4\":\r\n\t\t\t\t\treturn v + \".x\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"0.0\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(output_type == \"vec2\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\":\r\n\t\t\t\t\treturn \"vec2(\"+v+\")\";\r\n\t\t\t\t//case \"vec2\":\r\n\t\t\t\tcase \"vec3\":\r\n\t\t\t\tcase \"vec4\":\r\n\t\t\t\t\treturn v + \".xy\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"vec2(0.0)\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(output_type == \"vec3\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\":\r\n\t\t\t\t\treturn \"vec3(\"+v+\")\";\r\n\t\t\t\tcase \"vec2\":\r\n\t\t\t\t\treturn \"vec3(\" + v + \",0.0)\";\r\n\t\t\t\t//case \"vec3\":\r\n\t\t\t\tcase \"vec4\":\r\n\t\t\t\t\treturn v + \".xyz\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"vec3(0.0)\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(output_type == \"vec4\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\":\r\n\t\t\t\t\treturn \"vec4(\"+v+\")\";\r\n\t\t\t\tcase \"vec2\":\r\n\t\t\t\t\treturn \"vec4(\" + v + \",0.0,1.0)\";\r\n\t\t\t\tcase \"vec3\":\r\n\t\t\t\t\treturn \"vec4(\" + v + \",1.0)\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"vec4(0.0,0.0,0.0,1.0)\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow(\"type cannot be converted\");\r\n\t}\r\n\r\n\r\n\t//used to plug incompatible stuff\r\n\tvar convertVarToGLSLType = LiteGraph.convertVarToGLSLType = function convertVarToGLSLType( varname, type, target_type )\r\n\t{\r\n\t\tif(type == target_type)\r\n\t\t\treturn varname;\r\n\t\tif(type == \"float\")\r\n\t\t\treturn target_type + \"(\" + varname + \")\";\r\n\t\tif(target_type == \"vec2\") //works for vec2,vec3 and vec4\r\n\t\t\treturn \"vec2(\" + varname + \".xy)\";\r\n\t\tif(target_type == \"vec3\") //works for vec2,vec3 and vec4\r\n\t\t{\r\n\t\t\tif(type == \"vec2\")\r\n\t\t\t\treturn \"vec3(\" + varname + \",0.0)\";\r\n\t\t\tif(type == \"vec4\")\r\n\t\t\t\treturn \"vec4(\" + varname + \".xyz)\";\r\n\t\t}\r\n\t\tif(target_type == \"vec4\")\r\n\t\t{\r\n\t\t\tif(type == \"vec2\")\r\n\t\t\t\treturn \"vec4(\" + varname + \",0.0,0.0)\";\r\n\t\t\tif(target_type == \"vec3\")\r\n\t\t\t\treturn \"vec4(\" + varname + \",1.0)\";\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t//used to host a shader body **************************************\r\n\tfunction LGShaderContext()\r\n\t{\r\n\t\t//to store the code template\r\n\t\tthis.vs_template = \"\";\r\n\t\tthis.fs_template = \"\";\r\n\r\n\t\t//required so nodes now where to fetch the input data\r\n\t\tthis.buffer_names = {\r\n\t\t\tuvs: \"v_coord\"\r\n\t\t};\r\n\r\n\t\tthis.extra = {}; //to store custom info from the nodes (like if this shader supports a feature, etc)\r\n\r\n\t\tthis._functions = {};\r\n\t\tthis._uniforms = {};\r\n\t\tthis._codeparts = {};\r\n\t\tthis._uniform_value = null;\r\n\t}\r\n\r\n\tLGShaderContext.prototype.clear = function()\r\n\t{\r\n\t\tthis._uniforms = {};\r\n\t\tthis._functions = {};\r\n\t\tthis._codeparts = {};\r\n\t\tthis._uniform_value = null;\r\n\r\n\t\tthis.extra = {};\r\n\t}\r\n\r\n\tLGShaderContext.prototype.addUniform = function( name, type, value )\r\n\t{\r\n\t\tthis._uniforms[ name ] = type;\r\n\t\tif(value != null)\r\n\t\t{\r\n\t\t\tif(!this._uniform_value)\r\n\t\t\t\tthis._uniform_value = {};\r\n\t\t\tthis._uniform_value[name] = value;\r\n\t\t}\r\n\t}\r\n\r\n\tLGShaderContext.prototype.addFunction = function( name, code )\r\n\t{\r\n\t\tthis._functions[name] = code;\r\n\t}\r\n\r\n\tLGShaderContext.prototype.addCode = function( hook, code, destinations )\r\n\t{\r\n\t\tdestinations = destinations || {\"\":\"\"};\r\n\t\tfor(var i in destinations)\r\n\t\t{\r\n\t\t\tvar h = i ? i + \"_\" + hook : hook;\r\n\t\t\tif(!this._codeparts[ h ])\r\n\t\t\t\tthis._codeparts[ h ] = code + \"\\n\";\r\n\t\t\telse\r\n\t\t\t\tthis._codeparts[ h ] += code + \"\\n\";\r\n\t\t}\r\n\t}\r\n\r\n\t//the system works by grabbing code fragments from every node and concatenating them in blocks depending on where must they be attached\r\n\tLGShaderContext.prototype.computeCodeBlocks = function( graph, extra_uniforms )\r\n\t{\r\n\t\t//prepare context\r\n\t\tthis.clear();\r\n\r\n\t\t//grab output nodes\r\n\t\tvar vertexout = graph.findNodesByType(\"shader::output/vertex\");\r\n\t\tvertexout = vertexout && vertexout.length ? vertexout[0] : null;\r\n\t\tvar fragmentout = graph.findNodesByType(\"shader::output/fragcolor\");\r\n\t\tfragmentout = fragmentout && fragmentout.length ? fragmentout[0] : null;\r\n\t\tif(!fragmentout) //??\r\n\t\t\treturn null; \r\n\r\n\t\t//propagate back destinations\r\n\t\tgraph.sendEventToAllNodes( \"clearDestination\" );\r\n\t\tif(vertexout)\r\n\t\t\tvertexout.propagateDestination(\"vs\");\r\n\t\tif(fragmentout)\r\n\t\t\tfragmentout.propagateDestination(\"fs\");\r\n\r\n\t\t//gets code from graph\r\n\t\tgraph.sendEventToAllNodes(\"onGetCode\", this );\r\n\r\n\t\tvar uniforms = \"\";\r\n\t\tfor(var i in this._uniforms)\r\n\t\t\tuniforms += \"uniform \" + this._uniforms[i] + \" \" + i + \";\\n\";\r\n\t\tif(extra_uniforms)\r\n\t\t\tfor(var i in extra_uniforms)\r\n\t\t\t\tuniforms += \"uniform \" + extra_uniforms[i] + \" \" + i + \";\\n\";\r\n\r\n\t\tvar functions = \"\";\r\n\t\tfor(var i in this._functions)\r\n\t\t\tfunctions += \"//\" + i + \"\\n\" + this._functions[i] + \"\\n\";\r\n\r\n\t\tvar blocks = this._codeparts;\r\n\t\tblocks.uniforms = uniforms;\r\n\t\tblocks.functions = functions;\r\n\t\treturn blocks;\r\n\t}\r\n\r\n\t//replaces blocks using the vs and fs template and returns the final codes\r\n\tLGShaderContext.prototype.computeShaderCode = function( graph )\r\n\t{\r\n\t\tvar blocks = this.computeCodeBlocks( graph );\r\n\t\tvar vs_code = GL.Shader.replaceCodeUsingContext( this.vs_template, blocks );\r\n\t\tvar fs_code = GL.Shader.replaceCodeUsingContext( this.fs_template, blocks );\r\n\t\treturn {\r\n\t\t\tvs_code: vs_code,\r\n\t\t\tfs_code: fs_code\r\n\t\t};\r\n\t}\r\n\r\n\t//generates the shader code from the template and the \r\n\tLGShaderContext.prototype.computeShader = function( graph, shader )\r\n\t{\r\n\t\tvar finalcode = this.computeShaderCode( graph );\r\n\t\tconsole.log( finalcode.vs_code, finalcode.fs_code );\r\n\r\n\t\tif(!LiteGraph.catch_exceptions)\r\n\t\t{\r\n\t\t\tthis._shader_error = true;\r\n\t\t\tif(shader)\r\n\t\t\t\tshader.updateShader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\telse\r\n\t\t\t\tshader = new GL.Shader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\tthis._shader_error = false;\r\n\t\t\treturn shader;\r\n\t\t}\r\n\r\n\t\ttry\r\n\t\t{\r\n\t\t\tif(shader)\r\n\t\t\t\tshader.updateShader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\telse\r\n\t\t\t\tshader = new GL.Shader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\tthis._shader_error = false;\r\n\t\t\treturn shader;\r\n\t\t}\r\n\t\tcatch (err)\r\n\t\t{\r\n\t\t\tif(!this._shader_error)\r\n\t\t\t{\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t\tif(err.indexOf(\"Fragment shader\") != -1)\r\n\t\t\t\t\tconsole.log( finalcode.fs_code.split(\"\\n\").map(function(v,i){ return i + \".- \" + v; }).join(\"\\n\") );\r\n\t\t\t\telse\r\n\t\t\t\t\tconsole.log( finalcode.vs_code );\r\n\t\t\t}\r\n\t\t\tthis._shader_error = true;\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn null;//never here\r\n\t}\r\n\r\n\tLGShaderContext.prototype.getShader = function( graph )\r\n\t{\r\n\t\t//if graph not changed?\r\n\t\tif(this._shader && this._shader._version == graph._version)\r\n\t\t\treturn this._shader;\r\n\r\n\t\t//compile shader\r\n\t\tvar shader = this.computeShader( graph, this._shader );\r\n\t\tif(!shader)\r\n\t\t\treturn null;\r\n\t\t\r\n\t\tthis._shader = shader;\r\n\t\tshader._version = graph._version;\r\n\t\treturn shader;\r\n\t}\r\n\r\n\t//some shader nodes could require to fill the box with some uniforms\r\n\tLGShaderContext.prototype.fillUniforms = function( uniforms, param )\r\n\t{\r\n\t\tif(!this._uniform_value)\r\n\t\t\treturn;\r\n\r\n\t\tfor(var i in this._uniform_value)\r\n\t\t{\r\n\t\t\tvar v = this._uniform_value[i];\r\n\t\t\tif(v == null)\r\n\t\t\t\tcontinue;\r\n\t\t\tif(v.constructor === Function)\r\n\t\t\t\tuniforms[i] = v.call( this, param );\r\n\t\t\telse if(v.constructor === GL.Texture)\r\n\t\t\t{\r\n\t\t\t\t//todo...\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tuniforms[i] = v;\r\n\t\t}\r\n\t}\r\n\r\n\tLiteGraph.ShaderContext = LiteGraph.Shaders.Context = LGShaderContext;\r\n\r\n\t// LGraphShaderGraph *****************************\r\n\t// applies a shader graph to texture, it can be uses as an example\r\n\r\n\tfunction LGraphShaderGraph() {\r\n\r\n\t\t//before inputs\r\n        this.subgraph = new LiteGraph.LGraph();\r\n        this.subgraph._subgraph_node = this;\r\n        this.subgraph._is_subgraph = true;\r\n\t\tthis.subgraph.filter = \"shader\";\r\n\r\n\t\tthis.addInput(\"in\", \"texture\");\r\n\t\tthis.addOutput(\"out\", \"texture\");\r\n\t\tthis.properties = { width: 0, height: 0, alpha: false, precision: typeof(LGraphTexture) != \"undefined\" ? LGraphTexture.DEFAULT : 2 };\r\n\r\n\t\tvar inputNode = this.subgraph.findNodesByType(\"shader::input/uniform\")[0];\r\n\t\tinputNode.pos = [200,300];\r\n\r\n\t\tvar sampler = LiteGraph.createNode(\"shader::texture/sampler2D\");\r\n\t\tsampler.pos = [400,300];\r\n\t\tthis.subgraph.add( sampler );\r\n\r\n\t\tvar outnode = LiteGraph.createNode(\"shader::output/fragcolor\");\r\n\t\toutnode.pos = [600,300];\r\n\t\tthis.subgraph.add( outnode );\r\n\r\n\t\tinputNode.connect( 0, sampler );\r\n\t\tsampler.connect( 0, outnode );\r\n\r\n\t\tthis.size = [180,60];\r\n\t\tthis.redraw_on_mouse = true; //force redraw\r\n\r\n\t\tthis._uniforms = {};\r\n\t\tthis._shader = null;\r\n\t\tthis._context = new LGShaderContext();\r\n\t\tthis._context.vs_template = \"#define VERTEX\\n\" + GL.Shader.SCREEN_VERTEX_SHADER;\r\n\t\tthis._context.fs_template = LGraphShaderGraph.template;\r\n\t}\r\n\r\n\tLGraphShaderGraph.template = \"\\n\\\r\n#define FRAGMENT\\n\\\r\nprecision highp float;\\n\\\r\nvarying vec2 v_coord;\\n\\\r\n{{varying}}\\n\\\r\n{{uniforms}}\\n\\\r\n{{functions}}\\n\\\r\n{{fs_functions}}\\n\\\r\nvoid main() {\\n\\n\\\r\nvec2 uv = v_coord;\\n\\\r\nvec4 fragcolor = vec4(0.0);\\n\\\r\nvec4 fragcolor1 = vec4(0.0);\\n\\\r\n{{fs_code}}\\n\\\r\ngl_FragColor = fragcolor;\\n\\\r\n}\\n\\\r\n\t\";\r\n\r\n\tLGraphShaderGraph.widgets_info = {\r\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n\t};\r\n\r\n\tLGraphShaderGraph.title = \"ShaderGraph\";\r\n\tLGraphShaderGraph.desc = \"Builds a shader using a graph\";\r\n\tLGraphShaderGraph.input_node_type = \"input/uniform\";\r\n\tLGraphShaderGraph.output_node_type = \"output/fragcolor\";\r\n\tLGraphShaderGraph.title_color = SHADERNODES_COLOR;\r\n\r\n\tLGraphShaderGraph.prototype.onSerialize = function(o)\r\n\t{\r\n\t\to.subgraph = this.subgraph.serialize();\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onConfigure = function(o)\r\n\t{\r\n\t\tthis.subgraph.configure(o.subgraph);\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onExecute = function() {\r\n\t\tif (!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\t//read input texture\r\n\t\tvar intex = this.getInputData(0);\r\n\t\tif(intex && intex.constructor != GL.Texture)\r\n\t\t\tintex = null;\r\n\r\n\t\tvar w = this.properties.width | 0;\r\n\t\tvar h = this.properties.height | 0;\r\n\t\tif (w == 0) {\r\n\t\t\tw = intex ? intex.width : gl.viewport_data[2];\r\n\t\t} //0 means default\r\n\t\tif (h == 0) {\r\n\t\t\th = intex ? intex.height : gl.viewport_data[3];\r\n\t\t} //0 means default\r\n\r\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, intex );\r\n\r\n\t\tvar texture = this._texture;\r\n\t\tif ( !texture || texture.width != w || texture.height != h || texture.type != type ) {\r\n\t\t\ttexture = this._texture = new GL.Texture(w, h, {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tformat: this.alpha ? gl.RGBA : gl.RGB,\r\n\t\t\t\tfilter: gl.LINEAR\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tvar shader = this.getShader( this.subgraph );\r\n\t\tif(!shader)\r\n\t\t\treturn;\r\n\r\n\t\tvar uniforms = this._uniforms;\r\n\t\tthis._context.fillUniforms( uniforms );\r\n\r\n\t\tvar tex_slot = 0;\r\n\t\tif(this.inputs)\r\n\t\tfor(var i = 0; i < this.inputs.length; ++i)\r\n\t\t{\r\n\t\t\tvar input = this.inputs[i];\r\n\t\t\tvar data = this.getInputData(i);\r\n\t\t\tif(input.type == \"texture\")\r\n\t\t\t{\r\n\t\t\t\tif(!data)\r\n\t\t\t\t\tdata = GL.Texture.getWhiteTexture();\r\n\t\t\t\tdata = data.bind(tex_slot++);\r\n\t\t\t}\r\n\r\n\t\t\tif(data != null)\r\n\t\t\t\tuniforms[ \"u_\" + input.name ] = data;\r\n\t\t}\r\n\r\n\t\tvar mesh = GL.Mesh.getScreenQuad();\r\n\r\n\t\tgl.disable( gl.DEPTH_TEST );\r\n\t\tgl.disable( gl.BLEND );\r\n\r\n\t\ttexture.drawTo(function(){\r\n\t\t\tshader.uniforms( uniforms );\r\n\t\t\tshader.draw( mesh );\r\n\t\t});\r\n\r\n\t\t//use subgraph output \r\n\t\tthis.setOutputData(0, texture );\r\n\t};\r\n\r\n\t//add input node inside subgraph\r\n\tLGraphShaderGraph.prototype.onInputAdded = function( slot_info )\r\n\t{\r\n\t\tvar subnode = LiteGraph.createNode(\"shader::input/uniform\");\r\n\t\tsubnode.setProperty(\"name\",slot_info.name);\r\n\t\tsubnode.setProperty(\"type\",slot_info.type);\r\n\t\tthis.subgraph.add( subnode );\r\n\t}\r\n\r\n\t//remove all\r\n\tLGraphShaderGraph.prototype.onInputRemoved = function( slot, slot_info )\r\n\t{\r\n\t\tvar nodes = this.subgraph.findNodesByType(\"shader::input/uniform\");\r\n\t\tfor(var i = 0; i < nodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar node = nodes[i];\r\n\t\t\tif(node.properties.name == slot_info.name )\r\n\t\t\t\tthis.subgraph.remove( node );\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.computeSize = function()\r\n\t{\r\n\t\tvar num_inputs = this.inputs ? this.inputs.length : 0;\r\n\t\tvar num_outputs = this.outputs ? this.outputs.length : 0;\r\n\t\treturn [ 200, Math.max(num_inputs,num_outputs) * LiteGraph.NODE_SLOT_HEIGHT + LiteGraph.NODE_TITLE_HEIGHT + 10];\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.getShader = function()\r\n\t{\r\n\t\tvar shader = this._context.getShader( this.subgraph );\r\n\t\tif(!shader)\r\n\t\t\tthis.boxcolor = \"red\";\r\n\t\telse\r\n\t\t\tthis.boxcolor = null;\r\n\t\treturn shader;\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onDrawBackground = function(ctx, graphcanvas, canvas, pos)\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn;\r\n\r\n\t\t//allows to preview the node if the canvas is a webgl canvas\r\n\t\tvar tex = this.getOutputData(0);\r\n\t\tvar inputs_y = this.inputs ? this.inputs.length * LiteGraph.NODE_SLOT_HEIGHT : 0;\r\n\t\tif (tex && ctx == tex.gl && this.size[1] > inputs_y + LiteGraph.NODE_TITLE_HEIGHT ) {\r\n\t\t\tctx.drawImage( tex, 10,y, this.size[0] - 20, this.size[1] - inputs_y - LiteGraph.NODE_TITLE_HEIGHT );\r\n\t\t}\r\n\r\n\t\tvar y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n\r\n\t\t//button\r\n\t\tvar over = LiteGraph.isInsideRectangle(pos[0],pos[1],this.pos[0],this.pos[1] + y,this.size[0],LiteGraph.NODE_TITLE_HEIGHT);\r\n\t\tctx.fillStyle = over ? \"#555\" : \"#222\";\r\n\t\tctx.beginPath();\r\n\t\tif (this._shape == LiteGraph.BOX_SHAPE)\r\n\t\t\tctx.rect(0, y, this.size[0]+1, LiteGraph.NODE_TITLE_HEIGHT);\r\n\t\telse\r\n\t\t\tctx.roundRect( 0, y, this.size[0]+1, LiteGraph.NODE_TITLE_HEIGHT, 0, 8);\r\n\t\tctx.fill();\r\n\r\n\t\t//button\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.font = \"24px Arial\";\r\n\t\tctx.fillStyle = over ? \"#DDD\" : \"#999\";\r\n\t\tctx.fillText( \"+\", this.size[0] * 0.5, y + 24 );\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onMouseDown = function(e, localpos, graphcanvas)\r\n\t{\r\n\t\tvar y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n\t\tif(localpos[1] > y)\r\n\t\t{\r\n\t\t\tgraphcanvas.showSubgraphPropertiesDialog(this);\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onDrawSubgraphBackground = function(graphcanvas)\r\n\t{\r\n\t\t//TODO\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.getExtraMenuOptions = function(graphcanvas)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tvar options = [{ content: \"Print Code\", callback: function(){\r\n\t\t\tvar code = that._context.computeShaderCode();\r\n\t\t\tconsole.log( code.vs_code, code.fs_code );\r\n\t\t}}];\r\n\r\n\t\treturn options;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"texture/shaderGraph\", LGraphShaderGraph );\r\n\r\n\tfunction shaderNodeFromFunction( classname, params, return_type, code )\r\n\t{\r\n\t\t//TODO\r\n\t}\r\n\r\n\t//Shader Nodes ***********************************************************\r\n\r\n\t//applies a shader graph to a code\r\n\tfunction LGraphShaderUniform() {\r\n\t\tthis.addOutput(\"out\", \"\");\r\n\t\tthis.properties = { name: \"\", type: \"\" };\r\n\t}\r\n\r\n\tLGraphShaderUniform.title = \"Uniform\";\r\n\tLGraphShaderUniform.desc = \"Input data for the shader\";\r\n\r\n\tLGraphShaderUniform.prototype.getTitle = function()\r\n\t{\r\n\t\tif( this.properties.name && this.flags.collapsed)\r\n\t\t\treturn this.properties.type + \" \" + this.properties.name;\r\n\t\treturn \"Uniform\";\r\n\t}\r\n\r\n\tLGraphShaderUniform.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tthis.outputs[0].name = this.properties.type + \" \" + this.properties.name;\r\n\t}\r\n\r\n\tLGraphShaderUniform.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar type = this.properties.type;\r\n\t\tif( !type )\r\n\t\t{\r\n\t\t\tif( !context.onGetPropertyInfo )\r\n\t\t\t\treturn;\r\n\t\t\tvar info = context.onGetPropertyInfo( this.property.name );\r\n\t\t\tif(!info)\r\n\t\t\t\treturn;\r\n\t\t\ttype = info.type;\r\n\t\t}\r\n\t\tif(type == \"number\")\r\n\t\t\ttype = \"float\";\r\n\t\telse if(type == \"texture\")\r\n\t\t\ttype = \"sampler2D\";\r\n\t\tif ( LGShaders.GLSL_types.indexOf(type) == -1 )\r\n\t\t\treturn;\r\n\r\n\t\tcontext.addUniform( \"u_\" + this.properties.name, type );\r\n\t\tthis.setOutputData( 0, type );\r\n\t}\r\n\r\n\tLGraphShaderUniform.prototype.getOutputVarName = function(slot)\r\n\t{\r\n\t\treturn \"u_\" + this.properties.name;\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/uniform\", LGraphShaderUniform );\r\n\r\n\r\n\tfunction LGraphShaderAttribute() {\r\n\t\tthis.addOutput(\"out\", \"vec2\");\r\n\t\tthis.properties = { name: \"coord\", type: \"vec2\" };\r\n\t}\r\n\r\n\tLGraphShaderAttribute.title = \"Attribute\";\r\n\tLGraphShaderAttribute.desc = \"Input data from mesh attribute\";\r\n\r\n\tLGraphShaderAttribute.prototype.getTitle = function()\r\n\t{\r\n\t\treturn \"att. \" + this.properties.name;\r\n\t}\r\n\r\n\tLGraphShaderAttribute.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar type = this.properties.type;\r\n\t\tif( !type || LGShaders.GLSL_types.indexOf(type) == -1 )\r\n\t\t\treturn;\r\n\t\tif(type == \"number\")\r\n\t\t\ttype = \"float\";\r\n\t\tif( this.properties.name != \"coord\")\r\n\t\t{\r\n\t\t\tcontext.addCode( \"varying\", \" varying \" + type +\" v_\" + this.properties.name + \";\" );\r\n\t\t\t//if( !context.varyings[ this.properties.name ] )\r\n\t\t\t//context.addCode( \"vs_code\", \"v_\" + this.properties.name + \" = \" + input_name + \";\" );\r\n\t\t}\r\n\t\tthis.setOutputData( 0, type );\r\n\t}\r\n\r\n\tLGraphShaderAttribute.prototype.getOutputVarName = function(slot)\r\n\t{\r\n\t\treturn \"v_\" + this.properties.name;\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/attribute\", LGraphShaderAttribute );\r\n\r\n\tfunction LGraphShaderSampler2D() {\r\n\t\tthis.addInput(\"tex\", \"sampler2D\");\r\n\t\tthis.addInput(\"uv\", \"vec2\");\r\n\t\tthis.addOutput(\"rgba\", \"vec4\");\r\n\t\tthis.addOutput(\"rgb\", \"vec3\");\r\n\t}\r\n\r\n\tLGraphShaderSampler2D.title = \"Sampler2D\";\r\n\tLGraphShaderSampler2D.desc = \"Reads a pixel from a texture\";\r\n\r\n\tLGraphShaderSampler2D.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar texname = getInputLinkID( this, 0 );\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"vec4 \" + varname + \" = vec4(0.0);\\n\";\r\n\t\tif(texname)\r\n\t\t{\r\n\t\t\tvar uvname = getInputLinkID( this, 1 ) || context.buffer_names.uvs;\r\n\t\t\tcode += varname + \" = texture2D(\"+texname+\",\"+uvname+\");\\n\";\r\n\t\t}\r\n\r\n\t\tvar link0 = getOutputLinkID( this, 0 );\r\n\t\tif(link0)\r\n\t\t\tcode += \"vec4 \" + getOutputLinkID( this, 0 ) + \" = \"+varname+\";\\n\";\r\n\r\n\t\tvar link1 = getOutputLinkID( this, 1 );\r\n\t\tif(link1)\r\n\t\t\tcode += \"vec3 \" + getOutputLinkID( this, 1 ) + \" = \"+varname+\".xyz;\\n\";\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"vec4\" );\r\n\t\tthis.setOutputData( 1, \"vec3\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"texture/sampler2D\", LGraphShaderSampler2D );\r\n\r\n\t//*********************************\r\n\r\n\tfunction LGraphShaderConstant()\r\n\t{\r\n\t\tthis.addOutput(\"\",\"float\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\ttype: \"float\",\r\n\t\t\tvalue: 0\r\n\t\t};\r\n\r\n\t\tthis.addWidget(\"combo\",\"type\",\"float\",null, { values: GLSL_types_const, property: \"type\" } );\r\n\t\tthis.updateWidgets();\r\n\t}\r\n\r\n\tLGraphShaderConstant.title = \"const\";\r\n\r\n\tLGraphShaderConstant.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn valueToGLSL( this.properties.value, this.properties.type, 2 );\r\n\t\treturn \"Const\";\r\n\t}\r\n\r\n\tLGraphShaderConstant.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tif(name == \"type\")\r\n\t\t{\r\n\t\t\tif(this.outputs[0].type != value)\r\n\t\t\t{\r\n\t\t\t\tthis.disconnectOutput(0);\r\n\t\t\t\tthis.outputs[0].type = value;\r\n\t\t\t}\r\n\t\t\tthis.widgets.length = 1; //remove extra widgets\r\n\t\t\tthis.updateWidgets();\r\n\t\t}\r\n\t\tif(name == \"value\")\r\n\t\t{\r\n\t\t\tif(!value.length)\r\n\t\t\t\tthis.widgets[1].value = value;\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.widgets[1].value = value[1];\r\n\t\t\t\tif(value.length > 2)\r\n\t\t\t\t\tthis.widgets[2].value = value[2];\r\n\t\t\t\tif(value.length > 3)\r\n\t\t\t\t\tthis.widgets[3].value = value[3];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderConstant.prototype.updateWidgets = function( old_value )\r\n\t{\r\n\t\tvar that = this;\r\n\t\tvar old_value = this.properties.value;\r\n\t\tvar options = { step: 0.01 };\r\n\t\tswitch(this.properties.type)\r\n\t\t{\r\n\t\t\tcase 'float': \r\n\t\t\t\tthis.properties.value = 0;\r\n\t\t\t\tthis.addWidget(\"number\",\"v\",0,{ step:0.01, property: \"value\" });\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'vec2': \r\n\t\t\t\tthis.properties.value = old_value && old_value.length == 2 ? [old_value[0],old_value[1]] : [0,0,0];\r\n\t\t\t\tthis.addWidget(\"number\",\"x\",this.properties.value[0], function(v){ that.properties.value[0] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"y\",this.properties.value[1], function(v){ that.properties.value[1] = v; },options); \r\n\t\t\t\tbreak;\r\n\t\t\tcase 'vec3': \r\n\t\t\t\tthis.properties.value = old_value && old_value.length == 3 ? [old_value[0],old_value[1],old_value[2]] : [0,0,0];\r\n\t\t\t\tthis.addWidget(\"number\",\"x\",this.properties.value[0], function(v){ that.properties.value[0] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"y\",this.properties.value[1], function(v){ that.properties.value[1] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"z\",this.properties.value[2], function(v){ that.properties.value[2] = v; },options); \r\n\t\t\t\tbreak;\r\n\t\t\tcase 'vec4': \r\n\t\t\t\tthis.properties.value = old_value && old_value.length == 4 ? [old_value[0],old_value[1],old_value[2],old_value[3]] : [0,0,0,0];\r\n\t\t\t\tthis.addWidget(\"number\",\"x\",this.properties.value[0], function(v){ that.properties.value[0] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"y\",this.properties.value[1], function(v){ that.properties.value[1] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"z\",this.properties.value[2], function(v){ that.properties.value[2] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"w\",this.properties.value[3], function(v){ that.properties.value[3] = v; },options); \r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(\"unknown type for constant\");\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderConstant.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar value = valueToGLSL( this.properties.value, this.properties.type );\r\n\t\tvar link_name = getOutputLinkID(this,0);\r\n\t\tif(!link_name) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar code = \"\t\" + this.properties.type + \" \" + link_name + \" = \" + value + \";\";\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\r\n\t\tthis.setOutputData( 0, this.properties.type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/const\", LGraphShaderConstant );\r\n\r\n\tfunction LGraphShaderVec2()\r\n\t{\r\n\t\tthis.addInput(\"xy\",\"vec2\");\r\n\t\tthis.addInput(\"x\",\"float\");\r\n\t\tthis.addInput(\"y\",\"float\");\r\n\t\tthis.addOutput(\"xy\",\"vec2\");\r\n\t\tthis.addOutput(\"x\",\"float\");\r\n\t\tthis.addOutput(\"y\",\"float\");\r\n\r\n\t\tthis.properties = { x: 0, y: 0 };\r\n\t}\r\n\r\n\tLGraphShaderVec2.title = \"vec2\";\r\n\tLGraphShaderVec2.varmodes = [\"xy\",\"x\",\"y\"];\r\n\r\n\tLGraphShaderVec2.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\t this.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderVec2.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar props = this.properties;\r\n\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"\tvec2 \" + varname + \" = \" + valueToGLSL([props.x,props.y]) + \";\\n\";\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec2.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec2.varmodes[i];\r\n\t\t\tvar inlink = getInputLinkID(this,i);\r\n\t\t\tif(!inlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tcode += \"\t\" + varname + \".\"+varmode+\" = \" + inlink + \";\\n\";\r\n\t\t}\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec2.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec2.varmodes[i];\r\n\t\t\tvar outlink = getOutputLinkID(this,i);\r\n\t\t\tif(!outlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar type = GLSL_types_const[varmode.length - 1];\r\n\t\t\tcode += \"\t\"+type+\" \" + outlink + \" = \" + varname + \".\" + varmode + \";\\n\";\r\n\t\t\tthis.setOutputData( i, type );\r\n\t\t}\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/vec2\", LGraphShaderVec2 );\t\r\n\r\n\tfunction LGraphShaderVec3()\r\n\t{\r\n\t\tthis.addInput(\"xyz\",\"vec3\");\r\n\t\tthis.addInput(\"x\",\"float\");\r\n\t\tthis.addInput(\"y\",\"float\");\r\n\t\tthis.addInput(\"z\",\"float\");\r\n\t\tthis.addInput(\"xy\",\"vec2\");\r\n\t\tthis.addInput(\"xz\",\"vec2\");\r\n\t\tthis.addInput(\"yz\",\"vec2\");\r\n\t\tthis.addOutput(\"xyz\",\"vec3\");\r\n\t\tthis.addOutput(\"x\",\"float\");\r\n\t\tthis.addOutput(\"y\",\"float\");\r\n\t\tthis.addOutput(\"z\",\"float\");\r\n\t\tthis.addOutput(\"xy\",\"vec2\");\r\n\t\tthis.addOutput(\"xz\",\"vec2\");\r\n\t\tthis.addOutput(\"yz\",\"vec2\");\r\n\r\n\t\tthis.properties = { x:0, y: 0, z: 0 };\r\n\t}\r\n\r\n\tLGraphShaderVec3.title = \"vec3\";\r\n\tLGraphShaderVec3.varmodes = [\"xyz\",\"x\",\"y\",\"z\",\"xy\",\"xz\",\"yz\"];\r\n\r\n\tLGraphShaderVec3.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderVec3.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar props = this.properties;\r\n\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"vec3 \" + varname + \" = \" + valueToGLSL([props.x,props.y,props.z]) + \";\\n\";\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec3.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec3.varmodes[i];\r\n\t\t\tvar inlink = getInputLinkID(this,i);\r\n\t\t\tif(!inlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tcode += \"\t\" + varname + \".\"+varmode+\" = \" + inlink + \";\\n\";\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < LGraphShaderVec3.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec3.varmodes[i];\r\n\t\t\tvar outlink = getOutputLinkID(this,i);\r\n\t\t\tif(!outlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar type = GLSL_types_const[varmode.length - 1];\r\n\t\t\tcode += \"\t\"+type+\" \" + outlink + \" = \" + varname + \".\" + varmode + \";\\n\";\r\n\t\t\tthis.setOutputData( i, type );\r\n\t\t}\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/vec3\", LGraphShaderVec3 );\t\r\n\r\n\r\n\tfunction LGraphShaderVec4()\r\n\t{\r\n\t\tthis.addInput(\"xyzw\",\"vec4\");\r\n\t\tthis.addInput(\"xyz\",\"vec3\");\r\n\t\tthis.addInput(\"x\",\"float\");\r\n\t\tthis.addInput(\"y\",\"float\");\r\n\t\tthis.addInput(\"z\",\"float\");\r\n\t\tthis.addInput(\"w\",\"float\");\r\n\t\tthis.addInput(\"xy\",\"vec2\");\r\n\t\tthis.addInput(\"yz\",\"vec2\");\r\n\t\tthis.addInput(\"zw\",\"vec2\");\r\n\t\tthis.addOutput(\"xyzw\",\"vec4\");\r\n\t\tthis.addOutput(\"xyz\",\"vec3\");\r\n\t\tthis.addOutput(\"x\",\"float\");\r\n\t\tthis.addOutput(\"y\",\"float\");\r\n\t\tthis.addOutput(\"z\",\"float\");\r\n\t\tthis.addOutput(\"xy\",\"vec2\");\r\n\t\tthis.addOutput(\"yz\",\"vec2\");\r\n\t\tthis.addOutput(\"zw\",\"vec2\");\r\n\r\n\t\tthis.properties = { x:0, y: 0, z: 0, w: 0 };\r\n\t}\r\n\r\n\tLGraphShaderVec4.title = \"vec4\";\r\n\tLGraphShaderVec4.varmodes = [\"xyzw\",\"xyz\",\"x\",\"y\",\"z\",\"w\",\"xy\",\"yz\",\"zw\"];\r\n\r\n\tLGraphShaderVec4.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderVec4.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar props = this.properties;\r\n\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"vec4 \" + varname + \" = \" + valueToGLSL([props.x,props.y,props.z,props.w]) + \";\\n\";\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec4.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec4.varmodes[i];\r\n\t\t\tvar inlink = getInputLinkID(this,i);\r\n\t\t\tif(!inlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tcode += \"\t\" + varname + \".\"+varmode+\" = \" + inlink + \";\\n\";\r\n\t\t}\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec4.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec4.varmodes[i];\r\n\t\t\tvar outlink = getOutputLinkID(this,i);\r\n\t\t\tif(!outlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar type = GLSL_types_const[varmode.length - 1];\r\n\t\t\tcode += \"\t\"+type+\" \" + outlink + \" = \" + varname + \".\" + varmode + \";\\n\";\r\n\t\t\tthis.setOutputData( i, type );\r\n\t\t}\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/vec4\", LGraphShaderVec4 );\t\r\n\t\r\n\t//*********************************\r\n\r\n\tfunction LGraphShaderFragColor() {\r\n\t\tthis.addInput(\"color\", LGShaders.ALL_TYPES );\r\n\t\tthis.block_delete = true;\r\n\t}\r\n\r\n\tLGraphShaderFragColor.title = \"FragColor\";\r\n\tLGraphShaderFragColor.desc = \"Pixel final color\";\r\n\r\n\tLGraphShaderFragColor.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tvar link_name = getInputLinkID( this, 0 );\r\n\t\tif(!link_name)\r\n\t\t\treturn;\r\n\t\tvar type = this.getInputData(0);\r\n\t\tvar code = varToTypeGLSL( link_name, type, \"vec4\" );\r\n\t\tcontext.addCode(\"fs_code\", \"fragcolor = \" + code + \";\");\r\n\t}\r\n\r\n\tregisterShaderNode( \"output/fragcolor\", LGraphShaderFragColor );\r\n\r\n\r\n\t/*\r\n\tfunction LGraphShaderDiscard()\r\n\t{\r\n\t\tthis.addInput(\"v\",\"T\");\r\n\t\tthis.addInput(\"min\",\"T\");\r\n\t\tthis.properties = { min_value: 0.0 };\r\n\t\tthis.addWidget(\"number\",\"min\",0,{ step: 0.01, property: \"min_value\" });\r\n\t}\r\n\r\n\tLGraphShaderDiscard.title = \"Discard\";\r\n\r\n\tLGraphShaderDiscard.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar inlink1 = getInputLinkID(this,1);\r\n\r\n\t\tif(!inlink && !inlink1) //not connected\r\n\t\t\treturn;\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = ( (\" + inlink + \" - \"+minv+\") / (\"+ maxv+\" - \"+minv+\") ) * (\"+ maxv2+\" - \"+minv2+\") + \" + minv2 + \";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"output/discard\", LGraphShaderDiscard );\r\n\t*/\r\n\r\n\r\n\t// *************************************************\r\n\r\n\tfunction LGraphShaderOperation()\r\n\t{\r\n\t\tthis.addInput(\"A\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"B\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"out\",\"\");\r\n\t\tthis.properties = {\r\n\t\t\toperation: \"*\"\r\n\t\t};\r\n\t\tthis.addWidget(\"combo\",\"op.\",this.properties.operation,{ property: \"operation\", values: LGraphShaderOperation.operations });\r\n\t}\r\n\r\n\tLGraphShaderOperation.title = \"Operation\";\r\n\tLGraphShaderOperation.operations = [\"+\",\"-\",\"*\",\"/\"];\r\n\r\n\tLGraphShaderOperation.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn \"A\" + this.properties.operation + \"B\";\r\n\t\telse\r\n\t\t\treturn \"Operation\";\r\n\t}\r\n\r\n\tLGraphShaderOperation.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlinks = [];\r\n\t\tfor(var i = 0; i < 3; ++i)\r\n\t\t\tinlinks.push( { name: getInputLinkID(this,i), type: this.getInputData(i) || \"float\" } );\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\t//func_desc\r\n\t\tvar base_type = inlinks[0].type;\r\n\t\tvar return_type = base_type;\r\n\t\tvar op = this.properties.operation;\r\n\r\n\t\tvar params = [];\r\n\t\tfor(var i = 0; i < 2; ++i)\r\n\t\t{\r\n\t\t\tvar param_code = inlinks[i].name;\r\n\t\t\tif(param_code == null) //not plugged\r\n\t\t\t{\r\n\t\t\t\tparam_code = p.value != null ? p.value : \"(1.0)\";\r\n\t\t\t\tinlinks[i].type = \"float\";\r\n\t\t\t}\r\n\r\n\t\t\t//convert\r\n\t\t\tif( inlinks[i].type != base_type ) \r\n\t\t\t{\r\n\t\t\t\tif( inlinks[i].type == \"float\" && (op == \"*\" || op == \"/\") )\r\n\t\t\t\t{\r\n\t\t\t\t\t//I find hard to create the opposite condition now, so I prefeer an else\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tparam_code = convertVarToGLSLType( param_code, inlinks[i].type, base_type );\r\n\t\t\t}\r\n\t\t\tparams.push( param_code );\r\n\t\t}\r\n\t\t\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = \"+ params[0] + op + params[1] + \";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/operation\", LGraphShaderOperation );\r\n\r\n\r\n\tfunction LGraphShaderFunc()\r\n\t{\r\n\t\tthis.addInput(\"A\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"B\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"out\",\"\");\r\n\t\tthis.properties = {\r\n\t\t\tfunc: \"floor\"\r\n\t\t};\r\n\t\tthis._current = \"floor\";\r\n\t\tthis.addWidget(\"combo\",\"func\",this.properties.func,{ property: \"func\", values: GLSL_functions_name });\r\n\t}\r\n\r\n\tLGraphShaderFunc.title = \"Func\";\r\n\r\n\tLGraphShaderFunc.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\r\n\t\tif(name == \"func\")\r\n\t\t{\r\n\t\t\tvar func_desc = GLSL_functions[ value ];\r\n\t\t\tif(!func_desc)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//remove extra inputs\r\n\t\t\tfor(var i = func_desc.params.length; i < this.inputs.length; ++i)\r\n\t\t\t\tthis.removeInput(i);\r\n\r\n\t\t\t//add and update inputs\r\n\t\t\tfor(var i = 0; i < func_desc.params.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar p = func_desc.params[i];\r\n\t\t\t\tif( this.inputs[i] )\r\n\t\t\t\t\tthis.inputs[i].name = p.name + (p.value ? \" (\" + p.value + \")\" : \"\");\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.addInput( p.name, LGShaders.ALL_TYPES );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderFunc.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn this.properties.func;\r\n\t\telse\r\n\t\t\treturn \"Func\";\r\n\t}\r\n\r\n\tLGraphShaderFunc.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlinks = [];\r\n\t\tfor(var i = 0; i < 3; ++i)\r\n\t\t\tinlinks.push( { name: getInputLinkID(this,i), type: this.getInputData(i) || \"float\" } );\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar func_desc = GLSL_functions[ this.properties.func ];\r\n\t\tif(!func_desc)\r\n\t\t\treturn;\r\n\r\n\t\t//func_desc\r\n\t\tvar base_type = inlinks[0].type;\r\n\t\tvar return_type = func_desc.return_type;\r\n\t\tif( return_type == \"T\" )\r\n\t\t\treturn_type = base_type;\r\n\r\n\t\tvar params = [];\r\n\t\tfor(var i = 0; i < func_desc.params.length; ++i)\r\n\t\t{\r\n\t\t\tvar p = func_desc.params[i];\r\n\t\t\tvar param_code = inlinks[i].name;\r\n\t\t\tif(param_code == null) //not plugged\r\n\t\t\t{\r\n\t\t\t\tparam_code = p.value != null ? p.value : \"(1.0)\";\r\n\t\t\t\tinlinks[i].type = \"float\";\r\n\t\t\t}\r\n\t\t\tif( (p.type == \"T\" && inlinks[i].type != base_type) ||\r\n\t\t\t\t(p.type != \"T\" && inlinks[i].type != base_type) )\r\n\t\t\t\tparam_code = convertVarToGLSLType( param_code, inlinks[i].type, base_type );\r\n\t\t\tparams.push( param_code );\r\n\t\t}\r\n\t\t\r\n\t\tcontext.addFunction(\"round\",\"float round(float v){ return floor(v+0.5); }\\nvec2 round(vec2 v){ return floor(v+vec2(0.5));}\\nvec3 round(vec3 v){ return floor(v+vec3(0.5));}\\nvec4 round(vec4 v){ return floor(v+vec4(0.5)); }\\n\");\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = \"+func_desc.func+\"(\"+params.join(\",\")+\");\", this.shader_destination );\r\n\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/func\", LGraphShaderFunc );\r\n\r\n\r\n\r\n\tfunction LGraphShaderSnippet()\r\n\t{\r\n\t\tthis.addInput(\"A\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"B\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"C\",\"vec4\");\r\n\t\tthis.properties = {\r\n\t\t\tcode:\"C = A+B\",\r\n\t\t\ttype: \"vec4\"\r\n\t\t}\r\n\t\tthis.addWidget(\"text\",\"code\",this.properties.code,{ property: \"code\" });\r\n\t\tthis.addWidget(\"combo\",\"type\",this.properties.type,{ values:[\"float\",\"vec2\",\"vec3\",\"vec4\"], property: \"type\" });\r\n\t}\r\n\r\n\tLGraphShaderSnippet.title = \"Snippet\";\r\n\r\n\tLGraphShaderSnippet.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\r\n\t\tif(name == \"type\"&& this.outputs[0].type != value)\r\n\t\t{\r\n\t\t\tthis.disconnectOutput(0);\r\n\t\t\tthis.outputs[0].type = value;\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderSnippet.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn this.properties.code;\r\n\t\telse\r\n\t\t\treturn \"Snippet\";\r\n\t}\r\n\r\n\tLGraphShaderSnippet.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlinkA = getInputLinkID(this,0);\r\n\t\tif(!inlinkA)\r\n\t\t\tinlinkA = \"1.0\";\r\n\t\tvar inlinkB = getInputLinkID(this,1);\r\n\t\tif(!inlinkB)\r\n\t\t\tinlinkB = \"1.0\";\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar inA_type = this.getInputData(0) || \"float\";\r\n\t\tvar inB_type = this.getInputData(1) || \"float\";\r\n\t\tvar return_type = this.properties.type;\r\n\r\n\t\t//cannot resolve input\r\n\t\tif(inA_type == \"T\" || inB_type == \"T\")\r\n\t\t{\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar funcname = \"funcSnippet\" + this.id;\r\n\r\n\t\tvar func_code = \"\\n\" + return_type + \" \" + funcname + \"( \" + inA_type + \" A, \" + inB_type + \" B) {\\n\";\r\n\t\tfunc_code += \"\t\" + return_type + \" C = \" + return_type + \"(0.0);\\n\";\r\n\t\tfunc_code += \"\t\" + this.properties.code + \";\\n\";\r\n\t\tfunc_code += \"\treturn C;\\n}\\n\";\r\n\r\n\t\tcontext.addCode(\"functions\", func_code, this.shader_destination );\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = \"+funcname+\"(\"+inlinkA+\",\"+inlinkB+\");\", this.shader_destination );\r\n\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"utils/snippet\", LGraphShaderSnippet );\r\n\r\n\t//************************************\r\n\r\n\tfunction LGraphShaderRand()\r\n\t{\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t}\r\n\r\n\tLGraphShaderRand.title = \"Rand\";\r\n\r\n\tLGraphShaderRand.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\r\n\t\tcontext.addUniform( \"u_rand\" + this.id, \"float\", function(){ return Math.random(); });\r\n\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = u_rand\" + this.id +\";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"float\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/rand\", LGraphShaderRand );\r\n\r\n\t//noise\r\n\t//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\r\n\tfunction LGraphShaderNoise()\r\n\t{\r\n\t\tthis.addInput(\"out\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"scale\", \"float\" );\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t\tthis.properties = {\r\n\t\t\ttype: \"noise\",\r\n\t\t\tscale: 1\r\n\t\t};\r\n\t\tthis.addWidget(\"combo\",\"type\", this.properties.type, { property: \"type\", values: LGraphShaderNoise.NOISE_TYPES });\r\n\t\tthis.addWidget(\"number\",\"scale\", this.properties.scale, { property: \"scale\" });\r\n\t}\r\n\r\n\tLGraphShaderNoise.NOISE_TYPES = [\"noise\",\"rand\"];\r\n\r\n\tLGraphShaderNoise.title = \"noise\";\r\n\r\n\tLGraphShaderNoise.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\r\n\t\tvar intype = this.getInputData(0);\r\n\t\tif(!inlink)\r\n\t\t{\r\n\t\t\tintype = \"vec2\";\r\n\t\t\tinlink = context.buffer_names.uvs;\r\n\t\t}\r\n\r\n\t\tcontext.addFunction(\"noise\",LGraphShaderNoise.shader_functions);\r\n\t\tcontext.addUniform( \"u_noise_scale\" + this.id, \"float\", this.properties.scale );\r\n\t\tif( intype == \"float\" )\r\n\t\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = snoise( vec2(\" + inlink +\") * u_noise_scale\" + this.id +\");\", this.shader_destination );\r\n\t\telse if( intype == \"vec2\" || intype == \"vec3\" )\r\n\t\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = snoise(\" + inlink +\" * u_noise_scale\" + this.id +\");\", this.shader_destination );\r\n\t\telse if( intype == \"vec4\" )\r\n\t\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = snoise(\" + inlink +\".xyz * u_noise_scale\" + this.id +\");\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"float\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/noise\", LGraphShaderNoise );\r\n\r\nLGraphShaderNoise.shader_functions = \"\\n\\\r\nvec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }\\n\\\r\n\\n\\\r\nfloat snoise(vec2 v){\\n\\\r\n  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);\\n\\\r\n  vec2 i  = floor(v + dot(v, C.yy) );\\n\\\r\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\\r\n  vec2 i1;\\n\\\r\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n\\\r\n  vec4 x12 = x0.xyxy + C.xxzz;\\n\\\r\n  x12.xy -= i1;\\n\\\r\n  i = mod(i, 289.0);\\n\\\r\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\\n\\\r\n  + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\\r\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);\\n\\\r\n  m = m*m ;\\n\\\r\n  m = m*m ;\\n\\\r\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n\\\r\n  vec3 h = abs(x) - 0.5;\\n\\\r\n  vec3 ox = floor(x + 0.5);\\n\\\r\n  vec3 a0 = x - ox;\\n\\\r\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\\r\n  vec3 g;\\n\\\r\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n\\\r\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n\\\r\n  return 130.0 * dot(m, g);\\n\\\r\n}\\n\\\r\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\\n\\\r\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\\n\\\r\n\\n\\\r\nfloat snoise(vec3 v){ \\n\\\r\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n\\\r\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\\n\\\r\n\\n\\\r\n// First corner\\n\\\r\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n\\\r\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\\r\n\\n\\\r\n// Other corners\\n\\\r\n  vec3 g = step(x0.yzx, x0.xyz);\\n\\\r\n  vec3 l = 1.0 - g;\\n\\\r\n  vec3 i1 = min( g.xyz, l.zxy );\\n\\\r\n  vec3 i2 = max( g.xyz, l.zxy );\\n\\\r\n\\n\\\r\n  //  x0 = x0 - 0. + 0.0 * C \\n\\\r\n  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\\n\\\r\n  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\\n\\\r\n  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\\n\\\r\n\\n\\\r\n// Permutations\\n\\\r\n  i = mod(i, 289.0 ); \\n\\\r\n  vec4 p = permute( permute( permute( \\n\\\r\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n\\\r\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \\n\\\r\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\\r\n\\n\\\r\n// Gradients\\n\\\r\n// ( N*N points uniformly over a square, mapped onto an octahedron.)\\n\\\r\n  float n_ = 1.0/7.0; // N=7\\n\\\r\n  vec3  ns = n_ * D.wyz - D.xzx;\\n\\\r\n\\n\\\r\n  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\\n\\\r\n\\n\\\r\n  vec4 x_ = floor(j * ns.z);\\n\\\r\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\\r\n\\n\\\r\n  vec4 x = x_ *ns.x + ns.yyyy;\\n\\\r\n  vec4 y = y_ *ns.x + ns.yyyy;\\n\\\r\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\\r\n\\n\\\r\n  vec4 b0 = vec4( x.xy, y.xy );\\n\\\r\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\\r\n\\n\\\r\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n\\\r\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n\\\r\n  vec4 sh = -step(h, vec4(0.0));\\n\\\r\n\\n\\\r\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n\\\r\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\\r\n\\n\\\r\n  vec3 p0 = vec3(a0.xy,h.x);\\n\\\r\n  vec3 p1 = vec3(a0.zw,h.y);\\n\\\r\n  vec3 p2 = vec3(a1.xy,h.z);\\n\\\r\n  vec3 p3 = vec3(a1.zw,h.w);\\n\\\r\n\\n\\\r\n//Normalise gradients\\n\\\r\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n\\\r\n  p0 *= norm.x;\\n\\\r\n  p1 *= norm.y;\\n\\\r\n  p2 *= norm.z;\\n\\\r\n  p3 *= norm.w;\\n\\\r\n\\n\\\r\n// Mix final noise value\\n\\\r\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n\\\r\n  m = m * m;\\n\\\r\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );\\n\\\r\n}\\n\\\r\n\\n\\\r\nvec3 hash3( vec2 p ){\\n\\\r\n    vec3 q = vec3( dot(p,vec2(127.1,311.7)), \\n\\\r\n\t\t\t\t   dot(p,vec2(269.5,183.3)), \\n\\\r\n\t\t\t\t   dot(p,vec2(419.2,371.9)) );\\n\\\r\n\treturn fract(sin(q)*43758.5453);\\n\\\r\n}\\n\\\r\nvec4 hash4( vec3 p ){\\n\\\r\n    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), \\n\\\r\n\t\t\t\t   dot(p,vec3(269.5,183.3,335.1)), \\n\\\r\n\t\t\t\t   dot(p,vec3(314.5,235.1,467.3)), \\n\\\r\n\t\t\t\t   dot(p,vec3(419.2,371.9,114.9)) );\\n\\\r\n\treturn fract(sin(q)*43758.5453);\\n\\\r\n}\\n\\\r\n\\n\\\r\nfloat iqnoise( in vec2 x, float u, float v ){\\n\\\r\n    vec2 p = floor(x);\\n\\\r\n    vec2 f = fract(x);\\n\\\r\n\t\\n\\\r\n\tfloat k = 1.0+63.0*pow(1.0-v,4.0);\\n\\\r\n\t\\n\\\r\n\tfloat va = 0.0;\\n\\\r\n\tfloat wt = 0.0;\\n\\\r\n    for( int j=-2; j<=2; j++ )\\n\\\r\n    for( int i=-2; i<=2; i++ )\\n\\\r\n    {\\n\\\r\n        vec2 g = vec2( float(i),float(j) );\\n\\\r\n\t\tvec3 o = hash3( p + g )*vec3(u,u,1.0);\\n\\\r\n\t\tvec2 r = g - f + o.xy;\\n\\\r\n\t\tfloat d = dot(r,r);\\n\\\r\n\t\tfloat ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\\n\\\r\n\t\tva += o.z*ww;\\n\\\r\n\t\twt += ww;\\n\\\r\n    }\\n\\\r\n\t\\n\\\r\n    return va/wt;\\n\\\r\n}\\n\\\r\n\"\r\n\r\n\tfunction LGraphShaderTime()\r\n\t{\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t}\r\n\r\n\tLGraphShaderTime.title = \"Time\";\r\n\r\n\tLGraphShaderTime.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\r\n\t\tcontext.addUniform( \"u_time\" + this.id, \"float\", function(){ return getTime() * 0.001; });\r\n\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = u_time\" + this.id +\";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"float\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/time\", LGraphShaderTime );\r\n\r\n\r\n\tfunction LGraphShaderDither()\r\n\t{\r\n\t\tthis.addInput(\"in\",\"T\");\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t}\r\n\r\n\tLGraphShaderDither.title = \"Dither\";\r\n\r\n\tLGraphShaderDither.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar return_type = \"float\";\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tvar intype = this.getInputData(0);\r\n\t\tinlink = varToTypeGLSL( inlink, intype, \"float\" );\r\n\t\tcontext.addFunction(\"dither8x8\", LGraphShaderDither.dither_func);\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = dither8x8(\"+ inlink +\");\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tLGraphShaderDither.dither_values = [0.515625,0.140625,0.640625,0.046875,0.546875,0.171875,0.671875,0.765625,0.265625,0.890625,0.390625,0.796875,0.296875,0.921875,0.421875,0.203125,0.703125,0.078125,0.578125,0.234375,0.734375,0.109375,0.609375,0.953125,0.453125,0.828125,0.328125,0.984375,0.484375,0.859375,0.359375,0.0625,0.5625,0.1875,0.6875,0.03125,0.53125,0.15625,0.65625,0.8125,0.3125,0.9375,0.4375,0.78125,0.28125,0.90625,0.40625,0.25,0.75,0.125,0.625,0.21875,0.71875,0.09375,0.59375,1.0001,0.5,0.875,0.375,0.96875,0.46875,0.84375,0.34375];\r\n\t\r\n\tLGraphShaderDither.dither_func = \"\\n\\\r\n\t\tfloat dither8x8(float brightness) {\\n\\\r\n\t\t  vec2 position = vec2(0.0);\\n\\\r\n\t\t  #ifdef FRAGMENT\\n\\\r\n\t\t\tposition = gl_FragCoord.xy;\\n\\\r\n\t\t  #endif\\n\\\r\n\t\t  int x = int(mod(position.x, 8.0));\\n\\\r\n\t\t  int y = int(mod(position.y, 8.0));\\n\\\r\n\t\t  int index = x + y * 8;\\n\\\r\n\t\t  float limit = 0.0;\\n\\\r\n\t\t  if (x < 8) {\\n\\\r\n\t\t\tif(index==0) limit = 0.015625;\\n\\\r\n\t\t\t\"+(LGraphShaderDither.dither_values.map( function(v,i){ return \"else if(index== \"+(i+1)+\") limit = \" + v + \";\"}).join(\"\\n\"))+\"\\n\\\r\n\t\t  }\\n\\\r\n\t\t  return brightness < limit ? 0.0 : 1.0;\\n\\\r\n\t\t}\\n\",\r\n\r\n\tregisterShaderNode( \"math/dither\", LGraphShaderDither );\r\n\r\n\tfunction LGraphShaderRemap()\r\n\t{\r\n\t\tthis.addInput(\"\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"\",\"\");\r\n\t\tthis.properties = {\r\n\t\t\tmin_value: 0,\r\n\t\t\tmax_value: 1,\r\n\t\t\tmin_value2: 0,\r\n\t\t\tmax_value2: 1\r\n\t\t};\r\n\t\tthis.addWidget(\"number\",\"min\",0,{ step: 0.1, property: \"min_value\" });\r\n\t\tthis.addWidget(\"number\",\"max\",1,{ step: 0.1, property: \"max_value\" });\r\n\t\tthis.addWidget(\"number\",\"min2\",0,{ step: 0.1, property: \"min_value2\"});\r\n\t\tthis.addWidget(\"number\",\"max2\",1,{ step: 0.1, property: \"max_value2\"});\r\n\t}\r\n\r\n\tLGraphShaderRemap.title = \"Remap\";\r\n\r\n\tLGraphShaderRemap.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderRemap.prototype.onConnectionsChange = function()\r\n\t{\r\n\t\tvar return_type = this.getInputDataType(0);\r\n\t\tthis.outputs[0].type = return_type || \"T\";\r\n\t}\r\n\r\n\tLGraphShaderRemap.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!inlink && !outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar return_type = this.getInputDataType(0);\r\n\t\tthis.outputs[0].type = return_type;\r\n\t\tif(return_type == \"T\")\r\n\t\t{\r\n\t\t\tconsole.warn(\"node type is T and cannot be resolved\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(!inlink)\r\n\t\t{\r\n\t\t\tcontext.addCode(\"code\",\"\t\" + return_type + \" \" + outlink + \" = \" + return_type + \"(0.0);\\n\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar minv = valueToGLSL( this.properties.min_value );\r\n\t\tvar maxv = valueToGLSL( this.properties.max_value );\r\n\t\tvar minv2 = valueToGLSL( this.properties.min_value2 );\r\n\t\tvar maxv2 = valueToGLSL( this.properties.max_value2 );\r\n\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = ( (\" + inlink + \" - \"+minv+\") / (\"+ maxv+\" - \"+minv+\") ) * (\"+ maxv2+\" - \"+minv2+\") + \" + minv2 + \";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/remap\", LGraphShaderRemap );\r\n\r\n})(this);\r\n\r\n\r\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n\tvar view_matrix = new Float32Array(16);\r\n\tvar projection_matrix = new Float32Array(16);\r\n\tvar viewprojection_matrix = new Float32Array(16);\r\n\tvar model_matrix = new Float32Array(16);\r\n\tvar global_uniforms = {\r\n\t\tu_view: view_matrix,\r\n\t\tu_projection: projection_matrix,\r\n\t\tu_viewprojection: viewprojection_matrix,\r\n\t\tu_model: model_matrix \r\n\t};\r\n\r\n\tLiteGraph.LGraphRender = {\r\n\t\tonRequestCameraMatrices: null //overwrite with your 3D engine specifics, it will receive (view_matrix, projection_matrix,viewprojection_matrix) and must be filled\r\n\t};\r\n\r\n\tfunction generateGeometryId() {\r\n\t\treturn (Math.random() * 100000)|0;\r\n\t}\r\n\r\n\tfunction LGraphPoints3D() {\r\n\r\n\t\tthis.addInput(\"obj\", \"\");\r\n\t\tthis.addInput(\"radius\", \"number\");\r\n\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\t\tthis.addOutput(\"points\", \"[vec3]\");\r\n\t\tthis.properties = {\r\n\t\t\tradius: 1,\r\n\t\t\tnum_points: 4096,\r\n\t\t\tgenerate_normals: true,\r\n\t\t\tregular: false,\r\n\t\t\tmode: LGraphPoints3D.SPHERE,\r\n\t\t\tforce_update: false\r\n\t\t};\r\n\r\n\t\tthis.points = new Float32Array( this.properties.num_points * 3 );\r\n\t\tthis.normals = new Float32Array( this.properties.num_points * 3 );\r\n\t\tthis.must_update = true;\r\n\t\tthis.version = 0;\r\n\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"update\",null, function(){ that.must_update = true; });\r\n\r\n\t\tthis.geometry = {\r\n\t\t\tvertices: null,\r\n\t\t\t_id: generateGeometryId()\r\n\t\t}\r\n\r\n\t\tthis._old_obj = null;\r\n\t\tthis._last_radius = null;\r\n\t}\r\n\r\n\tglobal.LGraphPoints3D = LGraphPoints3D;\r\n\r\n\tLGraphPoints3D.RECTANGLE = 1;\r\n\tLGraphPoints3D.CIRCLE = 2;\r\n\r\n\tLGraphPoints3D.CUBE = 10;\r\n\tLGraphPoints3D.SPHERE = 11;\r\n\tLGraphPoints3D.HEMISPHERE = 12;\r\n\tLGraphPoints3D.INSIDE_SPHERE = 13;\r\n\r\n\tLGraphPoints3D.OBJECT = 20;\r\n\tLGraphPoints3D.OBJECT_UNIFORMLY = 21;\r\n\tLGraphPoints3D.OBJECT_INSIDE = 22;\r\n\r\n\tLGraphPoints3D.MODE_VALUES = { \"rectangle\":LGraphPoints3D.RECTANGLE, \"circle\":LGraphPoints3D.CIRCLE, \"cube\":LGraphPoints3D.CUBE, \"sphere\":LGraphPoints3D.SPHERE, \"hemisphere\":LGraphPoints3D.HEMISPHERE, \"inside_sphere\":LGraphPoints3D.INSIDE_SPHERE, \"object\":LGraphPoints3D.OBJECT, \"object_uniformly\":LGraphPoints3D.OBJECT_UNIFORMLY, \"object_inside\":LGraphPoints3D.OBJECT_INSIDE };\r\n\r\n\tLGraphPoints3D.widgets_info = {\r\n\t\tmode: { widget: \"combo\", values: LGraphPoints3D.MODE_VALUES }\r\n\t};\r\n\r\n\tLGraphPoints3D.title = \"list of points\";\r\n\tLGraphPoints3D.desc = \"returns an array of points\";\r\n\r\n\tLGraphPoints3D.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphPoints3D.prototype.onExecute = function() {\r\n\r\n\t\tvar obj = this.getInputData(0);\r\n\t\tif( obj != this._old_obj || (obj && obj._version != this._old_obj_version) )\r\n\t\t{\r\n\t\t\tthis._old_obj = obj;\r\n\t\t\tthis.must_update = true;\r\n\t\t}\r\n\r\n\t\tvar radius = this.getInputData(1);\r\n\t\tif(radius == null)\r\n\t\t\tradius = this.properties.radius;\r\n\t\tif( this._last_radius != radius )\r\n\t\t{\r\n\t\t\tthis._last_radius = radius;\r\n\t\t\tthis.must_update = true;\r\n\t\t}\r\n\r\n\t\tif(this.must_update || this.properties.force_update )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.updatePoints();\r\n\t\t}\r\n\r\n\t\tthis.geometry.vertices = this.points;\r\n\t\tthis.geometry.normals = this.normals;\r\n\t\tthis.geometry._version = this.version;\r\n\r\n\t\tthis.setOutputData( 0, this.geometry );\r\n\t}\r\n\r\n\tLGraphPoints3D.prototype.updatePoints = function() {\r\n\t\tvar num_points = this.properties.num_points|0;\r\n\t\tif(num_points < 1)\r\n\t\t\tnum_points = 1;\r\n\r\n\t\tif(!this.points || this.points.length != num_points * 3)\r\n\t\t\tthis.points = new Float32Array( num_points * 3 );\r\n\r\n\t\tif(this.properties.generate_normals)\r\n\t\t{\r\n\t\t\tif (!this.normals || this.normals.length != this.points.length)\r\n\t\t\t\tthis.normals = new Float32Array( this.points.length );\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.normals = null;\r\n\r\n\t\tvar radius = this._last_radius || this.properties.radius;\r\n\t\tvar mode = this.properties.mode;\r\n\r\n\t\tvar obj = this.getInputData(0);\r\n\t\tthis._old_obj_version = obj ? obj._version : null;\r\n\r\n\t\tthis.points = LGraphPoints3D.generatePoints( radius, num_points, mode, this.points, this.normals, this.properties.regular, obj );\r\n\r\n\t\tthis.version++;\r\n\t}\r\n\r\n\t//global\r\n\tLGraphPoints3D.generatePoints = function( radius, num_points, mode, points, normals, regular, obj )\r\n\t{\r\n\t\tvar size = num_points * 3;\r\n\t\tif(!points || points.length != size)\r\n\t\t\tpoints = new Float32Array( size );\r\n\t\tvar temp = new Float32Array(3);\r\n\t\tvar UP = new Float32Array([0,1,0]);\r\n\r\n\t\tif(regular)\r\n\t\t{\r\n\t\t\tif( mode == LGraphPoints3D.RECTANGLE)\r\n\t\t\t{\r\n\t\t\t\tvar side = Math.floor(Math.sqrt(num_points));\r\n\t\t\t\tfor(var i = 0; i < side; ++i)\r\n\t\t\t\tfor(var j = 0; j < side; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar pos = i*3 + j*3*side;\r\n\t\t\t\t\tpoints[pos] = ((i/side) - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[pos+1] = 0;\r\n\t\t\t\t\tpoints[pos+2] = ((j/side) - 0.5) * radius * 2;\r\n\t\t\t\t}\r\n\t\t\t\tpoints = new Float32Array( points.subarray(0,side*side*3) );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.SPHERE)\r\n\t\t\t{\r\n\t\t\t\tvar side = Math.floor(Math.sqrt(num_points));\r\n\t\t\t\tfor(var i = 0; i < side; ++i)\r\n\t\t\t\tfor(var j = 0; j < side; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar pos = i*3 + j*3*side;\r\n\t\t\t\t\tpolarToCartesian( temp, (i/side) * 2 * Math.PI, ((j/side) - 0.5) * 2 * Math.PI, radius );\r\n\t\t\t\t\tpoints[pos] = temp[0];\r\n\t\t\t\t\tpoints[pos+1] = temp[1];\r\n\t\t\t\t\tpoints[pos+2] = temp[2];\r\n\t\t\t\t}\r\n\t\t\t\tpoints = new Float32Array( points.subarray(0,side*side*3) );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.CIRCLE)\r\n\t\t\t{\r\n\t\t\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar angle = 2 * Math.PI * (i/size);\r\n\t\t\t\t\tpoints[i] = Math.cos( angle ) * radius;\r\n\t\t\t\t\tpoints[i+1] = 0;\r\n\t\t\t\t\tpoints[i+2] = Math.sin( angle ) * radius;\r\n\t\t\t\t}\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse //non regular\r\n\t\t{\r\n\t\t\tif( mode == LGraphPoints3D.RECTANGLE)\r\n\t\t\t{\r\n\t\t\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tpoints[i] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[i+1] = 0;\r\n\t\t\t\t\tpoints[i+2] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t}\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.CUBE)\r\n\t\t\t{\r\n\t\t\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tpoints[i] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[i+1] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[i+2] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t}\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.SPHERE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateSphere( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.HEMISPHERE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateHemisphere( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.CIRCLE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateInsideCircle( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.INSIDE_SPHERE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateInsideSphere( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.OBJECT)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateFromObject( points, normals, size, obj, false );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.OBJECT_UNIFORMLY)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateFromObject( points, normals, size, obj, true );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.OBJECT_INSIDE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateFromInsideObject( points, size, obj );\r\n\t\t\t\t//if(normals)\r\n\t\t\t\t//\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tconsole.warn(\"wrong mode in LGraphPoints3D\");\r\n\t\t}\r\n\r\n\t\treturn points;\r\n\t}\r\n\r\n\tLGraphPoints3D.generateSphericalNormals = function(points, normals)\r\n\t{\r\n\t\tvar temp = new Float32Array(3);\r\n\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t{\r\n\t\t\ttemp[0] = points[i];\r\n\t\t\ttemp[1] = points[i+1];\r\n\t\t\ttemp[2] = points[i+2];\r\n\t\t\tvec3.normalize(temp,temp);\r\n\t\t\tnormals.set(temp,i);\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateSphere = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r1 = Math.random();\r\n\t\t\tvar r2 = Math.random();\r\n\t\t\tvar x = 2 * Math.cos( 2 * Math.PI * r1 ) * Math.sqrt( r2 * (1-r2) );\r\n\t\t\tvar y = 1 - 2 * r2;\r\n\t\t\tvar z = 2 * Math.sin( 2 * Math.PI * r1 ) * Math.sqrt( r2 * (1-r2) );\r\n\t\t\tpoints[i] = x * radius;\r\n\t\t\tpoints[i+1] = y * radius;\r\n\t\t\tpoints[i+2] = z * radius;\r\n\t\t}\t\t\t\r\n\t}\r\n\r\n\tLGraphPoints3D.generateHemisphere = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r1 = Math.random();\r\n\t\t\tvar r2 = Math.random();\r\n\t\t\tvar x = Math.cos( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tvar y = r2;\r\n\t\t\tvar z = Math.sin( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tpoints[i] = x * radius;\r\n\t\t\tpoints[i+1] = y * radius;\r\n\t\t\tpoints[i+2] = z * radius;\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateInsideCircle = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r1 = Math.random();\r\n\t\t\tvar r2 = Math.random();\r\n\t\t\tvar x = Math.cos( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tvar y = r2;\r\n\t\t\tvar z = Math.sin( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tpoints[i] = x * radius;\r\n\t\t\tpoints[i+1] = 0;\r\n\t\t\tpoints[i+2] = z * radius;\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateInsideSphere = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar u = Math.random();\r\n\t\t\tvar v = Math.random();\r\n\t\t\tvar theta = u * 2.0 * Math.PI;\r\n\t\t\tvar phi = Math.acos(2.0 * v - 1.0);\r\n\t\t\tvar r = Math.cbrt(Math.random()) * radius;\r\n\t\t\tvar sinTheta = Math.sin(theta);\r\n\t\t\tvar cosTheta = Math.cos(theta);\r\n\t\t\tvar sinPhi = Math.sin(phi);\r\n\t\t\tvar cosPhi = Math.cos(phi);\r\n\t\t\tpoints[i] = r * sinPhi * cosTheta;\r\n\t\t\tpoints[i+1] = r * sinPhi * sinTheta;\r\n\t\t\tpoints[i+2] = r * cosPhi;\r\n\t\t}\t\r\n\t}\r\n\r\n\tfunction findRandomTriangle( areas, f )\r\n\t{\r\n\t\tvar l = areas.length;\r\n\t\tvar imin = 0;\r\n\t\tvar imid = 0;\r\n\t\tvar imax = l;\r\n\r\n\t\tif(l == 0)\r\n\t\t\treturn -1;\r\n\t\tif(l == 1)\r\n\t\t\treturn 0;\r\n\t\t//dichotomic search\r\n\t\twhile (imax >= imin)\r\n\t\t{\r\n\t\t\timid = ((imax + imin)*0.5)|0;\r\n\t\t\tvar t = areas[ imid ];\r\n\t\t\tif( t == f )\r\n\t\t\t\treturn imid; \r\n\t\t\tif( imin == (imax - 1) )\r\n\t\t\t\treturn imin;\r\n\t\t\tif (t < f)\r\n\t\t\t\timin = imid;\r\n\t\t\telse         \r\n\t\t\t\timax = imid;\r\n\t\t}\r\n\t\treturn imid;\t\t\r\n\t}\r\n\r\n\tLGraphPoints3D.generateFromObject = function( points, normals, size, obj, evenly )\r\n\t{\r\n\t\tif(!obj)\r\n\t\t\treturn;\r\n\r\n\t\tvar vertices = null;\r\n\t\tvar mesh_normals = null;\r\n\t\tvar indices = null;\r\n\t\tvar areas = null;\r\n\t\tif( obj.constructor === GL.Mesh )\r\n\t\t{\r\n\t\t\tvertices = obj.vertexBuffers.vertices.data;\r\n\t\t\tmesh_normals = obj.vertexBuffers.normals ? obj.vertexBuffers.normals.data : null;\r\n\t\t\tindices = obj.indexBuffers.indices ? obj.indexBuffers.indices.data : null;\r\n\t\t\tif(!indices)\r\n\t\t\t\tindices = obj.indexBuffers.triangles ? obj.indexBuffers.triangles.data : null;\r\n\t\t}\r\n\t\tif(!vertices)\r\n\t\t\treturn null;\r\n\t\tvar num_triangles = indices ? indices.length / 3 : vertices.length / (3*3);\r\n\t\tvar total_area = 0; //sum of areas of all triangles\r\n\r\n\t\tif(evenly)\r\n\t\t{\r\n\t\t\tareas = new Float32Array(num_triangles); //accum\r\n\t\t\tfor(var i = 0; i < num_triangles; ++i)\r\n\t\t\t{\r\n\t\t\t\tif(indices)\r\n\t\t\t\t{\r\n\t\t\t\t\ta = indices[i*3]*3;\r\n\t\t\t\t\tb = indices[i*3+1]*3;\r\n\t\t\t\t\tc = indices[i*3+2]*3;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ta = i*9;\r\n\t\t\t\t\tb = i*9+3;\r\n\t\t\t\t\tc = i*9+6;\r\n\t\t\t\t}\r\n\t\t\t\tvar P1 = vertices.subarray(a,a+3);\r\n\t\t\t\tvar P2 = vertices.subarray(b,b+3);\r\n\t\t\t\tvar P3 = vertices.subarray(c,c+3);\r\n\t\t\t\tvar aL = vec3.distance( P1, P2 );\r\n\t\t\t\tvar bL = vec3.distance( P2, P3 );\r\n\t\t\t\tvar cL = vec3.distance( P3, P1 );\r\n\t\t\t\tvar s = (aL + bL+ cL) / 2;\r\n\t\t\t\ttotal_area += Math.sqrt(s * (s - aL) * (s - bL) * (s - cL));\r\n\t\t\t\tareas[i] = total_area;\r\n\t\t\t}\t\t\t\r\n\t\t\tfor(var i = 0; i < num_triangles; ++i) //normalize\r\n\t\t\t\tareas[i] /= total_area;\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r = Math.random();\r\n\t\t\tvar index = evenly ? findRandomTriangle( areas, r ) : Math.floor(r * num_triangles );\r\n\t\t\t//get random triangle\r\n\t\t\tvar a = 0;\r\n\t\t\tvar b = 0;\r\n\t\t\tvar c = 0;\r\n\t\t\tif(indices)\r\n\t\t\t{\r\n\t\t\t\ta = indices[index*3]*3;\r\n\t\t\t\tb = indices[index*3+1]*3;\r\n\t\t\t\tc = indices[index*3+2]*3;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ta = index*9;\r\n\t\t\t\tb = index*9+3;\r\n\t\t\t\tc = index*9+6;\r\n\t\t\t}\r\n\t\t\tvar s = Math.random();\r\n\t\t\tvar t = Math.random();\r\n\t\t\tvar sqrt_s = Math.sqrt(s);\r\n\t\t\tvar af = 1 - sqrt_s;\r\n\t\t\tvar bf = sqrt_s * ( 1 - t);\r\n\t\t\tvar cf = t * sqrt_s;\r\n\t\t\tpoints[i] = af * vertices[a] + bf*vertices[b] + cf*vertices[c];\r\n\t\t\tpoints[i+1] = af * vertices[a+1] + bf*vertices[b+1] + cf*vertices[c+1];\r\n\t\t\tpoints[i+2] = af * vertices[a+2] + bf*vertices[b+2] + cf*vertices[c+2];\r\n\t\t\tif(normals && mesh_normals)\r\n\t\t\t{\r\n\t\t\t\tnormals[i] = af * mesh_normals[a] + bf*mesh_normals[b] + cf*mesh_normals[c];\r\n\t\t\t\tnormals[i+1] = af * mesh_normals[a+1] + bf*mesh_normals[b+1] + cf*mesh_normals[c+1];\r\n\t\t\t\tnormals[i+2] = af * mesh_normals[a+2] + bf*mesh_normals[b+2] + cf*mesh_normals[c+2];\r\n\t\t\t\tvar N = normals.subarray(i,i+3);\r\n\t\t\t\tvec3.normalize(N,N);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateFromInsideObject = function( points, size, mesh )\r\n\t{\r\n\t\tif(!mesh || mesh.constructor !== GL.Mesh)\r\n\t\t\treturn;\r\n\r\n\t\tvar aabb = mesh.getBoundingBox();\r\n\t\tif(!mesh.octree)\r\n\t\t\tmesh.octree = new GL.Octree( mesh );\r\n\t\tvar octree = mesh.octree;\r\n\t\tvar origin = vec3.create();\r\n\t\tvar direction = vec3.fromValues(1,0,0);\r\n\t\tvar temp = vec3.create();\r\n\t\tvar i = 0;\r\n\t\tvar tries = 0;\r\n\t\twhile(i < size && tries < points.length * 10) //limit to avoid problems\r\n\t\t{\r\n\t\t\ttries += 1\r\n\t\t\tvar r = vec3.random(temp); //random point inside the aabb\r\n\t\t\tr[0] = (r[0] * 2 - 1) * aabb[3] + aabb[0];\r\n\t\t\tr[1] = (r[1] * 2 - 1) * aabb[4] + aabb[1];\r\n\t\t\tr[2] = (r[2] * 2 - 1) * aabb[5] + aabb[2];\r\n\t\t\torigin.set(r);\r\n\t\t\tvar hit = octree.testRay( origin, direction, 0, 10000, true, GL.Octree.ALL );\r\n\t\t\tif(!hit || hit.length % 2 == 0) //not inside\r\n\t\t\t\tcontinue;\r\n\t\t\tpoints.set( r, i );\r\n\t\t\ti+=3;\r\n\t\t}\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/points3D\", LGraphPoints3D );\r\n\r\n\r\n\r\n\tfunction LGraphPointsToInstances() {\r\n\t\tthis.addInput(\"points\", \"geometry\");\r\n\t\tthis.addOutput(\"instances\", \"[mat4]\");\r\n\t\tthis.properties = {\r\n\t\t\tmode: 1,\r\n\t\t\tautoupdate: true\r\n\t\t};\r\n\r\n\t\tthis.must_update = true;\r\n\t\tthis.matrices = [];\r\n\t\tthis.first_time = true;\r\n\t}\r\n\r\n\tLGraphPointsToInstances.NORMAL = 0;\r\n\tLGraphPointsToInstances.VERTICAL = 1;\r\n\tLGraphPointsToInstances.SPHERICAL = 2;\r\n\tLGraphPointsToInstances.RANDOM = 3;\r\n\tLGraphPointsToInstances.RANDOM_VERTICAL = 4;\r\n\r\n\tLGraphPointsToInstances.modes = {\"normal\":0,\"vertical\":1,\"spherical\":2,\"random\":3,\"random_vertical\":4};\r\n\tLGraphPointsToInstances.widgets_info = {\r\n\t\tmode: { widget: \"combo\", values: LGraphPointsToInstances.modes }\r\n\t};\r\n\r\n\tLGraphPointsToInstances.title = \"points to inst\";\r\n\r\n\tLGraphPointsToInstances.prototype.onExecute = function()\r\n\t{\r\n\t\tvar geo = this.getInputData(0);\r\n\t\tif( !geo )\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tvar has_changed = (geo._version != this._version || geo._id != this._geometry_id);\r\n\r\n\t\tif( has_changed && this.properties.autoupdate || this.first_time )\r\n\t\t{\r\n\t\t\tthis.first_time = false;\r\n\t\t\tthis.updateInstances( geo );\r\n\t\t}\r\n\r\n\t\tthis.setOutputData( 0, this.matrices );\r\n\t}\r\n\r\n\tLGraphPointsToInstances.prototype.updateInstances = function( geometry )\r\n\t{\r\n\t\tvar vertices = geometry.vertices;\r\n\t\tif(!vertices)\r\n\t\t\treturn null;\r\n\t\tvar normals = geometry.normals;\r\n\r\n\t\tvar matrices = this.matrices;\r\n\t\tvar num_points = vertices.length / 3;\r\n\t\tif( matrices.length != num_points)\r\n\t\t\tmatrices.length = num_points;\r\n\t\tvar identity = mat4.create();\r\n\t\tvar temp = vec3.create();\r\n\t\tvar zero = vec3.create();\r\n\t\tvar UP = vec3.fromValues(0,1,0);\r\n\t\tvar FRONT = vec3.fromValues(0,0,-1);\r\n\t\tvar RIGHT = vec3.fromValues(1,0,0);\r\n\t\tvar R = quat.create();\r\n\r\n\t\tvar front = vec3.create();\r\n\t\tvar right = vec3.create();\r\n\t\tvar top = vec3.create();\r\n\r\n\t\tfor(var i = 0; i < vertices.length; i += 3)\r\n\t\t{\r\n\t\t\tvar index = i/3;\r\n\t\t\tvar m = matrices[index];\r\n\t\t\tif(!m)\r\n\t\t\t\tm = matrices[index] = mat4.create();\r\n\t\t\tm.set( identity );\r\n\t\t\tvar point = vertices.subarray(i,i+3);\r\n\r\n\t\t\tswitch(this.properties.mode)\r\n\t\t\t{\r\n\t\t\t\tcase LGraphPointsToInstances.NORMAL: \r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tif(normals)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar normal = normals.subarray(i,i+3);\r\n\t\t\t\t\t\ttop.set( normal );\r\n\t\t\t\t\t\tvec3.normalize( top, top );\r\n\t\t\t\t\t\tvec3.cross( right, FRONT, top );\r\n\t\t\t\t\t\tvec3.normalize( right, right );\r\n\t\t\t\t\t\tvec3.cross( front, right, top );\r\n\t\t\t\t\t\tvec3.normalize( front, front );\r\n\t\t\t\t\t\tm.set(right,0);\r\n\t\t\t\t\t\tm.set(top,4);\r\n\t\t\t\t\t\tm.set(front,8);\r\n\t\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.VERTICAL: \r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.SPHERICAL: \r\n\t\t\t\t\tfront.set( point );\r\n\t\t\t\t\tvec3.normalize( front, front );\r\n\t\t\t\t\tvec3.cross( right, UP, front );\r\n\t\t\t\t\tvec3.normalize( right, right );\r\n\t\t\t\t\tvec3.cross( top, front, right );\r\n\t\t\t\t\tvec3.normalize( top, top );\r\n\t\t\t\t\tm.set(right,0);\r\n\t\t\t\t\tm.set(top,4);\r\n\t\t\t\t\tm.set(front,8);\r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.RANDOM:\r\n\t\t\t\t\ttemp[0] = Math.random()*2 - 1;\r\n\t\t\t\t\ttemp[1] = Math.random()*2 - 1;\r\n\t\t\t\t\ttemp[2] = Math.random()*2 - 1;\r\n\t\t\t\t\tvec3.normalize( temp, temp );\r\n\t\t\t\t\tquat.setAxisAngle( R, temp, Math.random() * 2 * Math.PI );\r\n\t\t\t\t\tmat4.fromQuat(m, R);\r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.RANDOM_VERTICAL:\r\n\t\t\t\t\tquat.setAxisAngle( R, UP, Math.random() * 2 * Math.PI );\r\n\t\t\t\t\tmat4.fromQuat(m, R);\r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._version = geometry._version;\r\n\t\tthis._geometry_id = geometry._id;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/points_to_instances\", LGraphPointsToInstances );\r\n\r\n\r\n\tfunction LGraphGeometryTransform() {\r\n\t\tthis.addInput(\"in\", \"geometry,[mat4]\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\t\tthis.properties = {};\r\n\r\n\t\tthis.geometry = {\r\n\t\t\ttype: \"triangles\",\r\n\t\t\tvertices: null,\r\n\t\t\t_id: generateGeometryId(),\r\n\t\t\t_version: 0\r\n\t\t};\r\n\r\n\t\tthis._last_geometry_id = -1;\r\n\t\tthis._last_version = -1;\r\n\t\tthis._last_key = \"\";\r\n\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphGeometryTransform.title = \"Transform\";\r\n\r\n\tLGraphGeometryTransform.prototype.onExecute = function() {\r\n\r\n\t\tvar input = this.getInputData(0);\r\n\t\tvar model = this.getInputData(1);\r\n\r\n\t\tif(!input)\r\n\t\t\treturn;\r\n\r\n\t\t//array of matrices\r\n\t\tif(input.constructor === Array)\r\n\t\t{\r\n\t\t\tif(input.length == 0)\r\n\t\t\t\treturn;\r\n\t\t\tthis.outputs[0].type = \"[mat4]\";\r\n\t\t\tif( !this.isOutputConnected(0) )\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(!model)\r\n\t\t\t{\r\n\t\t\t\tthis.setOutputData(0,input);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!this._output)\r\n\t\t\t\tthis._output = new Array();\r\n\t\t\tif(this._output.length != input.length)\r\n\t\t\t\tthis._output.length = input.length;\r\n\t\t\tfor(var i = 0; i < input.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar m = this._output[i];\r\n\t\t\t\tif(!m)\r\n\t\t\t\t\tm = this._output[i] = mat4.create();\r\n\t\t\t\tmat4.multiply(m,input[i],model);\r\n\t\t\t}\r\n\t\t\tthis.setOutputData(0,this._output);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//geometry\r\n\t\tif(!input.vertices || !input.vertices.length)\r\n\t\t\treturn;\r\n\t\tvar geo = input;\r\n\t\tthis.outputs[0].type = \"geometry\";\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\t\tif(!model)\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,geo);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar key = typedArrayToArray(model).join(\",\");\r\n\r\n\t\tif( this.must_update || geo._id != this._last_geometry_id || geo._version != this._last_version || key != this._last_key )\r\n\t\t{\r\n\t\t\tthis.updateGeometry(geo, model);\r\n\t\t\tthis._last_key = key;\r\n\t\t\tthis._last_version = geo._version;\r\n\t\t\tthis._last_geometry_id = geo._id;\r\n\t\t\tthis.must_update = false;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLGraphGeometryTransform.prototype.updateGeometry = function(geometry, model) {\r\n\t\tvar old_vertices = geometry.vertices;\r\n\t\tvar vertices = this.geometry.vertices;\r\n\t\tif( !vertices || vertices.length != old_vertices.length )\r\n\t\t\tvertices = this.geometry.vertices = new Float32Array( old_vertices.length );\r\n\t\tvar temp = vec3.create();\r\n\r\n\t\tfor(var i = 0, l = vertices.length; i < l; i+=3)\r\n\t\t{\r\n\t\t\ttemp[0] = old_vertices[i]; temp[1] = old_vertices[i+1]; temp[2] = old_vertices[i+2]; \r\n\t\t\tmat4.multiplyVec3( temp, model, temp );\r\n\t\t\tvertices[i] = temp[0]; vertices[i+1] = temp[1]; vertices[i+2] = temp[2];\r\n\t\t}\r\n\r\n\t\tif(geometry.normals)\r\n\t\t{\r\n\t\t\tif( !this.geometry.normals || this.geometry.normals.length != geometry.normals.length )\r\n\t\t\t\tthis.geometry.normals = new Float32Array( geometry.normals.length );\r\n\t\t\tvar normals = this.geometry.normals;\r\n\t\t\tvar normal_model = mat4.invert(mat4.create(), model);\r\n\t\t\tif(normal_model)\r\n\t\t\t\tmat4.transpose(normal_model, normal_model);\r\n\t\t\tvar old_normals = geometry.normals;\r\n\t\t\tfor(var i = 0, l = normals.length; i < l; i+=3)\r\n\t\t\t{\r\n\t\t\t\ttemp[0] = old_normals[i]; temp[1] = old_normals[i+1]; temp[2] = old_normals[i+2]; \r\n\t\t\t\tmat4.multiplyVec3( temp, normal_model, temp );\r\n\t\t\t\tnormals[i] = temp[0]; normals[i+1] = temp[1]; normals[i+2] = temp[2];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.geometry.type = geometry.type;\r\n\t\tthis.geometry._version++;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/transform\", LGraphGeometryTransform );\r\n\r\n\r\n\tfunction LGraphGeometryPolygon() {\r\n\t\tthis.addInput(\"sides\", \"number\");\r\n\t\tthis.addInput(\"radius\", \"number\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\t\tthis.properties = { sides: 6, radius: 1, uvs: false }\r\n\r\n\t\tthis.geometry = {\r\n\t\t\ttype: \"line_loop\",\r\n\t\t\tvertices: null,\r\n\t\t\t_id: generateGeometryId()\r\n\t\t};\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.must_update = true;\r\n\r\n\t\tthis.last_info = { sides: -1, radius: -1 };\r\n\t}\r\n\r\n\tLGraphGeometryPolygon.title = \"Polygon\";\r\n\r\n\tLGraphGeometryPolygon.prototype.onExecute = function() {\r\n\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tvar sides = this.getInputOrProperty(\"sides\");\r\n\t\tvar radius = this.getInputOrProperty(\"radius\");\r\n\t\tsides = Math.max(3,sides)|0;\r\n\r\n\t\t//update\r\n\t\tif( this.last_info.sides != sides || this.last_info.radius != radius )\r\n\t\t\tthis.updateGeometry(sides, radius);\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLGraphGeometryPolygon.prototype.updateGeometry = function(sides, radius) {\r\n\t\tvar num = 3*sides;\r\n\t\tvar vertices = this.geometry.vertices;\r\n\t\tif( !vertices || vertices.length != num )\r\n\t\t\tvertices = this.geometry.vertices = new Float32Array( 3*sides );\r\n\t\tvar delta = (Math.PI * 2) / sides;\r\n\t\tvar gen_uvs = this.properties.uvs;\r\n\t\tif(gen_uvs)\r\n\t\t{\r\n\t\t\tuvs = this.geometry.coords = new Float32Array( 3*sides );\r\n\t\t}\r\n\r\n\r\n\t\tfor(var i = 0; i < sides; ++i)\r\n\t\t{\r\n\t\t\tvar angle = delta * -i;\r\n\t\t\tvar x = Math.cos( angle ) * radius;\r\n\t\t\tvar y = 0;\r\n\t\t\tvar z = Math.sin( angle ) * radius;\r\n\t\t\tvertices[i*3] = x;\r\n\t\t\tvertices[i*3+1] = y;\r\n\t\t\tvertices[i*3+2] = z;\r\n\r\n\t\t\tif(gen_uvs)\r\n\t\t\t{\r\n\t\t\t\t\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.geometry._id = ++this.geometry_id;\r\n\t\tthis.geometry._version = ++this.version;\r\n\t\tthis.last_info.sides = sides;\r\n\t\tthis.last_info.radius = radius;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/polygon\", LGraphGeometryPolygon );\r\n\r\n\r\n\tfunction LGraphGeometryExtrude() {\r\n\r\n\t\tthis.addInput(\"\", \"geometry\");\r\n\t\tthis.addOutput(\"\", \"geometry\");\r\n\t\tthis.properties = { top_cap: true, bottom_cap: true, offset: [0,100,0] };\r\n\t\tthis.version = -1;\r\n\r\n\t\tthis._last_geo_version = -1;\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tLGraphGeometryExtrude.title = \"extrude\";\r\n\r\n\tLGraphGeometryExtrude.prototype.onPropertyChanged = function(name, value)\r\n\t{\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tLGraphGeometryExtrude.prototype.onExecute = function()\r\n\t{\r\n\t\tvar geo = this.getInputData(0);\r\n\t\tif( !geo || !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tif(geo.version != this._last_geo_version || this._must_update)\r\n\t\t{\r\n\t\t\tthis._geo = this.extrudeGeometry( geo, this._geo );\r\n\t\t\tif(this._geo)\r\n\t\t\t\tthis._geo.version = this.version++;\r\n\t\t\tthis._must_update = false;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0, this._geo);\r\n\t}\r\n\r\n\tLGraphGeometryExtrude.prototype.extrudeGeometry = function( geo )\r\n\t{\r\n\t\t//for every pair of vertices\r\n\t\tvar vertices = geo.vertices;\r\n\t\tvar num_points = vertices.length / 3;\r\n\r\n\t\tvar tempA = vec3.create();\r\n\t\tvar tempB = vec3.create();\r\n\t\tvar tempC = vec3.create();\r\n\t\tvar tempD = vec3.create();\r\n\t\tvar offset = new Float32Array( this.properties.offset );\r\n\r\n\t\tif(geo.type == \"line_loop\")\r\n\t\t{\r\n\t\t\tvar new_vertices = new Float32Array( num_points * 6 * 3 ); //every points become 6 ( caps not included )\r\n\t\t\tvar npos = 0;\r\n\t\t\tfor(var i = 0, l = vertices.length; i < l; i += 3)\r\n\t\t\t{\r\n\t\t\t\ttempA[0] = vertices[i]; tempA[1] = vertices[i+1]; tempA[2] = vertices[i+2];\r\n\r\n\t\t\t\tif( i+3 < l ) //loop\r\n\t\t\t\t{\r\n\t\t\t\t\ttempB[0] = vertices[i+3]; tempB[1] = vertices[i+4]; tempB[2] = vertices[i+5];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ttempB[0] = vertices[0]; tempB[1] = vertices[1]; tempB[2] = vertices[2];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvec3.add( tempC, tempA, offset );\r\n\t\t\t\tvec3.add( tempD, tempB, offset );\r\n\r\n\t\t\t\tnew_vertices.set( tempA, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempB, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempC, npos ); npos += 3;\r\n\r\n\t\t\t\tnew_vertices.set( tempB, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempD, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempC, npos ); npos += 3;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar out_geo = {\r\n\t\t\t_id: generateGeometryId(),\r\n\t\t\ttype: \"triangles\",\r\n\t\t\tvertices: new_vertices\r\n\t\t};\r\n\r\n\t\treturn out_geo;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/extrude\", LGraphGeometryExtrude );\r\n\r\n\r\n\tfunction LGraphGeometryEval() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tcode: \"V[1] += 0.01 * Math.sin(I + T*0.001);\",\r\n\t\t\texecute_every_frame: false\r\n\t\t};\r\n\r\n\t\tthis.geometry = null;\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.must_update = true;\r\n\r\n\t\tthis.vertices = null;\r\n\t\tthis.func = null;\r\n\t}\r\n\r\n\tLGraphGeometryEval.title = \"geoeval\";\r\n\tLGraphGeometryEval.desc = \"eval code\";\r\n\r\n\tLGraphGeometryEval.widgets_info = {\r\n\t\tcode: { widget: \"code\" }\r\n\t};\r\n\r\n\tLGraphGeometryEval.prototype.onConfigure = function(o)\r\n\t{\r\n\t\tthis.compileCode();\r\n\t}\r\n\r\n\tLGraphGeometryEval.prototype.compileCode = function()\r\n\t{\r\n\t\tif(!this.properties.code)\r\n\t\t\treturn;\r\n\r\n\t\ttry\r\n\t\t{\r\n\t\t\tthis.func = new Function(\"V\",\"I\",\"T\", this.properties.code); \r\n\t\t\tthis.boxcolor = \"#AFA\";\r\n\t\t\tthis.must_update = true;\r\n\t\t}\r\n\t\tcatch (err)\r\n\t\t{\r\n\t\t\tthis.boxcolor = \"red\";\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphGeometryEval.prototype.onPropertyChanged = function(name, value)\r\n\t{\r\n\t\tif(name == \"code\")\r\n\t\t{\r\n\t\t\tthis.properties.code = value;\r\n\t\t\tthis.compileCode();\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphGeometryEval.prototype.onExecute = function() {\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this.func)\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,geometry);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif( this.geometry_id != geometry._id || this.version != geometry._version || this.must_update || this.properties.execute_every_frame )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.geometry_id = geometry._id;\r\n\t\t\tif(this.properties.execute_every_frame)\r\n\t\t\t\tthis.version++;\r\n\t\t\telse\r\n\t\t\t\tthis.version = geometry._version;\r\n\t\t\tvar func = this.func;\r\n\t\t\tvar T = getTime();\r\n\r\n\t\t\t//clone\r\n\t\t\tif(!this.geometry)\r\n\t\t\t\tthis.geometry = {};\r\n\t\t\tfor(var i in geometry)\r\n\t\t\t{\r\n\t\t\t\tif(geometry[i] == null)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tif( geometry[i].constructor == Float32Array )\r\n\t\t\t\t\tthis.geometry[i] = new Float32Array( geometry[i] );\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.geometry[i] = geometry[i];\r\n\t\t\t}\r\n\t\t\tthis.geometry._id = geometry._id;\r\n\t\t\tif(this.properties.execute_every_frame)\r\n\t\t\t\tthis.geometry._version = this.version;\r\n\t\t\telse\r\n\t\t\t\tthis.geometry._version = geometry._version + 1;\r\n\r\n\t\t\tvar V = vec3.create();\r\n\t\t\tvar vertices = this.vertices;\r\n\t\t\tif(!vertices || this.vertices.length != geometry.vertices.length)\r\n\t\t\t\tvertices = this.vertices = new Float32Array( geometry.vertices );\r\n\t\t\telse\r\n\t\t\t\tvertices.set( geometry.vertices );\r\n\t\t\tfor(var i = 0; i < vertices.length; i+=3)\r\n\t\t\t{\r\n\t\t\t\tV[0] = vertices[i];\r\n\t\t\t\tV[1] = vertices[i+1];\r\n\t\t\t\tV[2] = vertices[i+2];\r\n\t\t\t\tfunc(V,i/3,T);\r\n\t\t\t\tvertices[i] = V[0];\r\n\t\t\t\tvertices[i+1] = V[1];\r\n\t\t\t\tvertices[i+2] = V[2];\r\n\t\t\t}\r\n\t\t\tthis.geometry.vertices = vertices;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/eval\", LGraphGeometryEval );\r\n\r\n/*\r\nfunction LGraphGeometryDisplace() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addInput(\"img\", \"image\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tgrid_size: 1\r\n\t\t};\r\n\r\n\t\tthis.geometry = null;\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.must_update = true;\r\n\r\n\t\tthis.vertices = null;\r\n\t}\r\n\r\n\tLGraphGeometryDisplace.title = \"displace\";\r\n\tLGraphGeometryDisplace.desc = \"displace points\";\r\n\r\n\tLGraphGeometryDisplace.prototype.onExecute = function() {\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tvar image = this.getInputData(1);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\r\n\t\tif(!image)\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,geometry);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif( this.geometry_id != geometry._id || this.version != geometry._version || this.must_update )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.geometry_id = geometry._id;\r\n\t\t\tthis.version = geometry._version;\r\n\r\n\t\t\t//copy\r\n\t\t\tthis.geometry = {};\r\n\t\t\tfor(var i in geometry)\r\n\t\t\t\tthis.geometry[i] = geometry[i];\r\n\t\t\tthis.geometry._id = geometry._id;\r\n\t\t\tthis.geometry._version = geometry._version + 1;\r\n\r\n\t\t\tvar grid_size = this.properties.grid_size;\r\n\t\t\tif(grid_size != 0)\r\n\t\t\t{\r\n\t\t\t\tvar vertices = this.vertices;\r\n\t\t\t\tif(!vertices || this.vertices.length != this.geometry.vertices.length)\r\n\t\t\t\t\tvertices = this.vertices = new Float32Array( this.geometry.vertices );\r\n\t\t\t\tfor(var i = 0; i < vertices.length; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tvertices[i] = Math.round(vertices[i]/grid_size) * grid_size;\r\n\t\t\t\t\tvertices[i+1] = Math.round(vertices[i+1]/grid_size) * grid_size;\r\n\t\t\t\t\tvertices[i+2] = Math.round(vertices[i+2]/grid_size) * grid_size;\r\n\t\t\t\t}\r\n\t\t\t\tthis.geometry.vertices = vertices;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/displace\", LGraphGeometryDisplace );\r\n*/\r\n\r\n\tfunction LGraphConnectPoints() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tmin_dist: 0.4,\r\n\t\t\tmax_dist: 0.5,\r\n\t\t\tmax_connections: 0,\r\n\t\t\tprobability: 1\r\n\t\t};\r\n\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.my_version = 1;\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphConnectPoints.title = \"connect points\";\r\n\tLGraphConnectPoints.desc = \"adds indices between near points\";\r\n\r\n\tLGraphConnectPoints.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphConnectPoints.prototype.onExecute = function() {\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\r\n\t\tif( this.geometry_id != geometry._id || this.version != geometry._version || this.must_update )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.geometry_id = geometry._id;\r\n\t\t\tthis.version = geometry._version;\r\n\r\n\t\t\t//copy\r\n\t\t\tthis.geometry = {};\r\n\t\t\tfor(var i in geometry)\r\n\t\t\t\tthis.geometry[i] = geometry[i];\r\n\t\t\tthis.geometry._id = generateGeometryId();\r\n\t\t\tthis.geometry._version = this.my_version++;\r\n\r\n\t\t\tvar vertices = geometry.vertices;\r\n\t\t\tvar l = vertices.length;\r\n\t\t\tvar min_dist = this.properties.min_dist;\r\n\t\t\tvar max_dist = this.properties.max_dist;\r\n\t\t\tvar probability = this.properties.probability;\r\n\t\t\tvar max_connections = this.properties.max_connections;\r\n\t\t\tvar indices = [];\r\n\t\t\t\r\n\t\t\tfor(var i = 0; i < l; i+=3)\r\n\t\t\t{\r\n\t\t\t\tvar x = vertices[i];\r\n\t\t\t\tvar y = vertices[i+1];\r\n\t\t\t\tvar z = vertices[i+2];\r\n\t\t\t\tvar connections = 0;\r\n\t\t\t\tfor(var j = i+3; j < l; j+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar x2 = vertices[j];\r\n\t\t\t\t\tvar y2 = vertices[j+1];\r\n\t\t\t\t\tvar z2 = vertices[j+2];\r\n\t\t\t\t\tvar dist = Math.sqrt( (x-x2)*(x-x2) + (y-y2)*(y-y2) + (z-z2)*(z-z2));\r\n\t\t\t\t\tif(dist > max_dist || dist < min_dist || (probability < 1 && probability < Math.random()) )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tindices.push(i/3,j/3);\r\n\t\t\t\t\tconnections += 1;\r\n\t\t\t\t\tif(max_connections && connections > max_connections)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.geometry.indices = this.indices = new Uint32Array(indices);\r\n\t\t}\r\n\r\n\t\tif(this.indices && this.indices.length)\r\n\t\t{\r\n\t\t\tthis.geometry.indices = this.indices;\r\n\t\t\tthis.setOutputData( 0, this.geometry );\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.setOutputData( 0, null );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/connectPoints\", LGraphConnectPoints );\r\n\r\n    //Works with Litegl.js to create WebGL nodes\r\n    if (typeof GL == \"undefined\") //LiteGL RELATED **********************************************\r\n\t\treturn;\r\n\r\n\tfunction LGraphToGeometry() {\r\n\t\tthis.addInput(\"mesh\", \"mesh\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.geometry = {};\r\n\t\tthis.last_mesh = null;\r\n\t}\r\n\r\n\tLGraphToGeometry.title = \"to geometry\";\r\n\tLGraphToGeometry.desc = \"converts a mesh to geometry\";\r\n\r\n\tLGraphToGeometry.prototype.onExecute = function() {\r\n\t\tvar mesh = this.getInputData(0);\r\n\t\tif(!mesh)\r\n\t\t\treturn;\r\n\r\n\t\tif(mesh != this.last_mesh)\r\n\t\t{\r\n\t\t\tthis.last_mesh = mesh;\r\n\t\t\tfor(i in mesh.vertexBuffers)\r\n\t\t\t{\r\n\t\t\t\tvar buffer = mesh.vertexBuffers[i];\r\n\t\t\t\tthis.geometry[i] = buffer.data\r\n\t\t\t}\r\n\t\t\tif(mesh.indexBuffers[\"triangles\"])\r\n\t\t\t\tthis.geometry.indices = mesh.indexBuffers[\"triangles\"].data;\r\n\r\n\t\t\tthis.geometry._id = generateGeometryId();\r\n\t\t\tthis.geometry._version = 0;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t\tif(this.geometry)\r\n\t\t\tthis.setOutputData(1,this.geometry.vertices);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/toGeometry\", LGraphToGeometry );\r\n\r\n\tfunction LGraphGeometryToMesh() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addOutput(\"mesh\", \"mesh\");\r\n\t\tthis.properties = {};\r\n\t\tthis.version = -1;\r\n\t\tthis.mesh = null;\r\n\t}\r\n\r\n\tLGraphGeometryToMesh.title = \"Geo to Mesh\";\r\n\r\n\tLGraphGeometryToMesh.prototype.updateMesh = function(geometry)\r\n\t{\r\n\t\tif(!this.mesh)\r\n\t\t\tthis.mesh = new GL.Mesh();\r\n\r\n\t\tfor(var i in geometry)\r\n\t\t{\r\n\t\t\tif(i[0] == \"_\")\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tvar buffer_data = geometry[i];\r\n\r\n\t\t\tvar info = GL.Mesh.common_buffers[i];\r\n\t\t\tif(!info && i != \"indices\") //unknown buffer\r\n\t\t\t\tcontinue;\r\n\t\t\tvar spacing = info ? info.spacing : 3;\r\n\t\t\tvar mesh_buffer = this.mesh.vertexBuffers[i];\r\n\r\n\t\t\tif(!mesh_buffer || mesh_buffer.data.length != buffer_data.length)\r\n\t\t\t{\r\n\t\t\t\tmesh_buffer = new GL.Buffer( i == \"indices\" ? GL.ELEMENT_ARRAY_BUFFER : GL.ARRAY_BUFFER, buffer_data, spacing, GL.DYNAMIC_DRAW );\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmesh_buffer.data.set( buffer_data );\r\n\t\t\t\tmesh_buffer.upload(GL.DYNAMIC_DRAW);\r\n\t\t\t}\r\n\r\n\t\t\tthis.mesh.addBuffer( i, mesh_buffer );\r\n\t\t}\r\n\r\n\t\tif(this.mesh.vertexBuffers.normals &&this.mesh.vertexBuffers.normals.data.length != this.mesh.vertexBuffers.vertices.data.length )\r\n\t\t{\r\n\t\t\tvar n = new Float32Array([0,1,0]);\r\n\t\t\tvar normals = new Float32Array( this.mesh.vertexBuffers.vertices.data.length );\r\n\t\t\tfor(var i = 0; i < normals.length; i+= 3)\r\n\t\t\t\tnormals.set( n, i );\r\n\t\t\tmesh_buffer = new GL.Buffer( GL.ARRAY_BUFFER, normals, 3 );\r\n\t\t\tthis.mesh.addBuffer( \"normals\", mesh_buffer );\r\n\t\t}\r\n\r\n\t\tthis.mesh.updateBoundingBox();\r\n\t\tthis.geometry_id = this.mesh.id = geometry._id;\r\n\t\tthis.version = this.mesh.version = geometry._version;\r\n\t\treturn this.mesh;\r\n\t}\r\n\r\n\tLGraphGeometryToMesh.prototype.onExecute = function() {\r\n\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\t\tif( this.version != geometry._version || this.geometry_id != geometry._id )\r\n\t\t\tthis.updateMesh( geometry );\r\n\t\tthis.setOutputData(0, this.mesh);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/toMesh\", LGraphGeometryToMesh );\r\n\r\n\tfunction LGraphRenderMesh() {\r\n\t\tthis.addInput(\"mesh\", \"mesh\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addInput(\"tex\", \"texture\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tenabled: true,\r\n\t\t\tprimitive: GL.TRIANGLES,\r\n\t\t\tadditive: false,\r\n\t\t\tcolor: [1,1,1],\r\n\t\t\topacity: 1\r\n\t\t};\r\n\r\n\t\tthis.color = vec4.create([1,1,1,1]);\r\n\t\tthis.model_matrix = mat4.create();\r\n\t\tthis.uniforms = {\r\n\t\t\tu_color: this.color,\r\n\t\t\tu_model: this.model_matrix\r\n\t\t};\r\n\t}\r\n\r\n\tLGraphRenderMesh.title = \"Render Mesh\";\r\n\tLGraphRenderMesh.desc = \"renders a mesh flat\";\r\n\r\n\tLGraphRenderMesh.PRIMITIVE_VALUES = { \"points\":GL.POINTS, \"lines\":GL.LINES, \"line_loop\":GL.LINE_LOOP,\"line_strip\":GL.LINE_STRIP, \"triangles\":GL.TRIANGLES, \"triangle_fan\":GL.TRIANGLE_FAN, \"triangle_strip\":GL.TRIANGLE_STRIP };\r\n\r\n\tLGraphRenderMesh.widgets_info = {\r\n\t\tprimitive: { widget: \"combo\", values: LGraphRenderMesh.PRIMITIVE_VALUES },\r\n\t\tcolor: { widget: \"color\" }\r\n\t};\r\n\r\n\tLGraphRenderMesh.prototype.onExecute = function() {\r\n\r\n\t\tif(!this.properties.enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar mesh = this.getInputData(0);\r\n\t\tif(!mesh)\r\n\t\t\treturn;\r\n\r\n\t\tif(!LiteGraph.LGraphRender.onRequestCameraMatrices)\r\n\t\t{\r\n\t\t\tconsole.warn(\"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tLiteGraph.LGraphRender.onRequestCameraMatrices( view_matrix, projection_matrix,viewprojection_matrix );\r\n\t\tvar shader = null;\r\n\t\tvar texture = this.getInputData(2);\r\n\t\tif(texture)\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"textured\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"textured\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code, { USE_TEXTURE:\"\" });\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"flat\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"flat\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code );\r\n\t\t}\r\n\r\n\t\tthis.color.set( this.properties.color );\r\n\t\tthis.color[3] = this.properties.opacity;\r\n\r\n\t\tvar model_matrix = this.model_matrix;\r\n\t\tvar m = this.getInputData(1);\r\n\t\tif(m)\r\n\t\t\tmodel_matrix.set(m);\r\n\t\telse\r\n\t\t\tmat4.identity( model_matrix );\r\n\r\n\t\tthis.uniforms.u_point_size = 1;\r\n\t\tvar primitive = this.properties.primitive;\r\n\r\n\t\tshader.uniforms( global_uniforms );\r\n\t\tshader.uniforms( this.uniforms );\r\n\r\n\t\tif(this.properties.opacity >= 1)\r\n\t\t\tgl.disable( gl.BLEND );\r\n\t\telse\r\n\t\t\tgl.enable( gl.BLEND );\r\n\t\tgl.enable( gl.DEPTH_TEST );\r\n\t\tif( this.properties.additive )\r\n\t\t{\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\t\t\tgl.depthMask( false );\r\n\t\t}\r\n\t\telse\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\tvar indices = \"indices\";\r\n\t\tif( mesh.indexBuffers.triangles )\r\n\t\t\tindices = \"triangles\";\r\n\t\tshader.draw( mesh, primitive, indices );\r\n\t\tgl.disable( gl.BLEND );\r\n\t\tgl.depthMask( true );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/render_mesh\", LGraphRenderMesh );\r\n\r\n\t//**************************\r\n\r\n\r\n\tfunction LGraphGeometryPrimitive() {\r\n\t\tthis.addInput(\"size\", \"number\");\r\n\t\tthis.addOutput(\"out\", \"mesh\");\r\n\t\tthis.properties = { type: 1, size: 1, subdivisions: 32 };\r\n\r\n\t\tthis.version = (Math.random() * 100000)|0;\r\n\t\tthis.last_info = { type: -1, size: -1, subdivisions: -1 };\r\n\t}\r\n\r\n\tLGraphGeometryPrimitive.title = \"Primitive\";\r\n\r\n\tLGraphGeometryPrimitive.VALID = { \"CUBE\":1, \"PLANE\":2, \"CYLINDER\":3, \"SPHERE\":4, \"CIRCLE\":5, \"HEMISPHERE\":6, \"ICOSAHEDRON\":7, \"CONE\":8, \"QUAD\":9 };\r\n\tLGraphGeometryPrimitive.widgets_info = {\r\n\t\ttype: { widget: \"combo\", values: LGraphGeometryPrimitive.VALID }\r\n\t};\r\n\r\n\tLGraphGeometryPrimitive.prototype.onExecute = function() {\r\n\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tvar size = this.getInputOrProperty(\"size\");\r\n\r\n\t\t//update\r\n\t\tif( this.last_info.type != this.properties.type || this.last_info.size != size || this.last_info.subdivisions != this.properties.subdivisions )\r\n\t\t\tthis.updateMesh( this.properties.type, size, this.properties.subdivisions );\r\n\r\n\t\tthis.setOutputData(0,this._mesh);\r\n\t}\r\n\r\n\tLGraphGeometryPrimitive.prototype.updateMesh = function(type, size, subdivisions)\r\n\t{\r\n\t\tsubdivisions = Math.max(0,subdivisions)|0;\r\n\r\n\t\tswitch (type)\r\n\t\t{\r\n\t\t\tcase 1: //CUBE: \r\n\t\t\t\tthis._mesh = GL.Mesh.cube({size: size, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2: //PLANE:\r\n\t\t\t\tthis._mesh = GL.Mesh.plane({size: size, xz: true, detail: subdivisions, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3: //CYLINDER:\r\n\t\t\t\tthis._mesh = GL.Mesh.cylinder({size: size, subdivisions: subdivisions, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4: //SPHERE:\r\n\t\t\t\tthis._mesh = GL.Mesh.sphere({size: size, \"long\": subdivisions, lat: subdivisions, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5: //CIRCLE:\r\n\t\t\t\tthis._mesh = GL.Mesh.circle({size: size, slices: subdivisions, normals:true, coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6: //HEMISPHERE:\r\n\t\t\t\tthis._mesh = GL.Mesh.sphere({size: size, \"long\": subdivisions, lat: subdivisions, normals:true, coords:true, hemi: true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7: //ICOSAHEDRON:\r\n\t\t\t\tthis._mesh = GL.Mesh.icosahedron({size: size, subdivisions:subdivisions });\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8: //CONE:\r\n\t\t\t\tthis._mesh = GL.Mesh.cone({radius: size, height: size, subdivisions:subdivisions });\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9: //QUAD:\r\n\t\t\t\tthis._mesh = GL.Mesh.plane({size: size, xz: false, detail: subdivisions, normals:true, coords:true });\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.last_info.type = type;\r\n\t\tthis.last_info.size = size;\r\n\t\tthis.last_info.subdivisions = subdivisions;\r\n\t\tthis._mesh.version = this.version++;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/mesh_primitive\", LGraphGeometryPrimitive );\r\n\r\n\r\n\tfunction LGraphRenderPoints() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addInput(\"tex\", \"texture\");\r\n\t\tthis.properties = {\r\n\t\t\tenabled: true,\r\n\t\t\tpoint_size: 0.1,\r\n\t\t\tfixed_size: false,\r\n\t\t\tadditive: true,\r\n\t\t\tcolor: [1,1,1],\r\n\t\t\topacity: 1\r\n\t\t};\r\n\r\n\t\tthis.color = vec4.create([1,1,1,1]);\r\n\r\n\t\tthis.uniforms = {\r\n\t\t\tu_point_size: 1,\r\n\t\t\tu_perspective: 1,\r\n\t\t\tu_point_perspective: 1,\r\n\t\t\tu_color: this.color\r\n\t\t};\r\n\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.mesh = null;\r\n\t}\r\n\r\n\tLGraphRenderPoints.title = \"renderPoints\";\r\n\tLGraphRenderPoints.desc = \"render points with a texture\";\r\n\r\n\tLGraphRenderPoints.widgets_info = {\r\n\t\tcolor: { widget: \"color\" }\r\n\t};\r\n\r\n\tLGraphRenderPoints.prototype.updateMesh = function(geometry)\r\n\t{\r\n\t\tvar buffer = this.buffer;\r\n\t\tif(!this.buffer || !this.buffer.data || this.buffer.data.length != geometry.vertices.length)\r\n\t\t\tthis.buffer = new GL.Buffer( GL.ARRAY_BUFFER, geometry.vertices,3,GL.DYNAMIC_DRAW);\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.buffer.data.set( geometry.vertices );\r\n\t\t\tthis.buffer.upload(GL.DYNAMIC_DRAW);\r\n\t\t}\r\n\r\n\t\tif(!this.mesh)\r\n\t\t\tthis.mesh = new GL.Mesh();\r\n\r\n\t\tthis.mesh.addBuffer(\"vertices\",this.buffer);\r\n\t\tthis.geometry_id = this.mesh.id = geometry._id;\r\n\t\tthis.version = this.mesh.version = geometry._version;\r\n\t}\r\n\r\n\tLGraphRenderPoints.prototype.onExecute = function() {\r\n\r\n\t\tif(!this.properties.enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\t\tif(this.version != geometry._version || this.geometry_id != geometry._id )\r\n\t\t\tthis.updateMesh( geometry );\r\n\r\n\t\tif(!LiteGraph.LGraphRender.onRequestCameraMatrices)\r\n\t\t{\r\n\t\t\tconsole.warn(\"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tLiteGraph.LGraphRender.onRequestCameraMatrices( view_matrix, projection_matrix,viewprojection_matrix );\r\n\t\tvar shader = null;\r\n\r\n\t\tvar texture = this.getInputData(2);\r\n\t\t\r\n\t\tif(texture)\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"textured_points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"textured_points\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code, { USE_TEXTURED_POINTS:\"\" });\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"points\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code, { USE_POINTS: \"\" });\r\n\t\t}\r\n\r\n\t\tthis.color.set( this.properties.color );\r\n\t\tthis.color[3] = this.properties.opacity;\r\n\r\n\t\tvar m = this.getInputData(1);\r\n\t\tif(m)\r\n\t\t\tmodel_matrix.set(m);\r\n\t\telse\r\n\t\t\tmat4.identity( model_matrix );\r\n\r\n\t\tthis.uniforms.u_point_size = this.properties.point_size;\r\n\t\tthis.uniforms.u_point_perspective = this.properties.fixed_size ? 0 : 1;\r\n\t\tthis.uniforms.u_perspective = gl.viewport_data[3] * projection_matrix[5];\r\n\r\n\t\tshader.uniforms( global_uniforms );\r\n\t\tshader.uniforms( this.uniforms );\r\n\r\n\t\tif(this.properties.opacity >= 1)\r\n\t\t\tgl.disable( gl.BLEND );\r\n\t\telse\r\n\t\t\tgl.enable( gl.BLEND );\r\n\r\n\t\tgl.enable( gl.DEPTH_TEST );\r\n\t\tif( this.properties.additive )\r\n\t\t{\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\t\t\tgl.depthMask( false );\r\n\t\t}\r\n\t\telse\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\tshader.draw( this.mesh, GL.POINTS );\r\n\r\n\t\tgl.disable( gl.BLEND );\r\n\t\tgl.depthMask( true );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/render_points\", LGraphRenderPoints );\r\n\r\n\tLGraphRenderPoints.vertex_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tattribute vec3 a_vertex;\\n\\\r\n\t\tvarying vec3 v_vertex;\\n\\\r\n\t\tattribute vec3 a_normal;\\n\\\r\n\t\tvarying vec3 v_normal;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tattribute vec4 a_color;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tattribute vec2 a_coord;\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\tattribute float a_extra;\\n\\\r\n\t\t#endif\\n\\\r\n\t\t#ifdef USE_INSTANCING\\n\\\r\n\t\t\tattribute mat4 u_model;\\n\\\r\n\t\t#else\\n\\\r\n\t\t\tuniform mat4 u_model;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tuniform mat4 u_viewprojection;\\n\\\r\n\t\tuniform float u_point_size;\\n\\\r\n\t\tuniform float u_perspective;\\n\\\r\n\t\tuniform float u_point_perspective;\\n\\\r\n\t\tfloat computePointSize(float radius, float w)\\n\\\r\n\t\t{\\n\\\r\n\t\t\tif(radius < 0.0)\\n\\\r\n\t\t\t\treturn -radius;\\n\\\r\n\t\t\treturn u_perspective * radius / w;\\n\\\r\n\t\t}\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tv_coord = a_coord;\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tv_color = a_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tv_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;\\n\\\r\n\t\t\tv_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;\\n\\\r\n\t\t\tgl_Position = u_viewprojection * vec4(v_vertex,1.0);\\n\\\r\n\t\t\tgl_PointSize = u_point_size;\\n\\\r\n\t\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\t\tgl_PointSize = a_extra;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tif(u_point_perspective != 0.0)\\n\\\r\n\t\t\t\tgl_PointSize = computePointSize( gl_PointSize, gl_Position.w );\\n\\\r\n\t\t}\\\r\n\t';\r\n\r\n\tLGraphRenderPoints.fragment_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tuniform vec4 u_color;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\tuniform sampler2D u_texture;\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tvec4 color = u_color;\\n\\\r\n\t\t\t#ifdef USE_TEXTURED_POINTS\\n\\\r\n\t\t\t\tcolor *= texture2D(u_texture, gl_PointCoord.xy);\\n\\\r\n\t\t\t#else\\n\\\r\n\t\t\t\t#ifdef USE_TEXTURE\\n\\\r\n\t\t\t\t  color *= texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\t  if(color.a < 0.1)\\n\\\r\n\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t\t#ifdef USE_POINTS\\n\\\r\n\t\t\t\t\tfloat dist = length( gl_PointCoord.xy - vec2(0.5) );\\n\\\r\n\t\t\t\t\tif( dist > 0.45 )\\n\\\r\n\t\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tcolor *= v_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tgl_FragColor = color;\\n\\\r\n\t\t}\\\r\n\t';\r\n\r\n\t//based on https://inconvergent.net/2019/depth-of-field/\r\n\t/*\r\n\tfunction LGraphRenderGeometryDOF() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addInput(\"tex\", \"texture\");\r\n\t\tthis.properties = {\r\n\t\t\tenabled: true,\r\n\t\t\tlines: true,\r\n\t\t\tpoint_size: 0.1,\r\n\t\t\tfixed_size: false,\r\n\t\t\tadditive: true,\r\n\t\t\tcolor: [1,1,1],\r\n\t\t\topacity: 1\r\n\t\t};\r\n\r\n\t\tthis.color = vec4.create([1,1,1,1]);\r\n\r\n\t\tthis.uniforms = {\r\n\t\t\tu_point_size: 1,\r\n\t\t\tu_perspective: 1,\r\n\t\t\tu_point_perspective: 1,\r\n\t\t\tu_color: this.color\r\n\t\t};\r\n\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.mesh = null;\r\n\t}\r\n\r\n\tLGraphRenderGeometryDOF.widgets_info = {\r\n\t\tcolor: { widget: \"color\" }\r\n\t};\r\n\r\n\tLGraphRenderGeometryDOF.prototype.updateMesh = function(geometry)\r\n\t{\r\n\t\tvar buffer = this.buffer;\r\n\t\tif(!this.buffer || this.buffer.data.length != geometry.vertices.length)\r\n\t\t\tthis.buffer = new GL.Buffer( GL.ARRAY_BUFFER, geometry.vertices,3,GL.DYNAMIC_DRAW);\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.buffer.data.set( geometry.vertices );\r\n\t\t\tthis.buffer.upload(GL.DYNAMIC_DRAW);\r\n\t\t}\r\n\r\n\t\tif(!this.mesh)\r\n\t\t\tthis.mesh = new GL.Mesh();\r\n\r\n\t\tthis.mesh.addBuffer(\"vertices\",this.buffer);\r\n\t\tthis.geometry_id = this.mesh.id = geometry._id;\r\n\t\tthis.version = this.mesh.version = geometry._version;\r\n\t}\r\n\r\n\tLGraphRenderGeometryDOF.prototype.onExecute = function() {\r\n\r\n\t\tif(!this.properties.enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\t\tif(this.version != geometry._version || this.geometry_id != geometry._id )\r\n\t\t\tthis.updateMesh( geometry );\r\n\r\n\t\tif(!LiteGraph.LGraphRender.onRequestCameraMatrices)\r\n\t\t{\r\n\t\t\tconsole.warn(\"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tLiteGraph.LGraphRender.onRequestCameraMatrices( view_matrix, projection_matrix,viewprojection_matrix );\r\n\t\tvar shader = null;\r\n\r\n\t\tvar texture = this.getInputData(2);\r\n\t\t\r\n\t\tif(texture)\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"textured_points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"textured_points\"] = new GL.Shader( LGraphRenderGeometryDOF.vertex_shader_code, LGraphRenderGeometryDOF.fragment_shader_code, { USE_TEXTURED_POINTS:\"\" });\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"points\"] = new GL.Shader( LGraphRenderGeometryDOF.vertex_shader_code, LGraphRenderGeometryDOF.fragment_shader_code, { USE_POINTS: \"\" });\r\n\t\t}\r\n\r\n\t\tthis.color.set( this.properties.color );\r\n\t\tthis.color[3] = this.properties.opacity;\r\n\r\n\t\tvar m = this.getInputData(1);\r\n\t\tif(m)\r\n\t\t\tmodel_matrix.set(m);\r\n\t\telse\r\n\t\t\tmat4.identity( model_matrix );\r\n\r\n\t\tthis.uniforms.u_point_size = this.properties.point_size;\r\n\t\tthis.uniforms.u_point_perspective = this.properties.fixed_size ? 0 : 1;\r\n\t\tthis.uniforms.u_perspective = gl.viewport_data[3] * projection_matrix[5];\r\n\r\n\t\tshader.uniforms( global_uniforms );\r\n\t\tshader.uniforms( this.uniforms );\r\n\r\n\t\tif(this.properties.opacity >= 1)\r\n\t\t\tgl.disable( gl.BLEND );\r\n\t\telse\r\n\t\t\tgl.enable( gl.BLEND );\r\n\r\n\t\tgl.enable( gl.DEPTH_TEST );\r\n\t\tif( this.properties.additive )\r\n\t\t{\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\t\t\tgl.depthMask( false );\r\n\t\t}\r\n\t\telse\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\tshader.draw( this.mesh, GL.POINTS );\r\n\r\n\t\tgl.disable( gl.BLEND );\r\n\t\tgl.depthMask( true );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/render_dof\", LGraphRenderGeometryDOF );\r\n\r\n\tLGraphRenderGeometryDOF.vertex_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tattribute vec3 a_vertex;\\n\\\r\n\t\tvarying vec3 v_vertex;\\n\\\r\n\t\tattribute vec3 a_normal;\\n\\\r\n\t\tvarying vec3 v_normal;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tattribute vec4 a_color;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tattribute vec2 a_coord;\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\tattribute float a_extra;\\n\\\r\n\t\t#endif\\n\\\r\n\t\t#ifdef USE_INSTANCING\\n\\\r\n\t\t\tattribute mat4 u_model;\\n\\\r\n\t\t#else\\n\\\r\n\t\t\tuniform mat4 u_model;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tuniform mat4 u_viewprojection;\\n\\\r\n\t\tuniform float u_point_size;\\n\\\r\n\t\tuniform float u_perspective;\\n\\\r\n\t\tuniform float u_point_perspective;\\n\\\r\n\t\tfloat computePointSize(float radius, float w)\\n\\\r\n\t\t{\\n\\\r\n\t\t\tif(radius < 0.0)\\n\\\r\n\t\t\t\treturn -radius;\\n\\\r\n\t\t\treturn u_perspective * radius / w;\\n\\\r\n\t\t}\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tv_coord = a_coord;\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tv_color = a_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tv_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;\\n\\\r\n\t\t\tv_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;\\n\\\r\n\t\t\tgl_Position = u_viewprojection * vec4(v_vertex,1.0);\\n\\\r\n\t\t\tgl_PointSize = u_point_size;\\n\\\r\n\t\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\t\tgl_PointSize = a_extra;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tif(u_point_perspective != 0.0)\\n\\\r\n\t\t\t\tgl_PointSize = computePointSize( gl_PointSize, gl_Position.w );\\n\\\r\n\t\t}\\\r\n\t';\r\n\r\n\tLGraphRenderGeometryDOF.fragment_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tuniform vec4 u_color;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\tuniform sampler2D u_texture;\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tvec4 color = u_color;\\n\\\r\n\t\t\t#ifdef USE_TEXTURED_POINTS\\n\\\r\n\t\t\t\tcolor *= texture2D(u_texture, gl_PointCoord.xy);\\n\\\r\n\t\t\t#else\\n\\\r\n\t\t\t\t#ifdef USE_TEXTURE\\n\\\r\n\t\t\t\t  color *= texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\t  if(color.a < 0.1)\\n\\\r\n\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t\t#ifdef USE_POINTS\\n\\\r\n\t\t\t\t\tfloat dist = length( gl_PointCoord.xy - vec2(0.5) );\\n\\\r\n\t\t\t\t\tif( dist > 0.45 )\\n\\\r\n\t\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tcolor *= v_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tgl_FragColor = color;\\n\\\r\n\t\t}\\\r\n\t';\r\n\t*/\r\n\r\n\r\n\r\n})(this);\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n    var LGraphTexture = global.LGraphTexture;\r\n\r\n    //Works with Litegl.js to create WebGL nodes\r\n    if (typeof GL != \"undefined\") {\r\n        // Texture Lens *****************************************\r\n        function LGraphFXLens() {\r\n            this.addInput(\"Texture\", \"Texture\");\r\n            this.addInput(\"Aberration\", \"number\");\r\n            this.addInput(\"Distortion\", \"number\");\r\n            this.addInput(\"Blur\", \"number\");\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                aberration: 1.0,\r\n                distortion: 1.0,\r\n                blur: 1.0,\r\n                precision: LGraphTexture.DEFAULT\r\n            };\r\n\r\n            if (!LGraphFXLens._shader) {\r\n                LGraphFXLens._shader = new GL.Shader(\r\n                    GL.Shader.SCREEN_VERTEX_SHADER,\r\n                    LGraphFXLens.pixel_shader\r\n                );\r\n                LGraphFXLens._texture = new GL.Texture(3, 1, {\r\n                    format: gl.RGB,\r\n                    wrap: gl.CLAMP_TO_EDGE,\r\n                    magFilter: gl.LINEAR,\r\n                    minFilter: gl.LINEAR,\r\n                    pixel_data: [255, 0, 0, 0, 255, 0, 0, 0, 255]\r\n                });\r\n            }\r\n        }\r\n\r\n        LGraphFXLens.title = \"Lens\";\r\n        LGraphFXLens.desc = \"Camera Lens distortion\";\r\n        LGraphFXLens.widgets_info = {\r\n            precision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n        };\r\n\r\n        LGraphFXLens.prototype.onExecute = function() {\r\n            var tex = this.getInputData(0);\r\n            if (this.properties.precision === LGraphTexture.PASS_THROUGH) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!tex) {\r\n                return;\r\n            }\r\n\r\n            this._tex = LGraphTexture.getTargetTexture(\r\n                tex,\r\n                this._tex,\r\n                this.properties.precision\r\n            );\r\n\r\n            var aberration = this.properties.aberration;\r\n            if (this.isInputConnected(1)) {\r\n                aberration = this.getInputData(1);\r\n                this.properties.aberration = aberration;\r\n            }\r\n\r\n            var distortion = this.properties.distortion;\r\n            if (this.isInputConnected(2)) {\r\n                distortion = this.getInputData(2);\r\n                this.properties.distortion = distortion;\r\n            }\r\n\r\n            var blur = this.properties.blur;\r\n            if (this.isInputConnected(3)) {\r\n                blur = this.getInputData(3);\r\n                this.properties.blur = blur;\r\n            }\r\n\r\n            gl.disable(gl.BLEND);\r\n            gl.disable(gl.DEPTH_TEST);\r\n            var mesh = Mesh.getScreenQuad();\r\n            var shader = LGraphFXLens._shader;\r\n            //var camera = LS.Renderer._current_camera;\r\n\r\n            this._tex.drawTo(function() {\r\n                tex.bind(0);\r\n                shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_aberration: aberration,\r\n                        u_distortion: distortion,\r\n                        u_blur: blur\r\n                    })\r\n                    .draw(mesh);\r\n            });\r\n\r\n            this.setOutputData(0, this._tex);\r\n        };\r\n\r\n        LGraphFXLens.pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tprecision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform float u_aberration;\\n\\\r\n\t\t\tuniform float u_distortion;\\n\\\r\n\t\t\tuniform float u_blur;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec2 coord = v_coord;\\n\\\r\n\t\t\t\tfloat dist = distance(vec2(0.5), coord);\\n\\\r\n\t\t\t\tvec2 dist_coord = coord - vec2(0.5);\\n\\\r\n\t\t\t\tfloat percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;\\n\\\r\n\t\t\t\tdist_coord *= percent;\\n\\\r\n\t\t\t\tcoord = dist_coord + vec2(0.5);\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture,coord, u_blur * dist);\\n\\\r\n\t\t\t\tcolor.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;\\n\\\r\n\t\t\t\tcolor.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n        /*\r\n\t\t\tfloat normalized_tunable_sigmoid(float xs, float k)\\n\\\r\n\t\t\t{\\n\\\r\n\t\t\t\txs = xs * 2.0 - 1.0;\\n\\\r\n\t\t\t\tfloat signx = sign(xs);\\n\\\r\n\t\t\t\tfloat absx = abs(xs);\\n\\\r\n\t\t\t\treturn signx * ((-k - 1.0)*absx)/(2.0*(-2.0*k*absx+k-1.0)) + 0.5;\\n\\\r\n\t\t\t}\\n\\\r\n\t\t*/\r\n\r\n        LiteGraph.registerNodeType(\"fx/lens\", LGraphFXLens);\r\n        global.LGraphFXLens = LGraphFXLens;\r\n\r\n        /* not working yet\r\n\tfunction LGraphDepthOfField()\r\n\t{\r\n\t\tthis.addInput(\"Color\",\"Texture\");\r\n\t\tthis.addInput(\"Linear Depth\",\"Texture\");\r\n\t\tthis.addInput(\"Camera\",\"camera\");\r\n\t\tthis.addOutput(\"Texture\",\"Texture\");\r\n\t\tthis.properties = { high_precision: false };\r\n\t}\r\n\r\n\tLGraphDepthOfField.title = \"Depth Of Field\";\r\n\tLGraphDepthOfField.desc = \"Applies a depth of field effect\";\r\n\r\n\tLGraphDepthOfField.prototype.onExecute = function()\r\n\t{\r\n\t\tvar tex = this.getInputData(0);\r\n\t\tvar depth = this.getInputData(1);\r\n\t\tvar camera = this.getInputData(2);\r\n\r\n\t\tif(!tex || !depth || !camera) \r\n\t\t{\r\n\t\t\tthis.setOutputData(0, tex);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar precision = gl.UNSIGNED_BYTE;\r\n\t\tif(this.properties.high_precision)\r\n\t\t\tprecision = gl.half_float_ext ? gl.HALF_FLOAT_OES : gl.FLOAT;\t\t\t\r\n\t\tif(!this._temp_texture || this._temp_texture.type != precision ||\r\n\t\t\tthis._temp_texture.width != tex.width || this._temp_texture.height != tex.height)\r\n\t\t\tthis._temp_texture = new GL.Texture( tex.width, tex.height, { type: precision, format: gl.RGBA, filter: gl.LINEAR });\r\n\r\n\t\tvar shader = LGraphDepthOfField._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphDepthOfField._pixel_shader );\r\n\r\n\t\tvar screen_mesh = Mesh.getScreenQuad();\r\n\r\n\t\tgl.disable( gl.DEPTH_TEST );\r\n\t\tgl.disable( gl.BLEND );\r\n\r\n\t\tvar camera_position = camera.getEye();\r\n\t\tvar focus_point = camera.getCenter();\r\n\t\tvar distance = vec3.distance( camera_position, focus_point );\r\n\t\tvar far = camera.far;\r\n\t\tvar focus_range = distance * 0.5;\r\n\r\n\t\tthis._temp_texture.drawTo( function() {\r\n\t\t\ttex.bind(0);\r\n\t\t\tdepth.bind(1);\r\n\t\t\tshader.uniforms({u_texture:0, u_depth_texture:1, u_resolution: [1/tex.width, 1/tex.height], u_far: far, u_focus_point: distance, u_focus_scale: focus_range }).draw(screen_mesh);\r\n\t\t});\r\n\r\n\t\tthis.setOutputData(0, this._temp_texture);\r\n\t}\r\n\r\n\t//from http://tuxedolabs.blogspot.com.es/2018/05/bokeh-depth-of-field-in-single-pass.html\r\n\tLGraphDepthOfField._pixel_shader = \"\\n\\\r\n\t\tprecision highp float;\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\tuniform sampler2D u_texture; //Image to be processed\\n\\\r\n\t\tuniform sampler2D u_depth_texture; //Linear depth, where 1.0 == far plane\\n\\\r\n\t\tuniform vec2 u_iresolution; //The size of a pixel: vec2(1.0/width, 1.0/height)\\n\\\r\n\t\tuniform float u_far; // Far plane\\n\\\r\n\t\tuniform float u_focus_point;\\n\\\r\n\t\tuniform float u_focus_scale;\\n\\\r\n\t\t\\n\\\r\n\t\tconst float GOLDEN_ANGLE = 2.39996323;\\n\\\r\n\t\tconst float MAX_BLUR_SIZE = 20.0;\\n\\\r\n\t\tconst float RAD_SCALE = 0.5; // Smaller = nicer blur, larger = faster\\n\\\r\n\t\t\\n\\\r\n\t\tfloat getBlurSize(float depth, float focusPoint, float focusScale)\\n\\\r\n\t\t{\\n\\\r\n\t\t float coc = clamp((1.0 / focusPoint - 1.0 / depth)*focusScale, -1.0, 1.0);\\n\\\r\n\t\t return abs(coc) * MAX_BLUR_SIZE;\\n\\\r\n\t\t}\\n\\\r\n\t\t\\n\\\r\n\t\tvec3 depthOfField(vec2 texCoord, float focusPoint, float focusScale)\\n\\\r\n\t\t{\\n\\\r\n\t\t float centerDepth = texture2D(u_depth_texture, texCoord).r * u_far;\\n\\\r\n\t\t float centerSize = getBlurSize(centerDepth, focusPoint, focusScale);\\n\\\r\n\t\t vec3 color = texture2D(u_texture, v_coord).rgb;\\n\\\r\n\t\t float tot = 1.0;\\n\\\r\n\t\t\\n\\\r\n\t\t float radius = RAD_SCALE;\\n\\\r\n\t\t for (float ang = 0.0; ang < 100.0; ang += GOLDEN_ANGLE)\\n\\\r\n\t\t {\\n\\\r\n\t\t  vec2 tc = texCoord + vec2(cos(ang), sin(ang)) * u_iresolution * radius;\\n\\\r\n\t\t\t\\n\\\r\n\t\t  vec3 sampleColor = texture2D(u_texture, tc).rgb;\\n\\\r\n\t\t  float sampleDepth = texture2D(u_depth_texture, tc).r * u_far;\\n\\\r\n\t\t  float sampleSize = getBlurSize( sampleDepth, focusPoint, focusScale );\\n\\\r\n\t\t  if (sampleDepth > centerDepth)\\n\\\r\n\t\t   sampleSize = clamp(sampleSize, 0.0, centerSize*2.0);\\n\\\r\n\t\t\t\\n\\\r\n\t\t  float m = smoothstep(radius-0.5, radius+0.5, sampleSize);\\n\\\r\n\t\t  color += mix(color/tot, sampleColor, m);\\n\\\r\n\t\t  tot += 1.0;\\n\\\r\n\t\t  radius += RAD_SCALE/radius;\\n\\\r\n\t\t  if(radius>=MAX_BLUR_SIZE)\\n\\\r\n\t\t\t return color / tot;\\n\\\r\n\t\t }\\n\\\r\n\t\t return color / tot;\\n\\\r\n\t\t}\\n\\\r\n\t\tvoid main()\\n\\\r\n\t\t{\\n\\\r\n\t\t\tgl_FragColor = vec4( depthOfField( v_coord, u_focus_point, u_focus_scale ), 1.0 );\\n\\\r\n\t\t\t//gl_FragColor = vec4( texture2D(u_depth_texture, v_coord).r );\\n\\\r\n\t\t}\\n\\\r\n\t\t\";\r\n\r\n\tLiteGraph.registerNodeType(\"fx/DOF\", LGraphDepthOfField );\r\n\tglobal.LGraphDepthOfField = LGraphDepthOfField;\r\n\t*/\r\n\r\n        //*******************************************************\r\n\r\n        function LGraphFXBokeh() {\r\n            this.addInput(\"Texture\", \"Texture\");\r\n            this.addInput(\"Blurred\", \"Texture\");\r\n            this.addInput(\"Mask\", \"Texture\");\r\n            this.addInput(\"Threshold\", \"number\");\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                shape: \"\",\r\n                size: 10,\r\n                alpha: 1.0,\r\n                threshold: 1.0,\r\n                high_precision: false\r\n            };\r\n        }\r\n\r\n        LGraphFXBokeh.title = \"Bokeh\";\r\n        LGraphFXBokeh.desc = \"applies an Bokeh effect\";\r\n\r\n        LGraphFXBokeh.widgets_info = { shape: { widget: \"texture\" } };\r\n\r\n        LGraphFXBokeh.prototype.onExecute = function() {\r\n            var tex = this.getInputData(0);\r\n            var blurred_tex = this.getInputData(1);\r\n            var mask_tex = this.getInputData(2);\r\n            if (!tex || !mask_tex || !this.properties.shape) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!blurred_tex) {\r\n                blurred_tex = tex;\r\n            }\r\n\r\n            var shape_tex = LGraphTexture.getTexture(this.properties.shape);\r\n            if (!shape_tex) {\r\n                return;\r\n            }\r\n\r\n            var threshold = this.properties.threshold;\r\n            if (this.isInputConnected(3)) {\r\n                threshold = this.getInputData(3);\r\n                this.properties.threshold = threshold;\r\n            }\r\n\r\n            var precision = gl.UNSIGNED_BYTE;\r\n            if (this.properties.high_precision) {\r\n                precision = gl.half_float_ext ? gl.HALF_FLOAT_OES : gl.FLOAT;\r\n            }\r\n            if (\r\n                !this._temp_texture ||\r\n                this._temp_texture.type != precision ||\r\n                this._temp_texture.width != tex.width ||\r\n                this._temp_texture.height != tex.height\r\n            ) {\r\n                this._temp_texture = new GL.Texture(tex.width, tex.height, {\r\n                    type: precision,\r\n                    format: gl.RGBA,\r\n                    filter: gl.LINEAR\r\n                });\r\n            }\r\n\r\n            //iterations\r\n            var size = this.properties.size;\r\n\r\n            var first_shader = LGraphFXBokeh._first_shader;\r\n            if (!first_shader) {\r\n                first_shader = LGraphFXBokeh._first_shader = new GL.Shader(\r\n                    Shader.SCREEN_VERTEX_SHADER,\r\n                    LGraphFXBokeh._first_pixel_shader\r\n                );\r\n            }\r\n\r\n            var second_shader = LGraphFXBokeh._second_shader;\r\n            if (!second_shader) {\r\n                second_shader = LGraphFXBokeh._second_shader = new GL.Shader(\r\n                    LGraphFXBokeh._second_vertex_shader,\r\n                    LGraphFXBokeh._second_pixel_shader\r\n                );\r\n            }\r\n\r\n            var points_mesh = this._points_mesh;\r\n            if (\r\n                !points_mesh ||\r\n                points_mesh._width != tex.width ||\r\n                points_mesh._height != tex.height ||\r\n                points_mesh._spacing != 2\r\n            ) {\r\n                points_mesh = this.createPointsMesh(tex.width, tex.height, 2);\r\n            }\r\n\r\n            var screen_mesh = Mesh.getScreenQuad();\r\n\r\n            var point_size = this.properties.size;\r\n            var min_light = this.properties.min_light;\r\n            var alpha = this.properties.alpha;\r\n\r\n            gl.disable(gl.DEPTH_TEST);\r\n            gl.disable(gl.BLEND);\r\n\r\n            this._temp_texture.drawTo(function() {\r\n                tex.bind(0);\r\n                blurred_tex.bind(1);\r\n                mask_tex.bind(2);\r\n                first_shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_texture_blur: 1,\r\n                        u_mask: 2,\r\n                        u_texsize: [tex.width, tex.height]\r\n                    })\r\n                    .draw(screen_mesh);\r\n            });\r\n\r\n            this._temp_texture.drawTo(function() {\r\n                //clear because we use blending\r\n                //gl.clearColor(0.0,0.0,0.0,1.0);\r\n                //gl.clear( gl.COLOR_BUFFER_BIT );\r\n                gl.enable(gl.BLEND);\r\n                gl.blendFunc(gl.ONE, gl.ONE);\r\n\r\n                tex.bind(0);\r\n                shape_tex.bind(3);\r\n                second_shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_mask: 2,\r\n                        u_shape: 3,\r\n                        u_alpha: alpha,\r\n                        u_threshold: threshold,\r\n                        u_pointSize: point_size,\r\n                        u_itexsize: [1.0 / tex.width, 1.0 / tex.height]\r\n                    })\r\n                    .draw(points_mesh, gl.POINTS);\r\n            });\r\n\r\n            this.setOutputData(0, this._temp_texture);\r\n        };\r\n\r\n        LGraphFXBokeh.prototype.createPointsMesh = function(\r\n            width,\r\n            height,\r\n            spacing\r\n        ) {\r\n            var nwidth = Math.round(width / spacing);\r\n            var nheight = Math.round(height / spacing);\r\n\r\n            var vertices = new Float32Array(nwidth * nheight * 2);\r\n\r\n            var ny = -1;\r\n            var dx = (2 / width) * spacing;\r\n            var dy = (2 / height) * spacing;\r\n            for (var y = 0; y < nheight; ++y) {\r\n                var nx = -1;\r\n                for (var x = 0; x < nwidth; ++x) {\r\n                    var pos = y * nwidth * 2 + x * 2;\r\n                    vertices[pos] = nx;\r\n                    vertices[pos + 1] = ny;\r\n                    nx += dx;\r\n                }\r\n                ny += dy;\r\n            }\r\n\r\n            this._points_mesh = GL.Mesh.load({ vertices2D: vertices });\r\n            this._points_mesh._width = width;\r\n            this._points_mesh._height = height;\r\n            this._points_mesh._spacing = spacing;\r\n\r\n            return this._points_mesh;\r\n        };\r\n\r\n        /*\r\n\tLGraphTextureBokeh._pixel_shader = \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 a_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_shape;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D( u_texture, gl_PointCoord );\\n\\\r\n\t\t\t\tcolor *= v_color * u_alpha;\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\";\r\n\t*/\r\n\r\n        LGraphFXBokeh._first_pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tprecision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_texture_blur;\\n\\\r\n\t\t\tuniform sampler2D u_mask;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tvec4 blurred_color = texture2D(u_texture_blur, v_coord);\\n\\\r\n\t\t\t\tfloat mask = texture2D(u_mask, v_coord).x;\\n\\\r\n\t\t\t   gl_FragColor = mix(color, blurred_color, mask);\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n\r\n        LGraphFXBokeh._second_vertex_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tattribute vec2 a_vertex2D;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_mask;\\n\\\r\n\t\t\tuniform vec2 u_itexsize;\\n\\\r\n\t\t\tuniform float u_pointSize;\\n\\\r\n\t\t\tuniform float u_threshold;\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec2 coord = a_vertex2D * 0.5 + 0.5;\\n\\\r\n\t\t\t\tv_color = texture2D( u_texture, coord );\\n\\\r\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );\\n\\\r\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));\\n\\\r\n\t\t\t\tv_color += texture2D( u_texture, coord + u_itexsize);\\n\\\r\n\t\t\t\tv_color *= 0.25;\\n\\\r\n\t\t\t\tfloat mask = texture2D(u_mask, coord).x;\\n\\\r\n\t\t\t\tfloat luminance = length(v_color) * mask;\\n\\\r\n\t\t\t\t/*luminance /= (u_pointSize*u_pointSize)*0.01 */;\\n\\\r\n\t\t\t\tluminance -= u_threshold;\\n\\\r\n\t\t\t\tif(luminance < 0.0)\\n\\\r\n\t\t\t\t{\\n\\\r\n\t\t\t\t\tgl_Position.x = -100.0;\\n\\\r\n\t\t\t\t\treturn;\\n\\\r\n\t\t\t\t}\\n\\\r\n\t\t\t\tgl_PointSize = u_pointSize;\\n\\\r\n\t\t\t\tgl_Position = vec4(a_vertex2D,0.0,1.0);\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n\r\n        LGraphFXBokeh._second_pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t\tuniform sampler2D u_shape;\\n\\\r\n\t\t\tuniform float u_alpha;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D( u_shape, gl_PointCoord );\\n\\\r\n\t\t\t\tcolor *= v_color * u_alpha;\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LiteGraph.registerNodeType(\"fx/bokeh\", LGraphFXBokeh);\r\n        global.LGraphFXBokeh = LGraphFXBokeh;\r\n\r\n        //************************************************\r\n\r\n        function LGraphFXGeneric() {\r\n            this.addInput(\"Texture\", \"Texture\");\r\n            this.addInput(\"value1\", \"number\");\r\n            this.addInput(\"value2\", \"number\");\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                fx: \"halftone\",\r\n                value1: 1,\r\n                value2: 1,\r\n                precision: LGraphTexture.DEFAULT\r\n            };\r\n        }\r\n\r\n        LGraphFXGeneric.title = \"FX\";\r\n        LGraphFXGeneric.desc = \"applies an FX from a list\";\r\n\r\n        LGraphFXGeneric.widgets_info = {\r\n            fx: {\r\n                widget: \"combo\",\r\n                values: [\"halftone\", \"pixelate\", \"lowpalette\", \"noise\", \"gamma\"]\r\n            },\r\n            precision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n        };\r\n        LGraphFXGeneric.shaders = {};\r\n\r\n        LGraphFXGeneric.prototype.onExecute = function() {\r\n            if (!this.isOutputConnected(0)) {\r\n                return;\r\n            } //saves work\r\n\r\n            var tex = this.getInputData(0);\r\n            if (this.properties.precision === LGraphTexture.PASS_THROUGH) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!tex) {\r\n                return;\r\n            }\r\n\r\n            this._tex = LGraphTexture.getTargetTexture(\r\n                tex,\r\n                this._tex,\r\n                this.properties.precision\r\n            );\r\n\r\n            //iterations\r\n            var value1 = this.properties.value1;\r\n            if (this.isInputConnected(1)) {\r\n                value1 = this.getInputData(1);\r\n                this.properties.value1 = value1;\r\n            }\r\n\r\n            var value2 = this.properties.value2;\r\n            if (this.isInputConnected(2)) {\r\n                value2 = this.getInputData(2);\r\n                this.properties.value2 = value2;\r\n            }\r\n\r\n            var fx = this.properties.fx;\r\n            var shader = LGraphFXGeneric.shaders[fx];\r\n            if (!shader) {\r\n                var pixel_shader_code = LGraphFXGeneric[\"pixel_shader_\" + fx];\r\n                if (!pixel_shader_code) {\r\n                    return;\r\n                }\r\n\r\n                shader = LGraphFXGeneric.shaders[fx] = new GL.Shader(\r\n                    Shader.SCREEN_VERTEX_SHADER,\r\n                    pixel_shader_code\r\n                );\r\n            }\r\n\r\n            gl.disable(gl.BLEND);\r\n            gl.disable(gl.DEPTH_TEST);\r\n            var mesh = Mesh.getScreenQuad();\r\n            var camera = global.LS ? LS.Renderer._current_camera : null;\r\n            var camera_planes;\r\n            if (camera) {\r\n                camera_planes = [\r\n                    LS.Renderer._current_camera.near,\r\n                    LS.Renderer._current_camera.far\r\n                ];\r\n            } else {\r\n                camera_planes = [1, 100];\r\n            }\r\n\r\n            var noise = null;\r\n            if (fx == \"noise\") {\r\n                noise = LGraphTexture.getNoiseTexture();\r\n            }\r\n\r\n            this._tex.drawTo(function() {\r\n                tex.bind(0);\r\n                if (fx == \"noise\") {\r\n                    noise.bind(1);\r\n                }\r\n\r\n                shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_noise: 1,\r\n                        u_size: [tex.width, tex.height],\r\n                        u_rand: [Math.random(), Math.random()],\r\n                        u_value1: value1,\r\n                        u_value2: value2,\r\n                        u_camera_planes: camera_planes\r\n                    })\r\n                    .draw(mesh);\r\n            });\r\n\r\n            this.setOutputData(0, this._tex);\r\n        };\r\n\r\n        LGraphFXGeneric.pixel_shader_halftone =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tfloat pattern() {\\n\\\r\n\t\t\t\tfloat s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);\\n\\\r\n\t\t\t\tvec2 tex = v_coord * u_size.xy;\\n\\\r\n\t\t\t\tvec2 point = vec2(\\n\\\r\n\t\t\t\t   c * tex.x - s * tex.y ,\\n\\\r\n\t\t\t\t   s * tex.x + c * tex.y \\n\\\r\n\t\t\t\t) * u_value2;\\n\\\r\n\t\t\t\treturn (sin(point.x) * sin(point.y)) * 4.0;\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tfloat average = (color.r + color.g + color.b) / 3.0;\\n\\\r\n\t\t\t\tgl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_pixelate =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, coord);\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_lowpalette =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tgl_FragColor = floor(color * u_value1) / u_value1;\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_noise =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_noise;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\tuniform vec2 u_rand;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tvec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);\\n\\\r\n\t\t\t\tgl_FragColor = vec4( color.xyz + noise * u_value1, color.a );\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_gamma =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tfloat gamma = 1.0 / u_value1;\\n\\\r\n\t\t\t\tgl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LiteGraph.registerNodeType(\"fx/generic\", LGraphFXGeneric);\r\n        global.LGraphFXGeneric = LGraphFXGeneric;\r\n\r\n        // Vigneting ************************************\r\n\r\n        function LGraphFXVigneting() {\r\n            this.addInput(\"Tex.\", \"Texture\");\r\n            this.addInput(\"intensity\", \"number\");\r\n\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                intensity: 1,\r\n                invert: false,\r\n                precision: LGraphTexture.DEFAULT\r\n            };\r\n\r\n            if (!LGraphFXVigneting._shader) {\r\n                LGraphFXVigneting._shader = new GL.Shader(\r\n                    Shader.SCREEN_VERTEX_SHADER,\r\n                    LGraphFXVigneting.pixel_shader\r\n                );\r\n            }\r\n        }\r\n\r\n        LGraphFXVigneting.title = \"Vigneting\";\r\n        LGraphFXVigneting.desc = \"Vigneting\";\r\n\r\n        LGraphFXVigneting.widgets_info = {\r\n            precision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n        };\r\n\r\n        LGraphFXVigneting.prototype.onExecute = function() {\r\n            var tex = this.getInputData(0);\r\n\r\n            if (this.properties.precision === LGraphTexture.PASS_THROUGH) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!tex) {\r\n                return;\r\n            }\r\n\r\n            this._tex = LGraphTexture.getTargetTexture(\r\n                tex,\r\n                this._tex,\r\n                this.properties.precision\r\n            );\r\n\r\n            var intensity = this.properties.intensity;\r\n            if (this.isInputConnected(1)) {\r\n                intensity = this.getInputData(1);\r\n                this.properties.intensity = intensity;\r\n            }\r\n\r\n            gl.disable(gl.BLEND);\r\n            gl.disable(gl.DEPTH_TEST);\r\n\r\n            var mesh = Mesh.getScreenQuad();\r\n            var shader = LGraphFXVigneting._shader;\r\n            var invert = this.properties.invert;\r\n\r\n            this._tex.drawTo(function() {\r\n                tex.bind(0);\r\n                shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_intensity: intensity,\r\n                        u_isize: [1 / tex.width, 1 / tex.height],\r\n                        u_invert: invert ? 1 : 0\r\n                    })\r\n                    .draw(mesh);\r\n            });\r\n\r\n            this.setOutputData(0, this._tex);\r\n        };\r\n\r\n        LGraphFXVigneting.pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tprecision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform float u_intensity;\\n\\\r\n\t\t\tuniform int u_invert;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tfloat luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tif(u_invert == 1)\\n\\\r\n\t\t\t\t\tluminance = 1.0 - luminance;\\n\\\r\n\t\t\t\tluminance = mix(1.0, luminance, u_intensity);\\n\\\r\n\t\t\t   gl_FragColor = vec4( luminance * color.xyz, color.a);\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n\r\n        LiteGraph.registerNodeType(\"fx/vigneting\", LGraphFXVigneting);\r\n        global.LGraphFXVigneting = LGraphFXVigneting;\r\n    }\r\n})(this);\r\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n    var MIDI_COLOR = \"#243\";\r\n\r\n    function MIDIEvent(data) {\r\n        this.channel = 0;\r\n        this.cmd = 0;\r\n        this.data = new Uint32Array(3);\r\n\r\n        if (data) {\r\n            this.setup(data);\r\n        }\r\n    }\r\n\r\n    LiteGraph.MIDIEvent = MIDIEvent;\r\n\r\n    MIDIEvent.prototype.fromJSON = function(o) {\r\n        this.setup(o.data);\r\n    };\r\n\r\n    MIDIEvent.prototype.setup = function(data) {\r\n        var raw_data = data;\r\n        if (data.constructor === Object) {\r\n            raw_data = data.data;\r\n        }\r\n\r\n        this.data.set(raw_data);\r\n\r\n        var midiStatus = raw_data[0];\r\n        this.status = midiStatus;\r\n\r\n        var midiCommand = midiStatus & 0xf0;\r\n\r\n        if (midiStatus >= 0xf0) {\r\n            this.cmd = midiStatus;\r\n        } else {\r\n            this.cmd = midiCommand;\r\n        }\r\n\r\n        if (this.cmd == MIDIEvent.NOTEON && this.velocity == 0) {\r\n            this.cmd = MIDIEvent.NOTEOFF;\r\n        }\r\n\r\n        this.cmd_str = MIDIEvent.commands[this.cmd] || \"\";\r\n\r\n        if (\r\n            midiCommand >= MIDIEvent.NOTEON ||\r\n            midiCommand <= MIDIEvent.NOTEOFF\r\n        ) {\r\n            this.channel = midiStatus & 0x0f;\r\n        }\r\n    };\r\n\r\n    Object.defineProperty(MIDIEvent.prototype, \"velocity\", {\r\n        get: function() {\r\n            if (this.cmd == MIDIEvent.NOTEON) {\r\n                return this.data[2];\r\n            }\r\n            return -1;\r\n        },\r\n        set: function(v) {\r\n            this.data[2] = v; //  v / 127;\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    MIDIEvent.notes = [\r\n        \"A\",\r\n        \"A#\",\r\n        \"B\",\r\n        \"C\",\r\n        \"C#\",\r\n        \"D\",\r\n        \"D#\",\r\n        \"E\",\r\n        \"F\",\r\n        \"F#\",\r\n        \"G\",\r\n        \"G#\"\r\n    ];\r\n    MIDIEvent.note_to_index = {\r\n        A: 0,\r\n        \"A#\": 1,\r\n        B: 2,\r\n        C: 3,\r\n        \"C#\": 4,\r\n        D: 5,\r\n        \"D#\": 6,\r\n        E: 7,\r\n        F: 8,\r\n        \"F#\": 9,\r\n        G: 10,\r\n        \"G#\": 11\r\n    };\r\n\r\n    Object.defineProperty(MIDIEvent.prototype, \"note\", {\r\n        get: function() {\r\n            if (this.cmd != MIDIEvent.NOTEON) {\r\n                return -1;\r\n            }\r\n            return MIDIEvent.toNoteString(this.data[1], true);\r\n        },\r\n        set: function(v) {\r\n            throw \"notes cannot be assigned this way, must modify the data[1]\";\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    Object.defineProperty(MIDIEvent.prototype, \"octave\", {\r\n        get: function() {\r\n            if (this.cmd != MIDIEvent.NOTEON) {\r\n                return -1;\r\n            }\r\n            var octave = this.data[1] - 24;\r\n            return Math.floor(octave / 12 + 1);\r\n        },\r\n        set: function(v) {\r\n            throw \"octave cannot be assigned this way, must modify the data[1]\";\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    //returns HZs\r\n    MIDIEvent.prototype.getPitch = function() {\r\n        return Math.pow(2, (this.data[1] - 69) / 12) * 440;\r\n    };\r\n\r\n    MIDIEvent.computePitch = function(note) {\r\n        return Math.pow(2, (note - 69) / 12) * 440;\r\n    };\r\n\r\n    MIDIEvent.prototype.getCC = function() {\r\n        return this.data[1];\r\n    };\r\n\r\n    MIDIEvent.prototype.getCCValue = function() {\r\n        return this.data[2];\r\n    };\r\n\r\n    //not tested, there is a formula missing here\r\n    MIDIEvent.prototype.getPitchBend = function() {\r\n        return this.data[1] + (this.data[2] << 7) - 8192;\r\n    };\r\n\r\n    MIDIEvent.computePitchBend = function(v1, v2) {\r\n        return v1 + (v2 << 7) - 8192;\r\n    };\r\n\r\n    MIDIEvent.prototype.setCommandFromString = function(str) {\r\n        this.cmd = MIDIEvent.computeCommandFromString(str);\r\n    };\r\n\r\n    MIDIEvent.computeCommandFromString = function(str) {\r\n        if (!str) {\r\n            return 0;\r\n        }\r\n\r\n        if (str && str.constructor === Number) {\r\n            return str;\r\n        }\r\n\r\n        str = str.toUpperCase();\r\n        switch (str) {\r\n            case \"NOTE ON\":\r\n            case \"NOTEON\":\r\n                return MIDIEvent.NOTEON;\r\n                break;\r\n            case \"NOTE OFF\":\r\n            case \"NOTEOFF\":\r\n                return MIDIEvent.NOTEON;\r\n                break;\r\n            case \"KEY PRESSURE\":\r\n            case \"KEYPRESSURE\":\r\n                return MIDIEvent.KEYPRESSURE;\r\n                break;\r\n            case \"CONTROLLER CHANGE\":\r\n            case \"CONTROLLERCHANGE\":\r\n            case \"CC\":\r\n                return MIDIEvent.CONTROLLERCHANGE;\r\n                break;\r\n            case \"PROGRAM CHANGE\":\r\n            case \"PROGRAMCHANGE\":\r\n            case \"PC\":\r\n                return MIDIEvent.PROGRAMCHANGE;\r\n                break;\r\n            case \"CHANNEL PRESSURE\":\r\n            case \"CHANNELPRESSURE\":\r\n                return MIDIEvent.CHANNELPRESSURE;\r\n                break;\r\n            case \"PITCH BEND\":\r\n            case \"PITCHBEND\":\r\n                return MIDIEvent.PITCHBEND;\r\n                break;\r\n            case \"TIME TICK\":\r\n            case \"TIMETICK\":\r\n                return MIDIEvent.TIMETICK;\r\n                break;\r\n            default:\r\n                return Number(str); //assume its a hex code\r\n        }\r\n    };\r\n\r\n    //transform from a pitch number to string like \"C4\"\r\n    MIDIEvent.toNoteString = function(d, skip_octave) {\r\n        d = Math.round(d); //in case it has decimals\r\n        var note = d - 21;\r\n        var octave = Math.floor((d - 24) / 12 + 1);\r\n        note = note % 12;\r\n        if (note < 0) {\r\n            note = 12 + note;\r\n        }\r\n        return MIDIEvent.notes[note] + (skip_octave ? \"\" : octave);\r\n    };\r\n\r\n    MIDIEvent.NoteStringToPitch = function(str) {\r\n        str = str.toUpperCase();\r\n        var note = str[0];\r\n        var octave = 4;\r\n\r\n        if (str[1] == \"#\") {\r\n            note += \"#\";\r\n            if (str.length > 2) {\r\n                octave = Number(str[2]);\r\n            }\r\n        } else {\r\n            if (str.length > 1) {\r\n                octave = Number(str[1]);\r\n            }\r\n        }\r\n        var pitch = MIDIEvent.note_to_index[note];\r\n        if (pitch == null) {\r\n            return null;\r\n        }\r\n        return (octave - 1) * 12 + pitch + 21;\r\n    };\r\n\r\n    MIDIEvent.prototype.toString = function() {\r\n        var str = \"\" + this.channel + \". \";\r\n        switch (this.cmd) {\r\n            case MIDIEvent.NOTEON:\r\n                str += \"NOTEON \" + MIDIEvent.toNoteString(this.data[1]);\r\n                break;\r\n            case MIDIEvent.NOTEOFF:\r\n                str += \"NOTEOFF \" + MIDIEvent.toNoteString(this.data[1]);\r\n                break;\r\n            case MIDIEvent.CONTROLLERCHANGE:\r\n                str += \"CC \" + this.data[1] + \" \" + this.data[2];\r\n                break;\r\n            case MIDIEvent.PROGRAMCHANGE:\r\n                str += \"PC \" + this.data[1];\r\n                break;\r\n            case MIDIEvent.PITCHBEND:\r\n                str += \"PITCHBEND \" + this.getPitchBend();\r\n                break;\r\n            case MIDIEvent.KEYPRESSURE:\r\n                str += \"KEYPRESS \" + this.data[1];\r\n                break;\r\n        }\r\n\r\n        return str;\r\n    };\r\n\r\n    MIDIEvent.prototype.toHexString = function() {\r\n        var str = \"\";\r\n        for (var i = 0; i < this.data.length; i++) {\r\n            str += this.data[i].toString(16) + \" \";\r\n        }\r\n    };\r\n\r\n    MIDIEvent.prototype.toJSON = function() {\r\n        return {\r\n            data: [this.data[0], this.data[1], this.data[2]],\r\n            object_class: \"MIDIEvent\"\r\n        };\r\n    };\r\n\r\n    MIDIEvent.NOTEOFF = 0x80;\r\n    MIDIEvent.NOTEON = 0x90;\r\n    MIDIEvent.KEYPRESSURE = 0xa0;\r\n    MIDIEvent.CONTROLLERCHANGE = 0xb0;\r\n    MIDIEvent.PROGRAMCHANGE = 0xc0;\r\n    MIDIEvent.CHANNELPRESSURE = 0xd0;\r\n    MIDIEvent.PITCHBEND = 0xe0;\r\n    MIDIEvent.TIMETICK = 0xf8;\r\n\r\n    MIDIEvent.commands = {\r\n        0x80: \"note off\",\r\n        0x90: \"note on\",\r\n        0xa0: \"key pressure\",\r\n        0xb0: \"controller change\",\r\n        0xc0: \"program change\",\r\n        0xd0: \"channel pressure\",\r\n        0xe0: \"pitch bend\",\r\n        0xf0: \"system\",\r\n        0xf2: \"Song pos\",\r\n        0xf3: \"Song select\",\r\n        0xf6: \"Tune request\",\r\n        0xf8: \"time tick\",\r\n        0xfa: \"Start Song\",\r\n        0xfb: \"Continue Song\",\r\n        0xfc: \"Stop Song\",\r\n        0xfe: \"Sensing\",\r\n        0xff: \"Reset\"\r\n    };\r\n\r\n    MIDIEvent.commands_short = {\r\n        0x80: \"NOTEOFF\",\r\n        0x90: \"NOTEOFF\",\r\n        0xa0: \"KEYP\",\r\n        0xb0: \"CC\",\r\n        0xc0: \"PC\",\r\n        0xd0: \"CP\",\r\n        0xe0: \"PB\",\r\n        0xf0: \"SYS\",\r\n        0xf2: \"POS\",\r\n        0xf3: \"SELECT\",\r\n        0xf6: \"TUNEREQ\",\r\n        0xf8: \"TT\",\r\n        0xfa: \"START\",\r\n        0xfb: \"CONTINUE\",\r\n        0xfc: \"STOP\",\r\n        0xfe: \"SENS\",\r\n        0xff: \"RESET\"\r\n    };\r\n\r\n    MIDIEvent.commands_reversed = {};\r\n    for (var i in MIDIEvent.commands) {\r\n        MIDIEvent.commands_reversed[MIDIEvent.commands[i]] = i;\r\n    }\r\n\r\n    //MIDI wrapper, instantiate by MIDIIn and MIDIOut\r\n    function MIDIInterface(on_ready, on_error) {\r\n        if (!navigator.requestMIDIAccess) {\r\n            this.error = \"not suppoorted\";\r\n            if (on_error) {\r\n                on_error(\"Not supported\");\r\n            } else {\r\n                console.error(\"MIDI NOT SUPPORTED, enable by chrome://flags\");\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.on_ready = on_ready;\r\n\r\n        this.state = {\r\n            note: [],\r\n            cc: []\r\n        };\r\n\r\n\t\tthis.input_ports = null;\r\n\t\tthis.input_ports_info = [];\r\n\t\tthis.output_ports = null;\r\n\t\tthis.output_ports_info = [];\r\n\r\n        navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this), this.onMIDIFailure.bind(this));\r\n    }\r\n\r\n    MIDIInterface.input = null;\r\n\r\n    MIDIInterface.MIDIEvent = MIDIEvent;\r\n\r\n    MIDIInterface.prototype.onMIDISuccess = function(midiAccess) {\r\n        console.log(\"MIDI ready!\");\r\n        console.log(midiAccess);\r\n        this.midi = midiAccess; // store in the global (in real usage, would probably keep in an object instance)\r\n        this.updatePorts();\r\n\r\n        if (this.on_ready) {\r\n            this.on_ready(this);\r\n        }\r\n    };\r\n\r\n    MIDIInterface.prototype.updatePorts = function() {\r\n        var midi = this.midi;\r\n        this.input_ports = midi.inputs;\r\n\t\tthis.input_ports_info = [];\r\n        this.output_ports = midi.outputs;\r\n\t\tthis.output_ports_info = [];\r\n\r\n        var num = 0;\r\n\r\n        var it = this.input_ports.values();\r\n        var it_value = it.next();\r\n        while (it_value && it_value.done === false) {\r\n            var port_info = it_value.value;\r\n\t\t\tthis.input_ports_info.push(port_info);\r\n            console.log( \"Input port [type:'\" + port_info.type + \"'] id:'\" + port_info.id + \"' manufacturer:'\" + port_info.manufacturer + \"' name:'\" + port_info.name + \"' version:'\" + port_info.version + \"'\" );\r\n            num++;\r\n            it_value = it.next();\r\n        }\r\n        this.num_input_ports = num;\r\n\r\n        num = 0;\r\n        var it = this.output_ports.values();\r\n        var it_value = it.next();\r\n        while (it_value && it_value.done === false) {\r\n            var port_info = it_value.value;\r\n\t\t\tthis.output_ports_info.push(port_info);\r\n            console.log( \"Output port [type:'\" + port_info.type + \"'] id:'\" + port_info.id + \"' manufacturer:'\" + port_info.manufacturer + \"' name:'\" + port_info.name + \"' version:'\" + port_info.version + \"'\" );\r\n            num++;\r\n            it_value = it.next();\r\n        }\r\n        this.num_output_ports = num;\r\n    };\r\n\r\n    MIDIInterface.prototype.onMIDIFailure = function(msg) {\r\n        console.error(\"Failed to get MIDI access - \" + msg);\r\n    };\r\n\r\n    MIDIInterface.prototype.openInputPort = function(port, callback) {\r\n        var input_port = this.input_ports.get(\"input-\" + port);\r\n        if (!input_port) {\r\n            return false;\r\n        }\r\n        MIDIInterface.input = this;\r\n        var that = this;\r\n\r\n        input_port.onmidimessage = function(a) {\r\n            var midi_event = new MIDIEvent(a.data);\r\n            that.updateState(midi_event);\r\n            if (callback) {\r\n                callback(a.data, midi_event);\r\n            }\r\n            if (MIDIInterface.on_message) {\r\n                MIDIInterface.on_message(a.data, midi_event);\r\n            }\r\n        };\r\n        console.log(\"port open: \", input_port);\r\n        return true;\r\n    };\r\n\r\n    MIDIInterface.parseMsg = function(data) {};\r\n\r\n    MIDIInterface.prototype.updateState = function(midi_event) {\r\n        switch (midi_event.cmd) {\r\n            case MIDIEvent.NOTEON:\r\n                this.state.note[midi_event.value1 | 0] = midi_event.value2;\r\n                break;\r\n            case MIDIEvent.NOTEOFF:\r\n                this.state.note[midi_event.value1 | 0] = 0;\r\n                break;\r\n            case MIDIEvent.CONTROLLERCHANGE:\r\n                this.state.cc[midi_event.getCC()] = midi_event.getCCValue();\r\n                break;\r\n        }\r\n    };\r\n\r\n    MIDIInterface.prototype.sendMIDI = function(port, midi_data) {\r\n        if (!midi_data) {\r\n            return;\r\n        }\r\n\r\n        var output_port = this.output_ports_info[port];//this.output_ports.get(\"output-\" + port);\r\n        if (!output_port) {\r\n            return;\r\n        }\r\n\r\n        MIDIInterface.output = this;\r\n\r\n        if (midi_data.constructor === MIDIEvent) {\r\n            output_port.send(midi_data.data);\r\n        } else {\r\n            output_port.send(midi_data);\r\n        }\r\n    };\r\n\r\n    function LGMIDIIn() {\r\n        this.addOutput(\"on_midi\", LiteGraph.EVENT);\r\n        this.addOutput(\"out\", \"midi\");\r\n        this.properties = { port: 0 };\r\n        this._last_midi_event = null;\r\n        this._current_midi_event = null;\r\n        this.boxcolor = \"#AAA\";\r\n        this._last_time = 0;\r\n\r\n        var that = this;\r\n        new MIDIInterface(function(midi) {\r\n            //open\r\n            that._midi = midi;\r\n            if (that._waiting) {\r\n                that.onStart();\r\n            }\r\n            that._waiting = false;\r\n        });\r\n    }\r\n\r\n    LGMIDIIn.MIDIInterface = MIDIInterface;\r\n\r\n    LGMIDIIn.title = \"MIDI Input\";\r\n    LGMIDIIn.desc = \"Reads MIDI from a input port\";\r\n    LGMIDIIn.color = MIDI_COLOR;\r\n\r\n    LGMIDIIn.prototype.getPropertyInfo = function(name) {\r\n        if (!this._midi) {\r\n            return;\r\n        }\r\n\r\n        if (name == \"port\") {\r\n            var values = {};\r\n            for (var i = 0; i < this._midi.input_ports_info.length; ++i) {\r\n                var input = this._midi.input_ports_info[i];\r\n                values[i] = i + \".- \" + input.name + \" version:\" + input.version;\r\n            }\r\n            return { type: \"enum\", values: values };\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onStart = function() {\r\n        if (this._midi) {\r\n            this._midi.openInputPort(\r\n                this.properties.port,\r\n                this.onMIDIEvent.bind(this)\r\n            );\r\n        } else {\r\n            this._waiting = true;\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onMIDIEvent = function(data, midi_event) {\r\n        this._last_midi_event = midi_event;\r\n        this.boxcolor = \"#AFA\";\r\n        this._last_time = LiteGraph.getTime();\r\n        this.trigger(\"on_midi\", midi_event);\r\n        if (midi_event.cmd == MIDIEvent.NOTEON) {\r\n            this.trigger(\"on_noteon\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.NOTEOFF) {\r\n            this.trigger(\"on_noteoff\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.CONTROLLERCHANGE) {\r\n            this.trigger(\"on_cc\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.PROGRAMCHANGE) {\r\n            this.trigger(\"on_pc\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.PITCHBEND) {\r\n            this.trigger(\"on_pitchbend\", midi_event);\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onDrawBackground = function(ctx) {\r\n        this.boxcolor = \"#AAA\";\r\n        if (!this.flags.collapsed && this._last_midi_event) {\r\n            ctx.fillStyle = \"white\";\r\n            var now = LiteGraph.getTime();\r\n            var f = 1.0 - Math.max(0, (now - this._last_time) * 0.001);\r\n            if (f > 0) {\r\n                var t = ctx.globalAlpha;\r\n                ctx.globalAlpha *= f;\r\n                ctx.font = \"12px Tahoma\";\r\n                ctx.fillText(\r\n                    this._last_midi_event.toString(),\r\n                    2,\r\n                    this.size[1] * 0.5 + 3\r\n                );\r\n                //ctx.fillRect(0,0,this.size[0],this.size[1]);\r\n                ctx.globalAlpha = t;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onExecute = function() {\r\n        if (this.outputs) {\r\n            var last = this._last_midi_event;\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n                var output = this.outputs[i];\r\n                var v = null;\r\n                switch (output.name) {\r\n                    case \"midi\":\r\n                        v = this._midi;\r\n                        break;\r\n                    case \"last_midi\":\r\n                        v = last;\r\n                        break;\r\n                    default:\r\n                        continue;\r\n                }\r\n                this.setOutputData(i, v);\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onGetOutputs = function() {\r\n        return [\r\n            [\"last_midi\", \"midi\"],\r\n            [\"on_midi\", LiteGraph.EVENT],\r\n            [\"on_noteon\", LiteGraph.EVENT],\r\n            [\"on_noteoff\", LiteGraph.EVENT],\r\n            [\"on_cc\", LiteGraph.EVENT],\r\n            [\"on_pc\", LiteGraph.EVENT],\r\n            [\"on_pitchbend\", LiteGraph.EVENT]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/input\", LGMIDIIn);\r\n\r\n    function LGMIDIOut() {\r\n        this.addInput(\"send\", LiteGraph.EVENT);\r\n        this.properties = { port: 0 };\r\n\r\n        var that = this;\r\n        new MIDIInterface(function(midi) {\r\n            that._midi = midi;\r\n\t\t\tthat.widget.options.values = that.getMIDIOutputs();\r\n        });\r\n\t\tthis.widget = this.addWidget(\"combo\",\"Device\",this.properties.port,{ property: \"port\", values: this.getMIDIOutputs.bind(this) });\r\n\t\tthis.size = [340,60];\r\n    }\r\n\r\n    LGMIDIOut.MIDIInterface = MIDIInterface;\r\n\r\n    LGMIDIOut.title = \"MIDI Output\";\r\n    LGMIDIOut.desc = \"Sends MIDI to output channel\";\r\n    LGMIDIOut.color = MIDI_COLOR;\r\n\r\n    LGMIDIOut.prototype.onGetPropertyInfo = function(name) {\r\n        if (!this._midi) {\r\n            return;\r\n        }\r\n\r\n        if (name == \"port\") {\r\n\t\t\tvar values = this.getMIDIOutputs();\r\n            return { type: \"enum\", values: values };\r\n        }\r\n    };\r\n\tLGMIDIOut.default_ports = {0:\"unknown\"};\r\n\r\n\tLGMIDIOut.prototype.getMIDIOutputs = function()\r\n\t{\r\n\t\tvar values = {};\r\n\t\tif(!this._midi)\r\n\t\t\treturn LGMIDIOut.default_ports;\r\n\t\tif(this._midi.output_ports_info)\r\n\t\tfor (var i = 0; i < this._midi.output_ports_info.length; ++i) {\r\n\t\t\tvar output = this._midi.output_ports_info[i];\r\n\t\t\tif(!output)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar name = i + \".- \" + output.name + \" version:\" + output.version;\r\n\t\t\tvalues[i] = name;\r\n\t\t}\r\n\t\treturn values;\r\n\t}\r\n\r\n    LGMIDIOut.prototype.onAction = function(event, midi_event) {\r\n        //console.log(midi_event);\r\n        if (!this._midi) {\r\n            return;\r\n        }\r\n        if (event == \"send\") {\r\n            this._midi.sendMIDI(this.properties.port, midi_event);\r\n        }\r\n        this.trigger(\"midi\", midi_event);\r\n    };\r\n\r\n    LGMIDIOut.prototype.onGetInputs = function() {\r\n        return [[\"send\", LiteGraph.ACTION]];\r\n    };\r\n\r\n    LGMIDIOut.prototype.onGetOutputs = function() {\r\n        return [[\"on_midi\", LiteGraph.EVENT]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/output\", LGMIDIOut);\r\n\r\n\r\n    function LGMIDIShow() {\r\n        this.addInput(\"on_midi\", LiteGraph.EVENT);\r\n        this._str = \"\";\r\n        this.size = [200, 40];\r\n    }\r\n\r\n    LGMIDIShow.title = \"MIDI Show\";\r\n    LGMIDIShow.desc = \"Shows MIDI in the graph\";\r\n    LGMIDIShow.color = MIDI_COLOR;\r\n\r\n    LGMIDIShow.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this._str;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    LGMIDIShow.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event) {\r\n            return;\r\n        }\r\n        if (midi_event.constructor === MIDIEvent) {\r\n            this._str = midi_event.toString();\r\n        } else {\r\n            this._str = \"???\";\r\n        }\r\n    };\r\n\r\n    LGMIDIShow.prototype.onDrawForeground = function(ctx) {\r\n        if (!this._str || this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        ctx.font = \"30px Arial\";\r\n        ctx.fillText(this._str, 10, this.size[1] * 0.8);\r\n    };\r\n\r\n    LGMIDIShow.prototype.onGetInputs = function() {\r\n        return [[\"in\", LiteGraph.ACTION]];\r\n    };\r\n\r\n    LGMIDIShow.prototype.onGetOutputs = function() {\r\n        return [[\"on_midi\", LiteGraph.EVENT]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/show\", LGMIDIShow);\r\n\r\n    function LGMIDIFilter() {\r\n        this.properties = {\r\n            channel: -1,\r\n            cmd: -1,\r\n            min_value: -1,\r\n            max_value: -1\r\n        };\r\n\r\n        var that = this;\r\n        this._learning = false;\r\n        this.addWidget(\"button\", \"Learn\", \"\", function() {\r\n            that._learning = true;\r\n            that.boxcolor = \"#FA3\";\r\n        });\r\n\r\n        this.addInput(\"in\", LiteGraph.EVENT);\r\n        this.addOutput(\"on_midi\", LiteGraph.EVENT);\r\n        this.boxcolor = \"#AAA\";\r\n    }\r\n\r\n    LGMIDIFilter.title = \"MIDI Filter\";\r\n    LGMIDIFilter.desc = \"Filters MIDI messages\";\r\n    LGMIDIFilter.color = MIDI_COLOR;\r\n\r\n    LGMIDIFilter[\"@cmd\"] = {\r\n        type: \"enum\",\r\n        title: \"Command\",\r\n        values: MIDIEvent.commands_reversed\r\n    };\r\n\r\n    LGMIDIFilter.prototype.getTitle = function() {\r\n        var str = null;\r\n        if (this.properties.cmd == -1) {\r\n            str = \"Nothing\";\r\n        } else {\r\n            str = MIDIEvent.commands_short[this.properties.cmd] || \"Unknown\";\r\n        }\r\n\r\n        if (\r\n            this.properties.min_value != -1 &&\r\n            this.properties.max_value != -1\r\n        ) {\r\n            str +=\r\n                \" \" +\r\n                (this.properties.min_value == this.properties.max_value\r\n                    ? this.properties.max_value\r\n                    : this.properties.min_value +\r\n                      \"..\" +\r\n                      this.properties.max_value);\r\n        }\r\n\r\n        return \"Filter: \" + str;\r\n    };\r\n\r\n    LGMIDIFilter.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"cmd\") {\r\n            var num = Number(value);\r\n            if (isNaN(num)) {\r\n                num = MIDIEvent.commands[value] || 0;\r\n            }\r\n            this.properties.cmd = num;\r\n        }\r\n    };\r\n\r\n    LGMIDIFilter.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (this._learning) {\r\n            this._learning = false;\r\n            this.boxcolor = \"#AAA\";\r\n            this.properties.channel = midi_event.channel;\r\n            this.properties.cmd = midi_event.cmd;\r\n            this.properties.min_value = this.properties.max_value =\r\n                midi_event.data[1];\r\n        } else {\r\n            if (\r\n                this.properties.channel != -1 &&\r\n                midi_event.channel != this.properties.channel\r\n            ) {\r\n                return;\r\n            }\r\n            if (\r\n                this.properties.cmd != -1 &&\r\n                midi_event.cmd != this.properties.cmd\r\n            ) {\r\n                return;\r\n            }\r\n            if (\r\n                this.properties.min_value != -1 &&\r\n                midi_event.data[1] < this.properties.min_value\r\n            ) {\r\n                return;\r\n            }\r\n            if (\r\n                this.properties.max_value != -1 &&\r\n                midi_event.data[1] > this.properties.max_value\r\n            ) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.trigger(\"on_midi\", midi_event);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/filter\", LGMIDIFilter);\r\n\r\n    function LGMIDIEvent() {\r\n        this.properties = {\r\n            channel: 0,\r\n            cmd: 144, //0x90\r\n            value1: 1,\r\n            value2: 1\r\n        };\r\n\r\n        this.addInput(\"send\", LiteGraph.EVENT);\r\n        this.addInput(\"assign\", LiteGraph.EVENT);\r\n        this.addOutput(\"on_midi\", LiteGraph.EVENT);\r\n\r\n        this.midi_event = new MIDIEvent();\r\n        this.gate = false;\r\n    }\r\n\r\n    LGMIDIEvent.title = \"MIDIEvent\";\r\n    LGMIDIEvent.desc = \"Create a MIDI Event\";\r\n    LGMIDIEvent.color = MIDI_COLOR;\r\n\r\n    LGMIDIEvent.prototype.onAction = function(event, midi_event) {\r\n        if (event == \"assign\") {\r\n            this.properties.channel = midi_event.channel;\r\n            this.properties.cmd = midi_event.cmd;\r\n            this.properties.value1 = midi_event.data[1];\r\n            this.properties.value2 = midi_event.data[2];\r\n            if (midi_event.cmd == MIDIEvent.NOTEON) {\r\n                this.gate = true;\r\n            } else if (midi_event.cmd == MIDIEvent.NOTEOFF) {\r\n                this.gate = false;\r\n            }\r\n            return;\r\n        }\r\n\r\n        //send\r\n        var midi_event = this.midi_event;\r\n        midi_event.channel = this.properties.channel;\r\n        if (this.properties.cmd && this.properties.cmd.constructor === String) {\r\n            midi_event.setCommandFromString(this.properties.cmd);\r\n        } else {\r\n            midi_event.cmd = this.properties.cmd;\r\n        }\r\n        midi_event.data[0] = midi_event.cmd | midi_event.channel;\r\n        midi_event.data[1] = Number(this.properties.value1);\r\n        midi_event.data[2] = Number(this.properties.value2);\r\n\r\n        this.trigger(\"on_midi\", midi_event);\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onExecute = function() {\r\n        var props = this.properties;\r\n\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; ++i) {\r\n                var input = this.inputs[i];\r\n                if (input.link == -1) {\r\n                    continue;\r\n                }\r\n                switch (input.name) {\r\n                    case \"note\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            if (v.constructor === String) {\r\n                                v = MIDIEvent.NoteStringToPitch(v);\r\n                            }\r\n                            this.properties.value1 = (v | 0) % 255;\r\n                        }\r\n                        break;\r\n                    case \"cmd\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            this.properties.cmd = v;\r\n                        }\r\n                        break;\r\n                    case \"value1\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            this.properties.value1 = clamp(v|0,0,127);\r\n                        }\r\n                        break;\r\n                    case \"value2\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            this.properties.value2 = clamp(v|0,0,127);\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n                var output = this.outputs[i];\r\n                var v = null;\r\n                switch (output.name) {\r\n                    case \"midi\":\r\n                        v = new MIDIEvent();\r\n                        v.setup([props.cmd, props.value1, props.value2]);\r\n                        v.channel = props.channel;\r\n                        break;\r\n                    case \"command\":\r\n                        v = props.cmd;\r\n                        break;\r\n                    case \"cc\":\r\n                        v = props.value1;\r\n                        break;\r\n                    case \"cc_value\":\r\n                        v = props.value2;\r\n                        break;\r\n                    case \"note\":\r\n                        v =\r\n                            props.cmd == MIDIEvent.NOTEON ||\r\n                            props.cmd == MIDIEvent.NOTEOFF\r\n                                ? props.value1\r\n                                : null;\r\n                        break;\r\n                    case \"velocity\":\r\n                        v = props.cmd == MIDIEvent.NOTEON ? props.value2 : null;\r\n                        break;\r\n                    case \"pitch\":\r\n                        v =\r\n                            props.cmd == MIDIEvent.NOTEON\r\n                                ? MIDIEvent.computePitch(props.value1)\r\n                                : null;\r\n                        break;\r\n                    case \"pitchbend\":\r\n                        v =\r\n                            props.cmd == MIDIEvent.PITCHBEND\r\n                                ? MIDIEvent.computePitchBend(\r\n                                      props.value1,\r\n                                      props.value2\r\n                                  )\r\n                                : null;\r\n                        break;\r\n                    case \"gate\":\r\n                        v = this.gate;\r\n                        break;\r\n                    default:\r\n                        continue;\r\n                }\r\n                if (v !== null) {\r\n                    this.setOutputData(i, v);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"cmd\") {\r\n            this.properties.cmd = MIDIEvent.computeCommandFromString(value);\r\n        }\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onGetInputs = function() {\r\n        return [[\"cmd\", \"number\"],[\"note\", \"number\"],[\"value1\", \"number\"],[\"value2\", \"number\"]];\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onGetOutputs = function() {\r\n        return [\r\n            [\"midi\", \"midi\"],\r\n            [\"on_midi\", LiteGraph.EVENT],\r\n            [\"command\", \"number\"],\r\n            [\"note\", \"number\"],\r\n            [\"velocity\", \"number\"],\r\n            [\"cc\", \"number\"],\r\n            [\"cc_value\", \"number\"],\r\n            [\"pitch\", \"number\"],\r\n            [\"gate\", \"bool\"],\r\n            [\"pitchbend\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/event\", LGMIDIEvent);\r\n\r\n    function LGMIDICC() {\r\n        this.properties = {\r\n            //\t\tchannel: 0,\r\n            cc: 1,\r\n            value: 0\r\n        };\r\n\r\n        this.addOutput(\"value\", \"number\");\r\n    }\r\n\r\n    LGMIDICC.title = \"MIDICC\";\r\n    LGMIDICC.desc = \"gets a Controller Change\";\r\n    LGMIDICC.color = MIDI_COLOR;\r\n\r\n    LGMIDICC.prototype.onExecute = function() {\r\n        var props = this.properties;\r\n        if (MIDIInterface.input) {\r\n            this.properties.value =\r\n                MIDIInterface.input.state.cc[this.properties.cc];\r\n        }\r\n        this.setOutputData(0, this.properties.value);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/cc\", LGMIDICC);\r\n\r\n    function LGMIDIGenerator() {\r\n        this.addInput(\"generate\", LiteGraph.ACTION);\r\n        this.addInput(\"scale\", \"string\");\r\n        this.addInput(\"octave\", \"number\");\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n        this.properties = {\r\n            notes: \"A,A#,B,C,C#,D,D#,E,F,F#,G,G#\",\r\n            octave: 2,\r\n            duration: 0.5,\r\n            mode: \"sequence\"\r\n        };\r\n\r\n        this.notes_pitches = LGMIDIGenerator.processScale(\r\n            this.properties.notes\r\n        );\r\n        this.sequence_index = 0;\r\n    }\r\n\r\n    LGMIDIGenerator.title = \"MIDI Generator\";\r\n    LGMIDIGenerator.desc = \"Generates a random MIDI note\";\r\n    LGMIDIGenerator.color = MIDI_COLOR;\r\n\r\n    LGMIDIGenerator.processScale = function(scale) {\r\n        var notes = scale.split(\",\");\r\n        for (var i = 0; i < notes.length; ++i) {\r\n            var n = notes[i];\r\n            if ((n.length == 2 && n[1] != \"#\") || n.length > 2) {\r\n                notes[i] = -LiteGraph.MIDIEvent.NoteStringToPitch(n);\r\n            } else {\r\n                notes[i] = MIDIEvent.note_to_index[n] || 0;\r\n            }\r\n        }\r\n        return notes;\r\n    };\r\n\r\n    LGMIDIGenerator.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"notes\") {\r\n            this.notes_pitches = LGMIDIGenerator.processScale(value);\r\n        }\r\n    };\r\n\r\n    LGMIDIGenerator.prototype.onExecute = function() {\r\n        var octave = this.getInputData(2);\r\n        if (octave != null) {\r\n            this.properties.octave = octave;\r\n        }\r\n\r\n        var scale = this.getInputData(1);\r\n        if (scale) {\r\n            this.notes_pitches = LGMIDIGenerator.processScale(scale);\r\n        }\r\n    };\r\n\r\n    LGMIDIGenerator.prototype.onAction = function(event, midi_event) {\r\n        //var range = this.properties.max - this.properties.min;\r\n        //var pitch = this.properties.min + ((Math.random() * range)|0);\r\n        var pitch = 0;\r\n        var range = this.notes_pitches.length;\r\n        var index = 0;\r\n\r\n        if (this.properties.mode == \"sequence\") {\r\n            index = this.sequence_index = (this.sequence_index + 1) % range;\r\n        } else if (this.properties.mode == \"random\") {\r\n            index = Math.floor(Math.random() * range);\r\n        }\r\n\r\n        var note = this.notes_pitches[index];\r\n        if (note >= 0) {\r\n            pitch = note + (this.properties.octave - 1) * 12 + 33;\r\n        } else {\r\n            pitch = -note;\r\n        }\r\n\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEON, pitch, 10]);\r\n        var duration = this.properties.duration || 1;\r\n        this.trigger(\"note\", midi_event);\r\n\r\n        //noteoff\r\n        setTimeout(\r\n            function() {\r\n                var midi_event = new MIDIEvent();\r\n                midi_event.setup([MIDIEvent.NOTEOFF, pitch, 0]);\r\n                this.trigger(\"note\", midi_event);\r\n            }.bind(this),\r\n            duration * 1000\r\n        );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/generator\", LGMIDIGenerator);\r\n\r\n    function LGMIDITranspose() {\r\n        this.properties = {\r\n            amount: 0\r\n        };\r\n        this.addInput(\"in\", LiteGraph.ACTION);\r\n        this.addInput(\"amount\", \"number\");\r\n        this.addOutput(\"out\", LiteGraph.EVENT);\r\n\r\n        this.midi_event = new MIDIEvent();\r\n    }\r\n\r\n    LGMIDITranspose.title = \"MIDI Transpose\";\r\n    LGMIDITranspose.desc = \"Transpose a MIDI note\";\r\n    LGMIDITranspose.color = MIDI_COLOR;\r\n\r\n    LGMIDITranspose.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (\r\n            midi_event.data[0] == MIDIEvent.NOTEON ||\r\n            midi_event.data[0] == MIDIEvent.NOTEOFF\r\n        ) {\r\n            this.midi_event = new MIDIEvent();\r\n            this.midi_event.setup(midi_event.data);\r\n            this.midi_event.data[1] = Math.round(\r\n                this.midi_event.data[1] + this.properties.amount\r\n            );\r\n            this.trigger(\"out\", this.midi_event);\r\n        } else {\r\n            this.trigger(\"out\", midi_event);\r\n        }\r\n    };\r\n\r\n    LGMIDITranspose.prototype.onExecute = function() {\r\n        var amount = this.getInputData(1);\r\n        if (amount != null) {\r\n            this.properties.amount = amount;\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/transpose\", LGMIDITranspose);\r\n\r\n    function LGMIDIQuantize() {\r\n        this.properties = {\r\n            scale: \"A,A#,B,C,C#,D,D#,E,F,F#,G,G#\"\r\n        };\r\n        this.addInput(\"note\", LiteGraph.ACTION);\r\n        this.addInput(\"scale\", \"string\");\r\n        this.addOutput(\"out\", LiteGraph.EVENT);\r\n\r\n        this.valid_notes = new Array(12);\r\n        this.offset_notes = new Array(12);\r\n        this.processScale(this.properties.scale);\r\n    }\r\n\r\n    LGMIDIQuantize.title = \"MIDI Quantize Pitch\";\r\n    LGMIDIQuantize.desc = \"Transpose a MIDI note tp fit an scale\";\r\n    LGMIDIQuantize.color = MIDI_COLOR;\r\n\r\n    LGMIDIQuantize.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"scale\") {\r\n            this.processScale(value);\r\n        }\r\n    };\r\n\r\n    LGMIDIQuantize.prototype.processScale = function(scale) {\r\n        this._current_scale = scale;\r\n        this.notes_pitches = LGMIDIGenerator.processScale(scale);\r\n        for (var i = 0; i < 12; ++i) {\r\n            this.valid_notes[i] = this.notes_pitches.indexOf(i) != -1;\r\n        }\r\n        for (var i = 0; i < 12; ++i) {\r\n            if (this.valid_notes[i]) {\r\n                this.offset_notes[i] = 0;\r\n                continue;\r\n            }\r\n            for (var j = 1; j < 12; ++j) {\r\n                if (this.valid_notes[(i - j) % 12]) {\r\n                    this.offset_notes[i] = -j;\r\n                    break;\r\n                }\r\n                if (this.valid_notes[(i + j) % 12]) {\r\n                    this.offset_notes[i] = j;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIQuantize.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (\r\n            midi_event.data[0] == MIDIEvent.NOTEON ||\r\n            midi_event.data[0] == MIDIEvent.NOTEOFF\r\n        ) {\r\n            this.midi_event = new MIDIEvent();\r\n            this.midi_event.setup(midi_event.data);\r\n            var note = midi_event.note;\r\n            var index = MIDIEvent.note_to_index[note];\r\n            var offset = this.offset_notes[index];\r\n            this.midi_event.data[1] += offset;\r\n            this.trigger(\"out\", this.midi_event);\r\n        } else {\r\n            this.trigger(\"out\", midi_event);\r\n        }\r\n    };\r\n\r\n    LGMIDIQuantize.prototype.onExecute = function() {\r\n        var scale = this.getInputData(1);\r\n        if (scale != null && scale != this._current_scale) {\r\n            this.processScale(scale);\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/quantize\", LGMIDIQuantize);\r\n\r\n\tfunction LGMIDIFromFile() {\r\n        this.properties = {\r\n            url: \"\",\r\n\t\t\tautoplay: true\r\n        };\r\n\r\n        this.addInput(\"play\", LiteGraph.ACTION);\r\n        this.addInput(\"pause\", LiteGraph.ACTION);\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n\t\tthis._midi = null;\r\n\t\tthis._current_time = 0;\r\n\t\tthis._playing = false;\r\n\r\n        if (typeof MidiParser == \"undefined\") {\r\n            console.error(\r\n                \"midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js\"\r\n            );\r\n            this.boxcolor = \"red\";\r\n\t\t}\r\n\r\n\t}\r\n\r\n    LGMIDIFromFile.title = \"MIDI fromFile\";\r\n    LGMIDIFromFile.desc = \"Plays a MIDI file\";\r\n    LGMIDIFromFile.color = MIDI_COLOR;\r\n\r\n\tLGMIDIFromFile.prototype.onAction = function( name )\r\n\t{\r\n\t\tif(name == \"play\")\r\n\t\t\tthis.play();\r\n\t\telse if(name == \"pause\")\r\n\t\t\tthis._playing = !this._playing;\r\n\t}\r\n\r\n\tLGMIDIFromFile.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tif(name == \"url\")\r\n\t\t\tthis.loadMIDIFile(value);\r\n\t}\r\n\r\n    LGMIDIFromFile.prototype.onExecute = function() {\r\n\t\tif(!this._midi)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this._playing)\r\n\t\t\treturn;\r\n\r\n\t\tthis._current_time += this.graph.elapsed_time;\r\n\t\tvar current_time = this._current_time * 100;\r\n\r\n\t\tfor(var i = 0; i < this._midi.tracks; ++i)\r\n\t\t{\r\n\t\t\tvar track = this._midi.track[i];\r\n\t\t\tif(!track._last_pos)\r\n\t\t\t{\r\n\t\t\t\ttrack._last_pos = 0;\r\n\t\t\t\ttrack._time = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar elem = track.event[ track._last_pos ];\r\n\t\t\tif(elem && (track._time + elem.deltaTime) <= current_time )\r\n\t\t\t{\r\n\t\t\t\ttrack._last_pos++;\r\n\t\t\t\ttrack._time += elem.deltaTime;\r\n\r\n\t\t\t\tif(elem.data)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar midi_cmd = elem.type << 4 + elem.channel;\r\n\t\t\t\t\tvar midi_event = new MIDIEvent();\r\n\t\t\t\t\tmidi_event.setup([midi_cmd, elem.data[0], elem.data[1]]);\r\n\t\t\t\t\tthis.trigger(\"note\", midi_event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n    };\r\n\r\n\tLGMIDIFromFile.prototype.play = function()\r\n\t{\r\n\t\tthis._playing = true;\r\n\t\tthis._current_time = 0;\r\n\t\tif(!this._midi)\r\n\t\t\treturn;\r\n\r\n\t\tfor(var i = 0; i < this._midi.tracks; ++i)\r\n\t\t{\r\n\t\t\tvar track = this._midi.track[i];\r\n\t\t\ttrack._last_pos = 0;\r\n\t\t\ttrack._time = 0;\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tLGMIDIFromFile.prototype.loadMIDIFile = function(url)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tLiteGraph.fetchFile( url, \"arraybuffer\", function(data)\r\n\t\t{\r\n\t\t\tthat.boxcolor = \"#AFA\";\r\n\t\t\tthat._midi = MidiParser.parse( new Uint8Array(data) );\r\n\t\t\tif(that.properties.autoplay)\r\n\t\t\t\tthat.play();\r\n\t\t}, function(err){\r\n\t\t\tthat.boxcolor = \"#FAA\";\r\n\t\t\tthat._midi = null;\r\n\t\t});\r\n\t}\r\n\r\n\tLGMIDIFromFile.prototype.onDropFile = function(file)\r\n\t{\r\n\t\tthis.properties.url = \"\";\r\n\t\tthis.loadMIDIFile( file );\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"midi/fromFile\", LGMIDIFromFile);\r\n\r\n\r\n    function LGMIDIPlay() {\r\n        this.properties = {\r\n            volume: 0.5,\r\n            duration: 1\r\n        };\r\n        this.addInput(\"note\", LiteGraph.ACTION);\r\n        this.addInput(\"volume\", \"number\");\r\n        this.addInput(\"duration\", \"number\");\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n\r\n        if (typeof AudioSynth == \"undefined\") {\r\n            console.error(\r\n                \"Audiosynth.js not included, LGMidiPlay requires that library\"\r\n            );\r\n            this.boxcolor = \"red\";\r\n        } else {\r\n            var Synth = (this.synth = new AudioSynth());\r\n            this.instrument = Synth.createInstrument(\"piano\");\r\n        }\r\n    }\r\n\r\n    LGMIDIPlay.title = \"MIDI Play\";\r\n    LGMIDIPlay.desc = \"Plays a MIDI note\";\r\n    LGMIDIPlay.color = MIDI_COLOR;\r\n\r\n    LGMIDIPlay.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (this.instrument && midi_event.data[0] == MIDIEvent.NOTEON) {\r\n            var note = midi_event.note; //C#\r\n            if (!note || note == \"undefined\" || note.constructor !== String) {\r\n                return;\r\n            }\r\n            this.instrument.play(\r\n                note,\r\n                midi_event.octave,\r\n                this.properties.duration,\r\n                this.properties.volume\r\n            );\r\n        }\r\n        this.trigger(\"note\", midi_event);\r\n    };\r\n\r\n    LGMIDIPlay.prototype.onExecute = function() {\r\n        var volume = this.getInputData(1);\r\n        if (volume != null) {\r\n            this.properties.volume = volume;\r\n        }\r\n\r\n        var duration = this.getInputData(2);\r\n        if (duration != null) {\r\n            this.properties.duration = duration;\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/play\", LGMIDIPlay);\r\n\r\n    function LGMIDIKeys() {\r\n        this.properties = {\r\n            num_octaves: 2,\r\n            start_octave: 2\r\n        };\r\n        this.addInput(\"note\", LiteGraph.ACTION);\r\n        this.addInput(\"reset\", LiteGraph.ACTION);\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n        this.size = [400, 100];\r\n        this.keys = [];\r\n        this._last_key = -1;\r\n    }\r\n\r\n    LGMIDIKeys.title = \"MIDI Keys\";\r\n    LGMIDIKeys.desc = \"Keyboard to play notes\";\r\n    LGMIDIKeys.color = MIDI_COLOR;\r\n\r\n    LGMIDIKeys.keys = [\r\n        { x: 0, w: 1, h: 1, t: 0 },\r\n        { x: 0.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 1, w: 1, h: 1, t: 0 },\r\n        { x: 1.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 2, w: 1, h: 1, t: 0 },\r\n        { x: 2.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 3, w: 1, h: 1, t: 0 },\r\n        { x: 4, w: 1, h: 1, t: 0 },\r\n        { x: 4.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 5, w: 1, h: 1, t: 0 },\r\n        { x: 5.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 6, w: 1, h: 1, t: 0 }\r\n    ];\r\n\r\n    LGMIDIKeys.prototype.onDrawForeground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        var num_keys = this.properties.num_octaves * 12;\r\n        this.keys.length = num_keys;\r\n        var key_width = this.size[0] / (this.properties.num_octaves * 7);\r\n        var key_height = this.size[1];\r\n\r\n        ctx.globalAlpha = 1;\r\n\r\n        for (\r\n            var k = 0;\r\n            k < 2;\r\n            k++ //draw first whites (0) then blacks (1)\r\n        ) {\r\n            for (var i = 0; i < num_keys; ++i) {\r\n                var key_info = LGMIDIKeys.keys[i % 12];\r\n                if (key_info.t != k) {\r\n                    continue;\r\n                }\r\n                var octave = Math.floor(i / 12);\r\n                var x = octave * 7 * key_width + key_info.x * key_width;\r\n                if (k == 0) {\r\n                    ctx.fillStyle = this.keys[i] ? \"#CCC\" : \"white\";\r\n                } else {\r\n                    ctx.fillStyle = this.keys[i] ? \"#333\" : \"black\";\r\n                }\r\n                ctx.fillRect(\r\n                    x + 1,\r\n                    0,\r\n                    key_width * key_info.w - 2,\r\n                    key_height * key_info.h\r\n                );\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIKeys.prototype.getKeyIndex = function(pos) {\r\n        var num_keys = this.properties.num_octaves * 12;\r\n        var key_width = this.size[0] / (this.properties.num_octaves * 7);\r\n        var key_height = this.size[1];\r\n\r\n        for (\r\n            var k = 1;\r\n            k >= 0;\r\n            k-- //test blacks first (1) then whites (0)\r\n        ) {\r\n            for (var i = 0; i < this.keys.length; ++i) {\r\n                var key_info = LGMIDIKeys.keys[i % 12];\r\n                if (key_info.t != k) {\r\n                    continue;\r\n                }\r\n                var octave = Math.floor(i / 12);\r\n                var x = octave * 7 * key_width + key_info.x * key_width;\r\n                var w = key_width * key_info.w;\r\n                var h = key_height * key_info.h;\r\n                if (pos[0] < x || pos[0] > x + w || pos[1] > h) {\r\n                    continue;\r\n                }\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onAction = function(event, params) {\r\n        if (event == \"reset\") {\r\n            for (var i = 0; i < this.keys.length; ++i) {\r\n                this.keys[i] = false;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (!params || params.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n        var midi_event = params;\r\n        var start_note = (this.properties.start_octave - 1) * 12 + 29;\r\n        var index = midi_event.data[1] - start_note;\r\n        if (index >= 0 && index < this.keys.length) {\r\n            if (midi_event.data[0] == MIDIEvent.NOTEON) {\r\n                this.keys[index] = true;\r\n            } else if (midi_event.data[0] == MIDIEvent.NOTEOFF) {\r\n                this.keys[index] = false;\r\n            }\r\n        }\r\n\r\n        this.trigger(\"note\", midi_event);\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onMouseDown = function(e, pos) {\r\n        if (pos[1] < 0) {\r\n            return;\r\n        }\r\n        var index = this.getKeyIndex(pos);\r\n        this.keys[index] = true;\r\n        this._last_key = index;\r\n        var pitch = (this.properties.start_octave - 1) * 12 + 29 + index;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEON, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n        return true;\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onMouseMove = function(e, pos) {\r\n        if (pos[1] < 0 || this._last_key == -1) {\r\n            return;\r\n        }\r\n        this.setDirtyCanvas(true);\r\n        var index = this.getKeyIndex(pos);\r\n        if (this._last_key == index) {\r\n            return true;\r\n        }\r\n        this.keys[this._last_key] = false;\r\n        var pitch =\r\n            (this.properties.start_octave - 1) * 12 + 29 + this._last_key;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEOFF, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n\r\n        this.keys[index] = true;\r\n        var pitch = (this.properties.start_octave - 1) * 12 + 29 + index;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEON, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n\r\n        this._last_key = index;\r\n        return true;\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onMouseUp = function(e, pos) {\r\n        if (pos[1] < 0) {\r\n            return;\r\n        }\r\n        var index = this.getKeyIndex(pos);\r\n        this.keys[index] = false;\r\n        this._last_key = -1;\r\n        var pitch = (this.properties.start_octave - 1) * 12 + 29 + index;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEOFF, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n        return true;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/keys\", LGMIDIKeys);\r\n\r\n    function now() {\r\n        return window.performance.now();\r\n    }\r\n})(this);\r\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    var LGAudio = {};\r\n    global.LGAudio = LGAudio;\r\n\r\n    LGAudio.getAudioContext = function() {\r\n        if (!this._audio_context) {\r\n            window.AudioContext =\r\n                window.AudioContext || window.webkitAudioContext;\r\n            if (!window.AudioContext) {\r\n                console.error(\"AudioContext not supported by browser\");\r\n                return null;\r\n            }\r\n            this._audio_context = new AudioContext();\r\n            this._audio_context.onmessage = function(msg) {\r\n                console.log(\"msg\", msg);\r\n            };\r\n            this._audio_context.onended = function(msg) {\r\n                console.log(\"ended\", msg);\r\n            };\r\n            this._audio_context.oncomplete = function(msg) {\r\n                console.log(\"complete\", msg);\r\n            };\r\n        }\r\n\r\n        //in case it crashes\r\n        //if(this._audio_context.state == \"suspended\")\r\n        //\tthis._audio_context.resume();\r\n        return this._audio_context;\r\n    };\r\n\r\n    LGAudio.connect = function(audionodeA, audionodeB) {\r\n        try {\r\n            audionodeA.connect(audionodeB);\r\n        } catch (err) {\r\n            console.warn(\"LGraphAudio:\", err);\r\n        }\r\n    };\r\n\r\n    LGAudio.disconnect = function(audionodeA, audionodeB) {\r\n        try {\r\n            audionodeA.disconnect(audionodeB);\r\n        } catch (err) {\r\n            console.warn(\"LGraphAudio:\", err);\r\n        }\r\n    };\r\n\r\n    LGAudio.changeAllAudiosConnections = function(node, connect) {\r\n        if (node.inputs) {\r\n            for (var i = 0; i < node.inputs.length; ++i) {\r\n                var input = node.inputs[i];\r\n                var link_info = node.graph.links[input.link];\r\n                if (!link_info) {\r\n                    continue;\r\n                }\r\n\r\n                var origin_node = node.graph.getNodeById(link_info.origin_id);\r\n                var origin_audionode = null;\r\n                if (origin_node.getAudioNodeInOutputSlot) {\r\n                    origin_audionode = origin_node.getAudioNodeInOutputSlot(\r\n                        link_info.origin_slot\r\n                    );\r\n                } else {\r\n                    origin_audionode = origin_node.audionode;\r\n                }\r\n\r\n                var target_audionode = null;\r\n                if (node.getAudioNodeInInputSlot) {\r\n                    target_audionode = node.getAudioNodeInInputSlot(i);\r\n                } else {\r\n                    target_audionode = node.audionode;\r\n                }\r\n\r\n                if (connect) {\r\n                    LGAudio.connect(origin_audionode, target_audionode);\r\n                } else {\r\n                    LGAudio.disconnect(origin_audionode, target_audionode);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (node.outputs) {\r\n            for (var i = 0; i < node.outputs.length; ++i) {\r\n                var output = node.outputs[i];\r\n                for (var j = 0; j < output.links.length; ++j) {\r\n                    var link_info = node.graph.links[output.links[j]];\r\n                    if (!link_info) {\r\n                        continue;\r\n                    }\r\n\r\n                    var origin_audionode = null;\r\n                    if (node.getAudioNodeInOutputSlot) {\r\n                        origin_audionode = node.getAudioNodeInOutputSlot(i);\r\n                    } else {\r\n                        origin_audionode = node.audionode;\r\n                    }\r\n\r\n                    var target_node = node.graph.getNodeById(\r\n                        link_info.target_id\r\n                    );\r\n                    var target_audionode = null;\r\n                    if (target_node.getAudioNodeInInputSlot) {\r\n                        target_audionode = target_node.getAudioNodeInInputSlot(\r\n                            link_info.target_slot\r\n                        );\r\n                    } else {\r\n                        target_audionode = target_node.audionode;\r\n                    }\r\n\r\n                    if (connect) {\r\n                        LGAudio.connect(origin_audionode, target_audionode);\r\n                    } else {\r\n                        LGAudio.disconnect(origin_audionode, target_audionode);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    //used by many nodes\r\n    LGAudio.onConnectionsChange = function(\r\n        connection,\r\n        slot,\r\n        connected,\r\n        link_info\r\n    ) {\r\n        //only process the outputs events\r\n        if (connection != LiteGraph.OUTPUT) {\r\n            return;\r\n        }\r\n\r\n        var target_node = null;\r\n        if (link_info) {\r\n            target_node = this.graph.getNodeById(link_info.target_id);\r\n        }\r\n\r\n        if (!target_node) {\r\n            return;\r\n        }\r\n\r\n        //get origin audionode\r\n        var local_audionode = null;\r\n        if (this.getAudioNodeInOutputSlot) {\r\n            local_audionode = this.getAudioNodeInOutputSlot(slot);\r\n        } else {\r\n            local_audionode = this.audionode;\r\n        }\r\n\r\n        //get target audionode\r\n        var target_audionode = null;\r\n        if (target_node.getAudioNodeInInputSlot) {\r\n            target_audionode = target_node.getAudioNodeInInputSlot(\r\n                link_info.target_slot\r\n            );\r\n        } else {\r\n            target_audionode = target_node.audionode;\r\n        }\r\n\r\n        //do the connection/disconnection\r\n        if (connected) {\r\n            LGAudio.connect(local_audionode, target_audionode);\r\n        } else {\r\n            LGAudio.disconnect(local_audionode, target_audionode);\r\n        }\r\n    };\r\n\r\n    //this function helps creating wrappers to existing classes\r\n    LGAudio.createAudioNodeWrapper = function(class_object) {\r\n        var old_func = class_object.prototype.onPropertyChanged;\r\n\r\n        class_object.prototype.onPropertyChanged = function(name, value) {\r\n            if (old_func) {\r\n                old_func.call(this, name, value);\r\n            }\r\n\r\n            if (!this.audionode) {\r\n                return;\r\n            }\r\n\r\n            if (this.audionode[name] === undefined) {\r\n                return;\r\n            }\r\n\r\n            if (this.audionode[name].value !== undefined) {\r\n                this.audionode[name].value = value;\r\n            } else {\r\n                this.audionode[name] = value;\r\n            }\r\n        };\r\n\r\n        class_object.prototype.onConnectionsChange =\r\n            LGAudio.onConnectionsChange;\r\n    };\r\n\r\n    //contains the samples decoded of the loaded audios in AudioBuffer format\r\n    LGAudio.cached_audios = {};\r\n\r\n    LGAudio.loadSound = function(url, on_complete, on_error) {\r\n        if (LGAudio.cached_audios[url] && url.indexOf(\"blob:\") == -1) {\r\n            if (on_complete) {\r\n                on_complete(LGAudio.cached_audios[url]);\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (LGAudio.onProcessAudioURL) {\r\n            url = LGAudio.onProcessAudioURL(url);\r\n        }\r\n\r\n        //load new sample\r\n        var request = new XMLHttpRequest();\r\n        request.open(\"GET\", url, true);\r\n        request.responseType = \"arraybuffer\";\r\n\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        // Decode asynchronously\r\n        request.onload = function() {\r\n            console.log(\"AudioSource loaded\");\r\n            context.decodeAudioData(\r\n                request.response,\r\n                function(buffer) {\r\n                    console.log(\"AudioSource decoded\");\r\n                    LGAudio.cached_audios[url] = buffer;\r\n                    if (on_complete) {\r\n                        on_complete(buffer);\r\n                    }\r\n                },\r\n                onError\r\n            );\r\n        };\r\n        request.send();\r\n\r\n        function onError(err) {\r\n            console.log(\"Audio loading sample error:\", err);\r\n            if (on_error) {\r\n                on_error(err);\r\n            }\r\n        }\r\n\r\n        return request;\r\n    };\r\n\r\n    //****************************************************\r\n\r\n    function LGAudioSource() {\r\n        this.properties = {\r\n            src: \"\",\r\n            gain: 0.5,\r\n            loop: true,\r\n            autoplay: true,\r\n            playbackRate: 1\r\n        };\r\n\r\n        this._loading_audio = false;\r\n        this._audiobuffer = null; //points to AudioBuffer with the audio samples decoded\r\n        this._audionodes = [];\r\n        this._last_sourcenode = null; //the last AudioBufferSourceNode (there could be more if there are several sounds playing)\r\n\r\n        this.addOutput(\"out\", \"audio\");\r\n        this.addInput(\"gain\", \"number\");\r\n\r\n        //init context\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        //create gain node to control volume\r\n        this.audionode = context.createGain();\r\n        this.audionode.graphnode = this;\r\n        this.audionode.gain.value = this.properties.gain;\r\n\r\n        //debug\r\n        if (this.properties.src) {\r\n            this.loadSound(this.properties.src);\r\n        }\r\n    }\r\n\r\n\tLGAudioSource.desc = \"Plays an audio file\";\r\n    LGAudioSource[\"@src\"] = { widget: \"resource\" };\r\n    LGAudioSource.supported_extensions = [\"wav\", \"ogg\", \"mp3\"];\r\n\r\n    LGAudioSource.prototype.onAdded = function(graph) {\r\n        if (graph.status === LGraph.STATUS_RUNNING) {\r\n            this.onStart();\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onStart = function() {\r\n        if (!this._audiobuffer) {\r\n            return;\r\n        }\r\n\r\n        if (this.properties.autoplay) {\r\n\t\t\tthis.playBuffer(this._audiobuffer);\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onStop = function() {\r\n        this.stopAllSounds();\r\n    };\r\n\r\n    LGAudioSource.prototype.onPause = function() {\r\n        this.pauseAllSounds();\r\n    };\r\n\r\n    LGAudioSource.prototype.onUnpause = function() {\r\n        this.unpauseAllSounds();\r\n        //this.onStart();\r\n    };\r\n\r\n    LGAudioSource.prototype.onRemoved = function() {\r\n        this.stopAllSounds();\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._url);\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.stopAllSounds = function() {\r\n        //iterate and stop\r\n        for (var i = 0; i < this._audionodes.length; ++i) {\r\n            if (this._audionodes[i].started) {\r\n                this._audionodes[i].started = false;\r\n                this._audionodes[i].stop();\r\n            }\r\n            //this._audionodes[i].disconnect( this.audionode );\r\n        }\r\n        this._audionodes.length = 0;\r\n    };\r\n\r\n    LGAudioSource.prototype.pauseAllSounds = function() {\r\n        LGAudio.getAudioContext().suspend();\r\n    };\r\n\r\n    LGAudioSource.prototype.unpauseAllSounds = function() {\r\n        LGAudio.getAudioContext().resume();\r\n    };\r\n\r\n    LGAudioSource.prototype.onExecute = function() {\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; ++i) {\r\n                var input = this.inputs[i];\r\n                if (input.link == null) {\r\n                    continue;\r\n                }\r\n                var v = this.getInputData(i);\r\n                if (v === undefined) {\r\n                    continue;\r\n                }\r\n                if (input.name == \"gain\")\r\n                    this.audionode.gain.value = v;\r\n                else if (input.name == \"src\") {\r\n                    this.setProperty(\"src\",v);\r\n                } else if (input.name == \"playbackRate\") {\r\n                    this.properties.playbackRate = v;\r\n                    for (var j = 0; j < this._audionodes.length; ++j) {\r\n                        this._audionodes[j].playbackRate.value = v;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n                var output = this.outputs[i];\r\n                if (output.name == \"buffer\" && this._audiobuffer) {\r\n                    this.setOutputData(i, this._audiobuffer);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onAction = function(event) {\r\n        if (this._audiobuffer) {\r\n            if (event == \"Play\") {\r\n                this.playBuffer(this._audiobuffer);\r\n            } else if (event == \"Stop\") {\r\n                this.stopAllSounds();\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"src\") {\r\n            this.loadSound(value);\r\n        } else if (name == \"gain\") {\r\n            this.audionode.gain.value = value;\r\n        } else if (name == \"playbackRate\") {\r\n            for (var j = 0; j < this._audionodes.length; ++j) {\r\n                this._audionodes[j].playbackRate.value = value;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.playBuffer = function(buffer) {\r\n        var that = this;\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        //create a new audionode (this is mandatory, AudioAPI doesnt like to reuse old ones)\r\n        var audionode = context.createBufferSource(); //create a AudioBufferSourceNode\r\n        this._last_sourcenode = audionode;\r\n        audionode.graphnode = this;\r\n        audionode.buffer = buffer;\r\n        audionode.loop = this.properties.loop;\r\n        audionode.playbackRate.value = this.properties.playbackRate;\r\n        this._audionodes.push(audionode);\r\n        audionode.connect(this.audionode); //connect to gain\r\n\r\n\t\tthis._audionodes.push(audionode);\r\n\r\n\t\tthis.trigger(\"start\");\r\n\r\n        audionode.onended = function() {\r\n            //console.log(\"ended!\");\r\n            that.trigger(\"ended\");\r\n            //remove\r\n            var index = that._audionodes.indexOf(audionode);\r\n            if (index != -1) {\r\n                that._audionodes.splice(index, 1);\r\n            }\r\n        };\r\n\r\n        if (!audionode.started) {\r\n            audionode.started = true;\r\n            audionode.start();\r\n        }\r\n        return audionode;\r\n    };\r\n\r\n    LGAudioSource.prototype.loadSound = function(url) {\r\n        var that = this;\r\n\r\n        //kill previous load\r\n        if (this._request) {\r\n            this._request.abort();\r\n            this._request = null;\r\n        }\r\n\r\n        this._audiobuffer = null; //points to the audiobuffer once the audio is loaded\r\n        this._loading_audio = false;\r\n\r\n        if (!url) {\r\n            return;\r\n        }\r\n\r\n        this._request = LGAudio.loadSound(url, inner);\r\n\r\n        this._loading_audio = true;\r\n        this.boxcolor = \"#AA4\";\r\n\r\n        function inner(buffer) {\r\n            this.boxcolor = LiteGraph.NODE_DEFAULT_BOXCOLOR;\r\n            that._audiobuffer = buffer;\r\n            that._loading_audio = false;\r\n            //if is playing, then play it\r\n            if (that.graph && that.graph.status === LGraph.STATUS_RUNNING) {\r\n                that.onStart();\r\n            } //this controls the autoplay already\r\n        }\r\n    };\r\n\r\n    //Helps connect/disconnect AudioNodes when new connections are made in the node\r\n    LGAudioSource.prototype.onConnectionsChange = LGAudio.onConnectionsChange;\r\n\r\n    LGAudioSource.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"playbackRate\", \"number\"],\r\n\t\t\t[\"src\",\"string\"],\r\n            [\"Play\", LiteGraph.ACTION],\r\n            [\"Stop\", LiteGraph.ACTION]\r\n        ];\r\n    };\r\n\r\n    LGAudioSource.prototype.onGetOutputs = function() {\r\n        return [[\"buffer\", \"audiobuffer\"], [\"start\", LiteGraph.EVENT], [\"ended\", LiteGraph.EVENT]];\r\n    };\r\n\r\n    LGAudioSource.prototype.onDropFile = function(file) {\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._dropped_url);\r\n        }\r\n        var url = URL.createObjectURL(file);\r\n        this.properties.src = url;\r\n        this.loadSound(url);\r\n        this._dropped_url = url;\r\n    };\r\n\r\n    LGAudioSource.title = \"Source\";\r\n    LGAudioSource.desc = \"Plays audio\";\r\n    LiteGraph.registerNodeType(\"audio/source\", LGAudioSource);\r\n\r\n    //****************************************************\r\n\r\n    function LGAudioMediaSource() {\r\n        this.properties = {\r\n            gain: 0.5\r\n        };\r\n\r\n        this._audionodes = [];\r\n        this._media_stream = null;\r\n\r\n        this.addOutput(\"out\", \"audio\");\r\n        this.addInput(\"gain\", \"number\");\r\n\r\n        //create gain node to control volume\r\n        var context = LGAudio.getAudioContext();\r\n        this.audionode = context.createGain();\r\n        this.audionode.graphnode = this;\r\n        this.audionode.gain.value = this.properties.gain;\r\n    }\r\n\r\n    LGAudioMediaSource.prototype.onAdded = function(graph) {\r\n        if (graph.status === LGraph.STATUS_RUNNING) {\r\n            this.onStart();\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onStart = function() {\r\n        if (this._media_stream == null && !this._waiting_confirmation) {\r\n            this.openStream();\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onStop = function() {\r\n        this.audionode.gain.value = 0;\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onPause = function() {\r\n        this.audionode.gain.value = 0;\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onUnpause = function() {\r\n        this.audionode.gain.value = this.properties.gain;\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onRemoved = function() {\r\n        this.audionode.gain.value = 0;\r\n        if (this.audiosource_node) {\r\n            this.audiosource_node.disconnect(this.audionode);\r\n            this.audiosource_node = null;\r\n        }\r\n        if (this._media_stream) {\r\n            var tracks = this._media_stream.getTracks();\r\n            if (tracks.length) {\r\n                tracks[0].stop();\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.openStream = function() {\r\n        if (!navigator.mediaDevices) {\r\n            console.log(\r\n                \"getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags\"\r\n            );\r\n            return;\r\n        }\r\n\r\n        this._waiting_confirmation = true;\r\n\r\n        // Not showing vendor prefixes.\r\n        navigator.mediaDevices\r\n            .getUserMedia({ audio: true, video: false })\r\n            .then(this.streamReady.bind(this))\r\n            .catch(onFailSoHard);\r\n\r\n        var that = this;\r\n        function onFailSoHard(err) {\r\n            console.log(\"Media rejected\", err);\r\n            that._media_stream = false;\r\n            that.boxcolor = \"red\";\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.streamReady = function(localMediaStream) {\r\n        this._media_stream = localMediaStream;\r\n        //this._waiting_confirmation = false;\r\n\r\n        //init context\r\n        if (this.audiosource_node) {\r\n            this.audiosource_node.disconnect(this.audionode);\r\n        }\r\n        var context = LGAudio.getAudioContext();\r\n        this.audiosource_node = context.createMediaStreamSource(\r\n            localMediaStream\r\n        );\r\n        this.audiosource_node.graphnode = this;\r\n        this.audiosource_node.connect(this.audionode);\r\n        this.boxcolor = \"white\";\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onExecute = function() {\r\n        if (this._media_stream == null && !this._waiting_confirmation) {\r\n            this.openStream();\r\n        }\r\n\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; ++i) {\r\n                var input = this.inputs[i];\r\n                if (input.link == null) {\r\n                    continue;\r\n                }\r\n                var v = this.getInputData(i);\r\n                if (v === undefined) {\r\n                    continue;\r\n                }\r\n                if (input.name == \"gain\") {\r\n                    this.audionode.gain.value = this.properties.gain = v;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onAction = function(event) {\r\n        if (event == \"Play\") {\r\n            this.audionode.gain.value = this.properties.gain;\r\n        } else if (event == \"Stop\") {\r\n            this.audionode.gain.value = 0;\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"gain\") {\r\n            this.audionode.gain.value = value;\r\n        }\r\n    };\r\n\r\n    //Helps connect/disconnect AudioNodes when new connections are made in the node\r\n    LGAudioMediaSource.prototype.onConnectionsChange =\r\n        LGAudio.onConnectionsChange;\r\n\r\n    LGAudioMediaSource.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"playbackRate\", \"number\"],\r\n            [\"Play\", LiteGraph.ACTION],\r\n            [\"Stop\", LiteGraph.ACTION]\r\n        ];\r\n    };\r\n\r\n    LGAudioMediaSource.title = \"MediaSource\";\r\n    LGAudioMediaSource.desc = \"Plays microphone\";\r\n    LiteGraph.registerNodeType(\"audio/media_source\", LGAudioMediaSource);\r\n\r\n    //*****************************************************\r\n\r\n    function LGAudioAnalyser() {\r\n        this.properties = {\r\n            fftSize: 2048,\r\n            minDecibels: -100,\r\n            maxDecibels: -10,\r\n            smoothingTimeConstant: 0.5\r\n        };\r\n\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        this.audionode = context.createAnalyser();\r\n        this.audionode.graphnode = this;\r\n        this.audionode.fftSize = this.properties.fftSize;\r\n        this.audionode.minDecibels = this.properties.minDecibels;\r\n        this.audionode.maxDecibels = this.properties.maxDecibels;\r\n        this.audionode.smoothingTimeConstant = this.properties.smoothingTimeConstant;\r\n\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"freqs\", \"array\");\r\n        this.addOutput(\"samples\", \"array\");\r\n\r\n        this._freq_bin = null;\r\n        this._time_bin = null;\r\n    }\r\n\r\n    LGAudioAnalyser.prototype.onPropertyChanged = function(name, value) {\r\n        this.audionode[name] = value;\r\n    };\r\n\r\n    LGAudioAnalyser.prototype.onExecute = function() {\r\n        if (this.isOutputConnected(0)) {\r\n            //send FFT\r\n            var bufferLength = this.audionode.frequencyBinCount;\r\n            if (!this._freq_bin || this._freq_bin.length != bufferLength) {\r\n                this._freq_bin = new Uint8Array(bufferLength);\r\n            }\r\n            this.audionode.getByteFrequencyData(this._freq_bin);\r\n            this.setOutputData(0, this._freq_bin);\r\n        }\r\n\r\n        //send analyzer\r\n        if (this.isOutputConnected(1)) {\r\n            //send Samples\r\n            var bufferLength = this.audionode.frequencyBinCount;\r\n            if (!this._time_bin || this._time_bin.length != bufferLength) {\r\n                this._time_bin = new Uint8Array(bufferLength);\r\n            }\r\n            this.audionode.getByteTimeDomainData(this._time_bin);\r\n            this.setOutputData(1, this._time_bin);\r\n        }\r\n\r\n        //properties\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n\r\n        //time domain\r\n        //this.audionode.getFloatTimeDomainData( dataArray );\r\n    };\r\n\r\n    LGAudioAnalyser.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"minDecibels\", \"number\"],\r\n            [\"maxDecibels\", \"number\"],\r\n            [\"smoothingTimeConstant\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LGAudioAnalyser.prototype.onGetOutputs = function() {\r\n        return [[\"freqs\", \"array\"], [\"samples\", \"array\"]];\r\n    };\r\n\r\n    LGAudioAnalyser.title = \"Analyser\";\r\n    LGAudioAnalyser.desc = \"Audio Analyser\";\r\n    LiteGraph.registerNodeType(\"audio/analyser\", LGAudioAnalyser);\r\n\r\n    //*****************************************************\r\n\r\n    function LGAudioGain() {\r\n        //default\r\n        this.properties = {\r\n            gain: 1\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createGain();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"gain\", \"number\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioGain.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioGain);\r\n\r\n    LGAudioGain.title = \"Gain\";\r\n    LGAudioGain.desc = \"Audio gain\";\r\n    LiteGraph.registerNodeType(\"audio/gain\", LGAudioGain);\r\n\r\n    function LGAudioConvolver() {\r\n        //default\r\n        this.properties = {\r\n            impulse_src: \"\",\r\n            normalize: true\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createConvolver();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioConvolver);\r\n\r\n    LGAudioConvolver.prototype.onRemove = function() {\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._dropped_url);\r\n        }\r\n    };\r\n\r\n    LGAudioConvolver.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"impulse_src\") {\r\n            this.loadImpulse(value);\r\n        } else if (name == \"normalize\") {\r\n            this.audionode.normalize = value;\r\n        }\r\n    };\r\n\r\n    LGAudioConvolver.prototype.onDropFile = function(file) {\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._dropped_url);\r\n        }\r\n        this._dropped_url = URL.createObjectURL(file);\r\n        this.properties.impulse_src = this._dropped_url;\r\n        this.loadImpulse(this._dropped_url);\r\n    };\r\n\r\n    LGAudioConvolver.prototype.loadImpulse = function(url) {\r\n        var that = this;\r\n\r\n        //kill previous load\r\n        if (this._request) {\r\n            this._request.abort();\r\n            this._request = null;\r\n        }\r\n\r\n        this._impulse_buffer = null;\r\n        this._loading_impulse = false;\r\n\r\n        if (!url) {\r\n            return;\r\n        }\r\n\r\n        //load new sample\r\n        this._request = LGAudio.loadSound(url, inner);\r\n        this._loading_impulse = true;\r\n\r\n        // Decode asynchronously\r\n        function inner(buffer) {\r\n            that._impulse_buffer = buffer;\r\n            that.audionode.buffer = buffer;\r\n            console.log(\"Impulse signal set\");\r\n            that._loading_impulse = false;\r\n        }\r\n    };\r\n\r\n    LGAudioConvolver.title = \"Convolver\";\r\n    LGAudioConvolver.desc = \"Convolves the signal (used for reverb)\";\r\n    LiteGraph.registerNodeType(\"audio/convolver\", LGAudioConvolver);\r\n\r\n    function LGAudioDynamicsCompressor() {\r\n        //default\r\n        this.properties = {\r\n            threshold: -50,\r\n            knee: 40,\r\n            ratio: 12,\r\n            reduction: -20,\r\n            attack: 0,\r\n            release: 0.25\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createDynamicsCompressor();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioDynamicsCompressor);\r\n\r\n    LGAudioDynamicsCompressor.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioDynamicsCompressor.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"threshold\", \"number\"],\r\n            [\"knee\", \"number\"],\r\n            [\"ratio\", \"number\"],\r\n            [\"reduction\", \"number\"],\r\n            [\"attack\", \"number\"],\r\n            [\"release\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LGAudioDynamicsCompressor.title = \"DynamicsCompressor\";\r\n    LGAudioDynamicsCompressor.desc = \"Dynamics Compressor\";\r\n    LiteGraph.registerNodeType(\r\n        \"audio/dynamicsCompressor\",\r\n        LGAudioDynamicsCompressor\r\n    );\r\n\r\n    function LGAudioWaveShaper() {\r\n        //default\r\n        this.properties = {};\r\n\r\n        this.audionode = LGAudio.getAudioContext().createWaveShaper();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"shape\", \"waveshape\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioWaveShaper.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n        var v = this.getInputData(1);\r\n        if (v === undefined) {\r\n            return;\r\n        }\r\n        this.audionode.curve = v;\r\n    };\r\n\r\n    LGAudioWaveShaper.prototype.setWaveShape = function(shape) {\r\n        this.audionode.curve = shape;\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioWaveShaper);\r\n\r\n    /* disabled till I dont find a way to do a wave shape\r\nLGAudioWaveShaper.title = \"WaveShaper\";\r\nLGAudioWaveShaper.desc = \"Distortion using wave shape\";\r\nLiteGraph.registerNodeType(\"audio/waveShaper\", LGAudioWaveShaper);\r\n*/\r\n\r\n    function LGAudioMixer() {\r\n        //default\r\n        this.properties = {\r\n            gain1: 0.5,\r\n            gain2: 0.5\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createGain();\r\n\r\n        this.audionode1 = LGAudio.getAudioContext().createGain();\r\n        this.audionode1.gain.value = this.properties.gain1;\r\n        this.audionode2 = LGAudio.getAudioContext().createGain();\r\n        this.audionode2.gain.value = this.properties.gain2;\r\n\r\n        this.audionode1.connect(this.audionode);\r\n        this.audionode2.connect(this.audionode);\r\n\r\n        this.addInput(\"in1\", \"audio\");\r\n        this.addInput(\"in1 gain\", \"number\");\r\n        this.addInput(\"in2\", \"audio\");\r\n        this.addInput(\"in2 gain\", \"number\");\r\n\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioMixer.prototype.getAudioNodeInInputSlot = function(slot) {\r\n        if (slot == 0) {\r\n            return this.audionode1;\r\n        } else if (slot == 2) {\r\n            return this.audionode2;\r\n        }\r\n    };\r\n\r\n    LGAudioMixer.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"gain1\") {\r\n            this.audionode1.gain.value = value;\r\n        } else if (name == \"gain2\") {\r\n            this.audionode2.gain.value = value;\r\n        }\r\n    };\r\n\r\n    LGAudioMixer.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n\r\n            if (input.link == null || input.type == \"audio\") {\r\n                continue;\r\n            }\r\n\r\n            var v = this.getInputData(i);\r\n            if (v === undefined) {\r\n                continue;\r\n            }\r\n\r\n            if (i == 1) {\r\n                this.audionode1.gain.value = v;\r\n            } else if (i == 3) {\r\n                this.audionode2.gain.value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioMixer);\r\n\r\n    LGAudioMixer.title = \"Mixer\";\r\n    LGAudioMixer.desc = \"Audio mixer\";\r\n    LiteGraph.registerNodeType(\"audio/mixer\", LGAudioMixer);\r\n\r\n    function LGAudioADSR() {\r\n        //default\r\n        this.properties = {\r\n            A: 0.1,\r\n            D: 0.1,\r\n            S: 0.1,\r\n            R: 0.1\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createGain();\r\n        this.audionode.gain.value = 0;\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"gate\", \"boolean\");\r\n        this.addOutput(\"out\", \"audio\");\r\n        this.gate = false;\r\n    }\r\n\r\n    LGAudioADSR.prototype.onExecute = function() {\r\n        var audioContext = LGAudio.getAudioContext();\r\n        var now = audioContext.currentTime;\r\n        var node = this.audionode;\r\n        var gain = node.gain;\r\n        var current_gate = this.getInputData(1);\r\n\r\n        var A = this.getInputOrProperty(\"A\");\r\n        var D = this.getInputOrProperty(\"D\");\r\n        var S = this.getInputOrProperty(\"S\");\r\n        var R = this.getInputOrProperty(\"R\");\r\n\r\n        if (!this.gate && current_gate) {\r\n            gain.cancelScheduledValues(0);\r\n            gain.setValueAtTime(0, now);\r\n            gain.linearRampToValueAtTime(1, now + A);\r\n            gain.linearRampToValueAtTime(S, now + A + D);\r\n        } else if (this.gate && !current_gate) {\r\n            gain.cancelScheduledValues(0);\r\n            gain.setValueAtTime(gain.value, now);\r\n            gain.linearRampToValueAtTime(0, now + R);\r\n        }\r\n\r\n        this.gate = current_gate;\r\n    };\r\n\r\n    LGAudioADSR.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"A\", \"number\"],\r\n            [\"D\", \"number\"],\r\n            [\"S\", \"number\"],\r\n            [\"R\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioADSR);\r\n\r\n    LGAudioADSR.title = \"ADSR\";\r\n    LGAudioADSR.desc = \"Audio envelope\";\r\n    LiteGraph.registerNodeType(\"audio/adsr\", LGAudioADSR);\r\n\r\n    function LGAudioDelay() {\r\n        //default\r\n        this.properties = {\r\n            delayTime: 0.5\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createDelay(10);\r\n        this.audionode.delayTime.value = this.properties.delayTime;\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"time\", \"number\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioDelay);\r\n\r\n    LGAudioDelay.prototype.onExecute = function() {\r\n        var v = this.getInputData(1);\r\n        if (v !== undefined) {\r\n            this.audionode.delayTime.value = v;\r\n        }\r\n    };\r\n\r\n    LGAudioDelay.title = \"Delay\";\r\n    LGAudioDelay.desc = \"Audio delay\";\r\n    LiteGraph.registerNodeType(\"audio/delay\", LGAudioDelay);\r\n\r\n    function LGAudioBiquadFilter() {\r\n        //default\r\n        this.properties = {\r\n            frequency: 350,\r\n            detune: 0,\r\n            Q: 1\r\n        };\r\n        this.addProperty(\"type\", \"lowpass\", \"enum\", {\r\n            values: [\r\n                \"lowpass\",\r\n                \"highpass\",\r\n                \"bandpass\",\r\n                \"lowshelf\",\r\n                \"highshelf\",\r\n                \"peaking\",\r\n                \"notch\",\r\n                \"allpass\"\r\n            ]\r\n        });\r\n\r\n        //create node\r\n        this.audionode = LGAudio.getAudioContext().createBiquadFilter();\r\n\r\n        //slots\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioBiquadFilter.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioBiquadFilter.prototype.onGetInputs = function() {\r\n        return [[\"frequency\", \"number\"], [\"detune\", \"number\"], [\"Q\", \"number\"]];\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioBiquadFilter);\r\n\r\n    LGAudioBiquadFilter.title = \"BiquadFilter\";\r\n    LGAudioBiquadFilter.desc = \"Audio filter\";\r\n    LiteGraph.registerNodeType(\"audio/biquadfilter\", LGAudioBiquadFilter);\r\n\r\n    function LGAudioOscillatorNode() {\r\n        //default\r\n        this.properties = {\r\n            frequency: 440,\r\n            detune: 0,\r\n            type: \"sine\"\r\n        };\r\n        this.addProperty(\"type\", \"sine\", \"enum\", {\r\n            values: [\"sine\", \"square\", \"sawtooth\", \"triangle\", \"custom\"]\r\n        });\r\n\r\n        //create node\r\n        this.audionode = LGAudio.getAudioContext().createOscillator();\r\n\r\n        //slots\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioOscillatorNode.prototype.onStart = function() {\r\n        if (!this.audionode.started) {\r\n            this.audionode.started = true;\r\n            try {\r\n                this.audionode.start();\r\n            } catch (err) {}\r\n        }\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onStop = function() {\r\n        if (this.audionode.started) {\r\n            this.audionode.started = false;\r\n            this.audionode.stop();\r\n        }\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onPause = function() {\r\n        this.onStop();\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onUnpause = function() {\r\n        this.onStart();\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 0; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"frequency\", \"number\"],\r\n            [\"detune\", \"number\"],\r\n            [\"type\", \"string\"]\r\n        ];\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioOscillatorNode);\r\n\r\n    LGAudioOscillatorNode.title = \"Oscillator\";\r\n    LGAudioOscillatorNode.desc = \"Oscillator\";\r\n    LiteGraph.registerNodeType(\"audio/oscillator\", LGAudioOscillatorNode);\r\n\r\n    //*****************************************************\r\n\r\n    //EXTRA\r\n\r\n    function LGAudioVisualization() {\r\n        this.properties = {\r\n            continuous: true,\r\n            mark: -1\r\n        };\r\n\r\n        this.addInput(\"data\", \"array\");\r\n        this.addInput(\"mark\", \"number\");\r\n        this.size = [300, 200];\r\n        this._last_buffer = null;\r\n    }\r\n\r\n    LGAudioVisualization.prototype.onExecute = function() {\r\n        this._last_buffer = this.getInputData(0);\r\n        var v = this.getInputData(1);\r\n        if (v !== undefined) {\r\n            this.properties.mark = v;\r\n        }\r\n        this.setDirtyCanvas(true, false);\r\n    };\r\n\r\n    LGAudioVisualization.prototype.onDrawForeground = function(ctx) {\r\n        if (!this._last_buffer) {\r\n            return;\r\n        }\r\n\r\n        var buffer = this._last_buffer;\r\n\r\n        //delta represents how many samples we advance per pixel\r\n        var delta = buffer.length / this.size[0];\r\n        var h = this.size[1];\r\n\r\n        ctx.fillStyle = \"black\";\r\n        ctx.fillRect(0, 0, this.size[0], this.size[1]);\r\n        ctx.strokeStyle = \"white\";\r\n        ctx.beginPath();\r\n        var x = 0;\r\n\r\n        if (this.properties.continuous) {\r\n            ctx.moveTo(x, h);\r\n            for (var i = 0; i < buffer.length; i += delta) {\r\n                ctx.lineTo(x, h - (buffer[i | 0] / 255) * h);\r\n                x++;\r\n            }\r\n        } else {\r\n            for (var i = 0; i < buffer.length; i += delta) {\r\n                ctx.moveTo(x + 0.5, h);\r\n                ctx.lineTo(x + 0.5, h - (buffer[i | 0] / 255) * h);\r\n                x++;\r\n            }\r\n        }\r\n        ctx.stroke();\r\n\r\n        if (this.properties.mark >= 0) {\r\n            var samplerate = LGAudio.getAudioContext().sampleRate;\r\n            var binfreq = samplerate / buffer.length;\r\n            var x = (2 * (this.properties.mark / binfreq)) / delta;\r\n            if (x >= this.size[0]) {\r\n                x = this.size[0] - 1;\r\n            }\r\n            ctx.strokeStyle = \"red\";\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, h);\r\n            ctx.lineTo(x, 0);\r\n            ctx.stroke();\r\n        }\r\n    };\r\n\r\n    LGAudioVisualization.title = \"Visualization\";\r\n    LGAudioVisualization.desc = \"Audio Visualization\";\r\n    LiteGraph.registerNodeType(\"audio/visualization\", LGAudioVisualization);\r\n\r\n    function LGAudioBandSignal() {\r\n        //default\r\n        this.properties = {\r\n            band: 440,\r\n            amplitude: 1\r\n        };\r\n\r\n        this.addInput(\"freqs\", \"array\");\r\n        this.addOutput(\"signal\", \"number\");\r\n    }\r\n\r\n    LGAudioBandSignal.prototype.onExecute = function() {\r\n        this._freqs = this.getInputData(0);\r\n        if (!this._freqs) {\r\n            return;\r\n        }\r\n\r\n        var band = this.properties.band;\r\n        var v = this.getInputData(1);\r\n        if (v !== undefined) {\r\n            band = v;\r\n        }\r\n\r\n        var samplerate = LGAudio.getAudioContext().sampleRate;\r\n        var binfreq = samplerate / this._freqs.length;\r\n        var index = 2 * (band / binfreq);\r\n        var v = 0;\r\n        if (index < 0) {\r\n            v = this._freqs[0];\r\n        }\r\n        if (index >= this._freqs.length) {\r\n            v = this._freqs[this._freqs.length - 1];\r\n        } else {\r\n            var pos = index | 0;\r\n            var v0 = this._freqs[pos];\r\n            var v1 = this._freqs[pos + 1];\r\n            var f = index - pos;\r\n            v = v0 * (1 - f) + v1 * f;\r\n        }\r\n\r\n        this.setOutputData(0, (v / 255) * this.properties.amplitude);\r\n    };\r\n\r\n    LGAudioBandSignal.prototype.onGetInputs = function() {\r\n        return [[\"band\", \"number\"]];\r\n    };\r\n\r\n    LGAudioBandSignal.title = \"Signal\";\r\n    LGAudioBandSignal.desc = \"extract the signal of some frequency\";\r\n    LiteGraph.registerNodeType(\"audio/signal\", LGAudioBandSignal);\r\n\r\n    function LGAudioScript() {\r\n        if (!LGAudioScript.default_code) {\r\n            var code = LGAudioScript.default_function.toString();\r\n            var index = code.indexOf(\"{\") + 1;\r\n            var index2 = code.lastIndexOf(\"}\");\r\n            LGAudioScript.default_code = code.substr(index, index2 - index);\r\n        }\r\n\r\n        //default\r\n        this.properties = {\r\n            code: LGAudioScript.default_code\r\n        };\r\n\r\n        //create node\r\n        var ctx = LGAudio.getAudioContext();\r\n        if (ctx.createScriptProcessor) {\r\n            this.audionode = ctx.createScriptProcessor(4096, 1, 1);\r\n        }\r\n        //buffer size, input channels, output channels\r\n        else {\r\n            console.warn(\"ScriptProcessorNode deprecated\");\r\n            this.audionode = ctx.createGain(); //bypass audio\r\n        }\r\n\r\n        this.processCode();\r\n        if (!LGAudioScript._bypass_function) {\r\n            LGAudioScript._bypass_function = this.audionode.onaudioprocess;\r\n        }\r\n\r\n        //slots\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioScript.prototype.onAdded = function(graph) {\r\n        if (graph.status == LGraph.STATUS_RUNNING) {\r\n            this.audionode.onaudioprocess = this._callback;\r\n        }\r\n    };\r\n\r\n    LGAudioScript[\"@code\"] = { widget: \"code\", type: \"code\" };\r\n\r\n    LGAudioScript.prototype.onStart = function() {\r\n        this.audionode.onaudioprocess = this._callback;\r\n    };\r\n\r\n    LGAudioScript.prototype.onStop = function() {\r\n        this.audionode.onaudioprocess = LGAudioScript._bypass_function;\r\n    };\r\n\r\n    LGAudioScript.prototype.onPause = function() {\r\n        this.audionode.onaudioprocess = LGAudioScript._bypass_function;\r\n    };\r\n\r\n    LGAudioScript.prototype.onUnpause = function() {\r\n        this.audionode.onaudioprocess = this._callback;\r\n    };\r\n\r\n    LGAudioScript.prototype.onExecute = function() {\r\n        //nothing! because we need an onExecute to receive onStart... fix that\r\n    };\r\n\r\n    LGAudioScript.prototype.onRemoved = function() {\r\n        this.audionode.onaudioprocess = LGAudioScript._bypass_function;\r\n    };\r\n\r\n    LGAudioScript.prototype.processCode = function() {\r\n        try {\r\n            var func = new Function(\"properties\", this.properties.code);\r\n            this._script = new func(this.properties);\r\n            this._old_code = this.properties.code;\r\n            this._callback = this._script.onaudioprocess;\r\n        } catch (err) {\r\n            console.error(\"Error in onaudioprocess code\", err);\r\n            this._callback = LGAudioScript._bypass_function;\r\n            this.audionode.onaudioprocess = this._callback;\r\n        }\r\n    };\r\n\r\n    LGAudioScript.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"code\") {\r\n            this.properties.code = value;\r\n            this.processCode();\r\n            if (this.graph && this.graph.status == LGraph.STATUS_RUNNING) {\r\n                this.audionode.onaudioprocess = this._callback;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioScript.default_function = function() {\r\n        this.onaudioprocess = function(audioProcessingEvent) {\r\n            // The input buffer is the song we loaded earlier\r\n            var inputBuffer = audioProcessingEvent.inputBuffer;\r\n\r\n            // The output buffer contains the samples that will be modified and played\r\n            var outputBuffer = audioProcessingEvent.outputBuffer;\r\n\r\n            // Loop through the output channels (in this case there is only one)\r\n            for (\r\n                var channel = 0;\r\n                channel < outputBuffer.numberOfChannels;\r\n                channel++\r\n            ) {\r\n                var inputData = inputBuffer.getChannelData(channel);\r\n                var outputData = outputBuffer.getChannelData(channel);\r\n\r\n                // Loop through the 4096 samples\r\n                for (var sample = 0; sample < inputBuffer.length; sample++) {\r\n                    // make output equal to the same as the input\r\n                    outputData[sample] = inputData[sample];\r\n                }\r\n            }\r\n        };\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioScript);\r\n\r\n    LGAudioScript.title = \"Script\";\r\n    LGAudioScript.desc = \"apply script to signal\";\r\n    LiteGraph.registerNodeType(\"audio/script\", LGAudioScript);\r\n\r\n    function LGAudioDestination() {\r\n        this.audionode = LGAudio.getAudioContext().destination;\r\n        this.addInput(\"in\", \"audio\");\r\n    }\r\n\r\n    LGAudioDestination.title = \"Destination\";\r\n    LGAudioDestination.desc = \"Audio output\";\r\n    LiteGraph.registerNodeType(\"audio/destination\", LGAudioDestination);\r\n})(this);\r\n\n//event related nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    function LGWebSocket() {\r\n        this.size = [60, 20];\r\n        this.addInput(\"send\", LiteGraph.ACTION);\r\n        this.addOutput(\"received\", LiteGraph.EVENT);\r\n        this.addInput(\"in\", 0);\r\n        this.addOutput(\"out\", 0);\r\n        this.properties = {\r\n            url: \"\",\r\n            room: \"lgraph\", //allows to filter messages,\r\n            only_send_changes: true\r\n        };\r\n        this._ws = null;\r\n        this._last_sent_data = [];\r\n        this._last_received_data = [];\r\n    }\r\n\r\n    LGWebSocket.title = \"WebSocket\";\r\n    LGWebSocket.desc = \"Send data through a websocket\";\r\n\r\n    LGWebSocket.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"url\") {\r\n            this.connectSocket();\r\n        }\r\n    };\r\n\r\n    LGWebSocket.prototype.onExecute = function() {\r\n        if (!this._ws && this.properties.url) {\r\n            this.connectSocket();\r\n        }\r\n\r\n        if (!this._ws || this._ws.readyState != WebSocket.OPEN) {\r\n            return;\r\n        }\r\n\r\n        var room = this.properties.room;\r\n        var only_changes = this.properties.only_send_changes;\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var data = this.getInputData(i);\r\n            if (data == null) {\r\n                continue;\r\n            }\r\n            var json;\r\n            try {\r\n                json = JSON.stringify({\r\n                    type: 0,\r\n                    room: room,\r\n                    channel: i,\r\n                    data: data\r\n                });\r\n            } catch (err) {\r\n                continue;\r\n            }\r\n            if (only_changes && this._last_sent_data[i] == json) {\r\n                continue;\r\n            }\r\n\r\n            this._last_sent_data[i] = json;\r\n            this._ws.send(json);\r\n        }\r\n\r\n        for (var i = 1; i < this.outputs.length; ++i) {\r\n            this.setOutputData(i, this._last_received_data[i]);\r\n        }\r\n\r\n        if (this.boxcolor == \"#AFA\") {\r\n            this.boxcolor = \"#6C6\";\r\n        }\r\n    };\r\n\r\n    LGWebSocket.prototype.connectSocket = function() {\r\n        var that = this;\r\n        var url = this.properties.url;\r\n        if (url.substr(0, 2) != \"ws\") {\r\n            url = \"ws://\" + url;\r\n        }\r\n        this._ws = new WebSocket(url);\r\n        this._ws.onopen = function() {\r\n            console.log(\"ready\");\r\n            that.boxcolor = \"#6C6\";\r\n        };\r\n        this._ws.onmessage = function(e) {\r\n            that.boxcolor = \"#AFA\";\r\n            var data = JSON.parse(e.data);\r\n            if (data.room && data.room != that.properties.room) {\r\n                return;\r\n            }\r\n            if (data.type == 1) {\r\n                if (\r\n                    data.data.object_class &&\r\n                    LiteGraph[data.data.object_class]\r\n                ) {\r\n                    var obj = null;\r\n                    try {\r\n                        obj = new LiteGraph[data.data.object_class](data.data);\r\n                        that.triggerSlot(0, obj);\r\n                    } catch (err) {\r\n                        return;\r\n                    }\r\n                } else {\r\n                    that.triggerSlot(0, data.data);\r\n                }\r\n            } else {\r\n                that._last_received_data[data.channel || 0] = data.data;\r\n            }\r\n        };\r\n        this._ws.onerror = function(e) {\r\n            console.log(\"couldnt connect to websocket\");\r\n            that.boxcolor = \"#E88\";\r\n        };\r\n        this._ws.onclose = function(e) {\r\n            console.log(\"connection closed\");\r\n            that.boxcolor = \"#000\";\r\n        };\r\n    };\r\n\r\n    LGWebSocket.prototype.send = function(data) {\r\n        if (!this._ws || this._ws.readyState != WebSocket.OPEN) {\r\n            return;\r\n        }\r\n        this._ws.send(JSON.stringify({ type: 1, msg: data }));\r\n    };\r\n\r\n    LGWebSocket.prototype.onAction = function(action, param) {\r\n        if (!this._ws || this._ws.readyState != WebSocket.OPEN) {\r\n            return;\r\n        }\r\n        this._ws.send({\r\n            type: 1,\r\n            room: this.properties.room,\r\n            action: action,\r\n            data: param\r\n        });\r\n    };\r\n\r\n    LGWebSocket.prototype.onGetInputs = function() {\r\n        return [[\"in\", 0]];\r\n    };\r\n\r\n    LGWebSocket.prototype.onGetOutputs = function() {\r\n        return [[\"out\", 0]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"network/websocket\", LGWebSocket);\r\n\r\n    //It is like a websocket but using the SillyServer.js server that bounces packets back to all clients connected:\r\n    //For more information: https://github.com/jagenjo/SillyServer.js\r\n\r\n    function LGSillyClient() {\r\n        //this.size = [60,20];\r\n        this.room_widget = this.addWidget(\r\n            \"text\",\r\n            \"Room\",\r\n            \"lgraph\",\r\n            this.setRoom.bind(this)\r\n        );\r\n        this.addWidget(\r\n            \"button\",\r\n            \"Reconnect\",\r\n            null,\r\n            this.connectSocket.bind(this)\r\n        );\r\n\r\n        this.addInput(\"send\", LiteGraph.ACTION);\r\n        this.addOutput(\"received\", LiteGraph.EVENT);\r\n        this.addInput(\"in\", 0);\r\n        this.addOutput(\"out\", 0);\r\n        this.properties = {\r\n            url: \"tamats.com:55000\",\r\n            room: \"lgraph\",\r\n            only_send_changes: true\r\n        };\r\n\r\n        this._server = null;\r\n        this.connectSocket();\r\n        this._last_sent_data = [];\r\n        this._last_received_data = [];\r\n\r\n\t\tif(typeof(SillyClient) == \"undefined\")\r\n\t\t\tconsole.warn(\"remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js\");\r\n    }\r\n\r\n    LGSillyClient.title = \"SillyClient\";\r\n    LGSillyClient.desc = \"Connects to SillyServer to broadcast messages\";\r\n\r\n    LGSillyClient.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"room\") {\r\n            this.room_widget.value = value;\r\n        }\r\n        this.connectSocket();\r\n    };\r\n\r\n    LGSillyClient.prototype.setRoom = function(room_name) {\r\n        this.properties.room = room_name;\r\n        this.room_widget.value = room_name;\r\n        this.connectSocket();\r\n    };\r\n\r\n    //force label names\r\n    LGSillyClient.prototype.onDrawForeground = function() {\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var slot = this.inputs[i];\r\n            slot.label = \"in_\" + i;\r\n        }\r\n        for (var i = 1; i < this.outputs.length; ++i) {\r\n            var slot = this.outputs[i];\r\n            slot.label = \"out_\" + i;\r\n        }\r\n    };\r\n\r\n    LGSillyClient.prototype.onExecute = function() {\r\n        if (!this._server || !this._server.is_connected) {\r\n            return;\r\n        }\r\n\r\n        var only_send_changes = this.properties.only_send_changes;\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var data = this.getInputData(i);\r\n\t\t\tvar prev_data = this._last_sent_data[i];\r\n            if (data != null) {\r\n                if (only_send_changes)\r\n\t\t\t\t{\t\r\n\t\t\t\t\tvar is_equal = true;\r\n\t\t\t\t\tif( data && data.length && prev_data && prev_data.length == data.length && data.constructor !== String)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor(var j = 0; j < data.length; ++j)\r\n\t\t\t\t\t\t\tif( prev_data[j] != data[j] )\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tis_equal = false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(this._last_sent_data[i] != data)\r\n\t\t\t\t\t\tis_equal = false;\r\n\t\t\t\t\tif(is_equal)\r\n\t\t\t\t\t\t\tcontinue;\r\n                }\r\n                this._server.sendMessage({ type: 0, channel: i, data: data });\r\n\t\t\t\tif( data.length && data.constructor !== String )\r\n\t\t\t\t{\r\n\t\t\t\t\tif( this._last_sent_data[i] )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis._last_sent_data[i].length = data.length;\r\n\t\t\t\t\t\tfor(var j = 0; j < data.length; ++j)\r\n\t\t\t\t\t\t\tthis._last_sent_data[i][j] = data[j];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse //create\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(data.constructor === Array)\r\n\t\t\t\t\t\t\tthis._last_sent_data[i] = data.concat();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tthis._last_sent_data[i] = new data.constructor( data );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t                this._last_sent_data[i] = data; //should be cloned\r\n            }\r\n        }\r\n\r\n        for (var i = 1; i < this.outputs.length; ++i) {\r\n            this.setOutputData(i, this._last_received_data[i]);\r\n        }\r\n\r\n        if (this.boxcolor == \"#AFA\") {\r\n            this.boxcolor = \"#6C6\";\r\n        }\r\n    };\r\n\r\n    LGSillyClient.prototype.connectSocket = function() {\r\n        var that = this;\r\n        if (typeof SillyClient == \"undefined\") {\r\n            if (!this._error) {\r\n                console.error(\r\n                    \"SillyClient node cannot be used, you must include SillyServer.js\"\r\n                );\r\n            }\r\n            this._error = true;\r\n            return;\r\n        }\r\n\r\n        this._server = new SillyClient();\r\n        this._server.on_ready = function() {\r\n            console.log(\"ready\");\r\n            that.boxcolor = \"#6C6\";\r\n        };\r\n        this._server.on_message = function(id, msg) {\r\n            var data = null;\r\n            try {\r\n                data = JSON.parse(msg);\r\n            } catch (err) {\r\n                return;\r\n            }\r\n\r\n            if (data.type == 1) {\r\n                //EVENT slot\r\n                if (\r\n                    data.data.object_class &&\r\n                    LiteGraph[data.data.object_class]\r\n                ) {\r\n                    var obj = null;\r\n                    try {\r\n                        obj = new LiteGraph[data.data.object_class](data.data);\r\n                        that.triggerSlot(0, obj);\r\n                    } catch (err) {\r\n                        return;\r\n                    }\r\n                } else {\r\n                    that.triggerSlot(0, data.data);\r\n                }\r\n            } //for FLOW slots\r\n            else {\r\n                that._last_received_data[data.channel || 0] = data.data;\r\n            }\r\n            that.boxcolor = \"#AFA\";\r\n        };\r\n        this._server.on_error = function(e) {\r\n            console.log(\"couldnt connect to websocket\");\r\n            that.boxcolor = \"#E88\";\r\n        };\r\n        this._server.on_close = function(e) {\r\n            console.log(\"connection closed\");\r\n            that.boxcolor = \"#000\";\r\n        };\r\n\r\n        if (this.properties.url && this.properties.room) {\r\n            try {\r\n                this._server.connect(this.properties.url, this.properties.room);\r\n            } catch (err) {\r\n                console.error(\"SillyServer error: \" + err);\r\n                this._server = null;\r\n                return;\r\n            }\r\n            this._final_url = this.properties.url + \"/\" + this.properties.room;\r\n        }\r\n    };\r\n\r\n    LGSillyClient.prototype.send = function(data) {\r\n        if (!this._server || !this._server.is_connected) {\r\n            return;\r\n        }\r\n        this._server.sendMessage({ type: 1, data: data });\r\n    };\r\n\r\n    LGSillyClient.prototype.onAction = function(action, param) {\r\n        if (!this._server || !this._server.is_connected) {\r\n            return;\r\n        }\r\n        this._server.sendMessage({ type: 1, action: action, data: param });\r\n    };\r\n\r\n    LGSillyClient.prototype.onGetInputs = function() {\r\n        return [[\"in\", 0]];\r\n    };\r\n\r\n    LGSillyClient.prototype.onGetOutputs = function() {\r\n        return [[\"out\", 0]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"network/sillyclient\", LGSillyClient);\r\n\r\n//HTTP Request\r\nfunction HTTPRequestNode() {\r\n\tvar that = this;\r\n\tthis.addInput(\"request\", LiteGraph.ACTION);\r\n\tthis.addInput(\"url\", \"string\");\r\n\tthis.addProperty(\"url\", \"\");\r\n\tthis.addOutput(\"ready\", LiteGraph.EVENT);\r\n    this.addOutput(\"data\", \"string\");\r\n\tthis.addWidget(\"button\", \"Fetch\", null, this.fetch.bind(this));\r\n\tthis._data = null;\r\n\tthis._fetching = null;\r\n}\r\n\r\nHTTPRequestNode.title = \"HTTP Request\";\r\nHTTPRequestNode.desc = \"Fetch data through HTTP\";\r\n\r\nHTTPRequestNode.prototype.fetch = function()\r\n{\r\n\tvar url = this.properties.url;\r\n\tif(!url)\r\n\t\treturn;\r\n\r\n\tthis.boxcolor = \"#FF0\";\r\n\tvar that = this;\r\n\tthis._fetching = fetch(url)\r\n\t.then(resp=>{\r\n\t\tif(!resp.ok)\r\n\t\t{\r\n\t\t\tthis.boxcolor = \"#F00\";\r\n\t\t\tthat.trigger(\"error\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.boxcolor = \"#0F0\";\r\n\t\t\treturn resp.text();\r\n\t\t}\r\n\t})\r\n\t.then(data=>{\r\n\t\tthat._data = data;\r\n\t\tthat._fetching = null;\r\n\t\tthat.trigger(\"ready\");\r\n\t});\r\n}\r\n\r\nHTTPRequestNode.prototype.onAction = function(evt)\r\n{\r\n\tif(evt == \"request\")\r\n\t\tthis.fetch();\r\n}\r\n\r\nHTTPRequestNode.prototype.onExecute = function() {\r\n\tthis.setOutputData(1, this._data);\r\n};\r\n\r\nHTTPRequestNode.prototype.onGetOutputs = function() {\r\n\treturn [[\"error\",LiteGraph.EVENT]];\r\n}\r\n\r\nLiteGraph.registerNodeType(\"network/httprequest\", HTTPRequestNode);\r\n\r\n\r\n\t\r\n})(this);\r\n\n"],
  "mappings": "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",
  "names": ["pos", "i", "v", "node", "that", "getTime", "on_frame", "x", "y", "index", "event", "w", "p", "text", "width", "ref_window", "document", "window", "delta", "cloned", "active_widget", "widget_width", "nvalue", "values", "inner_clicked", "value", "prev_menu", "menu", "e", "entries", "options", "inner_test_filter", "ctor", "name", "panel", "html", "elem", "color", "global", "LiteGraph", "Math3DQuaternion", "Math3DRotation", "MathEulerToQuat", "MathQuatToEuler", "Math3DRotateVec3", "Math3DMultQuat", "Math3DQuatSlerp", "Math3DRemapRange", "quat", "LGraphCanvas", "LGraphTexture", "temp", "tempA", "tempB", "distance", "index2", "valueToGLSL", "varToTypeGLSL", "convertVarToGLSLType", "old_value", "x2", "y2", "model_matrix", "LGraphFXLens", "LGraphFXBokeh", "LGraphFXGeneric", "LGraphFXVigneting", "now", "midi_event"]
}
